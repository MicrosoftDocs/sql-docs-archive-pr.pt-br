---
title: Analisar deadlocks com SQL Server Profiler | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: profiler
ms.topic: conceptual
helpviewer_keywords:
- process nodes [SQL Server Profiler]
- Profiler [SQL Server Profiler], deadlocks
- deadlocks [SQL Server], identifying cause
- resource nodes [SQL Server Profiler]
- graphs [SQL Server Profiler]
- SQL Server Profiler, deadlocks
- events [SQL Server], deadlocks
- edges [SQL Server Profiler]
ms.assetid: 72d6718f-501b-4ea6-b344-c0e653f19561
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3414cda74d75dbacf10ed98b6fc6d50da2feaa18
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87678423"
---
# <a name="analyze-deadlocks-with-sql-server-profiler"></a><span data-ttu-id="39e8c-102">Analisar deadlocks com o SQL Server Profiler</span><span class="sxs-lookup"><span data-stu-id="39e8c-102">Analyze Deadlocks with SQL Server Profiler</span></span>
  <span data-ttu-id="39e8c-103">Use o [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] para identificar a causa de um deadlock.</span><span class="sxs-lookup"><span data-stu-id="39e8c-103">Use [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to identify the cause of a deadlock.</span></span> <span data-ttu-id="39e8c-104">Um deadlock ocorre quando há uma dependência cíclica entre dois ou mais threads, ou processos, do mesmo conjunto de recursos dentro do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="39e8c-104">A deadlock occurs when there is a cyclic dependency between two or more threads, or processes, for some set of resources within SQL Server.</span></span> <span data-ttu-id="39e8c-105">Usando o [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], é possível criar um rastreamento que registra, reproduz e exibe eventos de deadlock para análise.</span><span class="sxs-lookup"><span data-stu-id="39e8c-105">Using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], you can create a trace that records, replays, and displays deadlock events for analysis.</span></span>  
  
 <span data-ttu-id="39e8c-106">Para rastrear eventos de deadlock, adicione a classe de evento **Deadlock graph** a um rastreamento.</span><span class="sxs-lookup"><span data-stu-id="39e8c-106">To trace deadlock events, add the **Deadlock graph** event class to a trace.</span></span> <span data-ttu-id="39e8c-107">Esta classe de evento popula a coluna de dados **TextData** no rastreamento com dados XML sobre o processo e objetos que estão envolvidos no deadlock.</span><span class="sxs-lookup"><span data-stu-id="39e8c-107">This event class populates the **TextData** data column in the trace with XML data about the process and objects that are involved in the deadlock.</span></span> [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="39e8c-108">pode extrair o documento XML para um arquivo XML de deadlock (.xdl) que pode ser exibido posteriormente no SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="39e8c-108">can extract the XML document to a deadlock XML (.xdl) file which you can view later in SQL Server Management Studio.</span></span> <span data-ttu-id="39e8c-109">Você pode configurar o [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] para extrair eventos **Deadlock graph** para um único arquivo contendo todos os eventos **Deadlock graph** ou para arquivos separados.</span><span class="sxs-lookup"><span data-stu-id="39e8c-109">You can configure [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to extract **Deadlock graph** events to a single file that contains all **Deadlock graph** events, or to separate files.</span></span> <span data-ttu-id="39e8c-110">Essa extração pode ser feita de qualquer uma destas formas:</span><span class="sxs-lookup"><span data-stu-id="39e8c-110">This extraction can be done in any of the following ways:</span></span>  
  
-   <span data-ttu-id="39e8c-111">No momento da configuração do rastreamento, usando a guia **Configurações de Extração de Eventos** . Observe que essa guia não será exibida a menos que você selecione o evento **Deadlock graph** na guia **Seleção de Eventos** .</span><span class="sxs-lookup"><span data-stu-id="39e8c-111">At trace configuration time, using the **Events Extraction Settings** tab. Note that this tab does not appear until you select the **Deadlock graph** event on the **Events Selection** tab.</span></span>  
  
-   <span data-ttu-id="39e8c-112">Usando a opção **Extrair Eventos do SQL Server** no menu **Arquivo** .</span><span class="sxs-lookup"><span data-stu-id="39e8c-112">Using the **Extract SQL Server Events** option on the **File** menu.</span></span>  
  
-   <span data-ttu-id="39e8c-113">Eventos individuais também podem ser extraídos e salvos clicando com o botão direito do mouse em um evento específico e escolhendo **Extrair Dados de Evento**.</span><span class="sxs-lookup"><span data-stu-id="39e8c-113">Individual events can also be extracted and saved by right-clicking a specific event and choosing **Extract Event Data**.</span></span>  
  
## <a name="deadlock-graphs"></a><span data-ttu-id="39e8c-114">Gráficos de deadlock</span><span class="sxs-lookup"><span data-stu-id="39e8c-114">Deadlock Graphs</span></span>  
 [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="39e8c-115">e o [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] usam um gráfico de espera de deadlock para descrever um deadlock.</span><span class="sxs-lookup"><span data-stu-id="39e8c-115">and [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] use a deadlock wait-for graph to describe a deadlock.</span></span> <span data-ttu-id="39e8c-116">O gráfico de espera de deadlock contém nós de processo, nós de recurso e bordas representando as relações entre os processos e os recursos.</span><span class="sxs-lookup"><span data-stu-id="39e8c-116">The deadlock wait-for graph contains process nodes, resource nodes, and edges representing the relationships between the processes and the resources.</span></span> <span data-ttu-id="39e8c-117">Os componentes dos gráficos de espera estão definidos na tabela a seguir:</span><span class="sxs-lookup"><span data-stu-id="39e8c-117">The components of wait-for graphs are defined in the following table:</span></span>  
  
 <span data-ttu-id="39e8c-118">Nó de processo</span><span class="sxs-lookup"><span data-stu-id="39e8c-118">Process node</span></span>  
 <span data-ttu-id="39e8c-119">Um thread que executa uma tarefa; por exemplo, INSERT, UPDATE ou DELETE.</span><span class="sxs-lookup"><span data-stu-id="39e8c-119">A thread that performs a task; for example, INSERT, UPDATE, or DELETE.</span></span>  
  
 <span data-ttu-id="39e8c-120">Nó de recurso</span><span class="sxs-lookup"><span data-stu-id="39e8c-120">Resource node</span></span>  
 <span data-ttu-id="39e8c-121">Um objeto de banco de dados; por exemplo, uma tabela, índice ou linha.</span><span class="sxs-lookup"><span data-stu-id="39e8c-121">A database object; for example, a table, index, or row.</span></span>  
  
 <span data-ttu-id="39e8c-122">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="39e8c-122">Edge</span></span>  
 <span data-ttu-id="39e8c-123">Uma relação entre um processo e um recurso.</span><span class="sxs-lookup"><span data-stu-id="39e8c-123">A relationship between a process and a resource.</span></span> <span data-ttu-id="39e8c-124">Uma borda `request` ocorre quando um processo espera por um recurso.</span><span class="sxs-lookup"><span data-stu-id="39e8c-124">A `request` edge occurs when a process waits for a resource.</span></span> <span data-ttu-id="39e8c-125">Uma borda `owner` ocorre quando um recurso espera por um processo.</span><span class="sxs-lookup"><span data-stu-id="39e8c-125">An `owner` edge occurs when a resource waits for a process.</span></span> <span data-ttu-id="39e8c-126">O modo de bloqueio encontra-se na descrição da borda.</span><span class="sxs-lookup"><span data-stu-id="39e8c-126">The lock mode is included in the edge description.</span></span> <span data-ttu-id="39e8c-127">Por exemplo, **Modo: X**.</span><span class="sxs-lookup"><span data-stu-id="39e8c-127">For example, **Mode: X**.</span></span>  
  
## <a name="deadlock-process-node"></a><span data-ttu-id="39e8c-128">Nó de processo de deadlock</span><span class="sxs-lookup"><span data-stu-id="39e8c-128">Deadlock Process Node</span></span>  
 <span data-ttu-id="39e8c-129">Em um gráfico de espera, o nó de processo contém informações sobre o processo.</span><span class="sxs-lookup"><span data-stu-id="39e8c-129">In a wait-for graph, the process node contains information about the process.</span></span> <span data-ttu-id="39e8c-130">A tabela a seguir explica os componentes de um processo.</span><span class="sxs-lookup"><span data-stu-id="39e8c-130">The following table explains the components of a process.</span></span>  
  
|<span data-ttu-id="39e8c-131">Componente</span><span class="sxs-lookup"><span data-stu-id="39e8c-131">Component</span></span>|<span data-ttu-id="39e8c-132">Definição</span><span class="sxs-lookup"><span data-stu-id="39e8c-132">Definition</span></span>|  
|---------------|----------------|  
|<span data-ttu-id="39e8c-133">ID de processo do servidor</span><span class="sxs-lookup"><span data-stu-id="39e8c-133">Server process Id</span></span>|<span data-ttu-id="39e8c-134">Identificador de processo de servidor (SPID), um identificador atribuído pelo servidor ao processo proprietário do bloqueio.</span><span class="sxs-lookup"><span data-stu-id="39e8c-134">Server process identifier (SPID), a server assigned identifier for the process owning the lock.</span></span>|  
|<span data-ttu-id="39e8c-135">ID de lote do servidor</span><span class="sxs-lookup"><span data-stu-id="39e8c-135">Server batch Id</span></span>|<span data-ttu-id="39e8c-136">Identificador de lote de servidor (SBID).</span><span class="sxs-lookup"><span data-stu-id="39e8c-136">Server batch identifier (SBID).</span></span>|  
|<span data-ttu-id="39e8c-137">ID do contexto de execução</span><span class="sxs-lookup"><span data-stu-id="39e8c-137">Execution context Id</span></span>|<span data-ttu-id="39e8c-138">Identificador do contexto de execução (ECID).</span><span class="sxs-lookup"><span data-stu-id="39e8c-138">Execution context identifier (ECID).</span></span> <span data-ttu-id="39e8c-139">A ID do contexto de execução de determinado thread associado a uma SPID específica.</span><span class="sxs-lookup"><span data-stu-id="39e8c-139">The execution context ID of a given thread associated with a specific SPID.</span></span><br /><br /> <span data-ttu-id="39e8c-140">ECID = {0,1,2,3, *...n*}, em que 0 sempre representa o thread principal ou pai e {1,2,3, *...n*} representa os subthreads.</span><span class="sxs-lookup"><span data-stu-id="39e8c-140">ECID = {0,1,2,3, *...n*}, where 0 always represents the main or parent thread, and {1,2,3, *...n*} represent the subthreads.</span></span>|  
|<span data-ttu-id="39e8c-141">Prioridade do deadlock</span><span class="sxs-lookup"><span data-stu-id="39e8c-141">Deadlock priority</span></span>|<span data-ttu-id="39e8c-142">Prioridade do deadlock para o processo.</span><span class="sxs-lookup"><span data-stu-id="39e8c-142">Deadlock priority for the process.</span></span> <span data-ttu-id="39e8c-143">Para obter mais informações sobre os valores possíveis, veja [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="39e8c-143">For more information about possible values, see [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span></span>|  
|<span data-ttu-id="39e8c-144">Log Usado</span><span class="sxs-lookup"><span data-stu-id="39e8c-144">Log Used</span></span>|<span data-ttu-id="39e8c-145">Quantidade de espaço de log usada pelo processo.</span><span class="sxs-lookup"><span data-stu-id="39e8c-145">Amount of log space used by the process.</span></span>|  
|<span data-ttu-id="39e8c-146">ID do Proprietário</span><span class="sxs-lookup"><span data-stu-id="39e8c-146">Owner Id</span></span>|<span data-ttu-id="39e8c-147">ID de transação para os processos que estão usando transações e, atualmente, aguardam em um bloqueio.</span><span class="sxs-lookup"><span data-stu-id="39e8c-147">Transaction ID for the processes which are using transactions and currently waiting on a lock.</span></span>|  
|<span data-ttu-id="39e8c-148">Descritor da transação</span><span class="sxs-lookup"><span data-stu-id="39e8c-148">Transaction descriptor</span></span>|<span data-ttu-id="39e8c-149">Ponteiro para o descritor de transação que descreve o estado da transação.</span><span class="sxs-lookup"><span data-stu-id="39e8c-149">Pointer to the transaction descriptor that describes the state of the transaction.</span></span>|  
|<span data-ttu-id="39e8c-150">Buffer de entrada</span><span class="sxs-lookup"><span data-stu-id="39e8c-150">Input buffer</span></span>|<span data-ttu-id="39e8c-151">Buffer de entrada do processo atual; define o tipo de evento e a instrução que são executados.</span><span class="sxs-lookup"><span data-stu-id="39e8c-151">Input buffer of the current process, defines the type of event and the statement being executed.</span></span> <span data-ttu-id="39e8c-152">Os valores possíveis incluem:</span><span class="sxs-lookup"><span data-stu-id="39e8c-152">Possible values include:</span></span><br /><br /> <span data-ttu-id="39e8c-153">**Idioma**</span><span class="sxs-lookup"><span data-stu-id="39e8c-153">**Language**</span></span><br /><br /> <span data-ttu-id="39e8c-154">**RPC**</span><span class="sxs-lookup"><span data-stu-id="39e8c-154">**RPC**</span></span><br /><br /> <span data-ttu-id="39e8c-155">**Nenhuma**</span><span class="sxs-lookup"><span data-stu-id="39e8c-155">**None**</span></span>|  
|<span data-ttu-id="39e8c-156">de</span><span class="sxs-lookup"><span data-stu-id="39e8c-156">Statement</span></span>|<span data-ttu-id="39e8c-157">Tipo de instrução.</span><span class="sxs-lookup"><span data-stu-id="39e8c-157">Type of statement.</span></span> <span data-ttu-id="39e8c-158">Os valores possíveis são:</span><span class="sxs-lookup"><span data-stu-id="39e8c-158">Possible values are:</span></span><br /><br /> <span data-ttu-id="39e8c-159">**NOP**</span><span class="sxs-lookup"><span data-stu-id="39e8c-159">**NOP**</span></span><br /><br /> <span data-ttu-id="39e8c-160">**SELECT**</span><span class="sxs-lookup"><span data-stu-id="39e8c-160">**SELECT**</span></span><br /><br /> <span data-ttu-id="39e8c-161">**UPDATE**</span><span class="sxs-lookup"><span data-stu-id="39e8c-161">**UPDATE**</span></span><br /><br /> <span data-ttu-id="39e8c-162">**INSERT**</span><span class="sxs-lookup"><span data-stu-id="39e8c-162">**INSERT**</span></span><br /><br /> <span data-ttu-id="39e8c-163">**DELETE**</span><span class="sxs-lookup"><span data-stu-id="39e8c-163">**DELETE**</span></span><br /><br /> <span data-ttu-id="39e8c-164">**Desconhecido**</span><span class="sxs-lookup"><span data-stu-id="39e8c-164">**Unknown**</span></span>|  
  
## <a name="deadlock-resource-node"></a><span data-ttu-id="39e8c-165">Nó de recurso de deadlock</span><span class="sxs-lookup"><span data-stu-id="39e8c-165">Deadlock Resource Node</span></span>  
 <span data-ttu-id="39e8c-166">Em um deadlock, dois processos esperam por um recurso ocupado pelo outro processo.</span><span class="sxs-lookup"><span data-stu-id="39e8c-166">In a deadlock, two processes are each waiting for a resource held by the other process.</span></span> <span data-ttu-id="39e8c-167">Em um gráfico de deadlock, os recursos são exibidos como nós de recurso.</span><span class="sxs-lookup"><span data-stu-id="39e8c-167">In a deadlock graph, the resources are displayed as resource nodes.</span></span>  
  
  
