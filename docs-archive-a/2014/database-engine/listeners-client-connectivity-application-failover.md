---
title: Ouvintes de grupo de disponibilidade, conectividade de cliente e failover de aplicativo (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], listeners
- read-only routing
- read-intent connections [AlwaysOn Availability Groups]
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], read-only routing
- Availability Groups [SQL Server], client connectivity
ms.assetid: 76fb3eca-6b08-4610-8d79-64019dd56c44
author: rothja
ms.author: jroth
ms.openlocfilehash: f66046625ca0078904e9555d1cf586873b9f697f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87680053"
---
# <a name="availability-group-listeners-client-connectivity-and-application-failover-sql-server"></a><span data-ttu-id="f8cc2-102">Ouvintes de grupo de disponibilidade, conectividade de cliente e failover de aplicativo (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="f8cc2-102">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>
  <span data-ttu-id="f8cc2-103">Este tópico contém informações sobre considerações de conectividade de cliente [!INCLUDE[ssHADR](../includes/sshadr-md.md)] e funcionalidade de failover de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-103">This topic contains information about considerations for [!INCLUDE[ssHADR](../includes/sshadr-md.md)] client connectivity and application-failover functionality.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f8cc2-104">Para a maioria das configurações comuns de ouvinte, você pode criar o primeiro ouvinte de grupo de disponibilidade simplesmente usando instruções [!INCLUDE[tsql](../includes/tsql-md.md)] ou cmdlets PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-104">For the majority of the common listener configurations, you can create the first availability group listener simply by using [!INCLUDE[tsql](../includes/tsql-md.md)] statements or PowerShell cmdlets.</span></span> <span data-ttu-id="f8cc2-105">Para obter mais informações, consulte [Tarefas relacionadas](#RelatedTasks), mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-105">For more information, see [Related Tasks](#RelatedTasks), later in this topic.</span></span>  
  
 
  
##  <a name="availability-group-listeners"></a><a name="AGlisteners"></a><span data-ttu-id="f8cc2-106">Ouvintes do grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f8cc2-106">Availability Group Listeners</span></span>  
 <span data-ttu-id="f8cc2-107">É possível fornecer conectividade de cliente ao banco de dados de um determinado grupo de disponibilidade criando um ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-107">You can provide client connectivity to the database of a given availability group by creating an availability group listener.</span></span> <span data-ttu-id="f8cc2-108">Um ouvinte de grupo de disponibilidade é um nome de rede virtual (VNN) ao qual os clientes podem se conectar para acessar um banco de dados em uma réplica primária ou secundária de um grupo de disponibilidade AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-108">An availability group listener is a virtual network name (VNN) to which clients can connect in order to access a database in a primary or secondary replica of an AlwaysOn availability group.</span></span> <span data-ttu-id="f8cc2-109">Um ouvinte de grupo de disponibilidade permite que o cliente conecte-se a uma réplica de disponibilidade sem saber o nome da instância física do SQL Server à qual o cliente está se conectando.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-109">An availability group listener enables a client to connect to an availability replica without knowing the name of the physical instance of SQL Server to which the client is connecting.</span></span>  <span data-ttu-id="f8cc2-110">A cadeia de conexão de cliente não precisa ser modificada para conectar-se ao local atual de uma réplica primária atual.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-110">The client connection string does not need to be modified to connect to the current location of the current primary replica.</span></span>  
  
 <span data-ttu-id="f8cc2-111">Um ouvinte de grupo de disponibilidade consiste em um nome de ouvinte DNS, designação de porta de ouvinte ou um ou mais endereços IP.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-111">An availability group listener consists of a Domain Name System (DNS) listener name, listener port designation, and one or more IP addresses.</span></span> <span data-ttu-id="f8cc2-112">Apenas o protocolo TCP tem suporte do ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-112">Only the TCP protocol is supported by availability group listener.</span></span>  <span data-ttu-id="f8cc2-113">O nome DNS do ouvinte também deve ser exclusivo no domínio e no NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-113">The DNS name of the listener must also be unique in the domain and in NetBIOS.</span></span>  <span data-ttu-id="f8cc2-114">Quando você cria um novo ouvinte de grupo de disponibilidade que se torna um recurso em um cluster com um VNN (nome de rede virtual), um VIP (IP virtual) e dependência de grupo de disponibilidade associados.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-114">When you create a new availability group listener it becomes a resource in a cluster with an associated virtual network name (VNN), virtual IP (VIP), and availability group dependency.</span></span> <span data-ttu-id="f8cc2-115">Um cliente usa o DNS para resolver o VNN em vários endereços IP e depois tenta se conectar a cada endereço, até uma solicitação de conexão ser bem-sucedida ou até a solicitação de conexão atingir seu tempo limite.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-115">A client uses DNS to resolve the VNN into multiple IP addresses and then tries to connect to each address, until a connection request succeeds or until the connection requests time out.</span></span>  
  
 <span data-ttu-id="f8cc2-116">Se o roteamento somente leitura estiver configurado para uma ou mais[réplicas secundárias legíveis](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), as conexões cliente com intenção de leitura para a réplica primária serão redirecionadas para uma réplica secundária legível.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-116">If read-only routing is configured for one or more[readable secondary replicas](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), read-intent client connections to the primary replica are redirected to a readable secondary replica.</span></span> <span data-ttu-id="f8cc2-117">Além disso, se a réplica primária se tornar offline em uma instância do SQL Server e uma nova réplica primária entrar online em outra instância do SQL Server, o ouvinte de grupo de disponibilidade permitirá que os clientes se conectem à nova réplica primária.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-117">Also, if the primary replica goes offline on one instance of SQL Server, and a new primary replica comes online on another instance of SQL Server, the availability group listener enables clients to connect to the new primary replica.</span></span>  
  
 <span data-ttu-id="f8cc2-118">Para obter informações básicas sobre ouvintes do grupo de disponibilidade, veja [Criar ou configurar um ouvinte do grupo de disponibilidade &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-118">For essential information about availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span></span>  
  
 
  
###  <a name="availability-group-listener-configuration"></a><a name="AGlConfig"></a> <span data-ttu-id="f8cc2-119">Configuração de ouvinte de grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f8cc2-119">Availability Group Listener Configuration</span></span>  
 <span data-ttu-id="f8cc2-120">Um ouvinte de grupo de disponibilidade é definido pelo seguinte:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-120">An availability group listener is defined by the following:</span></span>  
  
 <span data-ttu-id="f8cc2-121">Um nome DNS exclusivo</span><span class="sxs-lookup"><span data-stu-id="f8cc2-121">A unique DNS name</span></span>  
 <span data-ttu-id="f8cc2-122">Isso também é conhecido como um VNN (nome de rede virtual).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-122">This is also known as a Virtual Network Name (VNN).</span></span> <span data-ttu-id="f8cc2-123">As regras de nomeação do Active Directory para nomes de host DNS se aplicam.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-123">Active Directory naming rules for DNS host names apply.</span></span> <span data-ttu-id="f8cc2-124">Para obter mais informações, consulte o artigo da Base de Dados de Conhecimento [Convenções de nomenclatura no Active Directory para computadores, domínios, sites e unidades organizacionais](https://support.microsoft.com/kb/909264) .</span><span class="sxs-lookup"><span data-stu-id="f8cc2-124">For more information, see the [Naming conventions in Active Directory for computers, domains, sites, and OUs](https://support.microsoft.com/kb/909264) KB article.</span></span>  
  
 <span data-ttu-id="f8cc2-125">Um ou mais endereços IP virtuais (VIPs)</span><span class="sxs-lookup"><span data-stu-id="f8cc2-125">One or more Virtual IP addresses (VIPs)</span></span>  
 <span data-ttu-id="f8cc2-126">VIPs são configurados para uma ou mais sub-redes para as quais o grupo de disponibilidade faz failover.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-126">VIPs are configured for one or more subnets to which the availability group can failover.</span></span>  
  
 <span data-ttu-id="f8cc2-127">Configuração do endereço IP</span><span class="sxs-lookup"><span data-stu-id="f8cc2-127">IP address configuration</span></span>  
 <span data-ttu-id="f8cc2-128">Para um ouvinte de grupo de disponibilidade específico, o endereço IP usa o protocolo DHCP ou um ou mais endereços IP estáticos.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-128">For a given availability group listener, the IP address uses either Dynamic Host Configuration Protocol (DHCP) or one or more static IP addresses.</span></span>  
  
-   <span data-ttu-id="f8cc2-129">Protocolo DHCP</span><span class="sxs-lookup"><span data-stu-id="f8cc2-129">Dynamic Host Configuration Protocol (DHCP)</span></span>  
  
     <span data-ttu-id="f8cc2-130">Se um grupo de disponibilidade residir em uma única sub-rede, você poderá configurar todos os endereços IP de ouvinte do grupo de disponibilidade para usar o DHCP.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-130">If an availability group resides on a single subnet, you can configure all the availability group listener IP addresses to use DHCP.</span></span> <span data-ttu-id="f8cc2-131">Em ambientes pré-produção, o DHCP oferece uma instalação fácil para um grupo de disponibilidade que não requer recuperação de desastres em um site remoto em uma sub-rede separada.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-131">For pre-production environments, DHCP offers an easy setup for an availability group that does not require disaster recovery to a remote site on a separate subnet.</span></span> <span data-ttu-id="f8cc2-132">Entretanto, você não deve usar o DHCP junto com um ouvinte de grupo de disponibilidade em um ambiente de produção.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-132">However, you should not use DHCP in conjunction with an availability group listener in a production environment.</span></span> <span data-ttu-id="f8cc2-133">O motivo é que, em caso de tempo de inatividade, se a concessão do IP DHCP expirar, será necessário tempo extra para registrar novamente o novo endereço IP DHCP associado ao nome DNS do ouvinte.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-133">This is because, in the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the listener DNS name.</span></span> <span data-ttu-id="f8cc2-134">O tempo extra causará falha na conexão de cliente.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-134">The extra time will cause client-connection failure.</span></span>  
  
-   <span data-ttu-id="f8cc2-135">Endereços IP estáticos</span><span class="sxs-lookup"><span data-stu-id="f8cc2-135">Static IP addresses</span></span>  
  
     <span data-ttu-id="f8cc2-136">Em ambientes de produção, recomendamos que os ouvintes de grupo de disponibilidade usem endereços IP estáticos.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-136">In production environments, we recommend that availability group listeners use static IP addresses.</span></span> <span data-ttu-id="f8cc2-137">Além disso, casos onde grupos de disponibilidade se estendem por sub-redes em um domínio de várias sub-redes, um ouvinte de grupo de disponibilidade deve usar endereços IP estáticos.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-137">Furthermore, where availability groups extend across subnets in a multi-subnet domain, an availability group listener must use static IP addresses.</span></span>  
  
 <span data-ttu-id="f8cc2-138">Não há suporte para configurações de redes híbridas e DHCP através de sub-redes para ouvintes de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-138">Hybrid network configurations and DHCP across subnets are not supported for availability group listeners.</span></span> <span data-ttu-id="f8cc2-139">Isso ocorre porque, quando há um failover, um IP dinâmico pode expirar ou ser liberado, o que coloca a alta disponibilidade geral em risco.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-139">This is because when a failover happens, a dynamic IP might expire or be released, which jeopardizes overall high availability.</span></span>  
  
###  <a name="selecting-an-availability-group-listener-port"></a><a name="SelectListenerPort"></a> <span data-ttu-id="f8cc2-140">Selecionando uma porta de ouvinte de grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f8cc2-140">Selecting an Availability Group Listener Port</span></span>  
 <span data-ttu-id="f8cc2-141">Ao configurar um ouvinte de grupo de disponibilidade, você precisa designar uma porta.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-141">When configuring an availability group listener, you must designate a port.</span></span>  <span data-ttu-id="f8cc2-142">Você pode configurar a porta padrão como 1433 para simplicidade das cadeias de conexão de cliente.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-142">You can configure the default port to 1433 in order to allow for simplicity of the client connection strings.</span></span> <span data-ttu-id="f8cc2-143">Ao usar 1433, você não precisa designar um número de porta em uma cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-143">If using 1433, you do not need to designate a port number in a connection string.</span></span>   <span data-ttu-id="f8cc2-144">Além disso, como cada ouvinte de grupo de disponibilidade terá um nome de rede virtual separado, cada ouvinte de grupo de disponibilidade configurado em um único WSFC poderá ser configurado para fazer referência à mesma porta padrão de 1433.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-144">Also, since each availability group listener will have a separate virtual network name, each availability group listener configured on a single WSFC can be configured to reference the same default port of 1433.</span></span>  
  
 <span data-ttu-id="f8cc2-145">Você também pode designar uma porta de ouvinte sem padrão. Porém isso significa que você também precisará especificar uma porta de destino explicitamente em sua cadeia de conexão ao conectar-se ao ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-145">You can also designate a non-standard listener port; however this means that you will also need to explicitly specify a target port in your connection string whenever connecting to the availability group listener.</span></span>  <span data-ttu-id="f8cc2-146">Você também precisará da permissão de abertura no firewall para a porta sem padrão.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-146">You will also need to open permission on the firewall for the non-standard port.</span></span>  
  
 <span data-ttu-id="f8cc2-147">Se você usar a porta padrão de 1433 para VNNs de ouvinte de grupo de disponibilidade, você ainda precisará garantir que nenhum outro serviço no nó de cluster esteja usando essa porta; caso contrário, isso causará um conflito de porta.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-147">If you use the default port of 1433 for availability group listener VNNs, you will still need to ensure that no other services on the cluster node are using this port; otherwise this would cause a port conflict.</span></span>  
  
 <span data-ttu-id="f8cc2-148">Se uma das instâncias do SQL Server já estiver escutando na porta TCP 1433 por meio do ouvinte da instância e não houver nenhum outro serviço (inclusive instâncias adicionais do SQL Server) no computador que escuta na porta 1433, isso não provocará um conflito de porta com o ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-148">If one of the instances of SQL Server is already listening on TCP port 1433 via the instance listener and there are no other services (including additional instances of SQL Server) on the computer listening on port 1433, this will not cause a port conflict with the availability group listener.</span></span>  <span data-ttu-id="f8cc2-149">Isso ocorre porque o ouvinte de grupo de disponibilidade pode compartilhar a mesma porta TCP no mesmo processo de serviço.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-149">This is because the availability group listener can share the same TCP port inside the same service process.</span></span>  <span data-ttu-id="f8cc2-150">No entanto, não devem ser configuradas várias instâncias do SQL Server (lado a lado) para escutar na mesma porta.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-150">However multiple instances of SQL Server (side-by-side)should not be configured to listen on the same port.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-the-primary-replica"></a><a name="ConnectToPrimary"></a><span data-ttu-id="f8cc2-151">Usando um ouvinte para se conectar à réplica primária</span><span class="sxs-lookup"><span data-stu-id="f8cc2-151">Using a Listener to Connect to the Primary Replica</span></span>  
 <span data-ttu-id="f8cc2-152">Para usar um ouvinte de grupo de disponibilidade para conectar-se à réplica de disponibilidade para acesso de leitura/gravação, a cadeia de conexão especifica o nome DNS do ouvinte do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-152">To use an availability group listener to connect to the primary replica for read-write access, the connection string specifies the availability group listener DNS name.</span></span>  <span data-ttu-id="f8cc2-153">Se uma réplica primária de grupo de disponibilidade for alterada para uma nova réplica, as conexões existentes que usam o nome da rede de um ouvinte de grupo de disponibilidade serão desconectadas.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-153">If an availability group primary replica changes to a new replica, existing connections that use an availability group listener's network name are disconnected.</span></span>  <span data-ttu-id="f8cc2-154">As novas conexões ao ouvinte do grupo de disponibilidade são então direcionadas para a nova réplica primária.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-154">New connections to the availability group listener are then directed to the new primary replica.</span></span> <span data-ttu-id="f8cc2-155">Um exemplo de uma cadeia de conexão básica para o provedor ADO.NET (System.Data.SqlClient) é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-155">An example of a basic connection string for the ADO.NET provider (System.Data.SqlClient) is as follows:</span></span>  
  
```  
Server=tcp: AGListener,1433;Database=MyDB;IntegratedSecurity=SSPI  
```  
  
 <span data-ttu-id="f8cc2-156">Você ainda pode escolher fazer referência direta à instância de nome do SQL Server das réplicas primárias ou secundárias, em vez de usar o nome do servidor do grupo de disponibilidade, no entanto, se optar por fazer isso, você perderá o benefício de novas conexões que são dirigidas automaticamente para a réplica primária atual.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-156">You can still choose to directly reference the instance of SQL Server name of the primary or secondary replicas instead of using the availability group listener server name, however if you choose to do so you will lose the benefit of new connections being directed automatically to the current primary replica.</span></span>  <span data-ttu-id="f8cc2-157">Você também perderá o benefício de roteamento somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-157">You will also lose the benefit of read-only routing.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-a-read-only-secondary-replica-read-only-routing"></a><a name="ConnectToSecondary"></a> <span data-ttu-id="f8cc2-158">Usando um ouvinte para conectar a uma réplica secundária somente leitura (roteamento somente leitura)</span><span class="sxs-lookup"><span data-stu-id="f8cc2-158">Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)</span></span>  
 <span data-ttu-id="f8cc2-159">*Roteamento somente leitura* refere-se à capacidade do [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] de rotear conexões de entrada a um ouvinte de grupo de disponibilidade para uma réplica secundária que é configurada para permitir cargas de trabalho somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-159">*Read-only routing* refers to the ability of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to route incoming connections to an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> <span data-ttu-id="f8cc2-160">Uma conexão de entrada que faz referência a um nome de ouvinte de grupo de disponibilidade poderá ser roteada automaticamente para uma réplica somente leitura se o seguinte for verdadeiro:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-160">An incoming connection referencing an availability group listener name can automatically be routed to a read-only replica if the following are true:</span></span>  
  
-   <span data-ttu-id="f8cc2-161">Pelo menos uma réplica secundária é definida como acesso somente leitura e cada réplica secundária somente leitura e a réplica primária são configuradas para oferecer suporte ao roteamento somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-161">At least one secondary replica is set to read-only access, and each read-only secondary replica and the primary replica are configured to support read-only routing.</span></span> <span data-ttu-id="f8cc2-162">Para obter mais informações, veja [Para configurar réplicas de disponibilidade para roteamento somente leitura](#ConfigureARsForROR), mais adiante nesta seção.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-162">For more information, see [To Configure Availability Replicas for Read-Only Routing](#ConfigureARsForROR), later in this section.</span></span>  
  
-   <span data-ttu-id="f8cc2-163">A cadeia de conexão faz referência a um ouvinte de grupo de disponibilidade, e a tentativa do aplicativo da conexão de entrada está definida como somente leitura (por exemplo, usando a palavra-chave **Application Intent=ReadOnly** nas cadeias de conexão ODBC ou OLEDB ou nos atributos ou propriedades da conexão).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-163">The connection string references an availability group listener, and the application intent of the incoming connection is set to read-only (for example, by using the **Application Intent=ReadOnly** keyword in the ODBC or OLEDB connection strings or connection attributes or properties).</span></span> <span data-ttu-id="f8cc2-164">Para obter informações, veja [Tentativa do aplicativo somente leitura e roteamento somente leitura](#ReadOnlyAppIntent), mais adiante nesta seção.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-164">For more information, see [Read-Only Application Intent and Read-Only Routing](#ReadOnlyAppIntent), later in this section.</span></span>  
  
###  <a name="to-configure-availability-replicas-for-read-only-routing"></a><a name="ConfigureARsForROR"></a> <span data-ttu-id="f8cc2-165">Para configurar réplicas de disponibilidade para roteamento somente leitura</span><span class="sxs-lookup"><span data-stu-id="f8cc2-165">To Configure Availability Replicas for Read-Only Routing</span></span>  
 <span data-ttu-id="f8cc2-166">Um administrador de banco de dados deve configurar as réplicas de disponibilidade como segue:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-166">A database administrator must configure the availability replicas as follows:</span></span>  
  
1.  <span data-ttu-id="f8cc2-167">Para cada réplica de disponibilidade que você deseja configurar como uma réplica secundária legível, um administrador de banco de dados deve configurar os parâmetros a seguir, que entram em vigor somente na função secundária:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-167">For each availability replica that you want to configure as a readable secondary replica, a database administrator must configure the following settings, which take effect only under the secondary role:</span></span>  
  
    -   <span data-ttu-id="f8cc2-168">O acesso de conexão deve ser definido como "tudo" ou "somente leitura".</span><span class="sxs-lookup"><span data-stu-id="f8cc2-168">Connection access must be set to "all" or "read only".</span></span>  
  
    -   <span data-ttu-id="f8cc2-169">A URL de roteamento somente leitura deve ser especificada.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-169">The read-only routing URL must be specified.</span></span>  
  
2.  <span data-ttu-id="f8cc2-170">Para cada uma dessas réplicas, uma lista de roteamento somente leitura deve ser especificada para a função primária.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-170">For each of these replicas, a read-only routing list must be specified for the primary role.</span></span> <span data-ttu-id="f8cc2-171">Especifique um ou mais nomes de servidor como destinos de roteamento.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-171">Specify one or more server names as routing targets.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksROR"></a> <span data-ttu-id="f8cc2-172">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="f8cc2-172">Related Tasks</span></span>  
  
-   [<span data-ttu-id="f8cc2-173">Configurar o acesso somente leitura em uma réplica de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-173">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="f8cc2-174">Configurar o roteamento somente leitura para um grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-174">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
###  <a name="read-only-application-intent-and-read-only-routing"></a><a name="ReadOnlyAppIntent"></a><span data-ttu-id="f8cc2-175">Tentativa de aplicativo somente leitura e roteamento somente leitura</span><span class="sxs-lookup"><span data-stu-id="f8cc2-175">Read-Only Application Intent and Read-Only Routing</span></span>  
 <span data-ttu-id="f8cc2-176">A propriedade da cadeia de conexão da intenção de aplicativo expressa a solicitação do aplicativo cliente de ser direcionada para uma versão de leitura/gravação ou somente leitura de um banco de dados de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-176">The application intent connection string property expresses the client application's request to be directed either to a read-write or read-only version of an availability group database.</span></span> <span data-ttu-id="f8cc2-177">Para usar o roteamento somente leitura, um cliente deve usar uma tentativa de aplicativo somente leitura na cadeia de conexão ao conectar-se ao ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-177">To use read-only routing, a client must use an application intent of read-only in the connection string when connecting to the availability group listener.</span></span> <span data-ttu-id="f8cc2-178">Sem a tentativa de aplicativo somente leitura, as conexões para o ouvinte de grupo de disponibilidade são direcionadas para o banco de dados na réplica primária.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-178">Without the read-only application intent, connections to the availability group listener are directed to the database on the primary replica.</span></span>  
  
 <span data-ttu-id="f8cc2-179">O atributo de intenção de aplicativo é armazenado na sessão do cliente durante o logon e a instância do SQL Server processará essa intenção e determinará o que fazer de acordo com a configuração do grupo de disponibilidade e o estado de leitura/gravação atual do banco de dados de destino na réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-179">The application intent attribute is stored in the client's session during login and the instance of SQL Server will then process this intent and determine what to do according to the configuration of the availability group and the current read-write state of the target database in the secondary replica.</span></span>  
  
 <span data-ttu-id="f8cc2-180">Um exemplo de uma cadeia de conexão para o provedor de ADO.NET (System.Data.SqlClient) que designa a intenção de aplicativo somente leitura é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-180">An example of a connection string for the ADO.NET provider (System.Data.SqlClient) that designates read-only application intent is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI;ApplicationIntent=ReadOnly  
```  
  
 <span data-ttu-id="f8cc2-181">Neste exemplo de cadeia de conexão, o cliente está tentando conectar-se a um ouvinte de grupo de disponibilidade denominado `AGListener` na porta 1433 (você também poderá omitir a porta se o ouvinte do grupo de disponibilidade estiver escutando na 1433).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-181">In this connection string example, the client is attempting to connect to an availability group listener named `AGListener` on port 1433 (you may also omit the port if the availability group listener is listening on 1433).</span></span>  <span data-ttu-id="f8cc2-182">A cadeia de conexão tem a `ApplicationIntent` propriedade definida como `ReadOnly` , tornando-a uma *cadeia de conexão de intenção de leitura*.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-182">The connection string has the `ApplicationIntent` property set to `ReadOnly`, making this a *read-intent connection string*.</span></span>  <span data-ttu-id="f8cc2-183">Sem essa configuração, o servidor não tentaria um roteamento somente leitura da conexão.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-183">Without this setting, the server would not have attempted a read-only routing of the connection.</span></span>  
  
 <span data-ttu-id="f8cc2-184">O banco de dados primário do grupo de disponibilidade processa a solicitação de roteamento somente leitura de entrada e tenta localizar uma réplica somente leitura online que esteja unida à réplica primária e configurada para roteamento somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-184">The primary database of the availability group processes the incoming read-only routing request and attempts to locate an online, read-only replica that is joined to the primary replica and is configured for read-only routing.</span></span>  <span data-ttu-id="f8cc2-185">O cliente recebe informações de conexão do servidor de réplica primária e conecta-se à réplica somente leitura identificada.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-185">The client receives back connection information from the primary replica server and connects to the identified read-only replica.</span></span>  
  
 <span data-ttu-id="f8cc2-186">Observe que a tentativa de aplicativo pode ser enviada de um driver cliente a uma instância de nível inferior do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-186">Note that the application intent can be sent from a client driver to a down-level instance of SQL Server.</span></span>  <span data-ttu-id="f8cc2-187">Neste caso, a tentativa de aplicativo de somente leitura é ignorada e a conexão continua normalmente.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-187">In this case, application intent of read-only is ignored and the connection proceeds as normal.</span></span>  
  
 <span data-ttu-id="f8cc2-188">Você pode ignorar o roteamento somente leitura não definindo a propriedade de conexão da tentativa de aplicativo como `ReadOnly` (quando não designado, o padrão é `ReadWrite` durante o logon) ou conectando-se diretamente à instância de réplica primária do SQL Server em vez de usar o nome do ouvinte do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-188">You can bypass read-only routing by not setting the application intent connection property to `ReadOnly` (when not designated, the default is `ReadWrite` during login) or by connecting directly to the primary replica instance of SQL Server instead of using the availability group listener name.</span></span>  <span data-ttu-id="f8cc2-189">O roteamento somente leitura também não ocorrerá se você conectar-se diretamente a uma réplica somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-189">Read-only routing will also not occur if you connect directly to a read-only replica.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksApps"></a> <span data-ttu-id="f8cc2-190">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="f8cc2-190">Related Tasks</span></span>  
  
-   [<span data-ttu-id="f8cc2-191">Suporte do SQL Server Native Client à alta disponibilidade e recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f8cc2-191">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>](../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md)  
  
-   [<span data-ttu-id="f8cc2-192">Usando palavras-chave da cadeia de conexão com o SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="f8cc2-192">Using Connection String Keywords with SQL Server Native Client</span></span>](../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
##  <a name="bypassing-availability-group-listeners"></a><a name="BypassAGl"></a><span data-ttu-id="f8cc2-193">Ignorando ouvintes do grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f8cc2-193">Bypassing Availability Group Listeners</span></span>  
 <span data-ttu-id="f8cc2-194">Embora os ouvintes de grupo de disponibilidade permitam suporte para redirecionamento de failover e roteamento somente leitura, as conexões de cliente não precisam usá-los.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-194">While availability group listeners enable support for failover redirection and read-only routing, client connections are not required to use them.</span></span> <span data-ttu-id="f8cc2-195">Uma conexão de cliente também pode fazer referência direta à instância do SQL Server em vez de conectar-se ao ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-195">A client connection can also directly reference the instance of SQL Server instead of connecting to the availability group listener.</span></span>  
  
 <span data-ttu-id="f8cc2-196">Na instância do SQL Server, é irrelevante se a conexão fizer logon usando o ouvinte de grupo de disponibilidade ou usando outro ponto de extremidade da instância.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-196">To the instance of SQL Server it is irrelevant whether a connection logs in using the availability group listener or using another instance endpoint.</span></span>  <span data-ttu-id="f8cc2-197">A instância do SQL Server verificará o estado do banco de dados de destino e permitirá ou não a conectividade com base na configuração do grupo de disponibilidade e no estado atual do banco de dados na instância.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-197">The instance of SQL Server will verify the state of the targeted database and either allow or disallow connectivity based on the configuration of the availability group and the current state of the database on the instance.</span></span>  <span data-ttu-id="f8cc2-198">Por exemplo, se um aplicativo cliente conectar-se diretamente a uma instância de porta do SQL Server e conectar-se a um banco de dados de destino hospedado em um grupo de disponibilidade, e o banco de dados de destino estiver em estado primário e online, a conectividade terá sucesso.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-198">For example, if a client application connects directly to a instance of SQL Server port and connects to a target database hosted in an availability group, and the target database is in primary state and online, then connectivity will succeed.</span></span>  <span data-ttu-id="f8cc2-199">Se o banco de dados de destino estiver offline ou em um estado de transição, haverá falha na conectividade para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-199">If the target database is offline or in a transitional state, connectivity to the database will fail.</span></span>  
  
 <span data-ttu-id="f8cc2-200">Como alternativa, ao migrar de espelhamento de banco de dados para o [!INCLUDE[ssHADR](../includes/sshadr-md.md)], os aplicativos podem especificar a cadeia de conexão do espelhamento do banco de dados desde que exista apenas uma réplica secundária e que as conexões de usuário não sejam permitidas.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-200">Alternatively, while migrating from database mirroring to [!INCLUDE[ssHADR](../includes/sshadr-md.md)], applications can specify the database mirroring connection string as long as only one secondary replica exists and it disallows user connections.</span></span> <span data-ttu-id="f8cc2-201">Para obter mais informações, veja [Usando cadeias de conexão de espelhamento de banco de dados com grupos de disponibilidade](#DbmConnectionString), mais adiante nesta seção.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-201">For more information, see [Using Database-Mirroring Connection Strings with Availability Groups](#DbmConnectionString), later in this section.</span></span>  
  
###  <a name="using-database-mirroring-connection-strings-with-availability-groups"></a><a name="DbmConnectionString"></a><span data-ttu-id="f8cc2-202">Usando cadeias de conexão de espelhamento de banco de dados com grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f8cc2-202">Using Database-Mirroring Connection Strings with Availability Groups</span></span>  
 <span data-ttu-id="f8cc2-203">Se um grupo de disponibilidade tiver apenas uma réplica secundária e não estiver configurado para permitir acesso de leitura à réplica secundária, os clientes poderão se conectar à réplica primária usando uma cadeia de conexão de espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-203">If an availability group possesses only one secondary replica and is not configured to allow read-access to the secondary replica, clients can connect to the primary replica by using a database mirroring connection string.</span></span> <span data-ttu-id="f8cc2-204">Essa abordagem pode ser útil na migração de um aplicativo existente do espelhamento de banco de dados para um grupo de disponibilidade, contanto que você limite o grupo de disponibilidade a duas réplicas de disponibilidade (uma réplica primária e uma réplica secundária).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-204">This approach can be useful while migrating an existing application from database mirroring to an availability group, as long as you limit the availability group to two availability replicas (a primary replica and one secondary replica).</span></span> <span data-ttu-id="f8cc2-205">Se adicionar mais réplicas secundárias, você precisará criar um ouvinte de grupo de disponibilidade para o grupo de disponibilidade e atualizar seus aplicativos para usarem o nome DNS do ouvinte do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-205">If you add additional secondary replicas, you will need to create an availability group listener for the availability group and update your applications to use the availability group listener DNS name.</span></span>  
  
 <span data-ttu-id="f8cc2-206">Quando cadeias de conexão de espelhamento de banco de dados forem utilizadas, o cliente poderá usar o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client ou o provedor de dados .NET Framework para [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f8cc2-206">When using database mirroring connection strings, the client can use either [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f8cc2-207">A cadeia de conexão oferecida por um cliente deve fornecer, no mínimo, o nome de uma instância de servidor, o *nome de parceiro inicial*, para identificar a instância de servidor que hospeda inicialmente a réplica de disponibilidade à qual você pretende se conectar.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-207">The connection string provided by a client must minimally supply the name of one server instance, the *initial partner name*, to identify the server instance that initially hosts the availability replica to which you intend to connect.</span></span> <span data-ttu-id="f8cc2-208">Opcionalmente, a cadeia de conexão também pode fornecer o nome de outra instância de servidor, o *nome de parceiro de failover*, para identificar a instância do servidor que hospeda inicialmente a réplica secundária como o nome de parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-208">Optionally, the connection string can also supply the name of another server instance, the *failover partner name*, to identify the server instance that initially hosts the secondary replica as the failover partner name.</span></span>  
  
 <span data-ttu-id="f8cc2-209">Para obter mais informações sobre cadeias de conexão de espelhamento de banco de dados, veja [Conectar clientes a uma sessão de espelhamento de banco de dados &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-209">For more information about database mirroring connection strings, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="behavior-of-client-connections-on-failover"></a><a name="CCBehaviorOnFailover"></a><span data-ttu-id="f8cc2-210">Comportamento de conexões de cliente no failover</span><span class="sxs-lookup"><span data-stu-id="f8cc2-210">Behavior of Client Connections on Failover</span></span>  
 <span data-ttu-id="f8cc2-211">Quando ocorrer um failover de grupo de disponibilidade, as conexões persistentes ao grupo de disponibilidade são terminadas e o cliente deve estabelecer uma nova conexão para continuar trabalhando com o mesmo banco de dados primário ou banco de dados secundário somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-211">When an availability group failover occurs, existing persistent connections to the availability group are terminated and the client must establish a new connection in order to continue working with the same primary database or read-only secondary database.</span></span>  <span data-ttu-id="f8cc2-212">Enquanto um failover estiver ocorrendo no lado do servidor, a conectividade com o grupo de disponibilidade pode falhar, forçando o aplicativo cliente a repetir a conexão até que o primário seja colocado completamente online.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-212">While a failover is occurring on the server side, connectivity to the availability group may fail, forcing the client application to retry connecting until the primary is brought fully back online.</span></span>  
  
 <span data-ttu-id="f8cc2-213">Se o grupo de disponibilidade voltar a ficar online durante a tentativa de conexão de um aplicativo cliente, mas antes do tempo limite da conexão, o driver cliente poderá conectar-se com êxito durante uma de suas tentativas internas e não ocorrerá nenhum erro no aplicativo nesse caso.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-213">If the availability group comes back online during a client application's connection attempt but before the connect timeout period, the client driver may successfully connect during one of its internal retry attempts and no error will be surfaced to the application in this case.</span></span>  
  
##  <a name="supporting-availability-group-multi-subnet-failovers"></a><a name="SupportAgMultiSubnetFailover"></a> <span data-ttu-id="f8cc2-214">Dando suporte a failovers de várias sub-redes de grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="f8cc2-214">Supporting Availability Group Multi-Subnet Failovers</span></span>  
 <span data-ttu-id="f8cc2-215">Se estiver usando bibliotecas de cliente que dão suporte à opção de conexão MultiSubnetFailover na cadeia de conexão, você poderá otimizar o failover do grupo de disponibilidade para uma sub-rede diferente configurando MultiSubnetFailover como "Verdadeiro" ou "Sim", dependendo da sintaxe do provedor que você está usando.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-215">If you are using client libraries that support the MultiSubnetFailover connection option in the connection string, you can optimize availability group failover to a different subnet by setting MultiSubnetFailover to "True" or "Yes", depending on the syntax of the provider you are using.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f8cc2-216">Essa configuração é recomendável para conexões únicas e de várias sub-redes para ouvintes de grupos de disponibilidade e nomes de instâncias de cluster de failover do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-216">We recommend this setting for both single and multi-subnet connections to availability groups listeners and to SQL Server Failover Cluster Instance names.</span></span>  <span data-ttu-id="f8cc2-217">A habilitação dessa opção adiciona mais otimizações, até mesmo para cenários de única sub-rede.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-217">Enabling this option adds additional optimizations, even for single-subnet scenarios.</span></span>  
  
 <span data-ttu-id="f8cc2-218">A opção de conexão `MultiSubnetFailover` funciona apenas com o protocolo de rede TCP e tem suporte apenas para conexão a um ouvinte de grupo de disponibilidade e para qualquer nome de rede virtual que se conecta ao [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f8cc2-218">The `MultiSubnetFailover` connection option only works with the TCP network protocol and is only supported when connecting to an availability group listener and for any virtual network name connecting to [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="f8cc2-219">Um exemplo de um cadeia de conexão do provedor de ADO.NET (System.Data.SqlClient) que habilita o failover de várias sub-redes é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-219">An example of a for the ADO.NET provider (System.Data.SqlClient) connection string that enables multi-subnet failover is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI; MultiSubnetFailover=True  
```  
  
 <span data-ttu-id="f8cc2-220">A opção de conexão `MultiSubnetFailover` deve ser definida como `True` mesmo que o grupo de disponibilidade se estenda apenas por uma única sub-rede.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-220">The `MultiSubnetFailover` connection option should be set to `True` even if the availability group only spans a single subnet.</span></span>  <span data-ttu-id="f8cc2-221">Isso permite pré-configurar novos clientes para dar suporte ao futuro alcance de sub-redes sem necessidade de alterações futuras na cadeia de conexão de cliente e também otimiza o desempenho de failover para failovers de sub-rede única.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-221">This allows you to preconfigure new clients to support future spanning of subnets without any need for future client connection string changes and also optimizes failover performance for single subnet failovers.</span></span>  <span data-ttu-id="f8cc2-222">Embora a opção de conexão `MultiSubnetFailover` não seja necessária, ela fornece o benefício de um failover de sub-rede mais rápido.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-222">While the `MultiSubnetFailover` connection option is not required, it does provide the benefit of a faster subnet failover.</span></span>  <span data-ttu-id="f8cc2-223">Isso ocorre porque o driver de cliente tentará abrir um soquete TCP para cada endereço IP em paralelo associado ao grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-223">This is because the client driver will attempt to open up a TCP socket for each IP address in parallel associated with the availability group.</span></span>  <span data-ttu-id="f8cc2-224">O driver de cliente esperará que o primeiro IP responda com êxito e quando o fizer, usa-o para a conexão.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-224">The client driver will wait for the first IP to respond with success and once it does, will then use it for the connection.</span></span>  
  
##  <a name="availability-group-listeners-and-ssl-certificates"></a><a name="SSLcertificates"></a> <span data-ttu-id="f8cc2-225">Ouvintes de grupo de disponibilidade e certificados SSL</span><span class="sxs-lookup"><span data-stu-id="f8cc2-225">Availability Group Listeners and SSL Certificates</span></span>  
 <span data-ttu-id="f8cc2-226">Ao conectar-se a um ouvinte de grupo de disponibilidade, se as instâncias participantes do SQL Server usarem certificados SSL junto com criptografia de sessão, o driver de cliente que está fazendo a conexão precisará dar suporte ao Nome Alternativo da Entidade no certificado SSL para forçar a criptografia.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-226">When connecting to an availability group listener, if the participating instances of SQL Server use SSL certificates in conjunction with session encryption, the connecting client driver will need to support the Subject Alternate Name in the SSL certificate in order to force encryption.</span></span>  <span data-ttu-id="f8cc2-227">O suporte ao driver do SQL Server para o Nome Alternativo da Entidade do certificado está planejado para ADO.NET (SqlClient), Microsoft JDBC e SQL Native Client (SNAC).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-227">SQL Server driver support for certificate Subject Alternative Name is planned for ADO.NET (SqlClient), Microsoft JDBC and SQL Native Client (SNAC).</span></span>  
  
 <span data-ttu-id="f8cc2-228">Um certificado X.509 deve ser configurado para cada nó de servidor participante do cluster de failover com uma lista de todos os ouvintes de grupo de disponibilidade definidos no Nome Alternativo da Entidade do certificado.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-228">A X.509 certificate must be configured for each participating server node in the failover cluster with a list of all availability group listeners set in the Subject Alternate Name of the certificate.</span></span>  
  
 <span data-ttu-id="f8cc2-229">Por exemplo, se o WSFC tiver três ouvintes de grupo de disponibilidade com os nomes `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`e `AG3_listener.Adventure-Works.com`, o Nome Alternativo da Entidade para o certificado deverá ser definido da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-229">For example, if the WSFC has three availability group listeners with the names `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`, and `AG3_listener.Adventure-Works.com`, the Subject Alternative Name for the certificate should be set as follows:</span></span>  
  
```  
CN = ServerFQDN  
SAN = ServerFQDN,AG1_listener.Adventure-Works.com, AG2_listener.Adventure-Works.com, AG3_listener.Adventure-Works.com  
```  
  
##  <a name="availability-group-listeners-and-server-principal-names-spns"></a><a name="SPNs"></a><span data-ttu-id="f8cc2-230">Ouvintes de grupo de disponibilidade e SPNs (nomes de entidade de servidor)</span><span class="sxs-lookup"><span data-stu-id="f8cc2-230">Availability Group Listeners and Server Principal Names (SPNs)</span></span>  
 <span data-ttu-id="f8cc2-231">Um SPN (nome de entidade de segurança de servidor) deve ser configurado no Active Directory por um administrador de domínio para cada nome de ouvinte de grupo de disponibilidade para habilitar o Kerberos para a conexão de cliente com o ouvinte de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-231">A Server Principal Name (SPN) must be configured in Active Directory by a domain administrator for each availability group listener name in order to enable Kerberos for the client connection to the availability group listener.</span></span> <span data-ttu-id="f8cc2-232">Ao registrar o SPN, você deve usar a conta de serviço da instância de servidor que hospeda a réplica de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-232">When registering the SPN, you must use the service account of the server instance that hosts the availability replica .</span></span>  <span data-ttu-id="f8cc2-233">Para que o SPN funcione em todas as réplicas, a mesma conta de serviço deve ser usada para todas as instâncias no cluster do WSFC que hospeda o grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-233">For the SPN to work across all replicas, the same service account must be used for all instances in the WSFC cluster that hosts the availability group.</span></span>  
  
 <span data-ttu-id="f8cc2-234">Use a ferramenta de linha de comando `setspn` do Windows para configurar o SPN.</span><span class="sxs-lookup"><span data-stu-id="f8cc2-234">Use the `setspn` Windows command line tool to configure the SPN.</span></span>  <span data-ttu-id="f8cc2-235">Por exemplo, para configurar um SPN para um grupo de disponibilidade denominado `AG1listener.Adventure-Works.com` hospedado em um conjunto de instâncias do SQL Server, todas configuradas para executar sob a conta de domínio `corp/svclogin2`:</span><span class="sxs-lookup"><span data-stu-id="f8cc2-235">For example to configure an SPN for an availability group named `AG1listener.Adventure-Works.com` hosted on a set of instances of SQL Server all configured to run under the domain account `corp/svclogin2`:</span></span>  
  
```cmd
setspn -A MSSQLSvc/AG1listener.Adventure-Works.com:1433 corp/svclogin2  
```  
  
 <span data-ttu-id="f8cc2-236">Para obter mais informações sobre o registro manual de um SPN para SQL Server, consulte [Registrar um nome de entidade de serviço para conexões de Kerberos](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="f8cc2-236">For more information about manual registration of a SPN for SQL Server, see [Register a Service Principal Name for Kerberos Connections](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="f8cc2-237">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="f8cc2-237">Related Tasks</span></span>  
  
-   [<span data-ttu-id="f8cc2-238">Conectividade de cliente AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-238">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)
  
-   [<span data-ttu-id="f8cc2-239">Criar ou configurar um ouvinte do grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-239">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="f8cc2-240">Exibir propriedades do ouvinte do grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-240">View Availability Group Listener Properties &#40;SQL Server&#41;</span></span>](availability-groups/windows/view-availability-group-listener-properties-sql-server.md)  
  
-   [<span data-ttu-id="f8cc2-241">Remover um ouvinte do grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-241">Remove an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/remove-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="f8cc2-242">Configurar o acesso somente leitura em uma réplica de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-242">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="f8cc2-243">Configurar o roteamento somente leitura para um grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-243">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="f8cc2-244">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="f8cc2-244">Related Content</span></span>  
  
-   [<span data-ttu-id="f8cc2-245">Guia de soluções AlwaysOn do Microsoft SQL Server para alta disponibilidade e recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="f8cc2-245">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   <span data-ttu-id="f8cc2-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (Introdução ao ouvinte de grupo de disponibilidade) (um blog da equipe do SQL Server AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="f8cc2-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (a SQL Server AlwaysOn team blog)</span></span>  
  
-   [<span data-ttu-id="f8cc2-247">Blog da equipe do AlwaysOn do SQL Server: blog oficial da equipe do SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="f8cc2-247">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="f8cc2-248">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="f8cc2-248">See Also</span></span>  
 <span data-ttu-id="f8cc2-249">[Visão geral do Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="f8cc2-249">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="f8cc2-250">Conectividade de cliente AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-250">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)  
 <span data-ttu-id="f8cc2-251">[Sobre o acesso de conexão de cliente a réplicas de disponibilidade &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="f8cc2-251">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="f8cc2-252">[Secundárias ativas: réplicas secundárias legíveis &#40;Grupos de Disponibilidade AlwaysOn&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="f8cc2-252">[Active Secondaries: Readable Secondary Replicas &#40;AlwaysOn Availability Groups&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span></span>  
 [<span data-ttu-id="f8cc2-253">Conectar clientes a uma sessão de espelhamento de banco de dados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f8cc2-253">Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;</span></span>](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)
