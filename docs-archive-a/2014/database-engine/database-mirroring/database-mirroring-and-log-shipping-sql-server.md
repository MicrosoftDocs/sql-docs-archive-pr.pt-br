---
title: Espelhamento de banco de dados e envio de logs (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87571573"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="1d4d6-102">Espelhamento de banco de dados e envio de logs (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1d4d6-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="1d4d6-103">Um determinado banco de dados pode ser espelhado ou ter o log enviado; ou ter os dois processos realizados simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="1d4d6-104">Para escolher o método a ser usado, considere o seguinte:</span><span class="sxs-lookup"><span data-stu-id="1d4d6-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="1d4d6-105">Você precisa de quantos servidores de destino?</span><span class="sxs-lookup"><span data-stu-id="1d4d6-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="1d4d6-106">Se você precisar de um único banco de dados de destino, o espelhamento de banco de dados será a solução indicada.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="1d4d6-107">Se você precisar de mais de um banco de dados de destino, deverá usar o envio de logs, sozinho ou com o espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="1d4d6-108">A combinação dos dois métodos traz os benefícios de um espelhamento de banco de dados com o suporte de vários destinos fornecido pelo envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="1d4d6-109">Caso precise adiar a restauração do log no banco de dados de destino (geralmente, para se proteger contra erros lógicos), use o envio de logs, sozinho ou com o espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="1d4d6-110">Este tópico aborda as considerações sobre como combinar o envio de logs com o espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1d4d6-111">Para introduções a essas tecnologias, consulte [Espelhamento de banco de dados &#40;SQL Server&#41;](database-mirroring-sql-server.md) e [Sobre o envio de Log &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="1d4d6-112">Combinando o envio de logs e o espelhamento de banco de dados</span><span class="sxs-lookup"><span data-stu-id="1d4d6-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="1d4d6-113">O banco de dados principal em uma sessão de espelhamento também pode agir como o banco de dados primário em uma configuração de envio de logs, ou vice-versa; uma vez que o compartilhamento de backup do envio de logs está intacto.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="1d4d6-114">A sessão de espelhamento de banco de dados é executada em qualquer modo operacional, síncrono (com a segurança de transação definida como FULL) ou assíncrono (com a segurança de transação definida como OFF).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1d4d6-115">Para usar o espelhamento de banco de dados em um banco de dados, será sempre necessário o modelo de recuperação completa.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="1d4d6-116">Geralmente, ao combinar o envio de logs e o espelhamento de banco de dados, a sessão de espelhamento é estabelecida antes do envio de logs, embora isso não seja um exigência.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="1d4d6-117">O banco de dados principal atual é configurado como envio de logs primário (o *banco de dados principal/primário*), junto com um ou mais bancos de dados secundários remotos.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="1d4d6-118">Além disso, o banco de dados espelho deve ser configurado como envio de logs primário (o *banco de dados espelho/primário*).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="1d4d6-119">Os bancos de dados secundários de envio de logs devem ocupar instâncias de servidor diferentes do servidor principal/primário ou servidor espelho/primário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1d4d6-120">As configurações de diferenciação de maiúsculas e minúsculas dos servidores envolvidos no envio de logs devem corresponder.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="1d4d6-121">Durante uma sessão de envio de logs, os trabalhos de backup no banco de dados primário criam backups de log em uma pasta de backup.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="1d4d6-122">Nessa pasta, os backups são copiados por trabalhos de cópia dos servidores secundários.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="1d4d6-123">Para obterem êxito, os trabalhos de backup e de cópia devem ter acesso à pasta de backup de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="1d4d6-124">Para maximizar a disponibilidade do servidor primário, recomendamos que a pasta de backup seja estabelecida em um local de backup compartilhado em um computador host separado.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="1d4d6-125">Assegure de que todos os servidores de envio de logs, inclusive o servidor espelho/primário, possam acessar o local de backup compartilhado (conhecido como um *compartilhamento de backup*).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="1d4d6-126">Para permitir que o envio de logs continue depois que houver falha no espelhamento de banco de dados, você também deverá configurar o servidor espelho como um servidor primário, usando a mesma configuração utilizada para o primário, no banco de dados principal.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="1d4d6-127">O banco de dados espelho está no estado de restauração, o que impede que os trabalhos de backup façam o backup do log no banco de dados espelho.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="1d4d6-128">Isso assegura que o banco de dados espelho/primário não interfira no banco de dados principal/primário cujos backups de log estão sendo copiados atualmente por servidores secundários.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="1d4d6-129">Para evitar alertas falsos, depois que o trabalho de backup é executado no banco de dados espelho/primário, ele emite uma mensagem para a tabela**log_shipping_monitor_history_detail** e o trabalho de agente retorna um status de êxito.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="1d4d6-130">O banco de dados espelho/primário está inativo na sessão de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="1d4d6-131">Porém, se houver falha no espelhamento, o banco de dados espelho anterior ficará online como o banco de dados principal.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="1d4d6-132">Nessa altura, aquele banco de dados também fica ativo como o banco de dados primário de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="1d4d6-133">Os trabalhos de backup de envio de logs que não puderam enviar previamente o log de envio naquele banco de dados, começam a enviar o log.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="1d4d6-134">Reciprocamente, um failover faz com que o banco de dados principal/primário anterior se torne o novo banco de dados espelho/primário e entre em estado de restauração, e os trabalhos de backup naquele banco de dados interrompam o backup de log.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1d4d6-135">No caso de um failover automático, a alteração para a função espelho acontece quando o banco de dados principal/primário anterior volta à sessão de espelhamento.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="1d4d6-136">Para executar em modo de segurança alta com failover automático a sessão de espelhamento está configurada com uma instância de servidor adicional conhecida como *testemunha*.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="1d4d6-137">Se o banco de dados principal estiver perdido por qualquer motivo, depois que o banco de dados for sincronizado e se o servidor espelho e a testemunha ainda conseguirem se comunicar, haverá um failover automático.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="1d4d6-138">Um failover automático faz com que o servidor espelho assuma a função principal e coloque seu banco de dados online como o banco de dados principal.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="1d4d6-139">Se o local de backup de envio de logs estiver acessível ao novo servidor principal/primário, seus trabalhos de backup começarão a enviar backups de log àquele local.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="1d4d6-140">O modo síncrono do espelhamento de banco de dados garante que a cadeia de logs não seja afetada por um failover de espelhamento, e que somente o log válido seja restaurado.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="1d4d6-141">Os servidores secundários continuam copiando backups de log sem saber que uma instância de servidor diferente se tornou o servidor primário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="1d4d6-142">Ao usar um monitor de envio de logs local, torna-se desnecessária qualquer consideração especial para acomodar esse cenário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="1d4d6-143">Para obter informações sobre como usar uma instância de monitoramento remoto com esse cenário, consulte "O Impacto do espelhamento de banco de dados em uma instância de monitoramento remoto", mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="1d4d6-144">Failover do banco de dados principal para o banco de dados espelho</span><span class="sxs-lookup"><span data-stu-id="1d4d6-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="1d4d6-145">A figura a seguir mostra como o envio de logs e o espelhamento de banco dados trabalham juntos quando o espelhamento está sendo executado em modo de alta segurança com failover automático.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="1d4d6-146">Inicialmente, o **Server_A** é o servidor principal do espelhamento e o servidor primário do envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="1d4d6-147">O**Server_B** é o servidor espelho, mas também está configurado como um servidor primário, só que inativo no momento.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="1d4d6-148">O**Server_C** e o **Server_D** são servidores de envio de logs secundários.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="1d4d6-149">Para maximizar a disponibilidade da sessão de envio de logs, o local de backup fica em um diretório de compartilhamento em um computador host separado.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="1d4d6-150">![Envio de logs e espelhamento de banco de dados](../media/logshipping-and-dbm-automatic-failover.gif "Envio de logs e espelhamento de banco de dados")</span><span class="sxs-lookup"><span data-stu-id="1d4d6-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="1d4d6-151">Depois de um failover de espelhamento, o nome do servidor primário definido no servidor secundário permanece inalterado.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="1d4d6-152">.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="1d4d6-153">O impacto do espelhamento de banco de dados em uma instância de monitoramento remoto</span><span class="sxs-lookup"><span data-stu-id="1d4d6-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="1d4d6-154">Quando o envio de logs é usado com uma instância de monitoramento remoto, a combinação da sessão de envio de logs e de espelhamento de banco de dados afeta as informações nas tabelas de monitor.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="1d4d6-155">As informações sobre o primário formam uma combinação de um configurado no principal/primário e o monitor configurado em cada secundário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="1d4d6-156">Para continuar monitorando da maneira mais uniforme possível, ao usar um monitor remoto, recomendamos que você especifique o nome primário original ao configurar o primário no secundário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="1d4d6-157">Essa abordagem também facilita a alteração da configuração de envio de logs do Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="1d4d6-158">Para obter mais informações sobre o monitoramento, consulte [Monitorar o envio de logs &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="1d4d6-159">Configurando um espelhamento e um envio de logs em conjunto</span><span class="sxs-lookup"><span data-stu-id="1d4d6-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="1d4d6-160">Para configurar um espelhamento de banco de dados junto com um envio de logs, siga as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="1d4d6-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="1d4d6-161">Restaure os backups do banco de dados principal/primário com NORECOVERY em outra instância de servidor a ser usada posteriormente como banco de dados espelho do espelhamento de banco de dados para o banco de dados principal/primário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="1d4d6-162">Para obter mais informações, veja [Preparar um banco de dados espelho para espelhamento &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="1d4d6-163">Configure um espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-163">Set up database mirroring.</span></span> <span data-ttu-id="1d4d6-164">Para obter mais informações, veja [Estabelecer uma sessão de espelhamento de banco de dados usando a Autenticação do Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) ou [Configurando o espelhamento de banco de dados &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="1d4d6-165">Restaure os backups do banco de dados principal/primário para outras instâncias do servidor a serem usadas posteriormente como bancos de dados secundários de envio de logs para o banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="1d4d6-166">Configure um envio de logs no banco de dados principal como o banco de dados primário para um ou mais bancos de dados secundários.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="1d4d6-167">Você deveria configurar um único compartilhamento como parte como diretório de backup (um compartilhamento de backup).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="1d4d6-168">Isso garante que depois da troca de funções entre os servidores principal e espelho, os trabalhos de backup continuam gravando no mesmo diretório que antes.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="1d4d6-169">Uma prática recomendada é garantir que esse compartilhamento esteja localizado em um servidor físico diferente dos servidores que hospedam os bancos de dados envolvidos no espelhamento e no envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="1d4d6-170">Para obter mais informações, consulte [Configurar o envio de logs &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1d4d6-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="1d4d6-171">Execute o failover manualmente do principal para o espelho.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="1d4d6-172">Para executar um failover manual:</span><span class="sxs-lookup"><span data-stu-id="1d4d6-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="1d4d6-173">Executar failover manualmente de uma sessão de espelhamento de banco de dados &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="1d4d6-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="1d4d6-174">Executar failover manualmente em uma sessão de espelhamento de banco de dados &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="1d4d6-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="1d4d6-175">Configure um envio de logs no principal novo (antigo espelho) como sendo o banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="1d4d6-176">Não execute nenhuma configuração de um secundário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="1d4d6-177">É necessário usar o mesmo compartilhamento de backup usado na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="1d4d6-178">A interface **Envio do Log de Transações** no [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] oferece suporte apenas a um banco de dados primário por configuração de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="1d4d6-179">Portanto, é necessário usar os procedimentos armazenados para configurar o novo principal como primário.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="1d4d6-180">Execute outro failover manual para failback da entidade original.</span><span class="sxs-lookup"><span data-stu-id="1d4d6-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
