---
title: Testemunha de espelhamento de banco de dados | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 6ac02e2a5dbe86af72c15c07e14de70b12892b48
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570213"
---
# <a name="database-mirroring-witness"></a><span data-ttu-id="91443-102">Testemunha de espelhamento de banco de dados</span><span class="sxs-lookup"><span data-stu-id="91443-102">Database Mirroring Witness</span></span>
  <span data-ttu-id="91443-103">Para dar suporte a failover automático, a sessão de espelhamento de banco de dados deve ser configurada em modo de alta segurança e também deve possuir uma terceira instância de servidor, conhecida como *testemunha*.</span><span class="sxs-lookup"><span data-stu-id="91443-103">To support automatic failover, a database mirroring session must be configured in high-safety mode and also possess a third server instance, known as the *witness*.</span></span> <span data-ttu-id="91443-104">A testemunha é uma instância opcional do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que permite ao servidor espelho, em uma sessão de modo de alta segurança, reconhecer se um failover automático deve ser iniciado.</span><span class="sxs-lookup"><span data-stu-id="91443-104">The witness is an optional instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that enables the mirror server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="91443-105">Ao contrário dos dois parceiros, a testemunha não atende ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="91443-105">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="91443-106">O suporte ao failover automático é a única função da testemunha.</span><span class="sxs-lookup"><span data-stu-id="91443-106">Supporting automatic failover is the only role of the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="91443-107">No modo de alto desempenho, a testemunha pode prejudicar a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="91443-107">In high-performance mode, the witness can adversely affect availability.</span></span> <span data-ttu-id="91443-108">Se uma testemunha for configurada para uma sessão de espelhamento de banco de dados, o servidor principal deverá ser conectado a pelo menos uma das outras instâncias de servidor, o servidor espelho ou a testemunha, ou ambos.</span><span class="sxs-lookup"><span data-stu-id="91443-108">If a witness is configured for a database mirroring session, the principal server must be connected at least to one of the other server instances, the mirror server or the witness, or both of them.</span></span> <span data-ttu-id="91443-109">Caso contrário, o banco de dados ficará indisponível e será impossível forçar o serviço (com possível perda de dados).</span><span class="sxs-lookup"><span data-stu-id="91443-109">Otherwise, the database becomes unavailable and forcing service (with possible data loss) is impossible.</span></span> <span data-ttu-id="91443-110">Portanto, para o modo de alto desempenho, é altamente recomendável que você sempre mantenha a testemunha definida como OFF.</span><span class="sxs-lookup"><span data-stu-id="91443-110">Therefore, for high-performance mode, we strongly recommend that you always keep the witness set to OFF.</span></span> <span data-ttu-id="91443-111">Para obter informações sobre o impacto de uma testemunha no modo de alto desempenho, veja [Modos de operação de espelhamento de banco de dados](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="91443-111">For information about the impact of a witness on high-performance mode, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="91443-112">A ilustração a seguir mostra uma sessão de modo de alta segurança com uma testemunha.</span><span class="sxs-lookup"><span data-stu-id="91443-112">The following illustration shows a high-safety mode session with a witness.</span></span>  
  
 <span data-ttu-id="91443-113">![Sessão de espelhamento com uma testemunha](../media/dbm-3-way-session-intro.gif "Sessão de espelhamento com uma testemunha")</span><span class="sxs-lookup"><span data-stu-id="91443-113">![Mirroring session with a witness](../media/dbm-3-way-session-intro.gif "Mirroring session with a witness")</span></span>  
  
 <span data-ttu-id="91443-114">**Neste tópico:**</span><span class="sxs-lookup"><span data-stu-id="91443-114">**In This Topic:**</span></span>  
  
-   [<span data-ttu-id="91443-115">Usando uma testemunha em várias sessões</span><span class="sxs-lookup"><span data-stu-id="91443-115">Using a Witness in Multiple Sessions</span></span>](#InMultipleSessions)  
  
-   [<span data-ttu-id="91443-116">Recomendações de software e hardware</span><span class="sxs-lookup"><span data-stu-id="91443-116">Software and Hardware Recommendations</span></span>](#SwHwRecommendations)  
  
-   [<span data-ttu-id="91443-117">Função da testemunha no failover automático</span><span class="sxs-lookup"><span data-stu-id="91443-117">Role of the Witness in Automatic Failover</span></span>](#InAutoFo)  
  
-   [<span data-ttu-id="91443-118">Para adicionar ou remover uma testemunha</span><span class="sxs-lookup"><span data-stu-id="91443-118">To Add or Remove a Witness</span></span>](#AddRemoveWitness)  
  
##  <a name="using-a-witness-in-multiple-sessions"></a><a name="InMultipleSessions"></a> <span data-ttu-id="91443-119">Usando uma testemunha em várias sessões</span><span class="sxs-lookup"><span data-stu-id="91443-119">Using a Witness in Multiple Sessions</span></span>  
 <span data-ttu-id="91443-120">Uma instância de servidor específica pode agir como uma testemunha em sessões de espelhamento de banco de dados, cada uma para um banco de dados diferente.</span><span class="sxs-lookup"><span data-stu-id="91443-120">A specific server instance can act as a witness in concurrent database mirroring sessions, each for a different database.</span></span> <span data-ttu-id="91443-121">As sessões diferentes podem ser com parceiros diferentes.</span><span class="sxs-lookup"><span data-stu-id="91443-121">Different sessions can be with different partners.</span></span> <span data-ttu-id="91443-122">A ilustração a seguir mostra uma instância de servidor que é uma testemunha em duas sessões de espelhamento de banco de dados com parceiros diferentes.</span><span class="sxs-lookup"><span data-stu-id="91443-122">The following illustration shows a server instance that is a witness in two database mirroring sessions with different partners.</span></span>  
  
 <span data-ttu-id="91443-123">![Instância do servidor que é uma testemunha para dois bancos de dados](../media/dbm-witness-in-2-sessions.gif "Instância do servidor que é uma testemunha para dois bancos de dados")</span><span class="sxs-lookup"><span data-stu-id="91443-123">![Server instance that is a witness for 2 databases](../media/dbm-witness-in-2-sessions.gif "Server instance that is a witness for 2 databases")</span></span>  
  
 <span data-ttu-id="91443-124">Uma instância de servidor único também pode funcionar ao mesmo tempo como uma testemunha em algumas sessões e um parceiro em outras sessões.</span><span class="sxs-lookup"><span data-stu-id="91443-124">A single-server instance can also function at the same time as a witness in some sessions and a partner in other sessions.</span></span> <span data-ttu-id="91443-125">Porém, na prática, uma instância de servidor normalmente funciona como uma testemunha ou um parceiro.</span><span class="sxs-lookup"><span data-stu-id="91443-125">However, in practice, a server instance typically functions as either a witness or a partner.</span></span> <span data-ttu-id="91443-126">Isso porque os parceiros exigem computadores sofisticados com hardware suficiente para oferecer suporte a um banco de dados de produção, ao passo que a testemunha pode ser executada em qualquer sistema Windows disponível que ofereça suporte ao [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="91443-126">This is because the partners require sophisticated computers that have enough hardware to support a production database, whereas the witness can run on any available Windows system that supports [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
##  <a name="software-and-hardware-recommendations"></a><a name="SwHwRecommendations"></a> <span data-ttu-id="91443-127">Recomendações de software e hardware</span><span class="sxs-lookup"><span data-stu-id="91443-127">Software and Hardware Recommendations</span></span>  
 <span data-ttu-id="91443-128">A localização da testemunha em um computador separado dos parceiros é altamente recomendável.</span><span class="sxs-lookup"><span data-stu-id="91443-128">We strongly recommend that the witness reside on a separate computer from the partners.</span></span> <span data-ttu-id="91443-129">Os parceiros de espelhamento de banco de dados só têm suporte no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition e no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] e Enterprise edition.</span><span class="sxs-lookup"><span data-stu-id="91443-129">Database mirroring partners are supported only by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="91443-130">As testemunhas, em contrapartida, também têm suporte no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup e no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span><span class="sxs-lookup"><span data-stu-id="91443-130">Witnesses, in contrast, are also supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span></span> <span data-ttu-id="91443-131">Exceto durante uma atualização de uma versão anterior do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], as instâncias de servidor em uma sessão de espelhamento devem todas estar executando a mesma versão do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="91443-131">Except during an upgrade from an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the server instances in a mirroring session must all be running the same version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="91443-132">Por exemplo, uma testemunha do [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] tem suporte quando você está atualizando de uma configuração de espelhamento do [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] , mas não pode ser adicionada a uma configuração de espelhamento do [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] existente, nova ou posterior.</span><span class="sxs-lookup"><span data-stu-id="91443-132">For example, a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] witness is supported when you are upgrading from a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] mirroring configuration but cannot be added to an existing or new [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] or later mirroring configuration.</span></span>  
  
 <span data-ttu-id="91443-133">Uma testemunha pode ser executada em qualquer sistema de computador confiável que forneça suporte a quaisquer edições do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="91443-133">A witness can run on any reliable computer system that supports any of these editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="91443-134">Porém, é recomendável que toda instância de servidor usada como testemunha atenda à configuração mínima exigida para a versão Standard do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que está sendo executada.</span><span class="sxs-lookup"><span data-stu-id="91443-134">However, we recommend that every server instance that is used as a witness correspond to the minimum configuration that is required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard version that you are running.</span></span> <span data-ttu-id="91443-135">Para obter mais informações sobre esses requisitos, consulte [requisitos de hardware e software para a instalação do SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="91443-135">For more information about these requirements, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span>  
  
##  <a name="role-of-the-witness-in-automatic-failover"></a><a name="InAutoFo"></a> <span data-ttu-id="91443-136">Função da testemunha no failover automático</span><span class="sxs-lookup"><span data-stu-id="91443-136">Role of the Witness in Automatic Failover</span></span>  
 <span data-ttu-id="91443-137">Ao longo de uma sessão de espelhamento de banco de dados, todas as instâncias de servidor monitoram seus status de conexão.</span><span class="sxs-lookup"><span data-stu-id="91443-137">Throughout a database mirroring session, all the server instances monitor their connection status.</span></span> <span data-ttu-id="91443-138">Se os parceiros forem desconectados uns dos outros, confiarão na testemunha para assegurar que apenas um deles esteja atendendo ao banco de dados atualmente.</span><span class="sxs-lookup"><span data-stu-id="91443-138">If the partners become disconnected from each other, they rely on the witness to make sure that only one of them is currently serving the database.</span></span> <span data-ttu-id="91443-139">Se um servidor espelho sincronizado perder sua conexão com o servidor principal, mas continuar conectado à testemunha, o servidor espelho entrará em contato com a testemunha para determinar se a testemunha perdeu sua conexão com o servidor principal:</span><span class="sxs-lookup"><span data-stu-id="91443-139">If a synchronized mirror server loses its connection to the principal server but remains connected to the witness, the mirror server contacts the witness to determine whether the witness has lost its connection to the principal server:</span></span>  
  
-   <span data-ttu-id="91443-140">Se o servidor principal ainda estiver conectado à testemunha, não acontecerá o failover automático.</span><span class="sxs-lookup"><span data-stu-id="91443-140">If the principal server is still connected to the witness, automatic failover does not occur.</span></span> <span data-ttu-id="91443-141">Em vez disso, o servidor principal continuará atendendo ao banco de dados enquanto estiver acumulando registros de log para enviar ao servidor espelho quando os parceiros forem reconectados.</span><span class="sxs-lookup"><span data-stu-id="91443-141">Instead, the principal server continues to server the database while accumulating log records to send the mirror server when the partners reconnect.</span></span>  
  
-   <span data-ttu-id="91443-142">Se a testemunha também estiver desconectada do servidor principal, o servidor espelho saberá que o banco de dados principal ficou indisponível.</span><span class="sxs-lookup"><span data-stu-id="91443-142">If the witness is also disconnected from the principal server, the mirror server knows that principal database has become unavailable.</span></span> <span data-ttu-id="91443-143">Nesse caso, o servidor espelho iniciará imediatamente um failover automático.</span><span class="sxs-lookup"><span data-stu-id="91443-143">In this case, the mirror server immediately initiates an automatic failover.</span></span>  
  
-   <span data-ttu-id="91443-144">Se o servidor espelho estiver desconectado da testemunha e também do servidor principal, não será possível o failover automático, independentemente do estado do servidor principal.</span><span class="sxs-lookup"><span data-stu-id="91443-144">If the mirror server is disconnected from the witness and also from the principal server, automatic failover is not possible, regardless of the state of the principal server.</span></span>  
  
 <span data-ttu-id="91443-145">O requisito de que pelo menos duas das instâncias de servidor estejam conectadas é conhecido como *quorum*.</span><span class="sxs-lookup"><span data-stu-id="91443-145">The requirement that at least two of the server instances be connected is known as *quorum*.</span></span> <span data-ttu-id="91443-146">O quorum assegura que o banco de dados só possa ser atendido por um parceiro de cada vez.</span><span class="sxs-lookup"><span data-stu-id="91443-146">Quorum makes sure that the database can only be served by one partner at a time.</span></span> <span data-ttu-id="91443-147">Para obter informações sobre o funcionamento do quorum e seu impacto em uma sessão, veja [Quorum: Como uma testemunha afeta a disponibilidade do banco de dados &#40;Espelhamento de Banco de Dados&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="91443-147">For information about how quorum works and its impact on a session, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
##  <a name="to-add-or-remove-a-witness"></a><a name="AddRemoveWitness"></a> <span data-ttu-id="91443-148">Para adicionar ou remover uma testemunha</span><span class="sxs-lookup"><span data-stu-id="91443-148">To Add or Remove a Witness</span></span>  
 <span data-ttu-id="91443-149">**Para adicionar uma testemunha**</span><span class="sxs-lookup"><span data-stu-id="91443-149">**To add a witness**</span></span>  
  
-   [<span data-ttu-id="91443-150">Adicionar ou substituir uma testemunha de espelhamento de banco de dados &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="91443-150">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="91443-151">Adicionar uma testemunha de espelhamento de banco de dados usando a Autenticação do Windows &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="91443-151">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 <span data-ttu-id="91443-152">**Para remover a testemunha**</span><span class="sxs-lookup"><span data-stu-id="91443-152">**To remove the witness**</span></span>  
  
-   [<span data-ttu-id="91443-153">Remover a testemunha de uma sessão de espelhamento de banco de dados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="91443-153">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="91443-154">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="91443-154">See Also</span></span>  
 <span data-ttu-id="91443-155">[Troca de função durante uma sessão de espelhamento de banco de dados &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="91443-155">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="91443-156">[Modos de operação de espelhamento de banco de dados](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="91443-156">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="91443-157">[Quorum: como uma testemunha afeta a disponibilidade do banco de dados &#40;Espelhamento de Banco de Dados&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="91443-157">[Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span></span>  
 <span data-ttu-id="91443-158">[Possíveis falhas durante o espelhamento de banco de dados](possible-failures-during-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="91443-158">[Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md) </span></span>  
 [<span data-ttu-id="91443-159">Estados de espelhamento &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="91443-159">Mirroring States &#40;SQL Server&#41;</span></span>](mirroring-states-sql-server.md)  
  
  
