---
title: Espelhamento de banco de dados e instâncias de cluster de failover do SQL Server | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- failover clustering [SQL Server], database mirroring
- database mirroring [SQL Server], failover
- high-availability mode [SQL Server]
ms.assetid: f1dd6a79-698b-4e31-b923-6bfc3ea0b617
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 378f834b4482f44f6a84abf419f027b353c7771a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87683673"
---
# <a name="database-mirroring-and-sql-server-failover-cluster-instances"></a><span data-ttu-id="df7e9-102">Espelhamento de banco de dados e instâncias de cluster de failover do SQL Server</span><span class="sxs-lookup"><span data-stu-id="df7e9-102">Database Mirroring and SQL Server Failover Cluster Instances</span></span>
  <span data-ttu-id="df7e9-103">Um cluster de failover é uma combinação de um ou mais discos físicos em um grupo de clusters do [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS), conhecido como um grupo de recursos, que são nós participantes do cluster.</span><span class="sxs-lookup"><span data-stu-id="df7e9-103">A failover cluster is a combination of one or more physical disks in a [!INCLUDE[msCoName](../../includes/msconame-md.md)] Cluster Service (MSCS) cluster group, known as a resource group, that are participating nodes of the cluster.</span></span> <span data-ttu-id="df7e9-104">O grupo de recursos é configurado como uma instância clusterizada de failover que hospeda uma instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="df7e9-104">The resource group is configured as a failover clustered instance that hosts an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="df7e9-105">Uma instância clusterizada de failover do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] aparece na rede como se fosse um único computador, mas tem funções que fornecerão failover de um nó para outro se um nó se tornar disponível.</span><span class="sxs-lookup"><span data-stu-id="df7e9-105">A [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance appears on the network as if it were a single computer, but has functionality that provides failover from one node to another if one node becomes unavailable.</span></span> <span data-ttu-id="df7e9-106">Para obter mais informações, consulte [Instâncias do Cluster de Failover do AlwaysOn (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df7e9-106">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
 <span data-ttu-id="df7e9-107">Os clusters de failover fornecem suporte de alta disponibilidade para toda uma instância do [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], em contrapartida ao espelhamento de banco de dados, que fornece suporte de alta disponibilidade para um banco de dados individual.</span><span class="sxs-lookup"><span data-stu-id="df7e9-107">Failover clusters provide high-availability support for an entire [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance, in contrast to database mirroring, which provides high-availability support for a single database.</span></span> <span data-ttu-id="df7e9-108">O espelhamento de banco de dados funciona entre clusters de failover e também entre um cluster de failover e um host não clusterizado.</span><span class="sxs-lookup"><span data-stu-id="df7e9-108">Database mirroring works between failover clusters and, also, between a failover cluster and a nonclustered host.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="df7e9-109">Para obter uma introdução ao espelhamento de banco de dados, consulte [Espelhamento de banco de dados &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="df7e9-109">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
## <a name="mirroring-and-clustering"></a><span data-ttu-id="df7e9-110">Espelhamento e clusterização</span><span class="sxs-lookup"><span data-stu-id="df7e9-110">Mirroring and Clustering</span></span>  
 <span data-ttu-id="df7e9-111">Em geral, quando o espelhamento é usado com clustering, o servidor principal e o servidor espelho residem em clusters, sendo que o servidor principal é executado na instância clusterizada de failover de um cluster e o servidor espelho é executado na instância clusterizada de failover de um cluster diferente.</span><span class="sxs-lookup"><span data-stu-id="df7e9-111">Typically, when mirroring is used with clustering, the principal server and mirror server both reside on clusters, with the principal server running on the failover clustered instance of one cluster and the mirror server running on the failover clustered instance of a different cluster.</span></span> <span data-ttu-id="df7e9-112">No entanto, você pode estabelecer uma sessão de espelhamento na qual um parceiro reside na instância clusterizada de failover e o outro reside em um computador separado não clusterizado.</span><span class="sxs-lookup"><span data-stu-id="df7e9-112">You can establish a mirroring session in which one partner resides on the failover clustered instance of a cluster and the other partner resides on a separate, unclustered computer, however.</span></span>  
  
 <span data-ttu-id="df7e9-113">Se um failover de cluster tornar um servidor principal temporariamente indisponível, as conexões de clientes serão desconectadas do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="df7e9-113">If a cluster failover makes a principal server temporarily unavailable, client connections are disconnected from the database.</span></span> <span data-ttu-id="df7e9-114">Após a conclusão do failover de cluster, os clientes podem se reconectar ao servidor principal no mesmo cluster ou em outro cluster ou em um computador não clusterizado, dependendo do [modo operacional](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="df7e9-114">After the cluster failover completes, clients can reconnect to the principal server on the same cluster, or on a different cluster or an unclustered computer, depending on the [operating mode](database-mirroring-operating-modes.md).</span></span> <span data-ttu-id="df7e9-115">Portanto, quando você decide como configurar o espelhamento de banco de dados em um ambiente clusterizado, o modo operacional utilizado para o espelhamento é importante.</span><span class="sxs-lookup"><span data-stu-id="df7e9-115">Therefore, when deciding how to configure database mirroring in a clustered environment, the operating mode you use for mirroring is significant.</span></span>  
  
### <a name="high-safety-mode-session-with-automatic-failover"></a><span data-ttu-id="df7e9-116">Sessão de modo de alta segurança com failover automático</span><span class="sxs-lookup"><span data-stu-id="df7e9-116">High-Safety mode Session with Automatic Failover</span></span>  
 <span data-ttu-id="df7e9-117">Se você pretende espelhar um banco de dados no modo de alta segurança com failover automático, uma configuração de dois clusters é recomendável para os parceiros.</span><span class="sxs-lookup"><span data-stu-id="df7e9-117">If you intend to mirror a database in high-safety mode with automatic failover, a two-cluster configuration is recommended for the partners.</span></span> <span data-ttu-id="df7e9-118">Essa configuração fornece o máximo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="df7e9-118">This configuration provides maximum availability.</span></span> <span data-ttu-id="df7e9-119">A testemunha ou pode residir em um terceiro cluster ou em um computador não clusterizado.</span><span class="sxs-lookup"><span data-stu-id="df7e9-119">The witness can reside either on a third cluster or on an unclustered computer.</span></span>  
  
 <span data-ttu-id="df7e9-120">Se o nó executando o servidor principal atual falhar, o failover automático do banco de dados começará em alguns segundos, enquanto o cluster ainda estiver executando o failover para outro nó.</span><span class="sxs-lookup"><span data-stu-id="df7e9-120">If the node running the current principal server fails, automatic failover of the database begins within a few seconds, while the cluster is still failing over to another node.</span></span> <span data-ttu-id="df7e9-121">A sessão de espelhamento de banco de dados executará o failover para o servidor espelho no outro cluster ou no computador não clusterizado, e o servidor espelho anterior se tornará o servidor principal.</span><span class="sxs-lookup"><span data-stu-id="df7e9-121">The database mirroring session fails over to the mirror server on the other cluster or unclustered computer, and the former mirror server becomes the principal server.</span></span> <span data-ttu-id="df7e9-122">O novo servidor principal encaminha sua cópia do banco de dados o mais rápido possível e a coloca online como o banco de dados principal.</span><span class="sxs-lookup"><span data-stu-id="df7e9-122">The new principal server rolls forward its copy of the database as quickly as possible and brings it online as the principal database.</span></span> <span data-ttu-id="df7e9-123">Após a conclusão do failover de cluster, que geralmente leva alguns minutos, a instância clusterizada de failover que anteriormente era o servidor principal se torna o servidor espelho.</span><span class="sxs-lookup"><span data-stu-id="df7e9-123">After the cluster failover completes, which typically takes several minutes, the failover clustered instance that was formerly the principal server becomes the mirror server.</span></span>  
  
 <span data-ttu-id="df7e9-124">A ilustração a seguir mostra um failover automático entre clusters em uma sessão de espelhamento executada no modo de alta segurança com uma testemunha (que dá suporte ao failover automático).</span><span class="sxs-lookup"><span data-stu-id="df7e9-124">The following illustration shows an automatic failover between clusters in a mirroring session running in high-safety mode with a witness (which supports automatic failover).</span></span>  
  
 <span data-ttu-id="df7e9-125">![Um failover em um cluster](../media/dbm-and-failover-clustering.gif "Um failover em um cluster")</span><span class="sxs-lookup"><span data-stu-id="df7e9-125">![A failover on a cluster](../media/dbm-and-failover-clustering.gif "A failover on a cluster")</span></span>  
  
 <span data-ttu-id="df7e9-126">As três instâncias de servidor na sessão de espelhamento residem em três clusters distintos: **Cluster_A**, **Cluster_B** e **Cluster_C**.</span><span class="sxs-lookup"><span data-stu-id="df7e9-126">The three server instances in the mirroring session reside on three distinct clusters: **Cluster_A**, **Cluster_B**, and **Cluster_C**.</span></span> <span data-ttu-id="df7e9-127">Em cada cluster, uma instância padrão do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] está sendo executada como uma instância clusterizada de failover do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="df7e9-127">On each cluster, a default instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover clustered instance.</span></span> <span data-ttu-id="df7e9-128">Quando a sessão de espelhamento é iniciada, a instância clusterizada de failover no **Cluster_A** é o servidor principal, a instância clusterizada de failover no **Cluster_B** é o servidor espelho e a instância clusterizada de failover no **Cluster_C** é a testemunha na sessão de espelhamento.</span><span class="sxs-lookup"><span data-stu-id="df7e9-128">When the mirroring session starts, the failover clustered instance on **Cluster_A** is the principal server, the failover clustered instance on **Cluster_B** is the mirror server, and the failover clustered instance on **Cluster_C** is the witness in the mirroring session.</span></span> <span data-ttu-id="df7e9-129">Por fim, o nó ativo no **Cluster_A** falhará, o que fará com que o servidor principal fique indisponível.</span><span class="sxs-lookup"><span data-stu-id="df7e9-129">Eventually, the active node on **Cluster_A** fails, which causes the principal server to become unavailable.</span></span>  
  
 <span data-ttu-id="df7e9-130">Antes de o cluster ter tempo para o failover, a perda do servidor principal será detectada pelo servidor espelho, com a ajuda da testemunha.</span><span class="sxs-lookup"><span data-stu-id="df7e9-130">Before the cluster has time to fail over, the loss of the principal server is detected by the mirror server, with the help of the witness.</span></span> <span data-ttu-id="df7e9-131">O servidor espelho encaminha seu banco de dados principal e o coloca online como o novo banco de dados de entidade o mais rápido possível.</span><span class="sxs-lookup"><span data-stu-id="df7e9-131">The mirror server rolls forward its database and brings it online as the new principal database as quickly as possible.</span></span> <span data-ttu-id="df7e9-132">Quando o **Cluster_A** conclui o failover, o servidor principal anterior agora é o servidor espelho e sincroniza seu banco de dados com o banco de dados principal de entidade atual no **Cluster_B**.</span><span class="sxs-lookup"><span data-stu-id="df7e9-132">When **Cluster_A** finishes failing over, the former principal server is now the mirror server, and it synchronizes its database with the current principal database on **Cluster_B**.</span></span>  
  
### <a name="high-safety-mode-session-without-automatic-failover"></a><span data-ttu-id="df7e9-133">Sessão de modo de alta segurança sem failover automático</span><span class="sxs-lookup"><span data-stu-id="df7e9-133">High-Safety Mode Session Without Automatic Failover</span></span>  
 <span data-ttu-id="df7e9-134">Se você estiver espelhando um banco de dados no modo de alta segurança sem failover automático, outro nó no cluster atuará como o servidor principal se o nó executando o servidor principal atual falhar.</span><span class="sxs-lookup"><span data-stu-id="df7e9-134">If you are mirroring a database in high-safety mode without automatic failover, another node in the cluster will act as the principal server if the node running the current principal server fails.</span></span> <span data-ttu-id="df7e9-135">Observe que enquanto o cluster está indisponível, o banco de dados está indisponível.</span><span class="sxs-lookup"><span data-stu-id="df7e9-135">Note that while the cluster is unavailable, the database is unavailable.</span></span>  
  
### <a name="high-performance-mode-session"></a><span data-ttu-id="df7e9-136">Sessão de modo de alto desempenho</span><span class="sxs-lookup"><span data-stu-id="df7e9-136">High-Performance Mode Session</span></span>  
 <span data-ttu-id="df7e9-137">Se você pretende espelhar um banco de dados no modo de alto desempenho, considere colocar o servidor principal na instância clusterizada de failover de um cluster e colocar o servidor espelho em um servidor não clusterizado em um local remoto.</span><span class="sxs-lookup"><span data-stu-id="df7e9-137">If you intend to mirror a database in high-performance mode, consider placing the principal server on the failover clustered instance of a cluster and placing the mirror server on an unclustered server in a remote location.</span></span> <span data-ttu-id="df7e9-138">Se o cluster executar o failover para outro nó, a instância clusterizada de failover continuará como o servidor principal na sessão de espelhamento.</span><span class="sxs-lookup"><span data-stu-id="df7e9-138">If the cluster fails over to a different node, the failover clustered instance will continue as the principal server in the mirroring session.</span></span> <span data-ttu-id="df7e9-139">Se todo o cluster tiver problemas, você poderá forçar serviço no servidor espelho.</span><span class="sxs-lookup"><span data-stu-id="df7e9-139">If the entire cluster has problems, you can force service onto the mirror server.</span></span>  
  
 <span data-ttu-id="df7e9-140">**Para configurar um novo cluster de failover do SQL Server**</span><span class="sxs-lookup"><span data-stu-id="df7e9-140">**To set up a new SQL Server failover cluster**</span></span>  
  
-   [<span data-ttu-id="df7e9-141">Criar um novo cluster de failover do SQL Server &#40;Instalação&#41;</span><span class="sxs-lookup"><span data-stu-id="df7e9-141">Create a New SQL Server Failover Cluster &#40;Setup&#41;</span></span>](../../sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup.md)  
  
 <span data-ttu-id="df7e9-142">**Para configurar o espelhamento de banco de dados**</span><span class="sxs-lookup"><span data-stu-id="df7e9-142">**To set up database mirroring**</span></span>  
  
-   [<span data-ttu-id="df7e9-143">Configurando o espelhamento de banco de dados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="df7e9-143">Setting Up Database Mirroring &#40;SQL Server&#41;</span></span>](setting-up-database-mirroring-sql-server.md)  
  
-   [<span data-ttu-id="df7e9-144">Estabelecer uma sessão de espelhamento de banco de dados usando a Autenticação do Windows &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="df7e9-144">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
## <a name="see-also"></a><span data-ttu-id="df7e9-145">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="df7e9-145">See Also</span></span>  
 <span data-ttu-id="df7e9-146">[Espelhamento de banco de dados &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="df7e9-146">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 <span data-ttu-id="df7e9-147">[Modos de operação de espelhamento de banco de dados](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="df7e9-147">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 [<span data-ttu-id="df7e9-148">Instâncias de cluster de failover do AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="df7e9-148">AlwaysOn Failover Cluster Instances (SQL Server)</span></span>](../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
