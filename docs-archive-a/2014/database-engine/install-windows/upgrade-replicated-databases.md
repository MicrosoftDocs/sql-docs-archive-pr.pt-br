---
title: Fazer upgrade de bancos de dados replicados | Microsoft Docs
ms.custom: ''
ms.date: 05/24/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: install
ms.topic: conceptual
helpviewer_keywords:
- merge replication database upgrades [SQL Server replication]
- replication [SQL Server], upgrading
- transactional replication, upgrading databases
- snapshot replication [SQL Server], upgrading databases
- upgrading replicated databases
ms.assetid: 9926a4f7-bcd8-4b9b-9dcf-5426a5857116
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 326a94820876b40128428aac58e47c650ce122b8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572149"
---
# <a name="upgrade-replicated-databases"></a><span data-ttu-id="99edb-102">Atualizar bancos de dados replicados</span><span class="sxs-lookup"><span data-stu-id="99edb-102">Upgrade Replicated Databases</span></span>
  <span data-ttu-id="99edb-103">O [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] suporta a atualização de bancos de dados replicados de versões anteriores do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]; não é necessário interromper a atividade de outros nós durante a atualização de um nó.</span><span class="sxs-lookup"><span data-stu-id="99edb-103">[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] supports upgrading replicated databases from previous versions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]; it is not required to stop activity at other nodes while a node is being upgraded.</span></span> <span data-ttu-id="99edb-104">Verifique se você está em conformidade com as regras que dizem respeito às versões suportadas em uma topologia:</span><span class="sxs-lookup"><span data-stu-id="99edb-104">Ensure that you adhere to the rules regarding which versions are supported in a topology:</span></span>  
  
-   <span data-ttu-id="99edb-105">Um Distribuidor pode ser de qualquer versão, desde que ela seja maior ou igual à do Publicador (em muitos casos, o Distribuidor tem a mesma instância que o Publicador).</span><span class="sxs-lookup"><span data-stu-id="99edb-105">A Distributor can be any version as long as it is greater than or equal to the Publisher version (in many cases the Distributor is the same instance as the Publisher).</span></span>  
  
-   <span data-ttu-id="99edb-106">Um Publicador pode ser de qualquer versão, contanto que ela seja menor ou igual à versão do Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="99edb-106">A Publisher can be any version as long as it less than or equal to the Distributor version.</span></span>  
  
-   <span data-ttu-id="99edb-107">A versão de assinante depende do tipo de publicação:</span><span class="sxs-lookup"><span data-stu-id="99edb-107">Subscriber version depends on the type of publication:</span></span>  
  
    -   <span data-ttu-id="99edb-108">Um Assinante de uma publicação transacional pode ser de qualquer uma das duas versões do Publicador.</span><span class="sxs-lookup"><span data-stu-id="99edb-108">A Subscriber to a transactional publication can be any version within two versions of the Publisher version.</span></span> <span data-ttu-id="99edb-109">Por exemplo, um Publicador do [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] pode ter Assinantes do [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] e um Publicador do [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] pode ter Assinantes do [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)].</span><span class="sxs-lookup"><span data-stu-id="99edb-109">For example: a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] Publisher running can have [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] Subscribers; and a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] Publisher can have [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] Subscribers.</span></span>  
  
    -   <span data-ttu-id="99edb-110">Um Assinante de uma publicação de mesclagem pode ser de qualquer versão menor ou igual à do Publicador.</span><span class="sxs-lookup"><span data-stu-id="99edb-110">A Subscriber to a merge publication can be any version less than or equal to the Publisher version.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="99edb-111">Esse tópico está disponível na documentação de Ajuda da instalação e nos Manuais Online do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="99edb-111">This topic is available in the Setup Help documentation and in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Books Online.</span></span> <span data-ttu-id="99edb-112">Os links do tópico que aparecem em negrito na documentação da Ajuda da instalação se referem a tópicos que só estão disponíveis nos Manuais Online.</span><span class="sxs-lookup"><span data-stu-id="99edb-112">Topic links that appear as bold text in the Setup Help documentation refer to topics that are only available in Books Online.</span></span>  
  
## <a name="run-the-log-reader-agent-for-transactional-replication-before-upgrade"></a><span data-ttu-id="99edb-113">Executar o Log Reader Agent para replicação transacional antes da atualização</span><span class="sxs-lookup"><span data-stu-id="99edb-113">Run the Log Reader Agent for Transactional Replication Before Upgrade</span></span>  
 <span data-ttu-id="99edb-114">Antes de atualizar para o [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], você deve verificar se todas as transações confirmadas de tabelas publicadas foram processadas pelo Log Reader Agent.</span><span class="sxs-lookup"><span data-stu-id="99edb-114">Before you upgrade to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], you must make sure that all committed transactions from published tables have been processed by the Log Reader Agent.</span></span> <span data-ttu-id="99edb-115">Para isso, execute as seguintes etapas para cada banco de dados que contém publicações transacionais:</span><span class="sxs-lookup"><span data-stu-id="99edb-115">To make sure that all transactions have been processed, perform the following steps for each database that contains transactional publications:</span></span>  
  
1.  <span data-ttu-id="99edb-116">Verifique se o Log Reader Agent está executando para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="99edb-116">Make sure that the Log Reader Agent is running for the database.</span></span> <span data-ttu-id="99edb-117">Por padrão, o agente é executado continuamente.</span><span class="sxs-lookup"><span data-stu-id="99edb-117">By default, the agent runs continuously.</span></span>  
  
2.  <span data-ttu-id="99edb-118">Interrompa a atividade de usuário em tabelas publicadas.</span><span class="sxs-lookup"><span data-stu-id="99edb-118">Stop user activity on published tables.</span></span>  
  
3.  <span data-ttu-id="99edb-119">Conceda um tempo para que o Log Reader Agent copie transações para o banco de dados de distribuição e, depois, interrompa o agente.</span><span class="sxs-lookup"><span data-stu-id="99edb-119">Allow time for the Log Reader Agent to copy transactions to the distribution database, and then stop the agent.</span></span>  
  
4.  <span data-ttu-id="99edb-120">Execute [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql) para verificar se todas as transações foram processadas.</span><span class="sxs-lookup"><span data-stu-id="99edb-120">Execute [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql) to verify that all transactions have been processed.</span></span> <span data-ttu-id="99edb-121">O conjunto de resultados deste procedimento deve ser vazio.</span><span class="sxs-lookup"><span data-stu-id="99edb-121">The result set from this procedure should be empty.</span></span>  
  
5.  <span data-ttu-id="99edb-122">Execute [sp_replflush](/sql/relational-databases/system-stored-procedures/sp-replflush-transact-sql) para fechar a conexão de sp_replcmds.</span><span class="sxs-lookup"><span data-stu-id="99edb-122">Execute [sp_replflush](/sql/relational-databases/system-stored-procedures/sp-replflush-transact-sql) to close the connection from sp_replcmds.</span></span>  
  
6.  <span data-ttu-id="99edb-123">Execute a atualização do servidor para o [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="99edb-123">Perform the server upgrade to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
7.  <span data-ttu-id="99edb-124">Reinicie o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent e o Log Reader Agent se eles não iniciarem automaticamente depois da atualização.</span><span class="sxs-lookup"><span data-stu-id="99edb-124">Restart [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent and the Log Reader Agent if they do not start automatically after the upgrade.</span></span>  
  
## <a name="run-agents-for-merge-replication-after-upgrade"></a><span data-ttu-id="99edb-125">Executar agentes para replicação de mesclagem após a atualização</span><span class="sxs-lookup"><span data-stu-id="99edb-125">Run Agents for Merge Replication After Upgrade</span></span>  
 <span data-ttu-id="99edb-126">Depois da atualização, execute o Snapshot Agent para cada publicação de mesclagem e o Merge Agent para cada assinatura a fim de atualizar os metadados de replicação.</span><span class="sxs-lookup"><span data-stu-id="99edb-126">After upgrade, run the Snapshot Agent for each merge publication and the Merge Agent for each subscription to update replication metadata.</span></span> <span data-ttu-id="99edb-127">Você não precisa aplicar o novo instantâneo, pois não é necessário reinicializar assinaturas.</span><span class="sxs-lookup"><span data-stu-id="99edb-127">You do not have to apply the new snapshot, because it is not necessary to reinitialize subscriptions.</span></span> <span data-ttu-id="99edb-128">Metadados de assinatura são atualizados a primeira vez que o Merge Agent é executado após a atualização.</span><span class="sxs-lookup"><span data-stu-id="99edb-128">Subscription metadata is updated the first time the Merge Agent is run after upgrade.</span></span> <span data-ttu-id="99edb-129">Isso significa que o banco de dados de assinatura pode permanecer online e ativo durante a atualização do Publicador.</span><span class="sxs-lookup"><span data-stu-id="99edb-129">This means that the subscription database can remain online and active during the Publisher upgrade.</span></span>  
  
 <span data-ttu-id="99edb-130">A replicação de mesclagem armazena metadados de publicação e de assinatura em várias tabelas do sistema nos bancos de dados de publicação e de assinatura.</span><span class="sxs-lookup"><span data-stu-id="99edb-130">Merge replication stores publication and subscription metadata in a number of system tables in the publication and subscription databases.</span></span> <span data-ttu-id="99edb-131">Executar o Snapshot Agent atualiza os metadados de publicação, e executar o Merge Agent atualiza os metadados de assinatura.</span><span class="sxs-lookup"><span data-stu-id="99edb-131">Running the Snapshot Agent updates publication metadata and running the Merge Agent updates subscription metadata.</span></span> <span data-ttu-id="99edb-132">Só é necessário gerar um instantâneo de publicação.</span><span class="sxs-lookup"><span data-stu-id="99edb-132">It is only required to generate a publication snapshot.</span></span> <span data-ttu-id="99edb-133">Se uma publicação de mesclagem usar filtros com parâmetros, cada partição também terá um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="99edb-133">If a merge publication uses parameterized filters, each partition also has a snapshot.</span></span> <span data-ttu-id="99edb-134">Não é necessário atualizar esses instantâneos particionados.</span><span class="sxs-lookup"><span data-stu-id="99edb-134">It is not necessary to update these partitioned snapshots.</span></span>  
  
 <span data-ttu-id="99edb-135">Execute os agentes do [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], Replication Monitor ou da linha de comando.</span><span class="sxs-lookup"><span data-stu-id="99edb-135">Run the agents from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], Replication Monitor, or from the command line.</span></span> <span data-ttu-id="99edb-136">Para obter mais informações sobre como executar o Snapshot Agent, consulte os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="99edb-136">For more information about running the Snapshot Agent, see the following topics:</span></span>  
  
-   [<span data-ttu-id="99edb-137">Criar e aplicar o instantâneo inicial</span><span class="sxs-lookup"><span data-stu-id="99edb-137">Create and Apply the Initial Snapshot</span></span>](../../../2014/relational-databases/replication/create-and-apply-the-initial-snapshot.md)  
  
-   [<span data-ttu-id="99edb-138">Iniciar e interromper um Agente de Replicação &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="99edb-138">Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/start-and-stop-a-replication-agent-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="99edb-139">Criar e aplicar o instantâneo inicial</span><span class="sxs-lookup"><span data-stu-id="99edb-139">Create and Apply the Initial Snapshot</span></span>](../../../2014/relational-databases/replication/create-and-apply-the-initial-snapshot.md)  
  
-   [<span data-ttu-id="99edb-140">Conceitos dos executáveis do Replication Agent</span><span class="sxs-lookup"><span data-stu-id="99edb-140">Replication Agent Executables Concepts</span></span>](../../../2014/relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
 <span data-ttu-id="99edb-141">Para obter mais informações sobre como executar o Merge Agent, consulte os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="99edb-141">For more information about running the Merge Agent, see the following topics:</span></span>  
  
-   [<span data-ttu-id="99edb-142">Sincronizar uma assinatura pull</span><span class="sxs-lookup"><span data-stu-id="99edb-142">Synchronize a Pull Subscription</span></span>](../../../2014/relational-databases/replication/synchronize-a-pull-subscription.md)  
  
-   [<span data-ttu-id="99edb-143">Sincronizar uma assinatura push</span><span class="sxs-lookup"><span data-stu-id="99edb-143">Synchronize a Push Subscription</span></span>](../../../2014/relational-databases/replication/synchronize-a-push-subscription.md)  
  
 <span data-ttu-id="99edb-144">Depois de atualizar o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] em uma topologia que utiliza a replicação de mesclagem, altere o nível de compatibilidade de publicação de qualquer publicação caso queira usar novos recursos.</span><span class="sxs-lookup"><span data-stu-id="99edb-144">After upgrading [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in a topology that uses merge replication, change the publication compatibility level of any publications if you want to use new features.</span></span>  
  
## <a name="upgrading-to-standard-workgroup-or-express-editions"></a><span data-ttu-id="99edb-145">Atualizando as edições Standard, Workgroup ou Express</span><span class="sxs-lookup"><span data-stu-id="99edb-145">Upgrading to Standard, Workgroup, or Express Editions</span></span>  
 <span data-ttu-id="99edb-146">Antes de fazer upgrade de uma edição do [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] para outra, verifique se há suporte para a funcionalidade atualmente utilizada na edição para a qual deseja fazer upgrade.</span><span class="sxs-lookup"><span data-stu-id="99edb-146">Before upgrading from one edition of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] to another, verify that the functionality you are currently using is supported in the edition to which you are upgrading.</span></span> <span data-ttu-id="99edb-147">Para obter mais informações, consulte a seção sobre replicação em [recursos com suporte nas edições do SQL Server 2014](../../../2014/getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="99edb-147">For more information, see the section on Replication in [Features Supported by the Editions of SQL Server 2014](../../../2014/getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
## <a name="web-synchronization-for-merge-replication"></a><span data-ttu-id="99edb-148">Sincronização da Web para replicação de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="99edb-148">Web Synchronization for Merge Replication</span></span>  
 <span data-ttu-id="99edb-149">A opção de sincronização da Web para replicação de mesclagem requer que o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (replisapi.dll) seja copiado para o diretório virtual do servidor IIS (Serviços de Informações da Internet) usado para sincronização.</span><span class="sxs-lookup"><span data-stu-id="99edb-149">The Web synchronization option for merge replication requires that the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Replication Listener (replisapi.dll) be copied to the virtual directory on the Internet Information Services (IIS) server used for synchronization.</span></span> <span data-ttu-id="99edb-150">Quando você configura a sincronização da Web, o arquivo é copiado para o diretório virtual pelo Assistente para Configuração da Sincronização da Web.</span><span class="sxs-lookup"><span data-stu-id="99edb-150">When you configure Web synchronization, the file is copied to the virtual directory by the Configure Web Synchronization Wizard.</span></span> <span data-ttu-id="99edb-151">Se você atualizar os componentes do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instalados no servidor IIS, deverá copiar replisapi.dll manualmente do diretório COM para o diretório virtual no servidor IIS.</span><span class="sxs-lookup"><span data-stu-id="99edb-151">If you upgrade the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] components installed on the IIS server, you must manually copy replisapi.dll from the COM directory to the virtual directory on the IIS server.</span></span> <span data-ttu-id="99edb-152">Para obter mais informações sobre como configurar a sincronização da Web, veja [Configurar sincronização da Web](../../../2014/relational-databases/replication/configure-web-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="99edb-152">For more information about configuring Web synchronization, see [Configure Web Synchronization](../../../2014/relational-databases/replication/configure-web-synchronization.md).</span></span>  
  
## <a name="restoring-a-replicated-database-from-an-earlier-version"></a><span data-ttu-id="99edb-153">Restaurando um banco de dados replicado de uma versão anterior</span><span class="sxs-lookup"><span data-stu-id="99edb-153">Restoring a Replicated Database from an Earlier Version</span></span>  
 <span data-ttu-id="99edb-154">Para assegurar que as configurações de replicação sejam mantidas na restauração do backup de um banco de dados replicado de uma versão anterior, restaure para um servidor e um banco de dados que tenham os mesmos nomes que o servidor e o banco de dados dos quais foi obtido o backup.</span><span class="sxs-lookup"><span data-stu-id="99edb-154">To ensure replication settings are retained when restoring a backup of a replicated database from a previous version: restore to a server and database with the same names as the server and database at which the backup was taken.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="99edb-155">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="99edb-155">See Also</span></span>  
 <span data-ttu-id="99edb-156">[Perguntas Frequentes sobre Administração de Replicação](../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md) </span><span class="sxs-lookup"><span data-stu-id="99edb-156">[Replication Administration FAQ](../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md) </span></span>  
 <span data-ttu-id="99edb-157">[Compatibilidade com versões anteriores de replicação](../../../2014/relational-databases/replication/replication-backward-compatibility.md) </span><span class="sxs-lookup"><span data-stu-id="99edb-157">[Replication Backward Compatibility](../../../2014/relational-databases/replication/replication-backward-compatibility.md) </span></span>  
 <span data-ttu-id="99edb-158">[Atualizações de versão e edição com suporte](../../database-engine/install-windows/supported-version-and-edition-upgrades.md) </span><span class="sxs-lookup"><span data-stu-id="99edb-158">[Supported Version and Edition Upgrades](../../database-engine/install-windows/supported-version-and-edition-upgrades.md) </span></span>  
 [<span data-ttu-id="99edb-159">Atualizar para o SQL Server 2014</span><span class="sxs-lookup"><span data-stu-id="99edb-159">Upgrade to SQL Server 2014</span></span>](upgrade-sql-server.md)  
  
  
