---
title: 'SQL Server Backup gerenciado para o Azure: interoperabilidade e coexistência | Microsoft Docs'
description: Este artigo descreve SQL Server Backup gerenciado para Microsoft Azure interoperabilidade e coexistência com vários recursos do SQL Server 2014.
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 78fb78ed-653f-45fe-a02a-a66519bfee1b
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 2e2839fc4755fe47504e42e5058a5da117888900
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87681062"
---
# <a name="sql-server-managed-backup-to-azure-interoperability-and-coexistence"></a><span data-ttu-id="f7bd1-103">Backup gerenciado do SQL Server para o Azure: interoperabilidade e coexistência</span><span class="sxs-lookup"><span data-stu-id="f7bd1-103">SQL Server Managed Backup to Azure: Interoperability and Coexistence</span></span>
  <span data-ttu-id="f7bd1-104">Este tópico descreve a interoperabilidade e a coexistência do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] em vários recursos do [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f7bd1-104">This topic describes [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] interoperability and coexistence with several features in [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="f7bd1-105">Esses recursos incluem: Grupos de Disponibilidade AlwaysOn, Espelhamento de Banco de Dados, Planos de Manutenção de Backup, Envio de Logs, Backups ad hoc, Desanexar Banco de Dados e Remover Banco de Dados.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-105">These features include the following: AlwaysOn Availability Groups, Database Mirroring, Backup Maintenance Plans, Log Shipping, Ad hoc backups, Detach Database, and Drop Database.</span></span>  
  
### <a name="alwayson-availability-groups"></a><span data-ttu-id="f7bd1-106">Grupos de disponibilidade AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="f7bd1-106">AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="f7bd1-107">Grupos de Disponibilidade AlwaysOn configuradas como uma solução somente do Azure com suporte para o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f7bd1-107">AlwaysOn Availability Groups that are configured as an Azure-only solution supported for [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="f7bd1-108">Não há suporte para configurações Grupo de Disponibilidade AlwaysOn Híbrido ou somente no local.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-108">On-premises only, or Hybrid AlwaysOn Availability Group configurations are not supported.</span></span> <span data-ttu-id="f7bd1-109">Para obter mais informações e outras considerações, consulte [Configurando SQL Server Backup gerenciado para o Azure para grupos de disponibilidade](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span><span class="sxs-lookup"><span data-stu-id="f7bd1-109">For more information and other considerations, see [Setting up SQL Server Managed Backup to Azure for Availability Groups](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span></span>  
  
### <a name="database-mirroring"></a><span data-ttu-id="f7bd1-110">Espelhamento de banco de dados</span><span class="sxs-lookup"><span data-stu-id="f7bd1-110">Database Mirroring</span></span>  
 <span data-ttu-id="f7bd1-111">Há suporte para o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] somente no banco de dados principal.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-111">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is supported only on the principal database.</span></span> <span data-ttu-id="f7bd1-112">Se o banco de dados principal e o banco de dados espelho estiverem configurados para usar o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], o banco de dados espelho será ignorado e não será incluído no backup.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-112">If both the principal and the mirror are configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], the mirrored database is skipped and will not be backed up.</span></span> <span data-ttu-id="f7bd1-113">No entanto, se ocorrer um failover, o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] iniciará o processo de backup depois que o espelho concluir a troca de função e estiver online.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-113">However, in the event of a failover, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will start the backup process after the mirror has completed role switching and is online.</span></span> <span data-ttu-id="f7bd1-114">Os backups serão armazenados em um novo contêiner nesse caso.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-114">The backups will be stored in a new container in this case.</span></span> <span data-ttu-id="f7bd1-115">Se o espelho não estiver configurado para usar o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], no caso de um failover, nenhum backup será feito.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-115">If the mirror is not configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], in the event of a failover, no backups are taken.</span></span> <span data-ttu-id="f7bd1-116">É recomendável que você configure o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] no banco de dados principal e no banco de dados espelho para que os backups continuem caso ocorra um failover.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-116">We recommend that you configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] on both the principal and the mirror so backups continue in the event of a failover.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="f7bd1-117">Se você estiver criando um banco de dados espelho em uma instância com as configurações padrão do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], talvez seja preferível desabilitar os valores padrão de instância do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], para que eles não sejam aplicados ao banco de dados espelho e não habilitem novamente os valores padrão da instância após a configuração do banco de dados principal e do banco de dados espelho.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-117">If you are creating a mirrored database on an instance with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] default settings, it may be preferable to disable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] instance defaults, so they are not applied to the mirrored database, and then re-enable the instance defaults after configuring the Principal and the Mirror.</span></span>  
  
### <a name="maintenance-plan"></a><span data-ttu-id="f7bd1-118">Plano de Manutenção</span><span class="sxs-lookup"><span data-stu-id="f7bd1-118">Maintenance Plan</span></span>  
 <span data-ttu-id="f7bd1-119">Não há suporte ao uso de planos de manutenção para criar backups de um banco de dados quando o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] está habilitado.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-119">Using Maintenance Plans for creating backups for a database when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled is not supported.</span></span> <span data-ttu-id="f7bd1-120">Os planos de manutenção causarão a interrupção da cadeia de logs e o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] talvez não possa oferecer suporte a uma capacidade de recuperação garantida do banco de dados durante a restauração.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-120">Maintenance plans will cause broken log chain and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] may not be able to support a guaranteed recoverability of the database during restore.</span></span> <span data-ttu-id="f7bd1-121">Isso também se aplica quando o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] está habilitado no nível da instância.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-121">This also applies when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled at the instance level.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="f7bd1-122">Os Planos de Manutenção com Backups somente cópia somente têm suporte com o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configurado para o mesmo banco de dados ou instância.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-122">Maintenance Plans with Copy Only backups is supported with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configured for the same database or instance.</span></span>  
  
### <a name="log-shipping"></a><span data-ttu-id="f7bd1-123">Envio de logs</span><span class="sxs-lookup"><span data-stu-id="f7bd1-123">Log Shipping</span></span>  
 <span data-ttu-id="f7bd1-124">Você não pode configurar o envio de logs e o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] para o mesmo banco de dados ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-124">You cannot configure Log Shipping and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database at the same time.</span></span> <span data-ttu-id="f7bd1-125">Isso afetará a capacidade de recuperação do banco de dados usando qualquer uma das funcionalidades.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-125">Doing so will affect the recoverability of the database using either functionality.</span></span>  
  
### <a name="ad-hoc-backups-using-transact-sql-and-sql-server-management-studio"></a><span data-ttu-id="f7bd1-126">Backups ad hoc usando Transact-SQL e SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="f7bd1-126">Ad Hoc Backups Using Transact-SQL and SQL Server Management Studio</span></span>  
 <span data-ttu-id="f7bd1-127">Os backups ad hoc ou de uma vez criados fora do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] usando Transact-SQL ou SQL Server Management Studio podem afetar o processo do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], dependendo do tipo de backup e da mídia de armazenamento usados.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-127">Ad hoc or one time backups created outside [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] using Transact-SQL or SQL Server Management Studio may affect the [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process depending on the type of backup and the storage media used.</span></span> <span data-ttu-id="f7bd1-128">Os backups de log para uma conta de armazenamento do Azure diferente do que [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] está usando, ou qualquer outro destino que o serviço de armazenamento de BLOBs do Azure, causarão uma interrupção de cadeia de logs.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-128">Log backups to a different Azure storage account than what [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is using, or any other destination than the Azure Blob storage service, will cause a log chain break.</span></span> <span data-ttu-id="f7bd1-129">É recomendável usar o [smart_admin. sp_backup_on_demand &#40;procedimento armazenado&#41;Transact-SQL](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) para iniciar um backup em bancos de dados que tenham sido [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] habilitados.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-129">We recommend that you use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure to initiate a backup on databases that have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled.</span></span> <span data-ttu-id="f7bd1-130">Você pode iniciar um banco de dados completo ou um backup de log usando esse procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-130">You can initiate either a full database or log backup using this stored procedure.</span></span>  
  
### <a name="drop-database-and-detach-database"></a><span data-ttu-id="f7bd1-131">Remover Banco de Dados e Desanexar Banco de Dados</span><span class="sxs-lookup"><span data-stu-id="f7bd1-131">Drop Database and Detach Database</span></span>  
 <span data-ttu-id="f7bd1-132">Se um banco de dados que tiver o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] habilitado for desanexado ou removido, embora nenhum backup adicional seja possível, os backups anteriores permanecem no armazenamento até o fim do período de retenção, ponto no qual os backups serão limpos.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-132">If a database that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled is detached or dropped, although no additional backups are possible, the previous backups remain in the storage until the retention period has elapsed, at which point the backups will be purged.</span></span>  
  
### <a name="changes-to-recovery-model"></a><span data-ttu-id="f7bd1-133">Alterações no modelo de recuperação</span><span class="sxs-lookup"><span data-stu-id="f7bd1-133">Changes to Recovery Model</span></span>  
  
-   <span data-ttu-id="f7bd1-134">Se você alterar o modelo de recuperação de um banco de dados de **simples** para **completo** ou **bulk-logged**, terá a opção de configurar [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-134">If you change the recovery model of a database from **Simple** to **Full** or **Bulk-Logged**, you have the option of configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the database.</span></span> <span data-ttu-id="f7bd1-135">Isso será considerado como um novo banco de dados da perspectiva do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f7bd1-135">This will be considered like a new database from [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] perspective.</span></span>  
  
-   <span data-ttu-id="f7bd1-136">Se você alterar o modelo de recuperação de um banco de dados de log **completo** ou **em massa** para **simples**, que tenha sido [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] habilitado, as operações de backup não serão mais agendadas.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-136">If you change the recovery model of a database from **Full** or **Bulk-Logged** to **Simple**, that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled, backup operations will no longer be scheduled.</span></span> <span data-ttu-id="f7bd1-137">A configuração de período de retenção ainda estará ativa e os arquivos de backup permanecerão na conta de armazenamento até que o período de retenção tenha decorrido.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-137">The retention period setting will still be active and backup files will remain in the storage account until the retention period has elapsed.</span></span> <span data-ttu-id="f7bd1-138">Se quiser reter os backups, é recomendável que você baixe os arquivos para uma conta de armazenamento diferente ou uma opção local.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-138">If you want to retain the backups, we recommend that you download the files either to a different storage account or to an on-premises location.</span></span> <span data-ttu-id="f7bd1-139">As definições de configuração são mantidas e podem ser reutilizadas se o modelo de recuperação for definido novamente como **completo** ou **registrado em massa** novamente.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-139">The configuration settings are retained and can be reused if the recovery model is set back to **Full** or **Bulk-Logged** again.</span></span>  
  
### <a name="log-backups-using-other-backup-tools-or-custom-scripts"></a><span data-ttu-id="f7bd1-140">Backups de log usando outras ferramentas de backup ou scripts personalizados</span><span class="sxs-lookup"><span data-stu-id="f7bd1-140">Log Backups Using Other Backup Tools or Custom Scripts</span></span>  
 <span data-ttu-id="f7bd1-141">Os dois backups que estiverem configurados para executar os backups de log no mesmo banco de dados causarão a interrupção na cadeia de logs de backup.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-141">Any two backups that are configured to perform log backups on the same database will cause break in the backup log chain.</span></span> <span data-ttu-id="f7bd1-142">Embora o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] tente resolver a interrupção na cadeia de backup agendando backups completos quando uma interrupção na cadeia for detectada, isso significa acompanhar continuamente com interrupções periódicas e backups de log executados por duas ferramentas concorrentes.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-142">Although [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will attempt to remedy the break in the backup chain by scheduling full backups when a break in chain is detected, this means keeping up continuously with periodic breaks and log backups performed by two competing tools.</span></span> <span data-ttu-id="f7bd1-143">Isso também pode afetar potencialmente a recuperabilidade do banco de dados porque nenhuma ferramenta pode ter um conjunto completo de backups em sequência.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-143">This can also potentially affect the recoverability of the database since no one tool can be expected to have a full set of backup in sequence.</span></span> <span data-ttu-id="f7bd1-144">Embora isso se aplique aos dois recursos ou ferramentas que executam os backups de log, é útil chamar exemplos específicos conforme descrito abaixo.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-144">Although this applies to any two features or tools performing log backups,, it is useful to call out specific examples as described below.</span></span> <span data-ttu-id="f7bd1-145">Essa também é a base para os problemas com a configuração dos planos de manutenção ou envio de logs conforme descrito nas seções anteriores deste tópico.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-145">This is also the basis for the issues with configuring maintenance plans or log shipping as described in earlier sections of this topic.</span></span>  
  
 <span data-ttu-id="f7bd1-146">**Backups baseados no Data Protection Manager (DPM):** O Microsoft Data Protection Manager permite que você faça backups completos e incrementais.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-146">**Data Protection Manager (DPM) based backups:** Microsoft Data Protection Manager allows you to do full and incremental backups.</span></span> <span data-ttu-id="f7bd1-147">Os backups incrementais são os backups de log que executam um truncamento de log depois de criar um backup de T-log.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-147">The incremental backups are log backups that do perform a log truncation after creating a T-log backup.</span></span> <span data-ttu-id="f7bd1-148">Para configurar o DPM e o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] para o mesmo banco de dados não tem suporte.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-148">So configuring both DPM and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database is not supported.</span></span>  
  
 <span data-ttu-id="f7bd1-149">**Scripts ou ferramentas de terceiros:** Qualquer ferramenta de terceiros ou scripts que executam backups de log que causam truncamento de log é incompatível com o [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] e não tem suporte.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-149">**Third Party Tools or Scripts:** Any third party tool or scripts that perform log backups causing log truncation is incompatible with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], and is not supported.</span></span>  
  
 <span data-ttu-id="f7bd1-150">Se você tiver [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] habilitado o para uma instância de banco de dados e desejar fazer um backup ad hoc, poderá usar o [smart_admin. sp_backup_on_demand &#40;procedimento armazenado&#41;do TRANSACT-SQL](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) , conforme descrito na seção anterior.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-150">If you have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled for a database instance, and you want to take an ad hoc backup you can either use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure as described in the earlier section.</span></span> <span data-ttu-id="f7bd1-151">Se você também tiver uma necessidade de agendar backup periodicamente fora do [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], poderá usar Copiar Somente Backup.</span><span class="sxs-lookup"><span data-stu-id="f7bd1-151">If you also have a need to schedule or un backups periodically outside of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], you can use the Copy Only Backup.</span></span>  <span data-ttu-id="f7bd1-152">Para obter mais informações, veja [Backups somente cópia &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f7bd1-152">For more information, see [Copy-Only Backups &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md).</span></span>  
  
  
