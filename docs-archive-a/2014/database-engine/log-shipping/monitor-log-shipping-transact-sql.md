---
title: Monitorar o envio de logs (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], status
- history tables [SQL Server]
- historical information [SQL Server], log shipping
- log shipping [SQL Server], monitoring
- alerts [SQL Server], log shipping
- status information [SQL Server], log shipping
- monitoring log shipping [SQL Server]
ms.assetid: acf3cd99-55f7-4287-8414-0892f830f423
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 0ab87d5d8aa08b7b2860fe52fd097f33af327a94
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87571538"
---
# <a name="monitor-log-shipping-transact-sql"></a><span data-ttu-id="cd340-102">Monitorar envio de logs (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="cd340-102">Monitor Log Shipping (Transact-SQL)</span></span>
  <span data-ttu-id="cd340-103">Depois que você configurar o envio de logs, você poderá monitorar as informações sobre o status de todos os servidores de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="cd340-103">After you have configured log shipping, you can monitor information about the status of all the log shipping servers.</span></span> <span data-ttu-id="cd340-104">O histórico e status de operações de envio de logs são sempre salvos localmente pelos trabalhos de envio de log.</span><span class="sxs-lookup"><span data-stu-id="cd340-104">The history and status of log shipping operations are always saved locally by the log shipping jobs.</span></span> <span data-ttu-id="cd340-105">O histórico e status da operação de backup são armazenados no servidor primário e o histórico e status de operações de cópia e restauração são armazenados no servidor secundário.</span><span class="sxs-lookup"><span data-stu-id="cd340-105">The history and status of the backup operation are stored at the primary server, and the history and status of the copy and restore operations are stored at the secondary server.</span></span> <span data-ttu-id="cd340-106">Se você implementou um servidor monitor remoto, estas informações também serão armazenadas no servidor monitor.</span><span class="sxs-lookup"><span data-stu-id="cd340-106">If you have implemented a remote monitor server, this information is also stored on the monitor server.</span></span>  
  
 <span data-ttu-id="cd340-107">Você pode configurar alertas que serão acionados se as operações de envio de logs não acontecerem como programado.</span><span class="sxs-lookup"><span data-stu-id="cd340-107">You can configure alerts that will fire if log shipping operations fail to occur as scheduled.</span></span> <span data-ttu-id="cd340-108">Os erros são encontrados por um trabalho de alerta que observa o status de operações de backup e restauração.</span><span class="sxs-lookup"><span data-stu-id="cd340-108">Errors are raised by an alert job that watches the status of the backup and restore operations.</span></span> <span data-ttu-id="cd340-109">Você pode definir os alertas que notificam um operador quando estes erros forem gerados.</span><span class="sxs-lookup"><span data-stu-id="cd340-109">You can define alerts that notify an operator when these errors are raised.</span></span> <span data-ttu-id="cd340-110">Se um servidor monitor estiver configurado, um trabalho de alerta gerado pelos erros de todas as operações da configuração de envio de logs é executado no servidor monitor.</span><span class="sxs-lookup"><span data-stu-id="cd340-110">If a monitor server is configured, one alert job runs on the monitor server that raises errors for all operations in the log shipping configuration.</span></span> <span data-ttu-id="cd340-111">Se um servidor monitor não for especificado, um trabalho de alerta é executado na instância primária do servidor que monitora a operação de backup.</span><span class="sxs-lookup"><span data-stu-id="cd340-111">If a monitor server is not specified, an alert job runs on the primary server instance, which monitors the backup operation.</span></span> <span data-ttu-id="cd340-112">Se um servidor monitor não for especificado, um trabalho de alerta também será executado em cada instância secundária de servidor para monitorar as operações locais de cópia e restauração.</span><span class="sxs-lookup"><span data-stu-id="cd340-112">If a monitor server is not specified, an alert job also runs on each secondary server instance to monitor the local copy and restore operations.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="cd340-113">Para monitorar uma configuração de envio de logs, você deve adicionar o servidor monitor quando habilitar o envio de log.</span><span class="sxs-lookup"><span data-stu-id="cd340-113">To monitor a log shipping configuration, you must add the monitor server when you enable log shipping.</span></span> <span data-ttu-id="cd340-114">Se você adicionar um servidor monitor posteriormente, você deve remover a configuração de envio de logs e em seguida substituí-la por uma configuração que inclui um servidor monitor.</span><span class="sxs-lookup"><span data-stu-id="cd340-114">If you add a monitor server later, you must remove the log shipping configuration and then replace it with a new configuration that includes a monitor server.</span></span> <span data-ttu-id="cd340-115">Para obter mais informações, consulte [Configurar o envio de logs &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="cd340-115">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span> <span data-ttu-id="cd340-116">Além disso, depois que o servidor monitor for configurado, ele não pode ser alterado sem remover primeiro o envio de logs.</span><span class="sxs-lookup"><span data-stu-id="cd340-116">Furthermore, after the monitor server has been configured, it cannot be changed without removing log shipping first.</span></span>  
  
## <a name="history-tables-containing-monitoring-information"></a><span data-ttu-id="cd340-117">Tabelas de histórico que contêm informações de monitoramento</span><span class="sxs-lookup"><span data-stu-id="cd340-117">History Tables Containing Monitoring Information</span></span>  
 <span data-ttu-id="cd340-118">As tabelas que monitoram histórico contêm metadados armazenados no servidor monitor.</span><span class="sxs-lookup"><span data-stu-id="cd340-118">The monitoring history tables contain metadata that is stored on the monitor server.</span></span> <span data-ttu-id="cd340-119">Também é armazenada localmente uma cópia de informações específicas de um determinado servidor primário ou secundário.</span><span class="sxs-lookup"><span data-stu-id="cd340-119">A copy of information specific to a given primary or secondary server is also stored locally.</span></span>  
  
 <span data-ttu-id="cd340-120">Você pode fazer consultas nestas tabelas para monitorar o status de uma sessão de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="cd340-120">You can query these tables to monitor the status of a log shipping session.</span></span> <span data-ttu-id="cd340-121">Por exemplo, para saber sobre o status de envio de logs, verifique o status e o histórico dos trabalhos de backup, de cópia e restauração.</span><span class="sxs-lookup"><span data-stu-id="cd340-121">For example, to learn status of log shipping, check the status and history of the backup job, copy job, and restore job.</span></span> <span data-ttu-id="cd340-122">Você pode exibir o histórico de envio de logs específico e detalhes de erros consultando as tabelas de monitoramento a seguir.</span><span class="sxs-lookup"><span data-stu-id="cd340-122">You can view specific log shipping history and error details by querying the following monitoring tables.</span></span>  
  
|<span data-ttu-id="cd340-123">Tabela</span><span class="sxs-lookup"><span data-stu-id="cd340-123">Table</span></span>|<span data-ttu-id="cd340-124">Descrição</span><span class="sxs-lookup"><span data-stu-id="cd340-124">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="cd340-125">log_shipping_monitor_alert</span><span class="sxs-lookup"><span data-stu-id="cd340-125">log_shipping_monitor_alert</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-alert-transact-sql)|<span data-ttu-id="cd340-126">Armazena ID de trabalho de alerta.</span><span class="sxs-lookup"><span data-stu-id="cd340-126">Stores alert job ID.</span></span>|  
|[<span data-ttu-id="cd340-127">log_shipping_monitor_error_detail</span><span class="sxs-lookup"><span data-stu-id="cd340-127">log_shipping_monitor_error_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-error-detail-transact-sql)|<span data-ttu-id="cd340-128">Armazena detalhes de erros dos trabalhos de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="cd340-128">Stores error details for log shipping jobs.</span></span> <span data-ttu-id="cd340-129">Você pode fazer consultas nesta tabela para ver os erros de uma sessão de agente.</span><span class="sxs-lookup"><span data-stu-id="cd340-129">You can query this table see the errors for an agent session.</span></span> <span data-ttu-id="cd340-130">Como opção, você pode classificar os erros por data e hora em que cada um foi registrado.</span><span class="sxs-lookup"><span data-stu-id="cd340-130">Optionally, you can sort the errors by the date and time at which each was logged.</span></span> <span data-ttu-id="cd340-131">Cada erro é registrado como uma sequência de exceções e erros múltiplos (sequências) por sessão de agente.</span><span class="sxs-lookup"><span data-stu-id="cd340-131">Each error is logged as a sequence of exceptions, and multiple errors (sequences) can per agent session.</span></span>|  
|[<span data-ttu-id="cd340-132">log_shipping_monitor_history_detail</span><span class="sxs-lookup"><span data-stu-id="cd340-132">log_shipping_monitor_history_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-history-detail-transact-sql)|<span data-ttu-id="cd340-133">Contém detalhes de histórico para agentes de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="cd340-133">Contains history details for log shipping agents.</span></span> <span data-ttu-id="cd340-134">Você pode fazer consultas nesta tabela para ver os detalhes de histórico de uma sessão de agente.</span><span class="sxs-lookup"><span data-stu-id="cd340-134">You can query this table to see the history detail for an agent session.</span></span>|  
|[<span data-ttu-id="cd340-135">log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="cd340-135">log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="cd340-136">Armazena um registro de monitor para o banco de dados primário em cada configuração de envio de logs, inclusive informações sobre o último arquivo de backup e último arquivo restaurado que é útil para monitoramento.</span><span class="sxs-lookup"><span data-stu-id="cd340-136">Stores one monitor record for the primary database in each log shipping configuration, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
|[<span data-ttu-id="cd340-137">log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="cd340-137">log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="cd340-138">Armazena um registro de monitor para cada banco de dados secundário, inclusive informações sobre o último arquivo de backup e último arquivo restaurado que é útil para monitoramento.</span><span class="sxs-lookup"><span data-stu-id="cd340-138">Stores one monitor record for each secondary database, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
  
## <a name="stored-procedures-for-monitoring-log-shipping"></a><span data-ttu-id="cd340-139">Procedimentos Armazenados para Monitoramento de Envio de Logs</span><span class="sxs-lookup"><span data-stu-id="cd340-139">Stored Procedures for Monitoring Log Shipping</span></span>  
 <span data-ttu-id="cd340-140">O monitoramento e as informações de histórico são armazenados em tabelas no **msdb**, que pode ser acessado com o uso dos procedimentos armazenados de envio de logs.</span><span class="sxs-lookup"><span data-stu-id="cd340-140">Monitoring and history information is stored in tables in **msdb**, which can be accessed using log shipping stored procedures.</span></span> <span data-ttu-id="cd340-141">Execute estes procedimentos armazenados nos servidores indicados na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="cd340-141">Run these stored procedures on the servers indicated in the following table.</span></span>  
  
|<span data-ttu-id="cd340-142">Procedimento armazenado</span><span class="sxs-lookup"><span data-stu-id="cd340-142">Stored procedure</span></span>|<span data-ttu-id="cd340-143">Descrição</span><span class="sxs-lookup"><span data-stu-id="cd340-143">Description</span></span>|<span data-ttu-id="cd340-144">Execute este procedimento em</span><span class="sxs-lookup"><span data-stu-id="cd340-144">Run this procedure on</span></span>|  
|----------------------|-----------------|---------------------------|  
|[<span data-ttu-id="cd340-145">sp_help_log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="cd340-145">sp_help_log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="cd340-146">Retorna registros de monitor para o banco de dados primário especificado da tabela **log_shipping_monitor_primary** .</span><span class="sxs-lookup"><span data-stu-id="cd340-146">Returns monitor records for the specified primary database from the **log_shipping_monitor_primary** table.</span></span>|<span data-ttu-id="cd340-147">Servidor monitor ou servidor primário</span><span class="sxs-lookup"><span data-stu-id="cd340-147">Monitor server or primary server</span></span>|  
|[<span data-ttu-id="cd340-148">sp_help_log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="cd340-148">sp_help_log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="cd340-149">Retorna registros de monitor para o banco de dados secundário especificado da tabela **log_shipping_monitor_secondary** .</span><span class="sxs-lookup"><span data-stu-id="cd340-149">Returns monitor records for the specified secondary database from the **log_shipping_monitor_secondary** table.</span></span>|<span data-ttu-id="cd340-150">Servidor monitor ou servidor secundário</span><span class="sxs-lookup"><span data-stu-id="cd340-150">Monitor server or secondary server</span></span>|  
|[<span data-ttu-id="cd340-151">sp_help_log_shipping_alert_job</span><span class="sxs-lookup"><span data-stu-id="cd340-151">sp_help_log_shipping_alert_job</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-alert-job-transact-sql)|<span data-ttu-id="cd340-152">Retorna a ID de trabalho do trabalho de alerta.</span><span class="sxs-lookup"><span data-stu-id="cd340-152">Returns the job ID of the alert job.</span></span>|<span data-ttu-id="cd340-153">Servidor monitor ou servidor primário ou secundário se nenhum monitor estiver definido</span><span class="sxs-lookup"><span data-stu-id="cd340-153">Monitor server, or primary or secondary server if no monitor is defined</span></span>|  
|[<span data-ttu-id="cd340-154">sp_help_log_shipping_primary_database</span><span class="sxs-lookup"><span data-stu-id="cd340-154">sp_help_log_shipping_primary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-database-transact-sql)|<span data-ttu-id="cd340-155">Recupera configurações do banco de dados primário e exibe os valores das tabelas **log_shipping_primary_databases** e **log_shipping_monitor_primary** .</span><span class="sxs-lookup"><span data-stu-id="cd340-155">Retrieves primary database settings and displays the values from the **log_shipping_primary_databases** and **log_shipping_monitor_primary** tables.</span></span>|<span data-ttu-id="cd340-156">Servidor primário</span><span class="sxs-lookup"><span data-stu-id="cd340-156">Primary server</span></span>|  
|[<span data-ttu-id="cd340-157">sp_help_log_shipping_primary_secondary</span><span class="sxs-lookup"><span data-stu-id="cd340-157">sp_help_log_shipping_primary_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-secondary-transact-sql)|<span data-ttu-id="cd340-158">Recupera nomes de banco de dados secundários para um banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="cd340-158">Retrieves secondary database names for a primary database.</span></span>|<span data-ttu-id="cd340-159">Servidor primário</span><span class="sxs-lookup"><span data-stu-id="cd340-159">Primary server</span></span>|  
|[<span data-ttu-id="cd340-160">sp_help_log_shipping_secondary_database</span><span class="sxs-lookup"><span data-stu-id="cd340-160">sp_help_log_shipping_secondary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-database-transact-sql)|<span data-ttu-id="cd340-161">Recupera configurações de bancos de dados primários e exibe os valores das tabelas **log_shipping_secondary**, **log_shipping_secondary_databases** e **log_shipping_monitor_secondary** .</span><span class="sxs-lookup"><span data-stu-id="cd340-161">Retrieves secondary-database settings from the **log_shipping_secondary**, **log_shipping_secondary_databases** and **log_shipping_monitor_secondary** tables.</span></span>|<span data-ttu-id="cd340-162">Servidor secundário</span><span class="sxs-lookup"><span data-stu-id="cd340-162">Secondary server</span></span>|  
|[<span data-ttu-id="cd340-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="cd340-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-primary-transact-sql)|<span data-ttu-id="cd340-164">Esse procedimento armazenado recupera a configurações de um banco de dados primário específico no servidor secundário.</span><span class="sxs-lookup"><span data-stu-id="cd340-164">This stored procedure retrieves the settings for a given primary database on the secondary server.</span></span>|<span data-ttu-id="cd340-165">Servidor secundário</span><span class="sxs-lookup"><span data-stu-id="cd340-165">Secondary server</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="cd340-166">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="cd340-166">See Also</span></span>  
 <span data-ttu-id="cd340-167">[Exibir o relatório de envio de logs &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span><span class="sxs-lookup"><span data-stu-id="cd340-167">[View the Log Shipping Report &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span></span>  
 [<span data-ttu-id="cd340-168">Tabelas e procedimentos armazenados de envio de logs</span><span class="sxs-lookup"><span data-stu-id="cd340-168">Log Shipping Stored Procedures and Tables</span></span>](log-shipping-tables-and-stored-procedures.md)  
  
  
