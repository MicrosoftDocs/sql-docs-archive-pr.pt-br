---
title: Usando índices Columnstore clusterizados | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
ms.assetid: 5af6b91c-724f-45ac-aff1-7555014914f4
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: afc7da4e28ef7f32ca4a2b4ea762e5a5af442471
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87569594"
---
# <a name="using-clustered-columnstore-indexes"></a><span data-ttu-id="ef8a5-102">Usando índices columnstore clusterizados</span><span class="sxs-lookup"><span data-stu-id="ef8a5-102">Using Clustered Columnstore Indexes</span></span>
  <span data-ttu-id="ef8a5-103">Tarefas para usar índices columnstore clusterizados no [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ef8a5-103">Tasks for using clustered columnstore indexes in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="ef8a5-104">Para obter uma visão geral de índices columnstore, consulte [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span><span class="sxs-lookup"><span data-stu-id="ef8a5-104">For an overview of columnstore indexes, see [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span></span>

 <span data-ttu-id="ef8a5-105">Para obter informações sobre índices columnstore clusterizados, consulte [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span><span class="sxs-lookup"><span data-stu-id="ef8a5-105">For information about clustered columnstore indexes, see [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span></span>

## <a name="contents"></a><span data-ttu-id="ef8a5-106">Sumário</span><span class="sxs-lookup"><span data-stu-id="ef8a5-106">Contents</span></span>

-   [<span data-ttu-id="ef8a5-107">Criar um índice columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-107">Create a Clustered Columnstore Index</span></span>](#create)

-   [<span data-ttu-id="ef8a5-108">Descartar um índice columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-108">Drop a Clustered Columnstore Index</span></span>](#drop)

-   [<span data-ttu-id="ef8a5-109">Carregar dados em um índice columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-109">Load Data into a Clustered Columnstore Index</span></span>](#load)

-   [<span data-ttu-id="ef8a5-110">Alterar dados em um índice columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-110">Change Data in a Clustered Columnstore Index</span></span>](#change)

-   [<span data-ttu-id="ef8a5-111">Recriar um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-111">Rebuild a Clustered Columnstore Index</span></span>](#rebuild)

-   [<span data-ttu-id="ef8a5-112">Reorganizar um índice columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-112">Reorganize a Clustered Columnstore Index</span></span>](#reorganize)

##  <a name="create-a-clustered-columnstore-index"></a><a name="create"></a><span data-ttu-id="ef8a5-113">Criar um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-113">Create a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-114">Para criar um índice columnstore clusterizado, primeiro crie uma tabela de repositório de armazenamento como um heap ou índice clusterizado e, em seguida, use a instrução [criar índice COLUMNSTORE clusterizado &#40;&#41;Transact-SQL](/sql/t-sql/statements/create-columnstore-index-transact-sql) para converter a tabela em um índice columnstore clusterizado.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-114">To create a clustered columnstore index, first create a rowstore table as a heap or clustered index, and then use the [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) statement to convert the table to a clustered columnstore index.</span></span> <span data-ttu-id="ef8a5-115">Se você desejar que o índice columnstore clusterizado tenha o mesmo nome que o índice clusterizado, use a opção DROP_EXISTING.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-115">If you want the clustered columnstore index to have the same name as the clustered index, use the DROP_EXISTING option.</span></span>

 <span data-ttu-id="ef8a5-116">Este exemplo cria uma tabela como um heap e, depois, converte-o em um índice columnstore clusterizado chamado o cci_Simple.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-116">This example creates a table as a heap and then converts it to a clustered columnstore index named cci_Simple.</span></span> <span data-ttu-id="ef8a5-117">Isso altera o armazenamento da tabela inteira, de rowstore a columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-117">This changes the storage for the entire table from rowstore to columnstore.</span></span>

```
CREATE TABLE T1(
    ProductKey [int] NOT NULL, 
    OrderDateKey [int] NOT NULL, 
    DueDateKey [int] NOT NULL, 
    ShipDateKey [int] NOT NULL);
GO
CREATE CLUSTERED COLUMNSTORE INDEX cci_T1 ON T1;
GO
```

 <span data-ttu-id="ef8a5-118">Para obter mais exemplos, consulte a seção exemplos em [criar índice COLUMNSTORE clusterizado &#40;&#41;Transact-SQL ](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="ef8a5-118">For more examples, see the Examples section in [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

##  <a name="drop-a-clustered-columnstore-index"></a><a name="drop"></a><span data-ttu-id="ef8a5-119">Remover um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-119">Drop a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-120">Use a instrução [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) para descartar um índice columnstore clusterizado.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-120">Use the [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) statement to drop a clustered columnstore index.</span></span> <span data-ttu-id="ef8a5-121">Essa operação irá remover o índice e converter a tabela columnstore em um heap rowstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-121">This operation will drop the index and convert the columnstore table to a rowstore heap.</span></span>

##  <a name="load-data-into-a-clustered-columnstore-index"></a><a name="load"></a><span data-ttu-id="ef8a5-122">Carregar dados em um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-122">Load Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-123">Você pode adicionar dados a um índice columnstore clusterizado existente usando qualquer um dos métodos de carregamento padrão.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-123">You can add data to an existing clustered columnstore index by using any of the standard loading methods.</span></span>  <span data-ttu-id="ef8a5-124">Por exemplo, a ferramenta de carregamento em massa bcp, Integration Services e INSERT... SELECT pode carregar dados em um índice columnstore clusterizado.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-124">For example, the bcp bulk loading tool, Integration Services, and INSERT ... SELECT can all load data into a clustered columnstore index.</span></span>

 <span data-ttu-id="ef8a5-125">Os índices columnstore clusterizados aproveitam o deltastore a fim de evitar a fragmentação de segmentos de colunas no columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-125">Clustered columnstore indexes leverage the deltastore in order to prevent fragmentation of column segments in the columnstore.</span></span>

### <a name="loading-into-a-partitioned-table"></a><span data-ttu-id="ef8a5-126">Carregando em uma tabela particionada</span><span class="sxs-lookup"><span data-stu-id="ef8a5-126">Loading into a partitioned table</span></span>
 <span data-ttu-id="ef8a5-127">Para dados particionados, primeiro o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] atribui cada linha a uma partição e, depois, executa operações columnstore nos dados na partição.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-127">For partitioned data, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] first assigns each row to a partition, and then performs columnstore operations on the data within the partition.</span></span> <span data-ttu-id="ef8a5-128">Cada partição tem seus próprios rowgroups e pelo menos um deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-128">Each partition has its own rowgroups and at least one deltastore.</span></span>

### <a name="deltastore-loading-scenarios"></a><span data-ttu-id="ef8a5-129">Cenários de carregamento de deltastore</span><span class="sxs-lookup"><span data-stu-id="ef8a5-129">Deltastore loading scenarios</span></span>
 <span data-ttu-id="ef8a5-130">As linhas são acumuladas no deltastore até que o número de linhas atinja o número máximo de linhas permitido para um rowgroup.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-130">Rows accumulate in the deltastore until the number of rows is the maximum number of rows allowed for a rowgroup.</span></span> <span data-ttu-id="ef8a5-131">Quando deltastore contém o número máximo de linhas por rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] o marca o rowgroup como "closed".</span><span class="sxs-lookup"><span data-stu-id="ef8a5-131">When the deltastore contains the maximum number of rows per rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the rowgroup as "CLOSED".</span></span> <span data-ttu-id="ef8a5-132">Um processo em segundo plano, chamado de "movimentação de tupla", localiza o rowgroup fechado e passa para o columnstore, onde o rowgroup é compactado em segmentos de coluna e os segmentos de coluna são armazenados no columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-132">A background process, called the "tuple-mover", finds the CLOSED rowgroup and moves into the columnstore, where the rowgroup is compressed into column segments and the column segments are stored in the columnstore.</span></span>

 <span data-ttu-id="ef8a5-133">Para cada índice columnstore clusterizado, podem existir vários deltastores.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-133">For each clustered columnstore index there can be multiple deltastores.</span></span>

-   <span data-ttu-id="ef8a5-134">Se um deltastore estiver bloqueado, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] tentará obter um bloqueio em outro deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-134">If a deltastore is locked, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will try to obtain a lock on a different deltastore.</span></span> <span data-ttu-id="ef8a5-135">Se não houver nenhum deltastore disponível, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] criará um novo deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-135">If there are no deltastores available, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will create a new deltastore.</span></span>

-   <span data-ttu-id="ef8a5-136">Para uma tabela particionada, podem existir um ou mais deltastores para cada partição.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-136">For a partitioned table, there can be one or more deltastores for each partition.</span></span>

 <span data-ttu-id="ef8a5-137">Para apenas índices columnstore clusterizados, os cenários a seguir descrevem quando as linhas carregadas vão diretamente para o columnstore, ou quando elas vão para o deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-137">For clustered columnstore indexes only, the following scenarios describe when loaded rows go directly to the columnstore or when they go to the deltastore.</span></span>

 <span data-ttu-id="ef8a5-138">No exemplo, cada rowgroup pode ter de 102.400 a 1.048.576 linhas por rowgroup.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-138">In the example, each rowgroup can have 102,400-1,048,576 rows per rowgroup.</span></span>

|<span data-ttu-id="ef8a5-139">Linhas para carregamento em massa</span><span class="sxs-lookup"><span data-stu-id="ef8a5-139">Rows to Bulk Load</span></span>|<span data-ttu-id="ef8a5-140">Linhas adicionadas ao columnstore</span><span class="sxs-lookup"><span data-stu-id="ef8a5-140">Rows Added to the Columnstore</span></span>|<span data-ttu-id="ef8a5-141">Linhas adicionadas ao deltastore</span><span class="sxs-lookup"><span data-stu-id="ef8a5-141">Rows Added to the Deltastore</span></span>|
|-----------------------|-----------------------------------|----------------------------------|
|<span data-ttu-id="ef8a5-142">102.000</span><span class="sxs-lookup"><span data-stu-id="ef8a5-142">102,000</span></span>|<span data-ttu-id="ef8a5-143">0</span><span class="sxs-lookup"><span data-stu-id="ef8a5-143">0</span></span>|<span data-ttu-id="ef8a5-144">102.000</span><span class="sxs-lookup"><span data-stu-id="ef8a5-144">102,000</span></span>|
|<span data-ttu-id="ef8a5-145">145.000</span><span class="sxs-lookup"><span data-stu-id="ef8a5-145">145,000</span></span>|<span data-ttu-id="ef8a5-146">145.000</span><span class="sxs-lookup"><span data-stu-id="ef8a5-146">145,000</span></span><br /><br /> <span data-ttu-id="ef8a5-147">Tamanho do rowgroup: 145.000</span><span class="sxs-lookup"><span data-stu-id="ef8a5-147">Rowgroup size: 145,000</span></span>|<span data-ttu-id="ef8a5-148">0</span><span class="sxs-lookup"><span data-stu-id="ef8a5-148">0</span></span>|
|<span data-ttu-id="ef8a5-149">1,048,577</span><span class="sxs-lookup"><span data-stu-id="ef8a5-149">1,048,577</span></span>|<span data-ttu-id="ef8a5-150">1\.048.576</span><span class="sxs-lookup"><span data-stu-id="ef8a5-150">1,048,576</span></span><br /><br /> <span data-ttu-id="ef8a5-151">Tamanho do rowgroup: 1.048.576.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-151">Rowgroup size: 1,048,576.</span></span>|<span data-ttu-id="ef8a5-152">1</span><span class="sxs-lookup"><span data-stu-id="ef8a5-152">1</span></span>|
|<span data-ttu-id="ef8a5-153">2,252,152</span><span class="sxs-lookup"><span data-stu-id="ef8a5-153">2,252,152</span></span>|<span data-ttu-id="ef8a5-154">2,252,152</span><span class="sxs-lookup"><span data-stu-id="ef8a5-154">2,252,152</span></span><br /><br /> <span data-ttu-id="ef8a5-155">Tamanhos dos rowgroups: 1.048.576, 1.048.576, 155.000.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-155">Rowgroup sizes: 1,048,576, 1,048,576, 155,000.</span></span>|<span data-ttu-id="ef8a5-156">0</span><span class="sxs-lookup"><span data-stu-id="ef8a5-156">0</span></span>|

 <span data-ttu-id="ef8a5-157">O exemplo a seguir mostra os resultados do carregamento de 1.048.577 linhas em uma partição.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-157">The following example shows the results of loading 1,048,577 rows into a partition.</span></span> <span data-ttu-id="ef8a5-158">Os resultados mostram um rowgroup COMPRESSED no columnstore (como segmentos de coluna compactados) e 1 linha no deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-158">The results show that one COMPRESSED rowgroup in the columnstore (as compressed column segments), and 1 row in the deltastore.</span></span>

```sql
SELECT * FROM sys.column_store_row_groups;
```

 <span data-ttu-id="ef8a5-159">![Rowgroup e deltastore para um carregamento em lote](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup e deltastore para um carregamento em lote")</span><span class="sxs-lookup"><span data-stu-id="ef8a5-159">![Rowgroup and deltastore for a batch load](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup and deltastore for a batch load")</span></span>



##  <a name="change-data-in-a-clustered-columnstore-index"></a><a name="change"></a><span data-ttu-id="ef8a5-160">Alterar dados em um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-160">Change Data in a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-161">Os índices columnstore clusterizados oferecem suporte a operações DML de inserção, atualização e exclusão.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-161">Clustered columnstore indexes support insert, update, and delete DML operations.</span></span>

 <span data-ttu-id="ef8a5-162">Use [insert &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) para inserir uma linha.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-162">Use [INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) to insert a row.</span></span> <span data-ttu-id="ef8a5-163">A linha será adicionada ao deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-163">The row will be added to the deltastore.</span></span>

 <span data-ttu-id="ef8a5-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) para excluir uma linha.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) to delete a row.</span></span>

-   <span data-ttu-id="ef8a5-165">Se a linha estiver no columnstore, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marcará a linha como excluída logicamente, mas não recuperará o armazenamento físico da linha até que o índice seja recriado.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-165">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted but does not reclaim the physical storage for the row until the index is rebuilt.</span></span>

-   <span data-ttu-id="ef8a5-166">Se a linha estiver no deltastore, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] excluirá a linha lógica e fisicamente.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-166">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] logically and physically deletes the row.</span></span>

 <span data-ttu-id="ef8a5-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) para atualizar uma linha.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) to update a row.</span></span>

-   <span data-ttu-id="ef8a5-168">Se a linha estiver no columnstore, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marcará a linha como excluída logicamente e irá inserir a linha atualizada no deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-168">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted, and then inserts the updated row into the deltastore.</span></span>

-   <span data-ttu-id="ef8a5-169">Se a linha estiver no deltastore, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] atualizará a linha no deltastore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-169">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] updates the row in the deltastore.</span></span>

##  <a name="rebuild-a-clustered-columnstore-index"></a><a name="rebuild"></a><span data-ttu-id="ef8a5-170">Recriar um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-170">Rebuild a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-171">Use [criar índice COLUMNSTORE clusterizado &#40;Transact-sql&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) ou [ALTER INDEX &#40;&#41;do Transact-SQL](/sql/t-sql/statements/alter-index-transact-sql) para executar uma recompilação completa de um índice COLUMNSTORE clusterizado existente.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-171">Use [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) or [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) to perform a full rebuild of an existing clustered columnstore index.</span></span> <span data-ttu-id="ef8a5-172">Além disso, você pode usar ALTER INDEX... Recompilar para recompilar uma partição específica.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-172">Additionally, you can use ALTER INDEX ... REBUILD to rebuild a specific partition.</span></span>

### <a name="rebuild-process"></a><span data-ttu-id="ef8a5-173">Processo de recriação</span><span class="sxs-lookup"><span data-stu-id="ef8a5-173">Rebuild Process</span></span>
 <span data-ttu-id="ef8a5-174">Para recompilar um índice columnstore clusterizado, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="ef8a5-174">To rebuild a clustered columnstore index, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>

-   <span data-ttu-id="ef8a5-175">Obtenha um bloqueio exclusivo na tabela ou na partição durante a recompilação.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-175">Acquires an exclusive lock on the table or partition while the rebuild occurs.</span></span>  <span data-ttu-id="ef8a5-176">Os dados ficam "offline" e não disponíveis enquanto você recompila.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-176">The data is "offline" and unavailable during the rebuild.</span></span>

-   <span data-ttu-id="ef8a5-177">Desfragmenta o columnstore excluindo fisicamente as linhas que foram excluídas logicamente da tabela; os bytes excluídos são recuperados na mídia física.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-177">Defragments the columnstore by physically deleting rows that have been logically deleted from the table; the deleted bytes are reclaimed on the physical media.</span></span>

-   <span data-ttu-id="ef8a5-178">Mescla os dados do rowstore no deltastore com os dados do columnstore antes da recriação do índice.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-178">Merges the rowstore data in the deltastore with the data in the columnstore before it rebuilds the index.</span></span> <span data-ttu-id="ef8a5-179">Quando a recriação é concluída, todos os dados são armazenados no formato columnstore, e o deltastore está vazio.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-179">When the rebuild is finished, all data is stored in columnstore format, and the deltastore is empty.</span></span>

-   <span data-ttu-id="ef8a5-180">Compacta novamente todos os dados do columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-180">Re-compresses all data into the columnstore.</span></span> <span data-ttu-id="ef8a5-181">Há duas cópias do índice columnstore durante a recompilação.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-181">Two copies of the columnstore index exist while the rebuild is taking place.</span></span> <span data-ttu-id="ef8a5-182">Quando a recompilação é concluída, o [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] exclui o índice columnstore original.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-182">When the rebuild is finished, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] deletes the original columnstore index.</span></span>

### <a name="recommendations-for-rebuilding-a-clustered-columnstore-index"></a><span data-ttu-id="ef8a5-183">Recomendações para recriar um índice columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-183">Recommendations for Rebuilding a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-184">Recriar um índice columnstore clusterizado é útil para remover a fragmentação, e para mover todas as linhas para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-184">Rebuilding a clustered columnstore index is useful for removing fragmentation, and for moving all rows into the columnstore.</span></span> <span data-ttu-id="ef8a5-185">Nossas recomendações:</span><span class="sxs-lookup"><span data-stu-id="ef8a5-185">We have the following recommendations:</span></span>

-   <span data-ttu-id="ef8a5-186">Recriar uma partição em vez de toda a tabela.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-186">Rebuild a partition instead of the entire table.</span></span>

    1.  <span data-ttu-id="ef8a5-187">Recriar a tabela inteira é uma tarefa demorada se o índice é grande, e isso exige espaço em disco suficiente para armazenar uma cópia adicional do índice durante a recriação.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-187">Rebuilding the entire table takes a long time if the index is large, and it requires enough disk space to store an additional copy of the index during the rebuild.</span></span> <span data-ttu-id="ef8a5-188">Geralmente, é necessário recriar apenas a partição mais recentemente usada.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-188">Usually it is only necessary to rebuild the most recently used partition.</span></span>

    2.  <span data-ttu-id="ef8a5-189">Em tabelas particionadas, não é necessário recriar todo o índice columnstore, pois é provável que a fragmentação ocorra apenas nas partições que foram modificadas recentemente.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-189">For partitioned tables, you do not need to rebuild the entire columnstore index because fragmentation is likely to occur in only the partitions that have been modified recently.</span></span> <span data-ttu-id="ef8a5-190">As tabelas de fatos e de dimensões grandes geralmente são particionadas para executar operações de backup e gerenciamento em partes da tabela.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-190">Fact tables and large dimension tables are usually partitioned in order to perform backup and management operations on chunks of the table.</span></span>

-   <span data-ttu-id="ef8a5-191">Recriar uma partição após operações DML pesadas.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-191">Rebuild a partition after heavy DML operations.</span></span>

     <span data-ttu-id="ef8a5-192">Recriar uma partição desfragmentará a partição e reduzirá o armazenamento em disco.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-192">Rebuilding a partition will defragment the partition and reduce disk storage.</span></span> <span data-ttu-id="ef8a5-193">Essa recriação excluirá todas as linhas do columnstore que são marcadas para exclusão, e moverá todas as linhas do deltastore para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-193">Rebuilding will delete all rows from the columnstore that are marked for deletion, and it will move all rows from the deltastore into the columnstore.</span></span>

-   <span data-ttu-id="ef8a5-194">Recriar uma partição após carregar dados.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-194">Rebuild a partition after loading data.</span></span>

     <span data-ttu-id="ef8a5-195">Isso garante que todos dados sejam armazenados no columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-195">This ensures all data is stored in the columnstore.</span></span> <span data-ttu-id="ef8a5-196">Se vários carregamentos ocorrerem ao mesmo tempo, cada partição poderá acabar tendo vários deltastores.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-196">If multiple loads occur at the same time, each partition could end up having multiple deltastores.</span></span> <span data-ttu-id="ef8a5-197">A recriação moverá todas as linhas do deltastore para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-197">Rebuilding will move all deltastore rows into the columnstore.</span></span>

##  <a name="reorganize-a-clustered-columnstore-index"></a><a name="reorganize"></a><span data-ttu-id="ef8a5-198">Reorganizar um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="ef8a5-198">Reorganize a Clustered Columnstore Index</span></span>
 <span data-ttu-id="ef8a5-199">A reorganização de um índice columnstore clusterizado move todos os rowgroups CLOSED para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-199">Reorganizing a clustered columnstore index moves all CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="ef8a5-200">Para executar uma reorganização, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)com a opção reorganizar.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-200">To perform a reorganize, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)with the REORGANIZE option.</span></span>

 <span data-ttu-id="ef8a5-201">A reorganização não é necessária para mover rowgroups CLOSED para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-201">Reorganizing is not required in order to move CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="ef8a5-202">O processo Tuple Mover acabará encontrando todos os rowgroups FECHADOS e os moverá.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-202">The tuple-mover process will eventually find all CLOSED rowgroups and move them.</span></span> <span data-ttu-id="ef8a5-203">No entanto, o Tuple Mover tem thread único e não pode mover rowgroups com rapidez suficiente para a carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-203">However, the tuple-mover is single-threaded and might not move rowgroups fast enough for your workload.</span></span>

### <a name="recommendations-for-reorganizing"></a><span data-ttu-id="ef8a5-204">Recomendações para reorganizar</span><span class="sxs-lookup"><span data-stu-id="ef8a5-204">Recommendations for Reorganizing</span></span>
 <span data-ttu-id="ef8a5-205">Quando reorganizar um índice columnstore clusterizado:</span><span class="sxs-lookup"><span data-stu-id="ef8a5-205">When to reorganize a clustered columnstore index:</span></span>

-   <span data-ttu-id="ef8a5-206">Reorganize um índice columnstore clusterizado depois que um ou mais carregamentos de dados atingir os benefícios de desempenho de consulta o mais rapidamente possível.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-206">Reorganize a clustered columnstore index after one or more data loads to achieve query performance benefits as quickly as possible.</span></span> <span data-ttu-id="ef8a5-207">Inicialmente, a reorganização exigirá recursos de CPU adicionais para compactar os dados, o que pode reduzir o desempenho geral do sistema.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-207">Reorganizing will initially require additional CPU resources to compress the data, which could slow overall system performance.</span></span> <span data-ttu-id="ef8a5-208">No entanto, assim que os dados forem compactados, o desempenho de consulta poderá aumentar.</span><span class="sxs-lookup"><span data-stu-id="ef8a5-208">However, as soon as the data is compressed, query performance can improve.</span></span>


