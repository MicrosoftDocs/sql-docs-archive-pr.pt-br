---
title: Clustering de failover e Grupos de Disponibilidade AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- clustering [SQL Server]
- Availability Groups [SQL Server], WSFC clusters
- Failover Cluster Instances [SQL Server], see failover clustering [SQL Server]
- quorum [SQL Server]
- failover clustering [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], Failover Cluster Instances
ms.assetid: 613bfbf1-9958-477b-a6be-c6d4f18785c3
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 64ee815c2b852849d9506ca6c3fc114d3d0e4935
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87573281"
---
# <a name="failover-clustering-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="53e6a-102">Clustering de failover e Grupos de Disponibilidade AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="53e6a-102">Failover Clustering and AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="53e6a-103">O [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], a solução de alta disponibilidade e recuperação de desastre incorporada no [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], requer o WSFC (Windows Server Failover Clustering).</span><span class="sxs-lookup"><span data-stu-id="53e6a-103">[!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the high availability and disaster recovery solution introduced in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)], requires Windows Server Failover Clustering (WSFC).</span></span> <span data-ttu-id="53e6a-104">Além disso, embora o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] não seja dependente do clustering de failover do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , você pode usar uma FCI (instância de clustering de failover) para hospedar uma réplica de disponibilidade para um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-104">Also, though [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is not dependent upon [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Clustering, you can use a failover clustering instance (FCI) to host an availability replica for an availability group.</span></span> <span data-ttu-id="53e6a-105">É importante saber a função de cada tecnologia de clustering e quais considerações precisam ser observadas ao criar o ambiente do [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="53e6a-105">It is important to know the role of each clustering technology, and to know what considerations are necessary as you design your [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] environment.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="53e6a-106">Para obter informações sobre os conceitos do [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], consulte [Visão geral dos grupos de disponibilidade AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="53e6a-106">For information about [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] concepts, see [Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md).</span></span>  
  

  
##  <a name="windows-server-failover-clustering-and-availability-groups"></a><a name="WSFC"></a><span data-ttu-id="53e6a-107">Clustering de failover do Windows Server e grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-107">Windows Server Failover Clustering and Availability Groups</span></span>  
 <span data-ttu-id="53e6a-108">A implantação do [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] exige um cluster do WSFC (Windows Server Failover Clustering).</span><span class="sxs-lookup"><span data-stu-id="53e6a-108">Deploying [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] requires a Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="53e6a-109">Para ser habilitado para [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], uma instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] deve residir em um nó WSFC, e o nó e o cluster WSFC devem estar online.</span><span class="sxs-lookup"><span data-stu-id="53e6a-109">To be enabled for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] must reside on a WSFC node, and the WSFC cluster and node must be online.</span></span> <span data-ttu-id="53e6a-110">Além do mais, cada réplica de disponibilidade de um determinado grupo de disponibilidade deve residir em um nó diferente do mesmo cluster do WSFC.</span><span class="sxs-lookup"><span data-stu-id="53e6a-110">Furthermore, each availability replica of a given availability group must reside on a different node of the same WSFC cluster.</span></span> <span data-ttu-id="53e6a-111">A única exceção é que, embora tenha sido migrado para outro cluster WSFC, um grupo de disponibilidade pode temporariamente abranger dois clusters.</span><span class="sxs-lookup"><span data-stu-id="53e6a-111">The only exception is that while being migrated to another WSFC cluster, an availability group can temporarily straddle two clusters.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="53e6a-112">conta com o cluster WSFC (Windows Failover Clustering) para monitorar e gerenciar as funções atuais das réplicas de disponibilidade que pertencem a determinado grupo de disponibilidade e especificar como um evento de failover afeta as réplicas de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-112">relies on the Windows Failover Clustering (WSFC) cluster to monitor and manage the current roles of the availability replicas that belong to a given availability group and to determine how a failover event affects the availability replicas.</span></span> <span data-ttu-id="53e6a-113">Um grupo de recursos do WSFC é criado para cada grupo de disponibilidade que você cria.</span><span class="sxs-lookup"><span data-stu-id="53e6a-113">A WSFC resource group is created for every availability group that you create.</span></span> <span data-ttu-id="53e6a-114">O cluster WSFC monitora este grupo de recursos para avaliar a integridade da réplica primária.</span><span class="sxs-lookup"><span data-stu-id="53e6a-114">The WSFC cluster monitors this resource group to evaluate the health of the primary replica.</span></span>  
  
 <span data-ttu-id="53e6a-115">O quorum para o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] é baseado em todos os nós no cluster WSFC independentemente de se um determinado nó de cluster hospeda qualquer réplica de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-115">The quorum for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] is based on all nodes in the WSFC cluster regardless of whether a given cluster node hosts any availability replicas.</span></span> <span data-ttu-id="53e6a-116">Ao contrário do espelhamento do banco de dados, não há nenhuma função de testemunha no [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="53e6a-116">In contrast to database mirroring, there is no witness role in [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="53e6a-117">A integridade geral de um cluster WSFC é determinada pelos votos do quorum de nós no cluster.</span><span class="sxs-lookup"><span data-stu-id="53e6a-117">The overall health of a WSFC cluster is determined by the votes of quorum of nodes in the cluster.</span></span> <span data-ttu-id="53e6a-118">Se o cluster WSFC for colocado offline devido a um desastre não planejado ou devido a um hardware ou uma falha de comunicação persistente, será necessária intervenção administrativa manual.</span><span class="sxs-lookup"><span data-stu-id="53e6a-118">If the WSFC cluster goes offline because of an unplanned disaster, or due to a persistent hardware or communications failure, manual administrative intervention is required.</span></span> <span data-ttu-id="53e6a-119">Um administrador do Windows Server ou do cluster WSFC precisará forçar um quorum e colocar os nós de cluster de sobrevivência novamente online em uma configuração não tolerante a falhas.</span><span class="sxs-lookup"><span data-stu-id="53e6a-119">A Windows Server or WSFC cluster administrator will need to force a quorum and then bring the surviving cluster nodes back online in a non-fault-tolerant configuration.</span></span>  
  
> [!IMPORTANT]  
>  [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="53e6a-120">são subchaves do cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="53e6a-120">registry keys are subkeys of the WSFC cluster.</span></span> <span data-ttu-id="53e6a-121">Se você excluir e recriar um cluster WSFC, deverá desabilitar e reabilitar o recurso [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] em cada instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que hospedava uma réplica de disponibilidade no cluster WSFC original.</span><span class="sxs-lookup"><span data-stu-id="53e6a-121">If you delete and re-create a WSFC cluster, you must disable and re-enable the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] feature on each instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosted an availability replica on the original WSFC cluster.</span></span>  
  
 <span data-ttu-id="53e6a-122">Para obter informações sobre como executar o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] em nós de cluster WSFC (Clustering de Failover do Windows Server) e sobre o quorum do WSFC, veja [Clustering de Failover do Windows Server &#40;WSFC&#41; com SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="53e6a-122">For information about running [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] on Windows Server Failover Clustering (WSFC) nodes and about WSFC quorum, see [Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md).</span></span>  
  
### <a name="cross-cluster-migration-of-alwayson-availability-groups-for-os-upgrade"></a><span data-ttu-id="53e6a-123">Migração entre clusters de Grupos de Disponibilidade AlwaysOn para atualização do sistema operacional</span><span class="sxs-lookup"><span data-stu-id="53e6a-123">Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade</span></span>  
 <span data-ttu-id="53e6a-124">A partir do [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], o recurso [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] dá suporte à migração entre clusters de grupos de disponibilidade para implantações em um novo cluster WSFC (Windows Server Failover Clustering).</span><span class="sxs-lookup"><span data-stu-id="53e6a-124">Beginning with [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)], [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] supports cross-cluster migration of availability groups for deployments to a new Windows Server Failover Clustering (WSFC) cluster.</span></span> <span data-ttu-id="53e6a-125">Uma migração entre clusters move um grupo de disponibilidade ou um lote de grupos de disponibilidade para o novo cluster WSFC de destino, com tempo de inatividade mínimo.</span><span class="sxs-lookup"><span data-stu-id="53e6a-125">A cross-cluster migration moves one availability group or a batch of availability groups to the new, destination WSFC cluster with minimal downtime.</span></span> <span data-ttu-id="53e6a-126">O processo de migração entre clusters permite manter os contratos de nível de serviço ao atualizar para um cluster do [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="53e6a-126">The cross-cluster migration process enables you to maintain your service level agreements (SLAs) when upgrading to a [!INCLUDE[win8srv](../../../includes/win8srv-md.md)] cluster.</span></span> <span data-ttu-id="53e6a-127">O [!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] (ou uma versão posterior) deve ser instalado e habilitado para AlwaysOn no cluster WSFC de destino.</span><span class="sxs-lookup"><span data-stu-id="53e6a-127">[!INCLUDE[ssSQL11SP1](../../../includes/sssql11sp1-md.md)] (or a later version) must be installed and enabled for AlwaysOn on the destination WSFC cluster.</span></span> <span data-ttu-id="53e6a-128">O êxito de uma migração entre clusters depende do planejamento e preparação meticulosos do cluster WSFC de destino.</span><span class="sxs-lookup"><span data-stu-id="53e6a-128">The success of a cross-cluster migration depends on thorough planning and preparation of the destination WSFC cluster.</span></span>  
  
 <span data-ttu-id="53e6a-129">Para obter mais informações, consulte [Migração entre clusters de grupos de disponibilidade AlwaysOn para atualização do sistema operacional](https://msdn.microsoft.com/library/jj873730.aspx).</span><span class="sxs-lookup"><span data-stu-id="53e6a-129">For more information, see [Cross-Cluster Migration of AlwaysOn Availability Groups for OS Upgrade](https://msdn.microsoft.com/library/jj873730.aspx).</span></span>  
  
##  <a name="ssnoversion-failover-cluster-instances-fcis-and-availability-groups"></a><a name="SQLServerFC"></a> <span data-ttu-id="53e6a-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] FCIs (Instâncias de Cluster de Failover) e grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-130">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Failover Cluster Instances (FCIs) and Availability Groups</span></span>  
 <span data-ttu-id="53e6a-131">Você pode configurar uma segunda camada de failover no nível da instância do servidor implementando o clustering de failover do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] junto com o cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="53e6a-131">You can set up a second layer of failover at the server-instance level by implementing [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering together with the WSFC cluster.</span></span> <span data-ttu-id="53e6a-132">Uma réplica de disponibilidade pode ser hospedada por ou uma instância autônoma do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ou uma instância FCI.</span><span class="sxs-lookup"><span data-stu-id="53e6a-132">An availability replica can be hosted by either a standalone instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] or an FCI instance.</span></span> <span data-ttu-id="53e6a-133">Somente um parceiro FCI pode hospedar uma réplica para um determinado grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-133">Only one FCI partner can host a replica for a given availability group.</span></span> <span data-ttu-id="53e6a-134">Quando uma réplica de disponibilidade estiver sendo executada em um FCI, a lista de proprietários possíveis para o grupo de disponibilidade conterá apenas o nó de FCI ativo.</span><span class="sxs-lookup"><span data-stu-id="53e6a-134">When an availability replica is running on an FCI, the possible owners list for the availability group will contain only the active FCI node.</span></span>  
  
 [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="53e6a-135">não depende de nenhuma forma de armazenamento compartilhado.</span><span class="sxs-lookup"><span data-stu-id="53e6a-135">does not depend on any form of shared storage.</span></span> <span data-ttu-id="53e6a-136">No entanto, se você usar uma FCI (instância de cluster de failover) do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] para hospedar uma ou mais réplicas de disponibilidade, cada uma dessas FCIs exigirá armazenamento compartilhado para cada instalação de instância de cluster de failover padrão do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="53e6a-136">However, if you use a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance (FCI) to host one or more availability replicas, each of those FCIs will require shared storage as per standard SQL Server failover cluster instance installation.</span></span>  
  
 <span data-ttu-id="53e6a-137">Para obter mais informações sobre os pré-requisitos adicionais, consulte a seção “Pré-requisitos e restrições do uso de uma FCI (Instância de Cluster de Failover) do SQL Server para hospedar uma réplica de disponibilidade” de [Pré-requisitos, restrições e recomendações para grupos de disponibilidade AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="53e6a-137">For more information about additional prerequisites, see the "Prerequisites and Restrictions for Using a SQL Server Failover Cluster Instance (FCI) to Host an Availability Replica" section of [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="comparison-of-failover-cluster-instances-and-availability-groups"></a><span data-ttu-id="53e6a-138">Comparação de instâncias de cluster de failover e grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-138">Comparison of Failover Cluster Instances and Availability Groups</span></span>  
 <span data-ttu-id="53e6a-139">Independentemente do número de nós na FCI, uma FCI inteira hospeda uma única réplica dentro de um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-139">Regardless of the number of nodes in the FCI, an entire FCI hosts a single replica within an availability group.</span></span> <span data-ttu-id="53e6a-140">A tabela a seguir descreve as distinções em conceitos entre nós em uma FCI e réplicas dentro de um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-140">The following table describes the distinctions in concepts between nodes in an FCI and replicas within an availability group.</span></span>  
  
||<span data-ttu-id="53e6a-141">Nós dentro de uma FCI</span><span class="sxs-lookup"><span data-stu-id="53e6a-141">Nodes within an FCI</span></span>|<span data-ttu-id="53e6a-142">Réplicas dentro de um grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-142">Replicas within an availability group</span></span>|  
|-|-------------------------|-------------------------------------------|  
|<span data-ttu-id="53e6a-143">**Usa cluster WSFC**</span><span class="sxs-lookup"><span data-stu-id="53e6a-143">**Uses WSFC cluster**</span></span>|<span data-ttu-id="53e6a-144">Sim</span><span class="sxs-lookup"><span data-stu-id="53e6a-144">Yes</span></span>|<span data-ttu-id="53e6a-145">Sim</span><span class="sxs-lookup"><span data-stu-id="53e6a-145">Yes</span></span>|  
|<span data-ttu-id="53e6a-146">**Nível de proteção**</span><span class="sxs-lookup"><span data-stu-id="53e6a-146">**Protection level**</span></span>|<span data-ttu-id="53e6a-147">Instância</span><span class="sxs-lookup"><span data-stu-id="53e6a-147">Instance</span></span>|<span data-ttu-id="53e6a-148">Banco de dados</span><span class="sxs-lookup"><span data-stu-id="53e6a-148">Database</span></span>|  
|<span data-ttu-id="53e6a-149">**Tipo de armazenamento**</span><span class="sxs-lookup"><span data-stu-id="53e6a-149">**Storage type**</span></span>|<span data-ttu-id="53e6a-150">Compartilhado</span><span class="sxs-lookup"><span data-stu-id="53e6a-150">Shared</span></span>|<span data-ttu-id="53e6a-151">Não compartilhado</span><span class="sxs-lookup"><span data-stu-id="53e6a-151">Non-shared</span></span><br /><br /> <span data-ttu-id="53e6a-152">Observe que, embora as réplicas de um grupo de disponibilidade não compartilhem armazenamento, uma réplica hospedada por uma FCI usa uma solução de armazenamento compartilhado conforme exigido por essa FCI.</span><span class="sxs-lookup"><span data-stu-id="53e6a-152">Note that while the replicas in an availability group do not share storage, a replica that is hosted by an FCI uses a shared storage solution as required by that FCI.</span></span> <span data-ttu-id="53e6a-153">A solução de armazenamento é compartilhada somente pelos nós dentro da FCI e não entre as réplicas do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-153">The storage solution is shared only by nodes within the FCI and not between replicas of the availability group.</span></span>|  
|<span data-ttu-id="53e6a-154">**Soluções de armazenamento**</span><span class="sxs-lookup"><span data-stu-id="53e6a-154">**Storage solutions**</span></span>|<span data-ttu-id="53e6a-155">Conexão direta, rede SAN, pontos de montagem, SMB</span><span class="sxs-lookup"><span data-stu-id="53e6a-155">Direct attached, SAN, mount points, SMB</span></span>|<span data-ttu-id="53e6a-156">Depende do tipo de nó</span><span class="sxs-lookup"><span data-stu-id="53e6a-156">Depends on node type</span></span>|  
|<span data-ttu-id="53e6a-157">**Secundários legíveis**</span><span class="sxs-lookup"><span data-stu-id="53e6a-157">**Readable secondaries**</span></span>|<span data-ttu-id="53e6a-158">Não\*</span><span class="sxs-lookup"><span data-stu-id="53e6a-158">No\*</span></span>|<span data-ttu-id="53e6a-159">Sim</span><span class="sxs-lookup"><span data-stu-id="53e6a-159">Yes</span></span>|  
|<span data-ttu-id="53e6a-160">**Configurações de política de failover aplicáveis**</span><span class="sxs-lookup"><span data-stu-id="53e6a-160">**Applicable failover policy settings**</span></span>|<span data-ttu-id="53e6a-161">Quorum WSFC</span><span class="sxs-lookup"><span data-stu-id="53e6a-161">WSFC quorum</span></span><br /><br /> <span data-ttu-id="53e6a-162">Específica da FCI</span><span class="sxs-lookup"><span data-stu-id="53e6a-162">FCI-specific</span></span><br /><br /> <span data-ttu-id="53e6a-163">Configurações de grupo de disponibilidade\*\*</span><span class="sxs-lookup"><span data-stu-id="53e6a-163">Availability group settings\*\*</span></span>|<span data-ttu-id="53e6a-164">Quorum WSFC</span><span class="sxs-lookup"><span data-stu-id="53e6a-164">WSFC quorum</span></span><br /><br /> <span data-ttu-id="53e6a-165">Configurações de grupo de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-165">Availability group settings</span></span>|  
|<span data-ttu-id="53e6a-166">**Recursos que recebem failover**</span><span class="sxs-lookup"><span data-stu-id="53e6a-166">**Failed-over resources**</span></span>|<span data-ttu-id="53e6a-167">Servidor, instância e banco de dados</span><span class="sxs-lookup"><span data-stu-id="53e6a-167">Server, instance, and database</span></span>|<span data-ttu-id="53e6a-168">Apenas banco de dados</span><span class="sxs-lookup"><span data-stu-id="53e6a-168">Database only</span></span>|  
  
 <span data-ttu-id="53e6a-169">\*Enquanto as réplicas secundárias síncronas em um grupo de disponibilidade sempre estão em execução em suas respectivas instâncias do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , os nós secundários em uma FCI não iniciaram suas respectivas instâncias do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] de fato e, portanto, não são legíveis.</span><span class="sxs-lookup"><span data-stu-id="53e6a-169">\*Whereas synchronous secondary replicas in an availability group are always running on their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances, secondary nodes in an FCI actually have not started their respective [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances and are therefore not readable.</span></span> <span data-ttu-id="53e6a-170">Em uma FCI, um nó secundário inicia sua instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] somente quando a propriedade do grupo de recursos é transferida a ele durante um failover de FCI.</span><span class="sxs-lookup"><span data-stu-id="53e6a-170">In an FCI, a secondary node starts its [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance only when the resource group ownership is transferred to it during an FCI failover.</span></span> <span data-ttu-id="53e6a-171">No entanto, no nó FCI ativo, quando um banco de dados hospedado por FCI pertence a um grupo de disponibilidade, se a réplica de disponibilidade local estiver em execução como réplica secundária legível, o banco de dados será legível.</span><span class="sxs-lookup"><span data-stu-id="53e6a-171">However, on the active FCI node, when an FCI-hosted database belongs to an availability group, if the local availability replica is running as a readable secondary replica, the database is readable.</span></span>  
  
 <span data-ttu-id="53e6a-172">\*\*As configurações de política de failover do grupo de disponibilidade se aplicam a todas as réplicas, sejam elas armazenadas em uma instância autônoma ou em uma instância FCI.</span><span class="sxs-lookup"><span data-stu-id="53e6a-172">\*\*Failover policy settings for the availability group apply to all replicas, whether it is hosted in a standalone instance or an FCI instance.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="53e6a-173">Para obter mais informações sobre o **número de nós** no clustering de Failover e **grupos de disponibilidade AlwaysOn** para edições diferentes do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , consulte [recursos com suporte nas edições do SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) ( https://go.microsoft.com/fwlink/?linkid=232473) .</span><span class="sxs-lookup"><span data-stu-id="53e6a-173">For more information about **Number of nodes** within Failover Clustering and **AlwaysOn Availability Groups** for different editions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], see [Features Supported by the Editions of SQL Server 2012](https://go.microsoft.com/fwlink/?linkid=232473) (https://go.microsoft.com/fwlink/?linkid=232473).</span></span>  
  
### <a name="considerations-for-hosting-an-availability-replica-on-an-fci"></a><span data-ttu-id="53e6a-174">Considerações para hospedar uma réplica de disponibilidade em uma FCI</span><span class="sxs-lookup"><span data-stu-id="53e6a-174">Considerations for hosting an Availability Replica on an FCI</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="53e6a-175">Se você planeja hospedar uma réplica de disponibilidade em uma FCI (instância de cluster de failover) do SQL Server, é preciso garantir que os nós host do Windows Server 2008 atendam aos pré-requisitos e às restrições do AlwaysOn para FCIs (instâncias de cluster de failover).</span><span class="sxs-lookup"><span data-stu-id="53e6a-175">If you plan to host an availability replica on a SQL Server Failover Cluster Instance (FCI), ensure that the Windows Server 2008 host nodes meet the AlwaysOn prerequisites and restrictions for Failover Cluster Instances (FCIs).</span></span> <span data-ttu-id="53e6a-176">Para obter mais informações, consulte [Pré-requisitos, restrições e recomendações para grupos de disponibilidade AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="53e6a-176">For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="53e6a-177">As FCIs (Instâncias de Cluster de Failover) não dão suporte ao failover automático por grupos de disponibilidade, de modo que qualquer réplica de disponibilidade que esteja hospedado por um FCI só pode ser configurada para failover manual.</span><span class="sxs-lookup"><span data-stu-id="53e6a-177">Failover Cluster Instances (FCIs) do not support automatic failover by availability groups, so any availability replica that is hosted by an FCI can only be configured for manual failover.</span></span>  
  
 <span data-ttu-id="53e6a-178">Talvez seja necessário configurar um cluster WSFC (Windows Server Failover Clustering) para incluir discos compartilhados que não estão disponíveis em todos os nós.</span><span class="sxs-lookup"><span data-stu-id="53e6a-178">You might need to configure a Windows Server Failover Clustering (WSFC) cluster to include shared disks that are not available on all nodes.</span></span> <span data-ttu-id="53e6a-179">Por exemplo, considere um cluster WSFC em dois centros de dados com três nós.</span><span class="sxs-lookup"><span data-stu-id="53e6a-179">For example, consider a WSFC cluster across two data centers with three nodes.</span></span> <span data-ttu-id="53e6a-180">Dois dos nós hospedam uma FCI (instância de clustering de failover) do SQL Server no data center primário e têm acesso aos mesmos discos compartilhados.</span><span class="sxs-lookup"><span data-stu-id="53e6a-180">Two of the nodes host a SQL Server failover clustering instance (FCI) in the primary data center and have access to the same shared disks.</span></span> <span data-ttu-id="53e6a-181">O terceiro nó hospeda uma instância autônoma do SQL Server em um data center diferente e não tem acesso aos discos compartilhados do data center primário.</span><span class="sxs-lookup"><span data-stu-id="53e6a-181">The third node hosts a stand-alone instance of SQL Server in a different data center and does not have access to the shared disks from the primary data center.</span></span> <span data-ttu-id="53e6a-182">Essa configuração de cluster WSFC oferece suporte à implantação de um grupo de disponibilidade se a FCI hospeda a réplica primária e a instância autônoma hospeda a réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="53e6a-182">This WSFC cluster configuration supports the deployment of an availability group if the FCI hosts the primary replica and the stand-alone instance hosts the secondary replica.</span></span>  
  
 <span data-ttu-id="53e6a-183">Quando for escolher uma FCI para hospedar uma réplica de disponibilidade para determinado grupo de disponibilidade, assegure-se de que um failover da FCI não tenha a possibilidade de fazer com que um nó WSFC tente hospedar duas réplicas de disponibilidade para o mesmo grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-183">When choosing an FCI to host an availability replica for a given availability group, ensure that an FCI failover could not potentially cause a single WSFC node to attempt to host two availability replicas for the same availability group.</span></span>  
  
 <span data-ttu-id="53e6a-184">O exemplo de cenário a seguir ilustra como esta configuração pode resultar em problemas:</span><span class="sxs-lookup"><span data-stu-id="53e6a-184">The following example scenario illustrates how this configuration could lead to problems:</span></span>  
  
 <span data-ttu-id="53e6a-185">Marcel configura um cluster WSFC com dois nós, `NODE01` e `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="53e6a-185">Marcel configures two a WSFC cluster with two nodes, `NODE01` and `NODE02`.</span></span> <span data-ttu-id="53e6a-186">Ele instala uma instância de cluster de failover do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , `fciInstance1`, em `NODE01` e `NODE02` onde `NODE01` é o proprietário atual de `fciInstance1`.</span><span class="sxs-lookup"><span data-stu-id="53e6a-186">He installs a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover cluster instance, `fciInstance1`, on both `NODE01` and `NODE02` where `NODE01` is the current owner for `fciInstance1`.</span></span>  
 <span data-ttu-id="53e6a-187">Em `NODE02`, Marcel instala outra instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, que é uma instância autônoma.</span><span class="sxs-lookup"><span data-stu-id="53e6a-187">On `NODE02`, Marcel installs another instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], `Instance3`, which is a stand-alone instance.</span></span>  
 <span data-ttu-id="53e6a-188">Em `NODE01`, Marcel habilita a fciInstance1 para o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="53e6a-188">On `NODE01`, Marcel enables fciInstance1 for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="53e6a-189">Em `NODE02`, ele habilita a `Instance3` para o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="53e6a-189">On `NODE02`, he enables `Instance3` for [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="53e6a-190">Depois, ele configura um grupo de disponibilidade para qual a `fciInstance1` hospeda a réplica primária e `Instance3` hospeda a réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="53e6a-190">Then he sets up an availability group for which `fciInstance1` hosts the primary replica, and `Instance3` hosts the secondary replica.</span></span>  
 <span data-ttu-id="53e6a-191">Em determinado momento, a `fciInstance1` torna-se disponível em `NODE01`e o cluster WSFC provoca o failover da `fciInstance1` em `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="53e6a-191">At some point `fciInstance1` becomes unavailable on `NODE01`, and the WSFC cluster causes a failover of `fciInstance1` to `NODE02`.</span></span> <span data-ttu-id="53e6a-192">Após o failover, `fciInstance1` torna-se uma instância habilitada para o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]executada sob a função primária em `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="53e6a-192">After the failover, `fciInstance1` is a [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]-enabled instance running under the primary role on `NODE02`.</span></span> <span data-ttu-id="53e6a-193">No entanto, agora a `Instance3` reside no mesmo nó WSFC da `fciInstance1`.</span><span class="sxs-lookup"><span data-stu-id="53e6a-193">However, `Instance3` now resides on the same WSFC node as `fciInstance1`.</span></span> <span data-ttu-id="53e6a-194">Isso violará a restrição do [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="53e6a-194">This violates the [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] constraint.</span></span>  
 <span data-ttu-id="53e6a-195">Para resolver o problema apresentado por este cenário, a instância autônoma, `Instance3`, deve residir em outro nó no mesmo cluster WSFC de `NODE01` e `NODE02`.</span><span class="sxs-lookup"><span data-stu-id="53e6a-195">To correct the problem that this scenario presents, the stand-alone instance, `Instance3`, must reside on another node in the same WSFC cluster as `NODE01` and `NODE02`.</span></span>  
  
 <span data-ttu-id="53e6a-196">Para obter mais informações sobre clustering de failover do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], consulte [Instâncias do cluster de failover do AlwaysOn &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="53e6a-196">For more information about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] failover clustering, see [AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
##  <a name="restrictions-on-using-the-wsfc-failover-cluster-manager-with-availability-groups"></a><a name="FCMrestrictions"></a><span data-ttu-id="53e6a-197">Restrições sobre como usar o Gerenciador de Cluster de Failover WSFC com grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-197">Restrictions on Using The WSFC Failover Cluster Manager with Availability Groups</span></span>  
 <span data-ttu-id="53e6a-198">Não use o Gerenciador de Cluster de Failover para manipular grupos de disponibilidade, por exemplo:</span><span class="sxs-lookup"><span data-stu-id="53e6a-198">Do not use the Failover Cluster Manager to manipulate availability groups, for example:</span></span>  
  
-   <span data-ttu-id="53e6a-199">Não adicione nem remova recursos no serviço clusterizado (grupo de recursos) para o grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-199">Do not add or remove resources in the clustered service (resource group) for the availability group.</span></span>  
  
-   <span data-ttu-id="53e6a-200">Não altere nenhuma propriedade do grupo de disponibilidade, como os proprietários possíveis e os proprietários preferenciais.</span><span class="sxs-lookup"><span data-stu-id="53e6a-200">Do not change any availability group properties, such as the possible owners and preferred owners.</span></span> <span data-ttu-id="53e6a-201">Essas propriedades são definidas automaticamente pelo grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-201">These properties are set automatically by the availability group.</span></span>  
  
-   <span data-ttu-id="53e6a-202">Não use o Gerenciador de Cluster de Failover para mover grupos de disponibilidade para nós diferentes ou para fazer o failover de grupos de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-202">Do not use the Failover Cluster Manager to move availability groups to different nodes or to fail over availability groups.</span></span> <span data-ttu-id="53e6a-203">O Gerenciador de Cluster de Failover não reconhece o status da sincronização das réplicas de disponibilidade, e isso pode resultar em um longo tempo de inatividade.</span><span class="sxs-lookup"><span data-stu-id="53e6a-203">The Failover Cluster Manager is not aware of the synchronization status of the availability replicas, and doing so can lead to extended downtime.</span></span> <span data-ttu-id="53e6a-204">Você deve usar [!INCLUDE[tsql](../../../includes/tsql-md.md)] ou [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="53e6a-204">You must use [!INCLUDE[tsql](../../../includes/tsql-md.md)] or [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)].</span></span>  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="53e6a-205">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="53e6a-205">Related Content</span></span>  
  
-   <span data-ttu-id="53e6a-206">**Blogs:**</span><span class="sxs-lookup"><span data-stu-id="53e6a-206">**Blogs:**</span></span>  
  
     [<span data-ttu-id="53e6a-207">Configurar o Windows Failover Clustering para SQL Server (grupo de disponibilidade ou FCI) com segurança limitada</span><span class="sxs-lookup"><span data-stu-id="53e6a-207">Configure Windows Failover Clustering for SQL Server (Availability Group or FCI) with Limited Security</span></span>](https://blogs.msdn.com/b/sqlalwayson/archive/2012/06/05/configure-windows-failover-clustering-for-sql-server-availability-group-or-fci-with-limited-security.aspx)  
  
     [<span data-ttu-id="53e6a-208">Blogs da equipe do SQL Server AlwaysOn: o blog oficial da equipe do SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="53e6a-208">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="53e6a-209">Blogs dos engenheiros do CSS SQL Server</span><span class="sxs-lookup"><span data-stu-id="53e6a-209">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="53e6a-210">**Whitepapers:**</span><span class="sxs-lookup"><span data-stu-id="53e6a-210">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="53e6a-211">Guia da arquitetura do AlwaysOn: Criando uma solução de alta disponibilidade e recuperação de desastres usando instâncias de cluster de failover e grupos de disponibilidade</span><span class="sxs-lookup"><span data-stu-id="53e6a-211">AlwaysOn Architecture Guide: Building a High Availability and Disaster Recovery Solution by Using Failover Cluster Instances and Availability Groups</span></span>](https://msdn.microsoft.com/library/jj215886.aspx)  
  
     [<span data-ttu-id="53e6a-212">Guia de soluções AlwaysOn do Microsoft SQL Server para alta disponibilidade e recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="53e6a-212">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="53e6a-213">White papers da Microsoft para SQL Server 2012</span><span class="sxs-lookup"><span data-stu-id="53e6a-213">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="53e6a-214">White papers da equipe de consultoria do cliente do SQL Server</span><span class="sxs-lookup"><span data-stu-id="53e6a-214">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="53e6a-215">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="53e6a-215">See Also</span></span>  
 <span data-ttu-id="53e6a-216">[Visão geral do Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [habilitar e desabilitar grupos de disponibilidade AlwaysOn](enable-and-disable-always-on-availability-groups-sql-server.md) &#40;SQL Server de&#41;[monitorar grupos de disponibilidade &#40;o Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span><span class="sxs-lookup"><span data-stu-id="53e6a-216">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) [Enable and Disable AlwaysOn Availability Groups &#40;SQL Server&#41;](enable-and-disable-always-on-availability-groups-sql-server.md) [Monitor Availability Groups &#40;Transact-SQL&#41;](monitor-availability-groups-transact-sql.md)</span></span>  
 [<span data-ttu-id="53e6a-217">Instâncias de cluster de failover do AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="53e6a-217">AlwaysOn Failover Cluster Instances &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) 
  
  
