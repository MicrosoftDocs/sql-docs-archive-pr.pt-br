---
title: Replicação, Controle de Alterações, captura de dados de alteração e Grupos de Disponibilidade AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- change tracking [SQL Server], AlwaysOn Availability Groups
- change data capture [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], interoperability
- replication [SQL Server], AlwaysOn Availability Groups
ms.assetid: e17a9ca9-dd96-4f84-a85d-60f590da96ad
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e8ea6257cb906177b9eb224d718eecf54fb94119
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87571598"
---
# <a name="replication-change-tracking-change-data-capture-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="b9c59-102">Replicação, controle de alterações, Change Data Capture e grupos de disponibilidade AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b9c59-102">Replication, Change Tracking, Change Data Capture, and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="b9c59-103">Há suporte para a replicação, a CDC (captura de dados de alteração) e o CT (controle de alterações) no [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-103">Replication, change data capture (CDC), and change tracking (CT) are supported on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="b9c59-104">fornece alta disponibilidade e recursos adicionais de recuperação de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b9c59-104">helps provide high availability and additional database recovery capabilities.</span></span>  
  
 
  
##  <a name="overview-of-replication-on-alwayson-availability-groups"></a><a name="Overview"></a><span data-ttu-id="b9c59-105">Visão geral da replicação no Grupos de Disponibilidade AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="b9c59-105">Overview of Replication on AlwaysOn Availability Groups</span></span>  
  
###  <a name="publisher-redirection"></a><a name="PublisherRedirect"></a> <span data-ttu-id="b9c59-106">Redirecionamento do publicador</span><span class="sxs-lookup"><span data-stu-id="b9c59-106">Publisher Redirection</span></span>  
 <span data-ttu-id="b9c59-107">Quando um banco de dados publicado reconhecer o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], o distribuidor que fornece ao agente acesso a esse banco de dados será configurado com as entradas de redirected_publishers.</span><span class="sxs-lookup"><span data-stu-id="b9c59-107">When a published database is aware of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the distributor that provides agent access to the publishing database is configured with redirected_publishers entries.</span></span> <span data-ttu-id="b9c59-108">Essas entradas redirecionam o par de publicador/banco de dados configurado originalmente, usando um nome do ouvinte do grupo de disponibilidade para conectar-se ao publicador e ao banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="b9c59-108">These entries redirect the originally configured publisher/database pair, making use of an availability group listener name to connect to the publisher and publishing database.</span></span> <span data-ttu-id="b9c59-109">Haverá falha no failover das conexões estabelecidas pelo nome do ouvinte do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-109">Established connections through the availability group listener name will fail on failover.</span></span> <span data-ttu-id="b9c59-110">Quando o agente de replicação for reiniciado depois do failover, a conexão será automaticamente redirecionada para o novo primário.</span><span class="sxs-lookup"><span data-stu-id="b9c59-110">When the replication agent restarts after failover, the connection will automatically be redirected to the new primary.</span></span>  
  
 <span data-ttu-id="b9c59-111">Em um grupo de disponibilidade AlwaysOn, um banco de dados secundário não pode ser um publicador.</span><span class="sxs-lookup"><span data-stu-id="b9c59-111">In an AlwaysOn availability group a secondary database cannot be a publisher.</span></span> <span data-ttu-id="b9c59-112">A republicação não tem suporte quando a replicação é combinada com o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-112">Republishing is not supported when replication is combined with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="b9c59-113">Se um banco de dados publicado for membro de um grupo de disponibilidade e o publicador for redirecionado, ele deverá ser redirecionado para um nome de ouvinte de grupo de disponibilidade associado ao grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-113">If a published database is a member of an availability group and the publisher is redirected, it must be redirected to an availability group listener name associated with the availability group.</span></span> <span data-ttu-id="b9c59-114">Ele não poderá ser redirecionado para um nó explícito.</span><span class="sxs-lookup"><span data-stu-id="b9c59-114">It may not be redirected to an explicit node.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b9c59-115">Após o failover em uma replica secundária, o Replication Monitor não poderá ajustar o nome da instância de publicação do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e continuará exibindo informações de replicação abaixo do nome da instância primária original do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-115">After failover to a secondary replica, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="b9c59-116">Depois do failover, um token de rastreamento não pode ser inserido usando o Replication Monitor; porém um token de rastreamento inserido no novo publicador usando [!INCLUDE[tsql](../../../includes/tsql-md.md)]é visível no Replication Monitor.</span><span class="sxs-lookup"><span data-stu-id="b9c59-116">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
###  <a name="general-changes-to-replication-agents-to-support-alwayson-availability-groups"></a><a name="Changes"></a><span data-ttu-id="b9c59-117">Alterações gerais nos agentes de replicação para dar suporte ao Grupos de Disponibilidade AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="b9c59-117">General Changes to Replication Agents to Support AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="b9c59-118">Três agentes de replicação foram modificados para dar suporte ao [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-118">Three replication agents were modified to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="b9c59-119">O Leitor de Log, o Instantâneo e os Agentes de mesclagem foram modificados para consultar o banco de dados de distribuição para o publicador redirecionado e para usar o nome do ouvinte do grupo de disponibilidade retornado, se um publicador redirecionado tiver sido declarado, para conectar-se ao publicador de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b9c59-119">The Log Reader, Snapshot, and Merge agents were modified to query the distribution database for the redirected publisher and to use the returned availability group listener name, if a redirected publisher was declared, to connect to the database publisher.</span></span>  
  
 <span data-ttu-id="b9c59-120">Por padrão, quando os agentes consultam o distribuidor para determinar se o publicador original foi redirecionado, é verificada a adequação do destino atual ou o redirecionamento antes de retornar o host redirecionado ao agente.</span><span class="sxs-lookup"><span data-stu-id="b9c59-120">By default, when the agents query the distributor to determine whether the original publisher has been redirected, the suitability of the current target or redirection will be verified prior to returning the redirected host to the agent.</span></span> <span data-ttu-id="b9c59-121">Este é o comportamento recomendado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-121">This is recommended behavior.</span></span> <span data-ttu-id="b9c59-122">No entanto, se a inicialização do agente ocorrer com muita frequência, a sobrecarga associada com o procedimento armazenado de validação poderá ser considerada muito cara.</span><span class="sxs-lookup"><span data-stu-id="b9c59-122">However, if agent start up occurs very frequently the overhead associated with the validation stored procedure may be deemed too costly.</span></span> <span data-ttu-id="b9c59-123">Uma nova opção de linha de comando, *BypassPublisherValidation*, foi adicionada aos agentes de Leitor de Log, Instantâneo e Mesclagem.</span><span class="sxs-lookup"><span data-stu-id="b9c59-123">A new command line switch, *BypassPublisherValidation*, has been added to the Logreader, Snapshot, and Merge agents.</span></span> <span data-ttu-id="b9c59-124">Quando o comutador é usado, o publicador redirecionado é retornado imediatamente ao agente e a execução do procedimento armazenado de validação é ignorada.</span><span class="sxs-lookup"><span data-stu-id="b9c59-124">When the switch is used, the redirected publisher is returned immediately to the agent and execution of the validation stored procedure is bypassed.</span></span>  
  
 <span data-ttu-id="b9c59-125">As falhas retornadas do procedimento armazenado de validação são registradas nos logs de histórico do agente.</span><span class="sxs-lookup"><span data-stu-id="b9c59-125">Failures returned from the validation stored procedure are logged in the agent history logs.</span></span> <span data-ttu-id="b9c59-126">Esses erros com severidade maior que ou igual a 16 causarão a finalização dos agentes.</span><span class="sxs-lookup"><span data-stu-id="b9c59-126">Those errors with severity greater than or equal to 16 will cause the agents to terminate.</span></span> <span data-ttu-id="b9c59-127">Alguns recursos de tentar novamente foram embutidos para os agentes tratarem a desconexão esperada de um banco de dados publicado quando ocorrer failover para um novo primário.</span><span class="sxs-lookup"><span data-stu-id="b9c59-127">Some retry capabilities have been built in to the agents to handle the expected disconnect from a published database when it fails over to a new primary.</span></span>  
  
#### <a name="log-reader-agent-modifications"></a><span data-ttu-id="b9c59-128">Modificações do Agente de Leitor de Log</span><span class="sxs-lookup"><span data-stu-id="b9c59-128">Log Reader Agent Modifications</span></span>  
 <span data-ttu-id="b9c59-129">O Logreader Agent tem as seguintes alterações.</span><span class="sxs-lookup"><span data-stu-id="b9c59-129">The Logreader Agent has the following changes.</span></span>  
  
-   <span data-ttu-id="b9c59-130">**Consistência do banco de dados replicado**</span><span class="sxs-lookup"><span data-stu-id="b9c59-130">**Replicated Database Consistency**</span></span>  
  
     <span data-ttu-id="b9c59-131">Quando um banco de dados publicado é membro de um grupo de disponibilidade AlwaysOn, por padrão, o leitor de log não processa registros de log que ainda não foram protegidos em todas as réplicas secundárias do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-131">When a published database is a member of an AlwaysOn availability group, by default the log reader will not process log records that have not already been hardened at all availability group secondary replicas.</span></span> <span data-ttu-id="b9c59-132">Isso garante que, durante um failover, todas as linhas replicadas para um assinante também estejam presentes no novo primário.</span><span class="sxs-lookup"><span data-stu-id="b9c59-132">This insures that on failover, all rows replicated to a subscriber also are present at the new primary.</span></span>  
  
     <span data-ttu-id="b9c59-133">Quando o publicador tem só duas réplicas do AlwaysOn (uma primária e uma secundária) e um failover acontece, a réplica primária original permanece desativada porque o logreader não avança até que todos os bancos de dados secundários sejam colocados novamente online ou até que as réplicas secundárias com falha sejam removidas do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-133">When the publisher has only two AlwaysOn availability replicas (one primary and one secondary) and a failover happens, the original primary replica remains down because the logreader does not move forward until all secondary databases are brought back online or until the failing secondary replicas are removed from the availability group.</span></span> <span data-ttu-id="b9c59-134">Agora o leitor de log, que está sendo executado no banco de dados secundário, não continuará porque o AlwaysOn não poderá proteger as alterações feitas nos bancos de dados secundários.</span><span class="sxs-lookup"><span data-stu-id="b9c59-134">The logreader, now running against the secondary database, will not proceed forward since AlwaysOn cannot harden any changes to any secondary database.</span></span> <span data-ttu-id="b9c59-135">Para permitir que o leitor de log continue e ainda tenha a capacidade de recuperação de desastres, remova a réplica primária original do grupo de disponibilidade usando ALTER AVAILABITY GROUP <nome_do_grupo> REMOVE REPLICA.</span><span class="sxs-lookup"><span data-stu-id="b9c59-135">To allow the logreader to proceed further and still have disaster recovery capacity, remove the original primary replica from the availability group using ALTER AVAILABITY GROUP <group_name> REMOVE REPLICA.</span></span> <span data-ttu-id="b9c59-136">Em seguida, adicione uma nova réplica secundária ao grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-136">Then add a new secondary replica to the availability group.</span></span>  
  
-   <span data-ttu-id="b9c59-137">**Sinalizador de rastreamento 1448**</span><span class="sxs-lookup"><span data-stu-id="b9c59-137">**Trace flag 1448**</span></span>  
  
     <span data-ttu-id="b9c59-138">O sinalizador de rastreamento 1448 permite que o leitor de log de replicação avance, mesmo se as réplicas secundárias assíncronas não tiverem confirmado a recepção de uma alteração.</span><span class="sxs-lookup"><span data-stu-id="b9c59-138">Trace flag 1448 enables the replication log reader to move forward even if the asynchronous secondary replicas have not acknowledged the reception of a change.</span></span> <span data-ttu-id="b9c59-139">Mesmo com esse sinalizador de rastreamento habilitado, o leitor de log sempre aguardará as réplicas secundárias síncronas.</span><span class="sxs-lookup"><span data-stu-id="b9c59-139">Even with this trace flag enabled,, the log reader always waits for the synchronous secondary replicas.</span></span> <span data-ttu-id="b9c59-140">O leitor de log não ultrapassará o reconhecimento mínimo das réplicas secundárias síncronas.</span><span class="sxs-lookup"><span data-stu-id="b9c59-140">The log reader will not go beyond the min ack of the synchronous secondary replicas.</span></span> <span data-ttu-id="b9c59-141">Ele se aplica à instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], e não apenas a um grupo de disponibilidade, um banco de dados de disponibilidade ou uma instância do leitor de log.</span><span class="sxs-lookup"><span data-stu-id="b9c59-141">This trace flag applies to the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], not just to an availability group, an availability database, or a log reader instance.</span></span> <span data-ttu-id="b9c59-142">Esse sinalizador de rastreamento entrará em vigor imediatamente, sem reinicialização.</span><span class="sxs-lookup"><span data-stu-id="b9c59-142">This trace flag takes effect immediately without a restart.</span></span> <span data-ttu-id="b9c59-143">Ele pode ser ativado antecipadamente ou quando uma réplica secundária assíncrona apresentar falha.</span><span class="sxs-lookup"><span data-stu-id="b9c59-143">It can be activated ahead of time or when an asynchronous secondary replica fails.</span></span>  
  
###  <a name="stored-procedures-supporting-alwayson"></a><a name="StoredProcs"></a><span data-ttu-id="b9c59-144">Procedimentos armazenados com suporte para AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="b9c59-144">Stored Procedures Supporting AlwaysOn</span></span>  
  
-   <span data-ttu-id="b9c59-145">**sp_redirect_publisher**</span><span class="sxs-lookup"><span data-stu-id="b9c59-145">**sp_redirect_publisher**</span></span>  
  
     <span data-ttu-id="b9c59-146">O procedimento armazenado **sp_redirect_publisher** é usado para especificar um publicador redirecionado para um par de publicador/banco de dados existente.</span><span class="sxs-lookup"><span data-stu-id="b9c59-146">The stored procedure **sp_redirect_publisher** is used to specify a redirected publisher for an existing publisher/database pair.</span></span> <span data-ttu-id="b9c59-147">Se o banco de dados publicador pertencer a um grupo de disponibilidade, o publicador redirecionado será o nome do ouvinte do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-147">If the publisher database belongs to an availability group, the redirected publisher is the availability group listener name.</span></span>  
  
-   <span data-ttu-id="b9c59-148">**sp_get_redirected_publisher**</span><span class="sxs-lookup"><span data-stu-id="b9c59-148">**sp_get_redirected_publisher**</span></span>  
  
     <span data-ttu-id="b9c59-149">O procedimento armazenado **sp_get_redirected_publisher** é usado por agentes de replicação para consultar um distribuidor para determinar se um par de publicador/banco de dados tem um publicador redirecionado definido.</span><span class="sxs-lookup"><span data-stu-id="b9c59-149">The stored procedure **sp_get_redirected_publisher** is used by replication agents to query a distributor to determine whether a publisher/database pair has a defined redirected publisher.</span></span> <span data-ttu-id="b9c59-150">Esse procedimento armazenado atende a dois objetivos.</span><span class="sxs-lookup"><span data-stu-id="b9c59-150">This stored procedure serves two purposes.</span></span> <span data-ttu-id="b9c59-151">Primeiro, permite que o agente determine se o publicador original foi redirecionado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-151">First, it allows the agent to determine whether the original publisher has been redirected.</span></span> <span data-ttu-id="b9c59-152">Em segundo lugar, também pode iniciar a execução de um procedimento armazenado de validação no distribuidor (**sp_validate_redirected_publisher**), que verifica a adequação do nó de destino do redirecionamento para servir como um publicador para o banco de dados nomeado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-152">Second, it may also initiate a validation stored procedure run at the distributor (**sp_validate_redirected_publisher**) that verifies the suitability of the target node of the redirection to serve as a publisher for the named database.</span></span>  
  
     <span data-ttu-id="b9c59-153">Para executar esse procedimento armazenado, o chamador deve ser membro da função de servidor **sysadmin** , da função de banco de dados **db_owner** para o banco de dados de distribuição ou membro de uma **Lista de Acesso à Publicação** para uma publicação definida associada ao banco de dados publicador.</span><span class="sxs-lookup"><span data-stu-id="b9c59-153">To execute this stored procedure the caller must either be a member of the **sysadmin** server role, the **db_owner** database role for the distribution database, or a member of a **Publication Access List** for a defined publication associated with the publisher database.</span></span>  
  
-   <span data-ttu-id="b9c59-154">**sp_validate_redirected_publisher**</span><span class="sxs-lookup"><span data-stu-id="b9c59-154">**sp_validate_redirected_publisher**</span></span>  
  
     <span data-ttu-id="b9c59-155">Este procedimento armazenado tenta validar se o publicador atual pode hospedar o banco de dados publicado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-155">This stored procedure attempts to validate that the current publisher is capable of hosting the published database.</span></span> <span data-ttu-id="b9c59-156">Ele pode ser chamado a qualquer momento para verificar se o host atual do banco de dados publicado pode dar suporte à replicação.</span><span class="sxs-lookup"><span data-stu-id="b9c59-156">It can be called at any time to verify that the current host for the published database is capable of supporting replication.</span></span>  
  
-   <span data-ttu-id="b9c59-157">**sp_validate_replicate_hosts_as_publishers**</span><span class="sxs-lookup"><span data-stu-id="b9c59-157">**sp_validate_replicate_hosts_as_publishers**</span></span>  
  
     <span data-ttu-id="b9c59-158">Embora seja útil para os agentes garantir que a réplica primária atual possa funcionar como publicador de replicação em um banco de dados publicador, será necessário um recurso de validação mais genérico para estabelecer a validade de uma topologia de replicação inteira no banco de dados de disponibilidade AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="b9c59-158">While it is useful for the agents to insure that the current primary can function as the replication publisher for a publisher database, a more general validation capability is needed to establish the validity of an entire replication topology on an AlwaysOn availability database.</span></span> <span data-ttu-id="b9c59-159">O procedimento armazenado **sp_validate_replica_hosts_as_publishers** foi criado para atender a essa necessidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-159">The stored procedure **sp_validate_replica_hosts_as_publishers** is designed to fill this need.</span></span>  
  
     <span data-ttu-id="b9c59-160">Esse procedimento armazenado sempre é executado manualmente.</span><span class="sxs-lookup"><span data-stu-id="b9c59-160">This stored procedure is always run manually.</span></span> <span data-ttu-id="b9c59-161">O chamador deve ser **sysadmin** no distribuidor, **dbowner** do banco de dados de distribuição ou membro da **Lista de Acesso à Publicação** de uma publicação do banco de dados publicador.</span><span class="sxs-lookup"><span data-stu-id="b9c59-161">The caller must either be **sysadmin** at the distributor, **dbowner** of the distribution database, or a member of the **Publication Access List** of a publication of the publisher database.</span></span> <span data-ttu-id="b9c59-162">Além disso, o logon do chamador deve ser válido para todos os hosts de réplica de disponibilidade e ter privilégios selecionados no banco de dados de disponibilidade associado ao banco de dados publicador.</span><span class="sxs-lookup"><span data-stu-id="b9c59-162">In addition, the login of the caller must be a valid login for all of the availability replica hosts, and have select privileges on the availability database associated with the publisher database.</span></span>  
  
###  <a name="change-data-capture"></a><a name="CDC"></a> <span data-ttu-id="b9c59-163">Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="b9c59-163">Change Data Capture</span></span>  
 <span data-ttu-id="b9c59-164">Os bancos de dados habilitados para CDC (captura de dados de alteração) podem utilizar o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] para garantir não apenas que o banco de dados permaneça disponível em caso de falha, mas que as alterações nas tabelas de banco de dados continuem sendo monitoradas e depositadas nas tabelas de alterações de CDC.</span><span class="sxs-lookup"><span data-stu-id="b9c59-164">Databases enabled for change data capture (CDC) are able to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in order to insure not only that the database remains available in the event of failure, but that changes to the database tables continue to be monitored and deposited in the CDC change tables.</span></span> <span data-ttu-id="b9c59-165">A ordem na qual o CDC e o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] são configurados não é importante.</span><span class="sxs-lookup"><span data-stu-id="b9c59-165">The order in which CDC and [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] are configured is not important.</span></span> <span data-ttu-id="b9c59-166">Os bancos de dados habilitados para CDC podem ser adicionados ao [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], e os bancos de dados que são membros de um grupo de disponibilidade AlwaysOn podem ser habilitados para CDC.</span><span class="sxs-lookup"><span data-stu-id="b9c59-166">CDC enabled databases can be added to [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], and databases that are members of an AlwaysOn availability group can be enabled for CDC.</span></span> <span data-ttu-id="b9c59-167">Porém, nos dois casos, a configuração de CDC sempre é executada na réplica primária atual ou pretendida.</span><span class="sxs-lookup"><span data-stu-id="b9c59-167">In both cases, however, CDC configuration is always performed on the current or intended primary replica.</span></span> <span data-ttu-id="b9c59-168">O CDC usa o agente de leitor de log e tem as mesmas restrições descritas na seção **Modificações do Agente de Leitor de Log** , apresentada anteriormente neste tópico.</span><span class="sxs-lookup"><span data-stu-id="b9c59-168">CDC uses the log reader agent and has the same limitations as described in the **Log Reader Agent Modifications** section earlier in this topic.</span></span>  
  
-   <span data-ttu-id="b9c59-169">**Colhendo alterações para o Change Data Capture sem replicação**</span><span class="sxs-lookup"><span data-stu-id="b9c59-169">**Harvesting Changes for Change Data Capture Without Replication**</span></span>  
  
     <span data-ttu-id="b9c59-170">Se o CDC estiver habilitado para um banco de dados, mas a replicação não estiver, o processo de captura usado para coletar alterações do log e depositá-las nas tabelas de alteração do CDC é executado no host do CDC como seu próprio trabalho do SQL Agent.</span><span class="sxs-lookup"><span data-stu-id="b9c59-170">If CDC is enabled for a database, but replication is not, the capture process used to harvest changes from the log and deposit them in CDC change tables runs at the CDC host as its own SQL Agent job.</span></span>  
  
     <span data-ttu-id="b9c59-171">Para retomar a coleta de alterações depois de um failover, o procedimento armazenado **sp_cdc_add_job** deve ser executado no novo primário para criar o trabalho de captura local.</span><span class="sxs-lookup"><span data-stu-id="b9c59-171">In order to resume the harvesting of changes after failover, the stored procedure **sp_cdc_add_job** must be run at the new primary to create the local capture job.</span></span>  
  
     <span data-ttu-id="b9c59-172">No exemplo a seguir, é criado o trabalho de captura.</span><span class="sxs-lookup"><span data-stu-id="b9c59-172">The following example creates the capture job.</span></span>  
  
    ```  
    EXEC sys.sp_cdc_add_job @job_type = 'capture';  
    ```  
  
-   <span data-ttu-id="b9c59-173">**Colhendo alterações para o Change Data Capture com replicação**</span><span class="sxs-lookup"><span data-stu-id="b9c59-173">**Harvesting Changes for Change Data Capture With Replication**</span></span>  
  
     <span data-ttu-id="b9c59-174">Se o CDC e a replicação estiverem habilitados para um banco de dados, o leitor de log tratará da população das tabelas de alteração do CDC.</span><span class="sxs-lookup"><span data-stu-id="b9c59-174">If both CDC and replication are enabled for a database, the log reader handles the population of the CDC change tables.</span></span> <span data-ttu-id="b9c59-175">Nesse caso, as técnicas usadas pela replicação para utilizar o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] garantirão que as alterações continuem a ser coletadas no log e depositadas nas tabelas de alteração de CDC após o failover.</span><span class="sxs-lookup"><span data-stu-id="b9c59-175">In this case, the techniques used by replication to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] will insure that changes continue to be harvested from the log and deposited in CDC change tables after failover.</span></span> <span data-ttu-id="b9c59-176">Não é necessário fazer nada a mais para o CDC nesta configuração para garantir que as tabelas de alteração sejam populadas.</span><span class="sxs-lookup"><span data-stu-id="b9c59-176">Nothing additional needs to be done for CDC in this configuration to insure that the change tables are populated.</span></span>  
  
-   <span data-ttu-id="b9c59-177">**Limpeza do Change Data Capture**</span><span class="sxs-lookup"><span data-stu-id="b9c59-177">**Change Data Capture Cleanup**</span></span>  
  
     <span data-ttu-id="b9c59-178">Para garantir que a limpeza apropriada ocorra no novo banco de dados primário, um trabalho de limpeza local sempre deve ser criado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-178">To insure that appropriate cleanup occurs at the new primary database, a local cleanup job should always be created.</span></span> <span data-ttu-id="b9c59-179">No exemplo a seguir, é criado o trabalho de limpeza.</span><span class="sxs-lookup"><span data-stu-id="b9c59-179">The following example creates the cleanup job.</span></span>  
  
    ```  
    EXEC sys.sp_cdc_add_job @job_type = 'cleanup';  
    ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="b9c59-180">Você deve criar os trabalhos em todos os destinos de failover possíveis antes do failover e marcá-los como desabilitados até que a réplica de disponibilidade em um host se torne a nova réplica primária.</span><span class="sxs-lookup"><span data-stu-id="b9c59-180">You should create the jobs at all of the possible failover targets before failover, and mark them as disabled until the availability replica at a host becomes the new primary replica.</span></span> <span data-ttu-id="b9c59-181">Os trabalhos de CDC em execução no banco de dados primário antigo também devem ser desabilitados quando o banco de dados local se torna um banco de dados secundário.</span><span class="sxs-lookup"><span data-stu-id="b9c59-181">The CDC jobs running at the old primary database should be also disabled when the local database becomes a secondary database.</span></span> <span data-ttu-id="b9c59-182">Para desabilitar e habilitar trabalhos, use a *@enabled* opção de [sp_update_job &#40;&#41;TRANSACT-SQL ](/sql/relational-databases/system-stored-procedures/sp-update-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b9c59-182">To disable and enable jobs, use the *@enabled* option of [sp_update_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-update-job-transact-sql).</span></span> <span data-ttu-id="b9c59-183">Para obter mais informações sobre como criar trabalhos de CDC, consulte [sys.sp_cdc_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b9c59-183">For more information about creating CDC jobs, see [sys.sp_cdc_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql).</span></span>  
  
-   <span data-ttu-id="b9c59-184">**Adicionando funções de CDC a uma réplica de banco de dados primário AlwaysOn**</span><span class="sxs-lookup"><span data-stu-id="b9c59-184">**Adding CDC Roles to an AlwaysOn Primary Database Replica**</span></span>  
  
     <span data-ttu-id="b9c59-185">Quando uma tabela está habilitada para CDC, é possível associar uma função de banco de dados com a instância de captura.</span><span class="sxs-lookup"><span data-stu-id="b9c59-185">When a table is enabled for CDC, it is possible to associate a database role with the capture instance.</span></span> <span data-ttu-id="b9c59-186">Se uma função for especificada, o usuário que quiser usar as funções com valor de tabela do CDC para acessar as alterações para a tabela não somente terá que ter acesso de seleção às colunas de tabela rastreadas, mas também deverá ser um membro da função nomeada.</span><span class="sxs-lookup"><span data-stu-id="b9c59-186">If a role is specified, the user wishing to use the CDC table-valued functions to access changes for the table must not only have select access to the tracked table columns, but must also be a member of the named role.</span></span> <span data-ttu-id="b9c59-187">Se a função especificada ainda não existir, a função será criada.</span><span class="sxs-lookup"><span data-stu-id="b9c59-187">If the specified role does not already exist, the role will be created.</span></span> <span data-ttu-id="b9c59-188">Quando as funções de banco de dados são automaticamente adicionadas a um banco de dados primário AlwaysOn, as funções também são propagadas para os bancos de dados secundários do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-188">When database roles are automatically added to an AlwaysOn primary database, the roles are also propagated to the secondary databases of the availability group.</span></span>  
  
-   <span data-ttu-id="b9c59-189">**Aplicativos cliente que acessam os dados de alteração do CDC e do AlwaysOn**</span><span class="sxs-lookup"><span data-stu-id="b9c59-189">**Client Applications Accessing CDC Change Data and Always On**</span></span>  
  
     <span data-ttu-id="b9c59-190">Aplicativos cliente que usam as TVFs (funções com valor de tabela) ou os servidores vinculados para acessar dados da tabela de alteração também precisam da capacidade de localizar um host de CDC apropriado depois do failover.</span><span class="sxs-lookup"><span data-stu-id="b9c59-190">Client applications that use the table-valued functions (TVFs) or linked servers to access change table data also need the ability to locate an appropriate CDC host after failover.</span></span> <span data-ttu-id="b9c59-191">O nome do ouvinte do grupo de disponibilidade é o mecanismo fornecido pelo [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] para permitir que uma conexão sempre seja redirecionada para um host diferente de modo transparente.</span><span class="sxs-lookup"><span data-stu-id="b9c59-191">The availability group listener name is the mechanism provided by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] to transparently allow a connection to be retargeted to a different host.</span></span> <span data-ttu-id="b9c59-192">Quando um nome do gruo de disponibilidade está associado a um grupo de disponibilidade, ele estará disponível para ser usado em cadeias de conexão TCP.</span><span class="sxs-lookup"><span data-stu-id="b9c59-192">Once an availability group listener name is associated with an availability group, it is available to be used in TCP connection strings.</span></span> <span data-ttu-id="b9c59-193">Dois cenários de conexão diferentes têm suporte por meio do nome do ouvinte do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-193">Two different connection scenarios are supported through the availability group listener name.</span></span>  
  
    -   <span data-ttu-id="b9c59-194">A pessoa assegura que as solicitações de conexão sejam sempre direcionadas para a réplica primária atual.</span><span class="sxs-lookup"><span data-stu-id="b9c59-194">One insures that connection requests are always directed to the current primary replica.</span></span>  
  
    -   <span data-ttu-id="b9c59-195">A pessoa assegura que as solicitações de conexão sejam direcionadas para uma réplica secundária somente leitura.</span><span class="sxs-lookup"><span data-stu-id="b9c59-195">One insures that connection requests are directed to a read-only secondary replica.</span></span>  
  
     <span data-ttu-id="b9c59-196">Se for usado para localizar uma réplica secundária somente leitura, uma lista de roteamento somente leitura também deverá ser definida para o grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-196">If used to locate a read-only secondary replica, a read-only routing list must also be defined for the availability group.</span></span> <span data-ttu-id="b9c59-197">Para obter mais informações sobre roteamento do acesso a secundários legíveis, consulte [Para configurar réplicas de disponibilidade para roteamento somente leitura](../../listeners-client-connectivity-application-failover.md#ConfigureARsForROR).</span><span class="sxs-lookup"><span data-stu-id="b9c59-197">For more information about routing access to readable secondaries, see [To Configure Availability Replicas for Read-Only Routing](../../listeners-client-connectivity-application-failover.md#ConfigureARsForROR).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b9c59-198">Há algum atraso de propagação associado à criação de um nome do ouvinte do grupo de disponibilidade e seu uso por aplicativos cliente para acessar uma réplica de banco de dados do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-198">There is some propagation delay associated with the creation of an availability group listener name and its use by client applications to access an availability group database replica.</span></span>  
  
     <span data-ttu-id="b9c59-199">Use a consulta a seguir para determinar se um nome do ouvinte do grupo de disponibilidade foi definido para o grupo de disponibilidade que hospeda um banco de dados do CDC.</span><span class="sxs-lookup"><span data-stu-id="b9c59-199">Use the following query to determine whether an availability group listener name has been defined for the availability group hosting a CDC database.</span></span> <span data-ttu-id="b9c59-200">A consulta retornará o nome do ouvinte do grupo de disponibilidade se ele tiver sido criado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-200">The query will return the availability group listener name if one has been created.</span></span>  
  
    ```  
    SELECT dns_name   
    FROM sys.availability_group_listeners AS l  
    INNER JOIN sys.availability_databases_cluster AS d  
        ON l.group_id = d.group_id  
    WHERE d.database_name = N'MyCDCDB';  
    ```  
  
-   <span data-ttu-id="b9c59-201">**Redirecionando a carga de consulta para uma réplica secundária legível**</span><span class="sxs-lookup"><span data-stu-id="b9c59-201">**Redirecting the Query Load to a Readable Secondary Replica**</span></span>  
  
     <span data-ttu-id="b9c59-202">Embora, em muitos casos, um aplicativo cliente sempre deseje se conectar à réplica primária atual, essa não é a única maneira de utilizar o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-202">While in many cases a client application will always want to connect to the current primary replica that is not the only way to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="b9c59-203">Se um grupo de disponibilidade for configurado para dar suporte a réplicas secundárias legíveis, os dados de alteração também poderão ser coletados a partir de nós secundários.</span><span class="sxs-lookup"><span data-stu-id="b9c59-203">If an availability group is configured to support readable secondary replicas, change data can also be gathered from secondary nodes.</span></span>  
  
     <span data-ttu-id="b9c59-204">Quando um grupo de disponibilidade estiver configurado, o atributo ALLOW_CONNECTIONS associado à SECONDARY_ROLE será usado para especificar o tipo de acesso secundário com suporte.</span><span class="sxs-lookup"><span data-stu-id="b9c59-204">When an availability group is configured, the ALLOW_CONNECTIONS attribute associated with the SECONDARY_ROLE is used to specify the type of secondary access supported.</span></span> <span data-ttu-id="b9c59-205">Se tiver sido configurado como ALL, todas as conexões à réplica secundária serão permitidas, mas somente as que exigirem acesso somente leitura terão sucesso.</span><span class="sxs-lookup"><span data-stu-id="b9c59-205">If configured as ALL, all connections to the secondary will be allowed, but only those requiring read only access will succeed.</span></span> <span data-ttu-id="b9c59-206">Se estiver configurado como READ_ONLY, será necessário especificar a intenção somente leitura ao estabelecer a conexão com o banco de dados secundário para que a conexão tenha sucesso.</span><span class="sxs-lookup"><span data-stu-id="b9c59-206">If configured as READ_ONLY, it is necessary to specify read only intent when making the connection to the secondary database in order for the connection to succeed.</span></span> <span data-ttu-id="b9c59-207">Para obter mais informações, consulte [Configurar o acesso somente leitura em uma réplica de disponibilidade &#40;SQL Server&#41;](configure-read-only-access-on-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b9c59-207">For more information, see [Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;](configure-read-only-access-on-an-availability-replica-sql-server.md).</span></span>  
  
     <span data-ttu-id="b9c59-208">A consulta a seguir pode ser usada para determinar se a intenção somente leitura é necessária para estabelecer a conexão com uma réplica secundária legível.</span><span class="sxs-lookup"><span data-stu-id="b9c59-208">The following query can be used to determine whether read-only intent is needed to connect to a readable secondary replica.</span></span>  
  
    ```  
    SELECT g.name AS AG, replica_server_name, secondary_role_allow_connections_desc  
    FROM sys.availability_replicas AS r  
    JOIN sys.availability_groups AS g  
        ON r.group_id = g.group_id  
    WHERE g.name = N'MY_AG_NAME;  
    ```  
  
     <span data-ttu-id="b9c59-209">O nome do ouvinte do grupo de disponibilidade ou o nome de nó explícito pode ser usado para localizar a réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="b9c59-209">Either the availability group listener name or the explicit node name can be used to locate the secondary replica.</span></span> <span data-ttu-id="b9c59-210">Se o nome do ouvinte do grupo de disponibilidade for usado, o acesso será direcionado a qualquer réplica secundária adequada.</span><span class="sxs-lookup"><span data-stu-id="b9c59-210">If the availability group listener name is used, access will be directed to any suitable secondary replica.</span></span>  
  
     <span data-ttu-id="b9c59-211">Quando `sp_addlinkedserver` é usado para criar um servidor vinculado para acessar o secundário, o *@datasrc* parâmetro é usado para o nome do ouvinte do grupo de disponibilidade ou o nome do servidor explícito, e o *@provstr* parâmetro é usado para especificar a intenção somente leitura.</span><span class="sxs-lookup"><span data-stu-id="b9c59-211">When `sp_addlinkedserver` is used to create a linked server to access the secondary, the *@datasrc* parameter is used for the availability group listener name or the explicit server name, and the *@provstr* parameter is used to specify read-only intent.</span></span>  
  
    ```  
    EXEC sp_addlinkedserver   
    @server = N'linked_svr',   
    @srvproduct=N'SqlServer',  
    @provider=N'SQLNCLI11',   
    @datasrc=N'AG_Listener_Name',   
    @provstr=N'ApplicationIntent=ReadOnly',   
    @catalog=N'MY_DB_NAME';  
    ```  
  
-   <span data-ttu-id="b9c59-212">**Acesso de cliente aos dados de alteração do CDC e logons de domínio**</span><span class="sxs-lookup"><span data-stu-id="b9c59-212">**Client Access to CDC Change Data and Domain Logins**</span></span>  
  
     <span data-ttu-id="b9c59-213">Em geral, você deve usar logons de domínio para acesso de cliente para dados de alteração que residem em bancos de dados que são membros de grupos de disponibilidade AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="b9c59-213">In general, you should use domain logins for client access to change data residing in databases that are members of AlwaysOn availability groups.</span></span> <span data-ttu-id="b9c59-214">Para assegurar acesso continuado a dados de alteração depois de failover, o usuário de domínio precisará de privilégios de acesso em todos os hosts que dão suporte a réplicas de grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-214">To insure continued access to change data after failover, the domain user will need access privileges on all of the hosts supporting availability group replicas.</span></span> <span data-ttu-id="b9c59-215">Se um usuário de banco de dados for adicionado a um banco de dados em uma réplica primária, e o usuário estiver associado com um logon de domínio, o usuário de banco de dados será propagado para bancos de dados secundários e continua sendo associado com o logon de domínio especificado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-215">If a database user is added to a database in a primary replica, and the user is associated with a domain login, the database user is propagated to secondary databases and continues to be associated with the specified domain login.</span></span> <span data-ttu-id="b9c59-216">Se o novo usuário de banco de dados estiver associado com um logon de autenticação do SQL Server, o usuário nos bancos de dados secundários será propagado sem um logon.</span><span class="sxs-lookup"><span data-stu-id="b9c59-216">If the new database user is associated with a SQL Server authentication login, the user at the secondary databases will be propagated without a login.</span></span> <span data-ttu-id="b9c59-217">Embora o logon de autenticação do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] associado pudesse ser usado para acessar dados de alteração no primário onde o usuário de banco de dados foi definido originalmente, esse nó é o único em que o acesso seria possível.</span><span class="sxs-lookup"><span data-stu-id="b9c59-217">While the associated [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication login could be used to access change data at the primary where the database user was originally defined, that node is the only one where access would be possible.</span></span> <span data-ttu-id="b9c59-218">O logon de autenticação do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] não poderia acessar dados de qualquer banco de dados secundário, nem de nenhum novo banco de dados primário além do banco de dados original onde o usuário de banco de dados foi definido.</span><span class="sxs-lookup"><span data-stu-id="b9c59-218">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication login would not be able to access data from any secondary database, nor from any new primary databases other than the original database where the database user was defined.</span></span>  
  
###  <a name="change-tracking"></a><a name="CT"></a> <span data-ttu-id="b9c59-219">Controle de alterações</span><span class="sxs-lookup"><span data-stu-id="b9c59-219">Change Tracking</span></span>  
 <span data-ttu-id="b9c59-220">Um banco de dados habilitado para CT (controle de alterações) pode fazer parte de um grupo de disponibilidade AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="b9c59-220">A database enabled for change tracking (CT) can be part of an AlwaysOn availability group.</span></span> <span data-ttu-id="b9c59-221">Nenhuma configuração adicional é necessária.</span><span class="sxs-lookup"><span data-stu-id="b9c59-221">No additional configuration is needed.</span></span> <span data-ttu-id="b9c59-222">Os aplicativos cliente de controle de alterações que usam as TVFs (funções com valor de tabela) de CDC para acessar dados de alteração também precisarão localizar a réplica primária após o failover.</span><span class="sxs-lookup"><span data-stu-id="b9c59-222">Change tracking client applications that use the CDC table-valued functions (TVFs) to access change data will need the ability to locate the primary replica after failover.</span></span> <span data-ttu-id="b9c59-223">Se o aplicativo cliente é conectado por meio do nome do ouvinte do grupo de disponibilidade, as solicitações de conexão serão sempre direcionadas corretamente para a réplica primária atual.</span><span class="sxs-lookup"><span data-stu-id="b9c59-223">If the client application connects through the availability group listener name, connection requests will always be appropriately directed to the current primary replica.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b9c59-224">Os dados de controle de alterações sempre devem ser obtidos da réplica primária.</span><span class="sxs-lookup"><span data-stu-id="b9c59-224">Change tracking data must always be obtained from the primary replica.</span></span> <span data-ttu-id="b9c59-225">Uma tentativa para acessar dados de alteração de uma réplica secundária resultará no seguinte erro:</span><span class="sxs-lookup"><span data-stu-id="b9c59-225">An attempt to access change data from a secondary replica will result in the following error:</span></span>  
>   
>  <span data-ttu-id="b9c59-226">Msg 22117, Nível 16, Estado 1, Linha 1</span><span class="sxs-lookup"><span data-stu-id="b9c59-226">Msg 22117, Level 16, State 1, Line1</span></span>  
>   
>  <span data-ttu-id="b9c59-227">Não há suporte para o controle de alterações nos bancos de dados que são membros de uma réplica secundária (ou seja, para bancos de dados secundários).</span><span class="sxs-lookup"><span data-stu-id="b9c59-227">For databases that are members of a secondary replica (that is, for secondary databases), change tracking is not supported.</span></span> <span data-ttu-id="b9c59-228">Execute consultas de controle de alterações nos bancos de dados na réplica primária.</span><span class="sxs-lookup"><span data-stu-id="b9c59-228">Run change tracking queries on the databases in the primary replica.</span></span>  
  
##  <a name="prerequisites-restrictions-and-considerations-for-using-replication"></a><a name="Prereqs"></a> <span data-ttu-id="b9c59-229">Pré-requisitos, restrições e considerações para usar replicação</span><span class="sxs-lookup"><span data-stu-id="b9c59-229">Prerequisites, Restrictions, and Considerations for Using Replication</span></span>  
 <span data-ttu-id="b9c59-230">Esta seção descreve as considerações para implantar a replicação com o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], incluindo pré-requisitos, restrições e recomendações.</span><span class="sxs-lookup"><span data-stu-id="b9c59-230">This section describes considerations for deploying replication with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], including prerequisites, restrictions, and recommendations.</span></span>  
  
### <a name="prerequisites"></a><span data-ttu-id="b9c59-231">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="b9c59-231">Prerequisites</span></span>  
  
-   <span data-ttu-id="b9c59-232">Ao usar a replicação transacional e o banco de dados de publicação estiver em um grupo de disponibilidade, o publicador e o distribuidor devem executar pelo menos o [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-232">When using transactional replication and the publishing database is in an availability group both the publisher and the distributor must run at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span> <span data-ttu-id="b9c59-233">O assinante pode usar um nível inferior do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-233">The subscriber can be using a lower level of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="b9c59-234">Ao usar a replicação de mesclagem e o banco de dados de publicação estiver em um grupo de disponibilidade:</span><span class="sxs-lookup"><span data-stu-id="b9c59-234">When using merge replication and the publishing database is in an availability group:</span></span>  
  
    -   <span data-ttu-id="b9c59-235">Assinatura push: o publicador e o distribuidor devem ser executados pelo menos no [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-235">Push subscription: Both the publisher and the distributor must run at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span>  
  
    -   <span data-ttu-id="b9c59-236">Assinatura por pull: os bancos de dados publicador, distribuidor e assinante devem estar pelo menos no [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b9c59-236">Pull subscription: The publisher, distributor, and subscriber databases must be on at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span> <span data-ttu-id="b9c59-237">Isso ocorre porque o agente de mesclagem no assinante deve entender como um grupo de disponibilidade pode fazer failover para seu secundário.</span><span class="sxs-lookup"><span data-stu-id="b9c59-237">This is because the merge agent on the subscriber must understand how an availability group can fail over to its secondary.</span></span>  
  
-   <span data-ttu-id="b9c59-238">Não há suporte à colocação do banco de dados de distribuição em um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-238">Placing the distribution database on an availability group is not supported.</span></span>  
  
-   <span data-ttu-id="b9c59-239">As instâncias do Publicador satisfazem todos os pré-requisitos necessários para participar de um grupo de disponibilidade AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="b9c59-239">The Publisher instances satisfy all the prerequisites required to participate in an AlwaysOn availability group.</span></span> <span data-ttu-id="b9c59-240">Para obter mais informações, consulte [pré-requisitos, restrições e recomendações para Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="b9c59-240">For more information see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="restrictions"></a><span data-ttu-id="b9c59-241">Restrições</span><span class="sxs-lookup"><span data-stu-id="b9c59-241">Restrictions</span></span>  
 <span data-ttu-id="b9c59-242">Combinações de replicação com suporte no [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="b9c59-242">Supported combinations of replication on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span></span>  
  
|||||  
|-|-|-|-|  
||<span data-ttu-id="b9c59-243">**Publicador**</span><span class="sxs-lookup"><span data-stu-id="b9c59-243">**Publisher**</span></span>|<span data-ttu-id="b9c59-244">**Distribuidor** <sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="b9c59-244">**Distributor** <sup>3</sup></span></span>|<span data-ttu-id="b9c59-245">**Assinante**</span><span class="sxs-lookup"><span data-stu-id="b9c59-245">**Subscriber**</span></span>|  
|<span data-ttu-id="b9c59-246">**Transacional.**</span><span class="sxs-lookup"><span data-stu-id="b9c59-246">**Transactional**</span></span>|<span data-ttu-id="b9c59-247">Sim<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="b9c59-247">Yes<sup>1</sup></span></span>|<span data-ttu-id="b9c59-248">Não</span><span class="sxs-lookup"><span data-stu-id="b9c59-248">No</span></span>|<span data-ttu-id="b9c59-249">Sim<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b9c59-249">Yes<sup>2</sup></span></span>|  
|<span data-ttu-id="b9c59-250">**P2P**</span><span class="sxs-lookup"><span data-stu-id="b9c59-250">**P2P**</span></span>|<span data-ttu-id="b9c59-251">Não</span><span class="sxs-lookup"><span data-stu-id="b9c59-251">No</span></span>|<span data-ttu-id="b9c59-252">Não</span><span class="sxs-lookup"><span data-stu-id="b9c59-252">No</span></span>|<span data-ttu-id="b9c59-253">Não</span><span class="sxs-lookup"><span data-stu-id="b9c59-253">No</span></span>|  
|<span data-ttu-id="b9c59-254">**Mesclagem**</span><span class="sxs-lookup"><span data-stu-id="b9c59-254">**Merge**</span></span>|<span data-ttu-id="b9c59-255">Sim</span><span class="sxs-lookup"><span data-stu-id="b9c59-255">Yes</span></span>|<span data-ttu-id="b9c59-256">Não</span><span class="sxs-lookup"><span data-stu-id="b9c59-256">No</span></span>|<span data-ttu-id="b9c59-257">Sim<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b9c59-257">Yes<sup>2</sup></span></span>|  
|<span data-ttu-id="b9c59-258">**Instantâneo**</span><span class="sxs-lookup"><span data-stu-id="b9c59-258">**Snapshot**</span></span>|<span data-ttu-id="b9c59-259">Sim</span><span class="sxs-lookup"><span data-stu-id="b9c59-259">Yes</span></span>|<span data-ttu-id="b9c59-260">Não</span><span class="sxs-lookup"><span data-stu-id="b9c59-260">No</span></span>|<span data-ttu-id="b9c59-261">Sim<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="b9c59-261">Yes<sup>2</sup></span></span>|  
  
 <span data-ttu-id="b9c59-262"><sup>1</sup> não inclui suporte para replicação transacional bidirecional e recíproca.</span><span class="sxs-lookup"><span data-stu-id="b9c59-262"><sup>1</sup> Does not include support for bi-directional and reciprocal transactional replication.</span></span>  
  
 <span data-ttu-id="b9c59-263"><sup>2</sup> o failover para o banco de dados de réplica é um procedimento manual.</span><span class="sxs-lookup"><span data-stu-id="b9c59-263"><sup>2</sup> Failover to the replica database is a manual procedure.</span></span> <span data-ttu-id="b9c59-264">O failover automático não é fornecido.</span><span class="sxs-lookup"><span data-stu-id="b9c59-264">Automatic failover is not provided.</span></span>  
  
 <span data-ttu-id="b9c59-265"><sup>3</sup> o banco de dados do distribuidor não tem suporte para uso com o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ou o espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b9c59-265"><sup>3</sup> The Distributor database is not supported for use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or database mirroring.</span></span>  
  
### <a name="considerations"></a><span data-ttu-id="b9c59-266">Considerações</span><span class="sxs-lookup"><span data-stu-id="b9c59-266">Considerations</span></span>  
  
-   <span data-ttu-id="b9c59-267">Não há suporte para o uso do banco de dados de distribuição com o [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ou espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b9c59-267">The distribution database is not supported for use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or database mirroring.</span></span> <span data-ttu-id="b9c59-268">A configuração da replicação é acoplada à instância do SQL Server onde o Distribuidor é configurado. Portanto, o banco de dados de distribuição não pode ser espelhado ou replicado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-268">Replication configuration is coupled to the SQL Server instance where the Distributor is configured; therefore the distribution database cannot be mirrored or replicated.</span></span> <span data-ttu-id="b9c59-269">Para fornecer alta disponibilidade para o Distribuidor, use um cluster de failover do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b9c59-269">To provide high availability for the Distributor, use a SQL Server failover cluster.</span></span> <span data-ttu-id="b9c59-270">Para obter mais informações, consulte [Instâncias do Cluster de Failover do AlwaysOn (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b9c59-270">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
-   <span data-ttu-id="b9c59-271">Embora haja suporte para o failover do assinante em um banco de dados secundário, esse é um procedimento manual relativamente complexo.</span><span class="sxs-lookup"><span data-stu-id="b9c59-271">Subscriber failover to a secondary database, while supported, is a relatively complex manual procedure.</span></span> <span data-ttu-id="b9c59-272">O procedimento é essencialmente idêntico ao método usado para failover de um banco de dados de assinante espelhado.</span><span class="sxs-lookup"><span data-stu-id="b9c59-272">The procedure is essentially identical to the method used to fail over a mirrored subscriber database.</span></span> <span data-ttu-id="b9c59-273">Os assinantes devem estar executando o [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] ou posterior para participar de um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="b9c59-273">Subscribers must be running [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] or later to participate in an availability group.</span></span>  
  
-   <span data-ttu-id="b9c59-274">Os metadados e os objetos que existem fora do banco de dados não são propagados para as réplicas secundárias, inclusive logons, trabalhos, servidores vinculados.</span><span class="sxs-lookup"><span data-stu-id="b9c59-274">Metadata and objects that exist outside the database are not propagated to the secondary replicas, including logins, jobs, linked servers.</span></span> <span data-ttu-id="b9c59-275">Se você precisar dos metadados e dos objetos no novo banco de dados primário após o failover, copie-os manualmente.</span><span class="sxs-lookup"><span data-stu-id="b9c59-275">If you require the metadata and objects at the new primary database after failover, you must copy them manually.</span></span> <span data-ttu-id="b9c59-276">Para obter mais informações, consulte [Gerenciamento de logons e trabalhos para os bancos de dados de um grupo de disponibilidade &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span><span class="sxs-lookup"><span data-stu-id="b9c59-276">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="b9c59-277">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="b9c59-277">Related Tasks</span></span>  
 <span data-ttu-id="b9c59-278">**Replicação**</span><span class="sxs-lookup"><span data-stu-id="b9c59-278">**Replication**</span></span>  
  
-   [<span data-ttu-id="b9c59-279">Configurar a replicação para grupos de disponibilidade AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="b9c59-279">Configure Replication for AlwaysOn Availability Groups (SQL Server)</span></span>](always-on-availability-groups-sql-server.md)  
  
-   [<span data-ttu-id="b9c59-280">Mantendo um banco de dados de publicação AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-280">Maintaining an AlwaysOn Publication Database &#40;SQL Server&#41;</span></span>](maintaining-an-always-on-publication-database-sql-server.md)  
  
-   [<span data-ttu-id="b9c59-281">Perguntas Frequentes sobre Administração de Replicação</span><span class="sxs-lookup"><span data-stu-id="b9c59-281">Replication Administration FAQ</span></span>](../../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md)  
  
 <span data-ttu-id="b9c59-282">**Alterar captura de dados**</span><span class="sxs-lookup"><span data-stu-id="b9c59-282">**Change data capture**</span></span>  
  
-   [<span data-ttu-id="b9c59-283">Habilitar e desabilitar a captura de dados de alterações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-283">Enable and Disable Change Data Capture &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server.md)  
  
-   [<span data-ttu-id="b9c59-284">Administrar e monitorar a captura de dados de alteração &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-284">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
-   [<span data-ttu-id="b9c59-285">Trabalhar com dados de alterações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-285">Work with Change Data &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/work-with-change-data-sql-server.md)  
  
 <span data-ttu-id="b9c59-286">**Controle de alterações**</span><span class="sxs-lookup"><span data-stu-id="b9c59-286">**Change tracking**</span></span>  
  
-   [<span data-ttu-id="b9c59-287">Habilitar e desabilitar o controle de alterações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-287">Enable and Disable Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/enable-and-disable-change-tracking-sql-server.md)  
  
-   [<span data-ttu-id="b9c59-288">Gerenciar o controle de alterações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-288">Manage Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/manage-change-tracking-sql-server.md)  
  
-   [<span data-ttu-id="b9c59-289">Trabalhar com o controle de alterações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-289">Work with Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/work-with-change-tracking-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="b9c59-290">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="b9c59-290">See Also</span></span>  
 <span data-ttu-id="b9c59-291">[Assinantes de replicação e Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](replication-subscribers-and-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-291">[Replication Subscribers and AlwaysOn Availability Groups &#40;SQL Server&#41;](replication-subscribers-and-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="b9c59-292">[Pré-requisitos, restrições e recomendações para Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-292">[Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) </span></span>  
 <span data-ttu-id="b9c59-293">[Visão geral do Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-293">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="b9c59-294">Grupos de Disponibilidade AlwaysOn: [instâncias de cluster de failover (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) de [interoperabilidade (SQL Server)](always-on-availability-groups-interoperability-sql-server.md) AlwaysOn </span><span class="sxs-lookup"><span data-stu-id="b9c59-294">[AlwaysOn Availability Groups: Interoperability (SQL Server)](always-on-availability-groups-interoperability-sql-server.md) [AlwaysOn Failover Cluster Instances (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) </span></span>  
 <span data-ttu-id="b9c59-295">[Sobre a captura de dados de alterações &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-295">[About Change Data Capture &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="b9c59-296">[Sobre o controle de alterações &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-tracking-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-296">[About Change Tracking &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-tracking-sql-server.md) </span></span>  
 <span data-ttu-id="b9c59-297">[Replicação do SQL Server](../../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-297">[SQL Server Replication](../../../relational-databases/replication/sql-server-replication.md) </span></span>  
 <span data-ttu-id="b9c59-298">[Controle de alterações de dados &#40;SQL Server&#41;](../../../relational-databases/track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="b9c59-298">[Track Data Changes &#40;SQL Server&#41;](../../../relational-databases/track-changes/track-data-changes-sql-server.md) </span></span>  
 [<span data-ttu-id="b9c59-299">sys.sp_cdc_add_job &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b9c59-299">sys.sp_cdc_add_job &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql)  
  
  
