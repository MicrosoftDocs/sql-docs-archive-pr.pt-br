---
title: Transações entre bancos de dados sem suporte para espelhamento de banco de dados ou Grupos de Disponibilidade AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- cross-database transactions [SQL Server]
- transactions [database mirroring]
- Availability Groups [SQL Server], interoperability
- troubleshooting [SQL Server], cross-database transactions
ms.assetid: 9f7ed895-ad65-43e3-ba08-00d7bff1456d
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: a0e23e073375c8f00317003635df8ec0b69883cd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685287"
---
# <a name="cross-database-transactions-not-supported-for-database-mirroring-or-alwayson-availability-groups-sql-server"></a><span data-ttu-id="dc1ad-102">Transações envolvendo todos os bancos de dados sem suporte para espelhamento de banco de dados ou Grupos de Disponibilidade AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="dc1ad-102">Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="dc1ad-103">Os [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ou o espelhamento de banco de dados não oferecem suporte a transações entre bancos de dados ou transações distribuídas.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-103">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or by database mirroring.</span></span> <span data-ttu-id="dc1ad-104">Isso é porque a atomicidade/integridade da transação não pode ser garantida pelos seguintes motivos:</span><span class="sxs-lookup"><span data-stu-id="dc1ad-104">This is because transaction atomicity/integrity cannot be guaranteed for the following reasons:</span></span>  
  
-   <span data-ttu-id="dc1ad-105">Para transações envolvendo todos os bancos de dados: cada banco de dados é confirmado de forma independente.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-105">For cross-database transactions: Each database commits independently.</span></span> <span data-ttu-id="dc1ad-106">Portanto, mesmo para bancos de dados em um único grupo de disponibilidade, um failover pode ocorrer depois que um banco de dados confirma uma transação, mas antes de o outro banco de dados confirmar.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-106">Therefore, even for databases in a single availability group, a failover could occur after one database commits a transaction but before the other database does.</span></span> <span data-ttu-id="dc1ad-107">No espelhamento de banco de dados, esse problema é complexo, pois, após o failover, o banco de dados espelhado fica normalmente em uma instância de servidor diferente do outro banco de dados, e mesmo se ambos os bancos de dados forem espelhados entre os mesmos dois parceiros, não haverá garantia de que ambos os bancos de dados receberão failover ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-107">For database mirroring this issue is compounded because after a failover, the mirrored database is typically on a different server instance from the other database, and  even if both databases are mirrored between the same two partners, there is no guarantee that both databases will fail over at the same time.</span></span>  
  
-   <span data-ttu-id="dc1ad-108">Para transações distribuídas: após um failover, o novo servidor principal/réplica primária não poderá se conectar ao coordenador de transações distribuídas no servidor principal/réplica primária anterior.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-108">For distributed transactions: After a failover, the new principal server/primary replica is unable to connect to the distributed transaction coordinator on the previous principal server/primary replica.</span></span> <span data-ttu-id="dc1ad-109">Portanto, o novo servidor principal/réplica primária não pode obter o status da transação.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-109">Therefore, the new principal server/primary replica cannot obtain the transaction status.</span></span>  
  
 <span data-ttu-id="dc1ad-110">O exemplo de espelhamento de banco de dados a seguir ilustra como uma inconsistência lógica pode ocorrer.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-110">The following database mirroring example illustrates how a logical inconsistency could occur.</span></span> <span data-ttu-id="dc1ad-111">Neste exemplo, um aplicativo usa uma transação de banco de dados cruzado para inserir duas linhas de dados: uma linha é inserida em uma tabela em um banco de dados espelho, A, e a outra linha é inserida em uma tabela em outro banco de dados, B. O banco de dados A está sendo espelhado em modo de alta segurança com failover automático.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-111">In this example, an application uses a cross-database transaction to insert two rows of data: one row is inserted into a table in a mirrored database, A, and the other row is inserted into a table in another database, B. Database A is being mirrored in high-safety mode with automatic failover.</span></span> <span data-ttu-id="dc1ad-112">Enquanto a transação está sendo confirmada, o banco de dados A torna-se indisponível e ocorre failover automático na sessão de espelhamento para o espelho do banco de dados A.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-112">While the transaction is being committed, database A becomes unavailable, and the mirroring session automatically fails over to the mirror of database A.</span></span>  
  
 <span data-ttu-id="dc1ad-113">Depois do failover, a transação entre bancos de dados pode ser confirmada com sucesso no banco de dados B, mas não no banco de dados onde ocorreu failover.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-113">After the failover, the cross-database transaction might be successfully committed on database B but not on the failed-over database.</span></span> <span data-ttu-id="dc1ad-114">Isso poderá ocorrer se o servidor original principal para o banco de dados A não enviar o log de transações entre bancos de dados para o servidor de espelho antes da falha.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-114">This would occur if the original principal server for database A had not sent the log for the cross-database transaction to the mirror server before the failure.</span></span> <span data-ttu-id="dc1ad-115">Depois do failover, a transação não existirá no novo servidor principal.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-115">After the failover, that transaction would not exist on the new principal server.</span></span> <span data-ttu-id="dc1ad-116">Os bancos de dados A e B se tornarão inconsistentes, porque os dados inseridos no banco de dados B permanecerão intactos, mas os dados inseridos no banco de dados A serão perdidos.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-116">Databases A and B would become inconsistent, because the data inserted in database B remains intact, but the data inserted in database A has been lost.</span></span>  
  
 <span data-ttu-id="dc1ad-117">Um cenário semelhante pode acontecer no uso de uma transação MS DTC.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-117">A similar scenario can occur while using a MS DTC transaction.</span></span> <span data-ttu-id="dc1ad-118">Por exemplo, depois do failover, o novo principal contata o MS DTC.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-118">For example, after failover, the new principal contacts MS DTC.</span></span> <span data-ttu-id="dc1ad-119">Mas o MS DTC não tem conhecimento do novo servidor principal e encerra qualquer transação que esteja "sendo preparada para confirmação”, considerada confirmada em outros bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-119">But MS DTC has no knowledge of the new principal server, and it terminates any transactions that are "preparing to commit," which are considered committed in other databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="dc1ad-120">Usar o espelhamento de banco de dados ou grupos de disponibilidade junto com DTC não resulta em uma instalação sem suporte do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-120">Using Database Mirroring or Availability Groups together with DTC does not result in an unsupported SQL Server installation.</span></span> <span data-ttu-id="dc1ad-121">Se, no entanto, um banco de dados faz parte de uma sessão de espelhamento de banco de dados ou do Grupo de Disponibilidade, e DTC também é usado no banco de dados, os problemas de suporte são investigados pela Microsoft somente se não relacionadas ao uso combinado de espelhamento de banco de dados ou grupos de disponibilidade com DTC.</span><span class="sxs-lookup"><span data-stu-id="dc1ad-121">If, however, a database is part of a Database Mirroring session or an Availability Group and DTC is also used in the database, support issues will be investigated by Microsoft only if unrelated to the combined use of Database Mirroring or Availability Groups with DTC.</span></span>  
  
  
