---
title: Executar um failover manual forçado de um grupo de disponibilidade (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
f1_keywords:
- sql12.swb.availabilitygroup.forcefailover.f1
helpviewer_keywords:
- Availability Groups [SQL Server], failover
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 222288fe-ffc0-4567-b624-5d91485d70f0
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f36908102a09eb1ef1f7a485898da715deb4253b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572701"
---
# <a name="perform-a-forced-manual-failover-of-an-availability-group-sql-server"></a><span data-ttu-id="88a85-102">Executar um failover manual forçado de um grupo de disponibilidade (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="88a85-102">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>
  <span data-ttu-id="88a85-103">Este tópico descreve como executar um failover forçado (com possível perda de dados) em um grupo de disponibilidade AlwaysOn usando o [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], o [!INCLUDE[tsql](../../../includes/tsql-md.md)] ou o PowerShell no [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="88a85-103">This topic describes how to perform a forced failover (with possible data loss) on an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="88a85-104">Um failover forçado é uma forma de failover manual cujo objetivo é estritamente a recuperação de desastres, quando um [failover manual planejado](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) não é possível.</span><span class="sxs-lookup"><span data-stu-id="88a85-104">A forced failover is a form of manual failover that is intended strictly for disaster recovery, when a [planned manual failover](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) is not possible.</span></span> <span data-ttu-id="88a85-105">Se você forçar o failover em uma réplica secundária não sincronizada, talvez ocorra alguma perda de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-105">If you force failover to an unsynchronized secondary replica, some data loss is possible.</span></span> <span data-ttu-id="88a85-106">Portanto, recomendamos veementemente que você só force o failover se for necessário restaurar o serviço imediatamente para o grupo de disponibilidade e se estiver disposto a correr o risco de perder dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-106">Therefore, we strongly recommend that you force failover only if you must restore service to the availability group immediately and you are willing to risk losing data.</span></span>  
  
 <span data-ttu-id="88a85-107">Após um failover forçado, o destino de failover no qual o grupo de disponibilidade falhou se torna a nova réplica primária.</span><span class="sxs-lookup"><span data-stu-id="88a85-107">After a forced failover, the failover target to which the availability group was failed over becomes the new primary replica.</span></span> <span data-ttu-id="88a85-108">Os bancos de dados secundários nas réplicas secundárias remanescentes são suspensos e devem ser retomados manualmente.</span><span class="sxs-lookup"><span data-stu-id="88a85-108">The secondary databases in the remaining secondary replicas are suspended and must be manually resumed.</span></span> <span data-ttu-id="88a85-109">Quando a antiga réplica primária ficar disponível, ela fará a transição para a função secundária, fazendo com que os antigos bancos de dados primários se tornem bancos de dados secundários e passem para o estado SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="88a85-109">When the former primary replica becomes available, it transitions to the secondary role, causing the former primary databases to become secondary databases and transition into the SUSPENDED state.</span></span> <span data-ttu-id="88a85-110">Antes de retomar um banco de dados secundário específico, você poderá recuperar dados dele que foram perdidos.</span><span class="sxs-lookup"><span data-stu-id="88a85-110">Before you resume a given secondary database, you might be able to recover lost data from it.</span></span> <span data-ttu-id="88a85-111">Entretanto, observe que o truncamento do log de transações será atrasado em um determinado banco de dados primário enquanto qualquer um de seus bancos de dados secundários esteja suspenso.</span><span class="sxs-lookup"><span data-stu-id="88a85-111">However, notice that transaction log truncation is delayed on a given primary database while any of its secondary databases is suspended.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="88a85-112">A sincronização de dados com o banco de dados primário não ocorrerá até o banco de dados secundário for retomado.</span><span class="sxs-lookup"><span data-stu-id="88a85-112">Data synchronization with the primary database will not occur until the secondary database is resumed.</span></span> <span data-ttu-id="88a85-113">Para obter informações sobre como retomar um banco de dados secundário, confira [Acompanhamento: Tarefas essenciais após um failover forçado](#FollowUp) mais adiante neste artigo.</span><span class="sxs-lookup"><span data-stu-id="88a85-113">For information about resuming a secondary database, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp) later in this article.</span></span>  
  
 <span data-ttu-id="88a85-114">A execução de um failover forçado é necessária nas seguintes situações de emergência:</span><span class="sxs-lookup"><span data-stu-id="88a85-114">Performing a forced failover is necessary in the following emergency situations:</span></span>  
  
-   <span data-ttu-id="88a85-115">Depois de forçar o quórum no cluster WSFC (*quórum forçado*), é necessário forçar o failover em cada grupo de disponibilidade (com possível perda de dados).</span><span class="sxs-lookup"><span data-stu-id="88a85-115">After forcing quorum on the WSFC cluster (*forced quorum*), you need to force failover each availability group (with possible data loss).</span></span> <span data-ttu-id="88a85-116">É necessário forçar o failover porque o estado real dos valores do cluster WSFC pode ter sido perdido.</span><span class="sxs-lookup"><span data-stu-id="88a85-116">Forcing failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="88a85-117">Porém, é possível evitar a perda de dados, caso você possa forçar o failover na instância de servidor que estava hospedando a réplica que era a réplica primária antes de forçar o quorum ou em uma réplica secundária que foi sincronizada antes de forçar o quorum.</span><span class="sxs-lookup"><span data-stu-id="88a85-117">However, you can avoid data loss, if are able to force failover on the server instance that was hosting the replica that was the primary replica before you forced quorum or to a secondary replica that was synchronized before you forced quorum.</span></span> <span data-ttu-id="88a85-118">Para obter mais informações, consulte [Possíveis maneiras de evitar perda de dados após quorum forçado](#WaysToAvoidDataLoss)mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="88a85-118">For more information, see [Potential Ways to Avoid Data Loss After Quorum is Forced](#WaysToAvoidDataLoss), later in this topic.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="88a85-119">Se o quorum for recuperado naturalmente em vez de ser forçado, as réplicas de disponibilidade passarão pelo processo de recuperação normal.</span><span class="sxs-lookup"><span data-stu-id="88a85-119">If quorum is regained by natural means instead of being forced, the availability replicas will go through normal recovery.</span></span> <span data-ttu-id="88a85-120">Se a réplica primária ainda não estiver disponível após o quorum ser recuperado, será possível executar um failover manual planejado em uma réplica secundária sincronizada.</span><span class="sxs-lookup"><span data-stu-id="88a85-120">If the primary replica is still unavailable after quorum is regained, you can perform a planned manual failover to a synchronized secondary replica.</span></span>  
  
     <span data-ttu-id="88a85-121">Para obter mais informações sobre como forçar o quórum, consulte [Recuperação de desastres do WSFC por meio de quorum forçado &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-121">For information about forcing quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span> <span data-ttu-id="88a85-122">Para obter informações sobre por que é necessário forçar um failover após forçar o quórum, consulte [Failover e modos de failover &#40;Grupos de disponibilidade AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-122">For information about why forcing failover is required after forcing quorum, see [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="88a85-123">Se a réplica primária ficar indisponível enquanto o cluster WSFC tiver um quorum íntegro, você poderá forçar o failover (com possível perda de dados) em qualquer réplica cuja função esteja no estado SECONDARY ou RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="88a85-123">If the primary replica becomes unavailable when the WSFC cluster has a healthy quorum, you can force failover (with possible data loss), to any replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="88a85-124">Se possível, force o failover em uma réplica secundária de confirmação síncrona que foi sincronizada quando a réplica primária foi perdida.</span><span class="sxs-lookup"><span data-stu-id="88a85-124">If possible, force failover to a synchronous-commit secondary replica that was synchronized when the primary replica was lost.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="88a85-125">Quando o cluster WSFC tiver um quorum íntegro, se você emitir um comando para forçar o failover em uma réplica secundária sincronizada, a réplica executará, na verdade, um failover manual planejado.</span><span class="sxs-lookup"><span data-stu-id="88a85-125">When the WSFC cluster has a healthy quorum, if you issue a force failover command on a synchronized secondary replica, the replica actually performs a planned manual failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="88a85-126">Para obter mais informações sobre os pré-requisitos e as recomendações para forçar um failover e para obter um cenário de exemplo que usa um failover forçado para recuperação de uma falha catastrófica, confira [Cenário de exemplo: Usando um failover forçado para recuperação de uma falha catastrófica](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy), mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="88a85-126">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy), later in this topic.</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="88a85-127">Antes de começar</span><span class="sxs-lookup"><span data-stu-id="88a85-127">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="88a85-128">Limitações e restrições</span><span class="sxs-lookup"><span data-stu-id="88a85-128">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="88a85-129">A única vez que você não pode executar um failover forçado é quando o cluster WSFC (Windows Server Failover Clustering) não tem quorum.</span><span class="sxs-lookup"><span data-stu-id="88a85-129">The only time that you cannot perform a forced failover is when Windows Server Failover Clustering (WSFC) cluster lacks quorum.</span></span>  
  
-   <span data-ttu-id="88a85-130">A perda de dados é possível durante o failover forçado de um grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-130">Data loss is possible during the forced failover of an availability group.</span></span> <span data-ttu-id="88a85-131">Além disso, se a réplica primária estiver em execução quando você iniciar um failover forçado, os clientes ainda poderão ser conectados a bancos de dados primários antigos.</span><span class="sxs-lookup"><span data-stu-id="88a85-131">In addition, if the primary replica is running when you initiate a forced failover, clients might still be connected to former primary databases.</span></span> <span data-ttu-id="88a85-132">Portanto, é altamente recomendável forçar failover apenas se a réplica primária não estiver mais em execução e se você estiver disposto a arriscar a perda de dados para restaurar o acesso aos bancos de dados no grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-132">Therefore, we strongly recommend that you force failover only if the primary replica is no longer running and if you are willing to risk losing data in order to restore access to databases in the availability group.</span></span>  
  
-   <span data-ttu-id="88a85-133">Quando um banco de dados secundário estiver no estado REVERTING ou INITIALIZING, o failover forçado causará uma falha na inicialização do banco de dados como um banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="88a85-133">When a secondary database in the REVERTING or INITIALIZING state, forcing failover would cause the database to fail to start as a primary database.</span></span> <span data-ttu-id="88a85-134">Se o banco de dados estiver no estado INITIALIZING, você precisará aplicar os registros de log ausentes de um backup de banco de dados ou restaurar completamente o banco de dados a partir do zero.</span><span class="sxs-lookup"><span data-stu-id="88a85-134">If the database was in the INTIAILIZGING state the you will need to apply the missing log records from a database backup or fully restore the database from scratch.</span></span> <span data-ttu-id="88a85-135">Se o banco de dados estiver no estado REVERTING, você precisará restaurar completamente o banco de dados dos backups.</span><span class="sxs-lookup"><span data-stu-id="88a85-135">If the database was in the REVERTING state you will need to fully restore the database from backups.</span></span>  
  
-   <span data-ttu-id="88a85-136">Um comando de failover é retornado assim que o destino de failover aceita o comando.</span><span class="sxs-lookup"><span data-stu-id="88a85-136">A failover command returns as soon as the failover target has accepted the command.</span></span> <span data-ttu-id="88a85-137">No entanto, a recuperação de banco de dados ocorre de forma assíncrona depois que o grupo de disponibilidade terminar o failover.</span><span class="sxs-lookup"><span data-stu-id="88a85-137">However, database recovery occurs asynchronously after the availability group has finished failing over.</span></span>  
  
-   <span data-ttu-id="88a85-138">A consistência do banco de dados entre bancos de dados dentro do grupo de disponibilidade não é mantida no failover.</span><span class="sxs-lookup"><span data-stu-id="88a85-138">Cross-database consistency across databases within the availability group is not maintained on failover.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="88a85-139">Não há suporte para transações entre bancos de dados e transações distribuídas no [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="88a85-139">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="88a85-140">Para obter mais informações, consulte [Transações envolvendo todos os bancos de dados sem suporte para espelhamento de banco de dados ou Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-140">For more information, see [Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="88a85-141">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="88a85-141">Prerequisites</span></span>  
  
-   <span data-ttu-id="88a85-142">O cluster WSFC tem quorum.</span><span class="sxs-lookup"><span data-stu-id="88a85-142">The WSFC cluster has quorum.</span></span> <span data-ttu-id="88a85-143">Se o cluster não tiver quórum, consulte [Recuperação de desastres do WSFC por meio de quorum forçado &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-143">If the cluster lacks quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
-   <span data-ttu-id="88a85-144">É necessário poder se conectar a uma instância de servidor que hospede uma réplica cuja função esteja no estado SECONDARY ou RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="88a85-144">You must be able to connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state.</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="88a85-145">Recomendações</span><span class="sxs-lookup"><span data-stu-id="88a85-145">Recommendations</span></span>  
  
-   <span data-ttu-id="88a85-146">Não force o failover enquanto a réplica primária ainda estiver em execução.</span><span class="sxs-lookup"><span data-stu-id="88a85-146">Do not force failover while the primary replica is still running.</span></span>  
  
-   <span data-ttu-id="88a85-147">Se possível, force o failover somente em um destino de failover cujos bancos de dados secundários estejam no estado NOT SYNCHRONIZED, SYNCHRONIZED ou SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="88a85-147">If possible, force failover only to a failover target whose secondary databases are either in the NOT SYNCHRONIZED, SYNCHRONIZED, or SYNCHRONIZING state.</span></span> <span data-ttu-id="88a85-148">Para obter informações sobre as implicações de forçar o failover quando um banco de dados secundário está no estado INTIAILIZGING ou REVERTING, consulte [Limitações e restrições](#Restrictions)anteriormente neste tópico.</span><span class="sxs-lookup"><span data-stu-id="88a85-148">For information about the implications of forcing failover when a secondary database is in the INTIAILIZGING or REVERTING state, see [Limitations and Restrictions](#Restrictions), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="88a85-149">Normalmente, a latência de um determinado banco de dados secundário, relativo ao banco de dados primário, deve ser semelhante em réplicas secundárias de confirmação assíncrona diferentes.</span><span class="sxs-lookup"><span data-stu-id="88a85-149">Typically, the latency of a given secondary database, relative to the primary database, should be similar on different asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="88a85-150">Porém, ao forçar failover, a perda de dados pode ser uma preocupação significativa.</span><span class="sxs-lookup"><span data-stu-id="88a85-150">However, when forcing failover, data loss can be a significant concern.</span></span> <span data-ttu-id="88a85-151">Portanto, dedique um tempo para determinar a latência relativa das cópias dos bancos de dados em diferentes réplicas secundárias.</span><span class="sxs-lookup"><span data-stu-id="88a85-151">Therefore, consider taking time to determine the relative latency of the copies of the databases on different secondary replicas.</span></span> <span data-ttu-id="88a85-152">Para determinar qual cópia de um determinado banco de dados secundário tem a menor latência, compare os LSNs de fim de log delas.</span><span class="sxs-lookup"><span data-stu-id="88a85-152">To determine which copy of a given secondary database has the least latency, compare their end-of-log LSNs.</span></span> <span data-ttu-id="88a85-153">Um LSN de fim de log mais alto indica menos latência.</span><span class="sxs-lookup"><span data-stu-id="88a85-153">A higher the end-of-log LSN indicates less latency.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="88a85-154">Para comparar LSNs de fim de log, conecte-se a cada réplica secundária online, uma de cada vez, e consulte [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) para obter o valor **end_of_log_lsn** de cada banco de dados secundário local.</span><span class="sxs-lookup"><span data-stu-id="88a85-154">To compare end-of-log LSNs, connect to each online secondary replica, in turn, and query [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) for the **end_of_log_lsn** value of each local secondary database.</span></span> <span data-ttu-id="88a85-155">Em seguida, compare os LSNs de fim de log das diferentes cópias de cada banco de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-155">Then, compare the end-of-log LSNs of the different copies of each database.</span></span> <span data-ttu-id="88a85-156">Observe que bancos de dados diferentes podem ter seus LSNs mais altos em réplicas secundárias diferentes.</span><span class="sxs-lookup"><span data-stu-id="88a85-156">Note that different databases might have their highest LSNs on different secondary replicas.</span></span> <span data-ttu-id="88a85-157">Neste caso, o destino de failover mais apropriado depende da importância relativa que você coloca nos dados nos bancos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="88a85-157">In this case, the most appropriate failover target depends on the relative importance that you place on the data in the different databases.</span></span> <span data-ttu-id="88a85-158">Ou seja, para qual desses bancos de dados você mais desejaria minimizar a possível perda de dados?</span><span class="sxs-lookup"><span data-stu-id="88a85-158">That is, for which of these databases would you most want to minimize possible data loss?</span></span>  
  
-   <span data-ttu-id="88a85-159">Se os clientes puderem conectar-se ao original primário, um failover forçado apresentará certo risco de comportamento de divisão de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-159">If clients are able to connect to the original primary, a forced failover incurs some risk of split brain behavior.</span></span> <span data-ttu-id="88a85-160">Antes de forçar um failover, é altamente recomendável evitar que os clientes acessem a réplica primária original.</span><span class="sxs-lookup"><span data-stu-id="88a85-160">Before you force failover, we strongly recommend that you prevent clients from accessing the original primary replica.</span></span> <span data-ttu-id="88a85-161">Caso contrário, depois que o failover for forçado, os bancos de dados primários originais e o bancos de dados primários atuais poderão ser atualizados independentemente uns dos outros.</span><span class="sxs-lookup"><span data-stu-id="88a85-161">Otherwise, after failover is forced, the original primary databases and the current primary databases could be updated independently of the other.</span></span>  
  
###  <a name="potential-ways-to-avoid-data-loss-after-quorum-is-forced"></a><a name="WaysToAvoidDataLoss"></a> <span data-ttu-id="88a85-162">Possíveis maneiras de evitar perda de dados após quorum forçado</span><span class="sxs-lookup"><span data-stu-id="88a85-162">Potential Ways to Avoid Data Loss After Quorum is Forced</span></span>  
 <span data-ttu-id="88a85-163">Em algumas condições de falha depois que o quorum é perdido, é possível evitar a perda de dados, como a seguir:</span><span class="sxs-lookup"><span data-stu-id="88a85-163">Under some failure conditions after quorum is lost, you can avoid prevent data loss, as follows:</span></span>  
  
-   <span data-ttu-id="88a85-164">**Se a réplica primária original ficar online**</span><span class="sxs-lookup"><span data-stu-id="88a85-164">**If the original primary replica comes online**</span></span>  
  
     <span data-ttu-id="88a85-165">Se o quorum for perdido e a ação de forçar o quorum WSFC restaurar o nó de cluster que hospeda a réplica primária de um grupo de disponibilidade, você poderá impedir a perda de dados para esse grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-165">If quorum is lost and forcing WSFC quorum restores the cluster node that hosts the primary replica of an availability group, you can prevent data loss for this availability group.</span></span> <span data-ttu-id="88a85-166">Conecte-se à réplica primária e execute um failover forçado (FAILOVER_ALLOW_DATA_LOSS).</span><span class="sxs-lookup"><span data-stu-id="88a85-166">Connect to the primary replica and perform a forced failover (FAILOVER_ALLOW_DATA_LOSS).</span></span> <span data-ttu-id="88a85-167">Isso coloca a réplica primária novamente online.</span><span class="sxs-lookup"><span data-stu-id="88a85-167">This brings the primary replica back online.</span></span> <span data-ttu-id="88a85-168">Como o failover forçado é executado na réplica primária original, não há perda de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-168">Because you perform the forced failover to the original primary replica, there is no data loss.</span></span>  
  
-   <span data-ttu-id="88a85-169">**Se uma réplica secundária de confirmação síncrona sincronizada ficar online**</span><span class="sxs-lookup"><span data-stu-id="88a85-169">**If a synchronized synchronous-commit secondary replica comes online**</span></span>  
  
     <span data-ttu-id="88a85-170">Se o quorum for perdido e a ação de forçar o quorum WSFC restaurar um nó de cluster que hospeda uma réplica secundária sincronizada de um grupo de disponibilidade, você deverá ser capaz de impedir a perda de dados para esse grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-170">If quorum is lost and forcing WSFC quorum restores a cluster node that hosts a synchronized secondary replica for an availability group, you should be able to prevent data loss for this availability group.</span></span> <span data-ttu-id="88a85-171">Se o nó restaurado estava ativo no momento em que o quórum foi perdido, você pode determinar se a perda de dados pode ocorrer em determinado banco de dados consultando a coluna **is_failover_ready** da exibição de gerenciamento dinâmico [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="88a85-171">If the restored node was up at the time that quorum was lost, you can determine whether data loss could occur on a given database by querying the **is_failover_ready** column of the [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) dynamic management view.</span></span> <span data-ttu-id="88a85-172">Por exemplo, para uma instância de servidor nomeada `sql108w2k8r22`, emita a seguinte consulta:</span><span class="sxs-lookup"><span data-stu-id="88a85-172">For example, for a server instance named `sql108w2k8r22`, issue the following query:</span></span>  
  
    ```  
    SELECT * FROM sys.dm_hadr_database_replica_cluster_states  
       WHERE replica_id=(SELECT replica_id FROM sys.availability_replicas   
          WHERE replica_server_name ='sql108w2k8r22')  
    ```  
  
    > [!CAUTION]  
    >  <span data-ttu-id="88a85-173">Se o nó restaurado não estava ativo no momento em que o quórum foi perdido, **is_failover_ready** talvez não reflita o estado real do cluster no momento em que a réplica primária ficou offline.</span><span class="sxs-lookup"><span data-stu-id="88a85-173">If the restored node was not up at the time quorum was lost, **is_failover_ready** may not reflect the cluster's actual state at the time the primary replica went offline.</span></span> <span data-ttu-id="88a85-174">Portanto, o valor **is_failover_ready** é adequado apenas para o nó do host no momento da falha.</span><span class="sxs-lookup"><span data-stu-id="88a85-174">Therefore, the **is_failover_ready** value is only good if the host node at the time of the failure.</span></span> <span data-ttu-id="88a85-175">Para obter informações, consulte “Por que o failover forçado é necessário após um quórum forçado” em [Failover e modos de failover &#40;grupos de disponibilidade AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-175">For more information, see "Why Forced Failover is Required After Forcing Quorum" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="88a85-176">Se **is_failover_ready** = 1, o banco de dados será marcado como sincronizado no cluster e estará pronto para um failover.</span><span class="sxs-lookup"><span data-stu-id="88a85-176">If **is_failover_ready** = 1, the database is marked as synchronized in the cluster and is ready for a failover.</span></span> <span data-ttu-id="88a85-177">Se **is_failover_ready** = 1 em cada banco de dados em determinada réplica secundária, você poderá executar um failover forçado (FORCE_FAILOVER_ALLOW_DATA_LOSS), sem perda de dados, nessa réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="88a85-177">If **is_failover_ready** = 1 on every database on a given secondary replica, you can perform a forced failover (FORCE_FAILOVER_ALLOW_DATA_LOSS) without data loss on this secondary replica.</span></span> <span data-ttu-id="88a85-178">A réplica secundária sincronizada entra online na função primária, ou seja, como a nova réplica primária, com todos os dados intactos.</span><span class="sxs-lookup"><span data-stu-id="88a85-178">The synchronized secondary replica comes online in the primary role, that is, as the new primary replica, with all the data intact.</span></span>  
  
     <span data-ttu-id="88a85-179">Se **is_failover_ready** = 0, o banco de dados não será marcado como sincronizado no cluster e *não* estará pronto para um failover manual planejado.</span><span class="sxs-lookup"><span data-stu-id="88a85-179">If **is_failover_ready** = 0, the database is not marked as synchronized in the cluster and is *not* ready for a planned manual failover.</span></span> <span data-ttu-id="88a85-180">Se você forçar o failover na réplica secundária do host, os dados serão perdidos nesse banco de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-180">If you force failover to the host secondary replica, data will be lost on this database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="88a85-181">Quando você forçar o failover em uma réplica secundária, a quantidade de perda de dados dependerá de quanto é o atraso do destino de failover subjacente à réplica primária.</span><span class="sxs-lookup"><span data-stu-id="88a85-181">When you force failover to a secondary replica, the amount of data loss will depend on how far the failover target is lagging behind the primary replica.</span></span> <span data-ttu-id="88a85-182">Infelizmente, quando o cluster WSFC não tem quorum ou o quorum foi forçado, não é possível avaliar a quantidade da potencial perda de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-182">Unfortunately, when the WSFC cluster lacks quorum or quorum has been forced, you cannot assess the amount of potential data loss.</span></span> <span data-ttu-id="88a85-183">Entretanto, observe que, quando o cluster WSFC recuperar um quorum íntegro, será possível começar a controlar a potencial perda de dados.</span><span class="sxs-lookup"><span data-stu-id="88a85-183">Note, however, that once the WSFC cluster regains a healthy quorum, you could begin to track potential data loss.</span></span> <span data-ttu-id="88a85-184">Para obter mais informações, consulte “Controlando a possível perda de dados” em [Failover e modos de failover &#40;grupos de disponibilidade AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-184">For more information, see "Tracking Potential Data Loss" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="88a85-185">Segurança</span><span class="sxs-lookup"><span data-stu-id="88a85-185">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="88a85-186">Permissões</span><span class="sxs-lookup"><span data-stu-id="88a85-186">Permissions</span></span>  
 <span data-ttu-id="88a85-187">Requer a permissão ALTER AVAILABILITY GROUP no grupo de disponibilidade, a permissão CONTROL AVAILABILITY GROUP, a permissão ALTER ANY AVAILABILITY GROUP ou a permissão CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="88a85-187">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="88a85-188">Usando o SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="88a85-188">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="88a85-189">**Para forçar o failover (com possível perda de dados)**</span><span class="sxs-lookup"><span data-stu-id="88a85-189">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="88a85-190">No Pesquisador de Objetos, conecte-se a uma instância de servidor que hospede uma réplica cuja função esteja no estado SECONDARY ou RESOLVING no grupo de disponibilidade que precisa sofrer failover e expanda a árvore de servidores.</span><span class="sxs-lookup"><span data-stu-id="88a85-190">In Object Explorer, connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over, and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="88a85-191">Expanda os nós **Alta Disponibilidade AlwaysOn** e **Grupos de Disponibilidade** .</span><span class="sxs-lookup"><span data-stu-id="88a85-191">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="88a85-192">Clique com o botão direito do mouse no grupo de disponibilidade do qual fazer failover e selecione o comando **Failover** .</span><span class="sxs-lookup"><span data-stu-id="88a85-192">Right-click the availability group to be failed over, and select the **Failover** command.</span></span>  
  
4.  <span data-ttu-id="88a85-193">Isso inicia o Assistente de Grupo de Disponibilidade de Failover.</span><span class="sxs-lookup"><span data-stu-id="88a85-193">This launches the Failover Availability Group Wizard.</span></span> <span data-ttu-id="88a85-194">Para obter mais informações, veja [Usar o Assistente para Executar Failover de Grupo de Disponibilidade &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-194">For more information, see [Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span></span>  
  
5.  <span data-ttu-id="88a85-195">Depois de forçar um failover do grupo de disponibilidade, conclua as etapas de acompanhamento necessárias.</span><span class="sxs-lookup"><span data-stu-id="88a85-195">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="88a85-196">Para obter mais informações, confira [Acompanhamento: Tarefas essenciais após um failover forçado](#FollowUp), mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="88a85-196">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="88a85-197">Usando o Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="88a85-197">Using Transact-SQL</span></span>  
 <span data-ttu-id="88a85-198">**Para forçar o failover (com possível perda de dados)**</span><span class="sxs-lookup"><span data-stu-id="88a85-198">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="88a85-199">Conecte-se a uma instância de servidor que hospede uma réplica cuja função esteja no estado SECONDARY ou RESOLVING no grupo de disponibilidade que precisa passar por failover.</span><span class="sxs-lookup"><span data-stu-id="88a85-199">Connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="88a85-200">Use a instrução [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) , da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="88a85-200">Use the [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) statement, as follows:</span></span>  
  
     <span data-ttu-id="88a85-201">ALTER AVAILABILITY GROUP *group_name* FORCE_FAILOVER_ALLOW_DATA_LOSS</span><span class="sxs-lookup"><span data-stu-id="88a85-201">ALTER AVAILABILITY GROUP *group_name* FORCE_FAILOVER_ALLOW_DATA_LOSS</span></span>  
  
     <span data-ttu-id="88a85-202">em que *group_name* é o nome do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-202">where *group_name* is the name of the availability group.</span></span>  
  
     <span data-ttu-id="88a85-203">O exemplo a seguir força o grupo de disponibilidade `AccountsAG` a fazer failover na réplica secundária local.</span><span class="sxs-lookup"><span data-stu-id="88a85-203">The following example forces the `AccountsAG` availability group to fail over to the local secondary replica.</span></span>  
  
    ```sql
    ALTER AVAILABILITY GROUP AccountsAG FORCE_FAILOVER_ALLOW_DATA_LOSS;  
    ```  
  
3.  <span data-ttu-id="88a85-204">Depois de forçar um failover do grupo de disponibilidade, conclua as etapas de acompanhamento necessárias.</span><span class="sxs-lookup"><span data-stu-id="88a85-204">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="88a85-205">Para obter mais informações, confira [Acompanhamento: Tarefas essenciais após um failover forçado](#FollowUp), mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="88a85-205">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="88a85-206">Usando o PowerShell</span><span class="sxs-lookup"><span data-stu-id="88a85-206">Using PowerShell</span></span>  
 <span data-ttu-id="88a85-207">**Para forçar o failover (com possível perda de dados)**</span><span class="sxs-lookup"><span data-stu-id="88a85-207">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="88a85-208">Altere o diretório ( `cd` ) para uma instância de servidor que hospede uma réplica cuja função esteja no estado secundário ou resolvendo no grupo de disponibilidade que precisa passar por failover.</span><span class="sxs-lookup"><span data-stu-id="88a85-208">Change directory (`cd`) to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="88a85-209">Use o cmdlet `Switch-SqlAvailabilityGroup` com o parâmetro `AllowDataLoss` em um dos seguintes formatos:</span><span class="sxs-lookup"><span data-stu-id="88a85-209">Use the `Switch-SqlAvailabilityGroup` cmdlet with the `AllowDataLoss` parameter in one of the following forms:</span></span>  
  
    -   `-AllowDataLoss`  
  
         <span data-ttu-id="88a85-210">Por padrão, o parâmetro `-AllowDataLoss` faz com que o `Switch-SqlAvailabilityGroup` avise a você que o failover forçado pode resultar na perda de transações não confirmadas e solicitar uma confirmação.</span><span class="sxs-lookup"><span data-stu-id="88a85-210">By default `-AllowDataLoss` parameter causes `Switch-SqlAvailabilityGroup` to prompt you to remind you that forcing failover might result in the loss of uncommitted transactions and to request confirmation.</span></span> <span data-ttu-id="88a85-211">Para continuar, insira `Y`. Para cancelar a operação, insira `N`.</span><span class="sxs-lookup"><span data-stu-id="88a85-211">To continue, enter `Y`; to cancel the operation, enter `N`.</span></span>  
  
         <span data-ttu-id="88a85-212">O exemplo a seguir executa um failover forçado (com possível perda de dados) do grupo de disponibilidade `MyAg` na réplica secundária na instância de servidor denominada `SecondaryServer\InstanceName`.</span><span class="sxs-lookup"><span data-stu-id="88a85-212">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the secondary replica on the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="88a85-213">Você será solicitado a confirmar essa operação.</span><span class="sxs-lookup"><span data-stu-id="88a85-213">You will be prompted to confirm this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss  
        ```  
  
    -   <span data-ttu-id="88a85-214">**-AllowDataLoss-Force**</span><span class="sxs-lookup"><span data-stu-id="88a85-214">**-AllowDataLoss-Force**</span></span>  
  
         <span data-ttu-id="88a85-215">Para iniciar um failover forçado sem confirmação, especifique os parâmetros `-AllowDataLoss` e `-Force`.</span><span class="sxs-lookup"><span data-stu-id="88a85-215">To initiate a forced failover without confirmation, specify both the `-AllowDataLoss` and `-Force` parameters.</span></span> <span data-ttu-id="88a85-216">Isso será útil se você desejar incluir o comando em um script e executá-lo sem interação do usuário.</span><span class="sxs-lookup"><span data-stu-id="88a85-216">This is useful if you want to include the command in a script and run it without user interaction.</span></span>  <span data-ttu-id="88a85-217">No entanto, use a opção `-Force` com cuidado, pois um failover forçado pode resultar na perda de dados dos bancos de dados que participam do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-217">However, use the `-Force` option with caution, because a forced failover might result in the loss of data from databases participating the availability group.</span></span>  
  
         <span data-ttu-id="88a85-218">O exemplo a seguir executa um failover forçado (com possível perda de dados) do grupo de disponibilidade `MyAg` na instância de servidor denominada `SecondaryServer\InstanceName`.</span><span class="sxs-lookup"><span data-stu-id="88a85-218">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="88a85-219">A opção `-Force` suprime a confirmação dessa operação.</span><span class="sxs-lookup"><span data-stu-id="88a85-219">The `-Force` option suppresses confirmation of this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss -Force  
        ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="88a85-220">Para exibir a sintaxe de um cmdlet, use o cmdlet `Get-Help` no ambiente do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell.</span><span class="sxs-lookup"><span data-stu-id="88a85-220">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="88a85-221">Para obter mais informações, consulte [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-221">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
3.  <span data-ttu-id="88a85-222">Depois de forçar um failover do grupo de disponibilidade, conclua as etapas de acompanhamento necessárias.</span><span class="sxs-lookup"><span data-stu-id="88a85-222">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="88a85-223">Para obter mais informações, confira [Acompanhamento: Tarefas essenciais após um failover forçado](#FollowUp), mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="88a85-223">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
 <span data-ttu-id="88a85-224">**Para configurar e usar o provedor do SQL Server PowerShell**</span><span class="sxs-lookup"><span data-stu-id="88a85-224">**To set up and use the SQL Server PowerShell provider**</span></span>  
  
-   [<span data-ttu-id="88a85-225">Provedor do SQL Server PowerShell</span><span class="sxs-lookup"><span data-stu-id="88a85-225">SQL Server PowerShell Provider</span></span>](../../../powershell/sql-server-powershell-provider.md)  
  
##  <a name="follow-up-essential-tasks-after-a-forced-failover"></a><a name="FollowUp"></a> <span data-ttu-id="88a85-226">Acompanhamento: Tarefas essenciais depois de um failover forçado</span><span class="sxs-lookup"><span data-stu-id="88a85-226">Follow Up: Essential Tasks After a Forced Failover</span></span>  
  
1.  <span data-ttu-id="88a85-227">Depois de um failover forçado, a réplica secundária na qual foi feito o failover se torna a nova réplica primária.</span><span class="sxs-lookup"><span data-stu-id="88a85-227">After a forced failover, the secondary replica to which you failed over becomes the new primary replica.</span></span> <span data-ttu-id="88a85-228">No entanto, para tornar essa réplica de disponibilidade acessível aos clientes, você pode precisar reconfigurar o quorum WSFC ou ajustar a configuração do modo de disponibilidade do grupo de disponibilidade, da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="88a85-228">However, to make that availability replica accessible to clients, you might need to reconfigure the WSFC quorum or adjust the availability-mode configuration of the availability group, as follows:</span></span>  
  
    -   <span data-ttu-id="88a85-229">**Se você fez failover fora do [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]:**  Ajuste os votos de quorum dos nós WSFC para refletir a nova configuração do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-229">**If you failed over outside of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]:**  Adjust the quorum votes of the WSFC nodes to reflect your new availability group configuration.</span></span> <span data-ttu-id="88a85-230">Se o nó WSFC, que hospeda a réplica secundária de destino, não tiver um voto de quorum WSFC, você poderá precisar forçar o quorum WSFC.</span><span class="sxs-lookup"><span data-stu-id="88a85-230">If the WSFC node that hosts the target secondary replica does not have a WSFC quorum vote, you might need to force WSFC quorum.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="88a85-231">Um [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] existirá apenas se duas réplicas de disponibilidade (inclusive a réplica primária anterior) estiverem configuradas para modo de confirmação síncrona com failover automático.</span><span class="sxs-lookup"><span data-stu-id="88a85-231">An [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] exists only if two availability replicas (including the previous primary replica) are configured for synchronous-commit mode with automatic failover.</span></span>  
  
         <span data-ttu-id="88a85-232">**Para ajustar votos de quorum**</span><span class="sxs-lookup"><span data-stu-id="88a85-232">**To adjust quorum votes**</span></span>  
  
        -   [<span data-ttu-id="88a85-233">Exibir configurações de NodeWeight de quorum do cluster</span><span class="sxs-lookup"><span data-stu-id="88a85-233">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="88a85-234">Definir configurações de NodeWeight de quorum do cluster</span><span class="sxs-lookup"><span data-stu-id="88a85-234">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="88a85-235">Forçar um cluster WSFC para iniciar sem um quorum</span><span class="sxs-lookup"><span data-stu-id="88a85-235">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
    -   <span data-ttu-id="88a85-236">**Se você fez failover fora do [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]:** Será recomendável considerar o ajuste do modo de disponibilidade e do modo de failover na nova réplica primária e nas réplicas secundárias restantes para refletir a confirmação síncrona desejada e a configuração de failover automático.</span><span class="sxs-lookup"><span data-stu-id="88a85-236">**If you failed over outside of the [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]:** We recommend that you consider adjusting the availability mode and failover mode on the new primary replica and on remaining secondary replicas to reflect your desired synchronous-commit and automatic failover configuration.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="88a85-237">Um [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] existirá somente se a réplica primária atual for configurada para modo de confirmação síncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-237">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] exists only if the current primary replica is configured for synchronous-commit mode.</span></span>  
  
         <span data-ttu-id="88a85-238">**Para alterar o modo de disponibilidade e o modo de failover**</span><span class="sxs-lookup"><span data-stu-id="88a85-238">**To change the availability mode and failover mode**</span></span>  
  
        -   [<span data-ttu-id="88a85-239">Alterar o modo de disponibilidade de uma réplica de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-239">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
        -   [<span data-ttu-id="88a85-240">Alterar o modo de failover de uma réplica de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-240">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
2.  <span data-ttu-id="88a85-241">Depois de um failover forçado, todos os bancos de dados secundários são suspensos.</span><span class="sxs-lookup"><span data-stu-id="88a85-241">After a forced failover, all secondary databases are suspended.</span></span> <span data-ttu-id="88a85-242">Isso inclui os antigos bancos de dados primários, depois que a antiga réplica primária ficar online novamente e descobrir que agora ela é uma réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="88a85-242">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="88a85-243">É necessário retomar manualmente cada banco de dados suspenso individualmente em cada réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="88a85-243">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
     <span data-ttu-id="88a85-244">Quando um banco de dados secundário é retomado, ele inicia a sincronização de dados com o banco de dados primário correspondente.</span><span class="sxs-lookup"><span data-stu-id="88a85-244">When a secondary database is resumed, it initiates data synchronization with the corresponding primary database.</span></span> <span data-ttu-id="88a85-245">O banco de dados secundário reverte os registros de log que nunca foram confirmados no novo banco de dados primário. Portanto, se você estiver preocupado com a possível perda de dados nos bancos de dados primários após o failover, tente criar um instantâneo do banco de dados nos bancos de dados suspensos em um dos bancos de dados secundários de confirmação síncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-245">The secondary database rolls back any log records that were never committed on the new primary database.Therefore, if you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one of the synchronous-commit secondary databases.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="88a85-246">O truncamento do log de transações será atrasado em um banco de dados primário enquanto qualquer um de seus bancos de dados secundários estiver suspenso.</span><span class="sxs-lookup"><span data-stu-id="88a85-246">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="88a85-247">Além disso, a integridade da sincronização de uma réplica secundária de confirmação síncrona não poderá fazer a transição para HEALTHY enquanto qualquer banco de dados local permanecer suspenso.</span><span class="sxs-lookup"><span data-stu-id="88a85-247">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
     <span data-ttu-id="88a85-248">**Para criar um instantâneo do banco de dados**</span><span class="sxs-lookup"><span data-stu-id="88a85-248">**To create a database snapshot**</span></span>  
  
    -   [<span data-ttu-id="88a85-249">Criar um instantâneo de banco de dados &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-249">Create a Database Snapshot &#40;Transact-SQL&#41;</span></span>](../../../relational-databases/databases/create-a-database-snapshot-transact-sql.md)  
  
     <span data-ttu-id="88a85-250">**Para retomar um banco de dados de disponibilidade**</span><span class="sxs-lookup"><span data-stu-id="88a85-250">**To resume an availability database**</span></span>  
  
    -   [<span data-ttu-id="88a85-251">Retomar um banco de dados de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-251">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)  
  
    > [!CAUTION]  
    >  <span data-ttu-id="88a85-252">Antes de tentar um failover do grupo novamente, depois de retomar todos os bancos de dados secundários, espere que todos os bancos de dados secundários no próximo destino de failover entrem no estado SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="88a85-252">After resuming all the secondary databases, before attempting to fail over the group again, wait for every secondary database on the next failover target to enter the SYNCHRONIZING state.</span></span> <span data-ttu-id="88a85-253">Se qualquer banco de dados ainda estiver no estado SYNCHRONIZING, esse banco de dados será impedido de entrar online como um banco de dados primário, e o restabelecimento da sincronização de dados para o banco de dados poderá exigir a restauração dos logs de transações, a restauração do backup completo do banco de dados ou o failover para a réplica primária anterior.</span><span class="sxs-lookup"><span data-stu-id="88a85-253">If any database is not yet SYNCHRONIZING, that database will be prevented from coming online as a primary database, and re-establishing data synchronization for the database might require restoring transaction logs, restoring a full database backup, or failing over back to the previous primary replica.</span></span>  
  
3.  <span data-ttu-id="88a85-254">Se uma réplica de disponibilidade com falha não será retornada à réplica de disponibilidade ou retornará muito tarde para você atrasar o truncamento do log de transações no novo banco de dados primário, considere remover a réplica com falha do grupo de disponibilidade para evitar a falta de espaço em disco para seus arquivos de log.</span><span class="sxs-lookup"><span data-stu-id="88a85-254">If an availability replica that failed will not be returning to the availability replica or will return too late for you to delay transaction log truncation on the new primary database, consider removing the failed replica from the availability group to avoid running out of disk space for your log files.</span></span>  
  
     <span data-ttu-id="88a85-255">**Para remover uma réplica secundária**</span><span class="sxs-lookup"><span data-stu-id="88a85-255">**To remove a secondary replica**</span></span>  
  
    -   [<span data-ttu-id="88a85-256">Remover uma réplica secundária de um grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-256">Remove a Secondary Replica from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-secondary-replica-from-an-availability-group-sql-server.md)  
  
4.  <span data-ttu-id="88a85-257">Se você seguir um failover forçado com um ou mais failovers forçados adicionais, execute um backup de log depois de cada failover forçado adicional na série.</span><span class="sxs-lookup"><span data-stu-id="88a85-257">If you follow a forced failover with one or more additional forced failovers, perform a log backup after each additional forced failover in the series.</span></span> <span data-ttu-id="88a85-258">Para obter informações sobre a razão para isto, consulte "Riscos de forçar o failover" na seção "Failover manual forçado (com possível perda de dados)" de [Failover e modos de failover &#40;grupos de disponibilidade AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-258">For information about the reason for this, see "Risks of Forcing Failover" in the "Forced Manual Failover (with Possible Data Loss)" section of [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="88a85-259">**Para realizar um backup de log**</span><span class="sxs-lookup"><span data-stu-id="88a85-259">**To perform a log backup**</span></span>  
  
    -   [<span data-ttu-id="88a85-260">Fazer backup de um log de transações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-260">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](../../../relational-databases/backup-restore/back-up-a-transaction-log-sql-server.md)  
  
##  <a name="example-scenario-using-a-forced-failover-to-recover-from-a-catastrophic-failure"></a><a name="ExampleRecoveryFromCatastrophy"></a> <span data-ttu-id="88a85-261">Cenário de exemplo: Usando um failover forçado para recuperar-se de uma falha catastrófica</span><span class="sxs-lookup"><span data-stu-id="88a85-261">Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure</span></span>  
 <span data-ttu-id="88a85-262">Se a réplica primária falhar e nenhuma réplica secundária sincronizada estiver disponível, forçar o grupo de disponibilidade a realizar failover poderá ser uma resposta apropriada.</span><span class="sxs-lookup"><span data-stu-id="88a85-262">If the primary replica fails and no synchronized secondary replica is available, forcing the availability group to fail over might be an appropriate response.</span></span> <span data-ttu-id="88a85-263">A conveniência de forçar um failover depende de: (1) se você espera que a réplica primária fique offline por mais tempo que seu SLA (contrato de nível de serviço) tolera e (2) se você está disposto a correr o risco de uma potencial perda de dados para disponibilizar os bancos de dados primários rapidamente.</span><span class="sxs-lookup"><span data-stu-id="88a85-263">The appropriateness of forcing a failover depends on: (1) whether you expect the primary replica to be offline for longer than your service level agreement (SLA) tolerates, and (2) whether you are willing to risk potential data loss in order to make primary databases available quickly.</span></span> <span data-ttu-id="88a85-264">Se você decidir que um grupo de disponibilidade exige um failover forçado, o failover forçado real será apenas uma etapa de um processo de várias etapas.</span><span class="sxs-lookup"><span data-stu-id="88a85-264">If you decide that an availability group requires a forced failover, the actual forced failover is but one step of a multi-step process.</span></span>  
  
 <span data-ttu-id="88a85-265">Para ilustrar as etapas que são necessárias para usar um failover forçado para recuperar-se de uma falha catastrófica, este tópico apresenta um possível cenário de recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="88a85-265">To illustrate the steps that are required to use a forced failover to recover from a catastrophic failure, this topic presents one possible disaster recovery scenario.</span></span> <span data-ttu-id="88a85-266">O cenário de exemplo considera um grupo de disponibilidade cuja topologia original consiste em um data center principal que hospeda três réplicas de disponibilidade de confirmação síncrona, incluindo a réplica primária, e um data center remoto que hospeda duas réplicas secundárias de confirmação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-266">The example scenario considers an availability group whose original topology consists of a main data center that hosts three synchronous-commit availability replicas, including the primary replica, and a remote data center that hosts two asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="88a85-267">A figura a seguir ilustra a topologia original deste grupo de disponibilidade de exemplo.</span><span class="sxs-lookup"><span data-stu-id="88a85-267">The following figure illustrates the original topology of this example availability group.</span></span> <span data-ttu-id="88a85-268">O grupo de disponibilidade está hospedado por um cluster WSFC de várias sub-redes com três nós no data center principal (**Nó 01**, **Nó 02**e **Nó 03**) e dois nós em um data center remoto (**Nó 04** e **Nó 05**).</span><span class="sxs-lookup"><span data-stu-id="88a85-268">The availability group is hosted by a multi-subnet WSFC cluster with three nodes in the main data center (**Node 01**, **Node 02**, and **Node 03**) and two nodes in a remote data center (**Node 04** and **Node 05**).</span></span>  
  
 <span data-ttu-id="88a85-269">![Topologia original do grupo de disponibilidade](../../media/aoag-failurerecovery-origtopology.gif "Topologia original do grupo de disponibilidade")</span><span class="sxs-lookup"><span data-stu-id="88a85-269">![Original topology of availability group](../../media/aoag-failurerecovery-origtopology.gif "Original topology of availability group")</span></span>  
  
 <span data-ttu-id="88a85-270">O data center principal é desligado inesperadamente.</span><span class="sxs-lookup"><span data-stu-id="88a85-270">The main data center shuts down unexpectedly.</span></span> <span data-ttu-id="88a85-271">Suas três réplicas de disponibilidade ficam offline e os seus bancos de dados ficam indisponíveis.</span><span class="sxs-lookup"><span data-stu-id="88a85-271">Its three availability replicas to go offline, and their databases become unavailable.</span></span> <span data-ttu-id="88a85-272">A figura a seguir ilustra o impacto dessa falha na topologia do grupo de disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="88a85-272">The following figure illustrates the impact of this failure on the topology of the availability group.</span></span>  
  
 <span data-ttu-id="88a85-273">![Topologia depois da falha do datacenter principal](../../media/aoag-failurerecovery-catastrophy.gif "Topologia depois da falha do datacenter principal")</span><span class="sxs-lookup"><span data-stu-id="88a85-273">![Topology after failure of main data center](../../media/aoag-failurerecovery-catastrophy.gif "Topology after failure of main data center")</span></span>  
  
 <span data-ttu-id="88a85-274">O DBA (administrador de banco de dados) determina que a melhor resposta possível é forçar o failover do grupo de disponibilidade para uma das réplicas secundárias de confirmação assíncrona remotas.</span><span class="sxs-lookup"><span data-stu-id="88a85-274">The database administrator (DBA) determines that the best possible response is to force failover of the availability group to one of the remote, asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="88a85-275">Este exemplo ilustra as etapas típicas envolvidas quando você força o failover do grupo de disponibilidade para uma réplica remota e, consequentemente, retorna o grupo de disponibilidade a sua topologia original.</span><span class="sxs-lookup"><span data-stu-id="88a85-275">This example illustrates the typical steps involved when you force failover of the availability group to a remote replica and, eventually, return the availability group to its original topology.</span></span>  
  
  
###  <a name="responding-to-the-catastrophic-failure-of-the-main-data-center"></a><a name="FailureResponse"></a> <span data-ttu-id="88a85-276">Responding to the Catastrophic Failure of the Main Data Center</span><span class="sxs-lookup"><span data-stu-id="88a85-276">Responding to the Catastrophic Failure of the Main Data Center</span></span>  
 <span data-ttu-id="88a85-277">A figura a seguir ilustra a série de ações realizadas no data center remoto em resposta à falha catastrófica no data center principal.</span><span class="sxs-lookup"><span data-stu-id="88a85-277">The following figure illustrates the series of actions performed at the remote data center in response a catastrophic failure at the main data center.</span></span>  
  
 <span data-ttu-id="88a85-278">![Etapas para responder à falha do datacenter principal](../../media/aoag-failurerecovery-actions-part1.gif "Etapas para responder à falha do datacenter principal")</span><span class="sxs-lookup"><span data-stu-id="88a85-278">![Steps for responding to failure of main data cente](../../media/aoag-failurerecovery-actions-part1.gif "Steps for responding to failure of main data cente")</span></span>  
  
 <span data-ttu-id="88a85-279">As etapas nesta figura indicam as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="88a85-279">The steps in this figure indicate the following steps:</span></span>  
  
|<span data-ttu-id="88a85-280">Etapa</span><span class="sxs-lookup"><span data-stu-id="88a85-280">Step</span></span>|<span data-ttu-id="88a85-281">Ação</span><span class="sxs-lookup"><span data-stu-id="88a85-281">Action</span></span>|<span data-ttu-id="88a85-282">Links</span><span class="sxs-lookup"><span data-stu-id="88a85-282">Links</span></span>|  
|----------|------------|-----------|  
|<span data-ttu-id="88a85-283">**1.**</span><span class="sxs-lookup"><span data-stu-id="88a85-283">**1.**</span></span>|<span data-ttu-id="88a85-284">O DBA ou administrador da rede verifica se o cluster WSFC tem um quorum íntegro.</span><span class="sxs-lookup"><span data-stu-id="88a85-284">The DBA or network administrator ensures that the WSFC cluster has a healthy quorum.</span></span> <span data-ttu-id="88a85-285">Neste exemplo, o quorum precisa ser forçado.</span><span class="sxs-lookup"><span data-stu-id="88a85-285">In this example, quorum needs to be forced.</span></span>|[<span data-ttu-id="88a85-286">Configuração de modos de quorum WSFC e votação &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-286">WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)<br /><br /> [<span data-ttu-id="88a85-287">Recuperação de desastres do WSFC por meio de quorum forçado &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-287">WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)|  
|<span data-ttu-id="88a85-288">**2.**</span><span class="sxs-lookup"><span data-stu-id="88a85-288">**2.**</span></span>|<span data-ttu-id="88a85-289">O DBA conecta-se à instância de servidor com a menor latência (no **Nó 04**) e executa um failover manual forçado.</span><span class="sxs-lookup"><span data-stu-id="88a85-289">The DBA connects to the server instance with the least latency (on **Node 04**) and performs a forced manual failover.</span></span> <span data-ttu-id="88a85-290">O failover forçado faz a transição desta réplica secundária para a função primária e suspende os bancos de dados secundários na réplica secundária restante (no **Nó 05**).</span><span class="sxs-lookup"><span data-stu-id="88a85-290">The forced failover transitions this secondary replica to the primary role and suspends the secondary databases on the remaining secondary replica (on **Node 05**).</span></span>|<span data-ttu-id="88a85-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (Consulta a coluna **end_of_log_lsn** .</span><span class="sxs-lookup"><span data-stu-id="88a85-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (Query the **end_of_log_lsn** column.</span></span> <span data-ttu-id="88a85-292">Para obter mais informações, consulte [Recomendações](#Recommendations)anteriormente neste tópico.)</span><span class="sxs-lookup"><span data-stu-id="88a85-292">For more information, see [Recommendations](#Recommendations), earlier in this topic.)</span></span>|  
|<span data-ttu-id="88a85-293">**3.**</span><span class="sxs-lookup"><span data-stu-id="88a85-293">**3.**</span></span>|<span data-ttu-id="88a85-294">O DBA retoma manualmente cada banco de dados secundário na réplica secundária restante.</span><span class="sxs-lookup"><span data-stu-id="88a85-294">The DBA manually resumes each of the secondary databases on the remaining secondary replica.</span></span>|[<span data-ttu-id="88a85-295">Retomar um banco de dados de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-295">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)|  
  
###  <a name="returning-the-availability-group-to-its-original-topology"></a><a name="ReturnToOrigTopology"></a> <span data-ttu-id="88a85-296">Voltando o grupo de disponibilidade a sua topologia original</span><span class="sxs-lookup"><span data-stu-id="88a85-296">Returning the Availability Group to its Original Topology</span></span>  
 <span data-ttu-id="88a85-297">A figura a seguir ilustra a série de ações que retornam o grupo de disponibilidade a sua topologia original depois que o data center principal volta a ficar online e os nós WSFC restabelecem comunicação com o cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="88a85-297">The following figure illustrates the series of actions that return the availability group to its original topology after the main data center comes back online and the WSFC nodes re-establish communication with the WSFC cluster.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="88a85-298">Se o quorum do cluster WSFC tiver sido forçado, quando os nós offline reiniciarem, eles poderão formar um novo quorum se as duas condições a seguir existirem: (a) não há nenhuma conectividade de rede entre qualquer nó no conjunto de quorum forçado e (b) os nós de reinicialização são a maioria dos nós de cluster.</span><span class="sxs-lookup"><span data-stu-id="88a85-298">If the WSFC cluster quorum has been forced, as the offline nodes restart they could form a new quorum if the following conditions both exist: (a) there is no network connectivity between any of the nodes in the forced-quorum set, and (b) the restarting nodes are the majority of the cluster nodes.</span></span> <span data-ttu-id="88a85-299">Isso resulta em uma condição de divisão de dados, na qual o grupo de disponibilidade teria duas réplicas primárias independentes, uma em cada data center.</span><span class="sxs-lookup"><span data-stu-id="88a85-299">This would result in a "split brain" condition in which the availability group would possess two independent primary replicas, one at each data center.</span></span> <span data-ttu-id="88a85-300">Antes de forçar o quórum para criar um conjunto de quórum minoritário, consulte [Recuperação de desastres do WSFC por meio de quorum forçado &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="88a85-300">Before forcing quorum to create a minority quorum set, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
 <span data-ttu-id="88a85-301">![Etapas para retornar o grupo à sua topologia original](../../media/aoag-failurerecovery-actions-part2.gif "Etapas para retornar o grupo à sua topologia original")</span><span class="sxs-lookup"><span data-stu-id="88a85-301">![Steps to return the group to its original topology](../../media/aoag-failurerecovery-actions-part2.gif "Steps to return the group to its original topology")</span></span>  
  
 <span data-ttu-id="88a85-302">As etapas nesta figura indicam as etapas a seguir:</span><span class="sxs-lookup"><span data-stu-id="88a85-302">The steps in this figure indicate the following steps:</span></span>  
  
||<span data-ttu-id="88a85-303">Etapa</span><span class="sxs-lookup"><span data-stu-id="88a85-303">Step</span></span>|<span data-ttu-id="88a85-304">Links</span><span class="sxs-lookup"><span data-stu-id="88a85-304">Links</span></span>|  
|-|----------|-----------|  
|<span data-ttu-id="88a85-305">**1.**</span><span class="sxs-lookup"><span data-stu-id="88a85-305">**1.**</span></span>|<span data-ttu-id="88a85-306">Os nós no data center principal ficam online novamente e restabelecem comunicação com o cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="88a85-306">The nodes in the main data center come back online and re-establish communication with the WSFC cluster.</span></span> <span data-ttu-id="88a85-307">As réplicas de disponibilidade ficam online como réplicas secundárias com bancos de dados suspensos e o DBA precisará retomar manualmente cada desses bancos de dados em breve.</span><span class="sxs-lookup"><span data-stu-id="88a85-307">Their availability replicas come online as secondary replicas with suspended databases, and the DBA will need to manually resume each of these databases soon.</span></span>|[<span data-ttu-id="88a85-308">Retomar um banco de dados de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-308">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)<br /><br /> <span data-ttu-id="88a85-309">Dica: Se você estiver preocupado com a possível perda de dados nos bancos de dados primários após o failover, tente criar um instantâneo de banco de dados nos bancos de dados suspensos em um dos bancos de dados secundário de confirmação síncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-309">Tip: If you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one the synchronous-commit secondary database.</span></span> <span data-ttu-id="88a85-310">Tenha em mente que o truncamento do log de transações é atrasado em um banco de dados primário enquanto qualquer um de seus bancos de dados secundários é suspenso.</span><span class="sxs-lookup"><span data-stu-id="88a85-310">Keep in mind that the transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="88a85-311">Além disso, a integridade da sincronização da réplica secundária de confirmação síncrona não poderá fazer a transição para HEALTHY enquanto qualquer banco de dados local permanecer suspenso.</span><span class="sxs-lookup"><span data-stu-id="88a85-311">Also the synchronization health of the synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>|  
|<span data-ttu-id="88a85-312">**2.**</span><span class="sxs-lookup"><span data-stu-id="88a85-312">**2.**</span></span>|<span data-ttu-id="88a85-313">Quando os bancos de dados forem retomados, o DBA alterará a nova réplica primária temporariamente para o modo de confirmação síncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-313">Once the databases are resumed, the DBA changes the new primary replica to synchronous-commit mode temporarily.</span></span> <span data-ttu-id="88a85-314">Isso envolve duas etapas:</span><span class="sxs-lookup"><span data-stu-id="88a85-314">This involves two steps:</span></span><br /><br /> <span data-ttu-id="88a85-315">1) Altere uma réplica de disponibilidade offline para o modo de confirmação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-315">1) Change one offline availability replica to asynchronous-commit mode.</span></span> <br /><span data-ttu-id="88a85-316">2) Altere a nova réplica primária para o modo de confirmação síncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-316">2) Change the new primary replica to synchronous-commit mode.</span></span><br /><span data-ttu-id="88a85-317">Observação: Esta etapa permite que bancos de dados secundários de confirmação síncrona retomados tornem-se SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="88a85-317">Note: This step enables resumed synchronous-commit secondary databases to become SYNCHRONIZED.</span></span>|[<span data-ttu-id="88a85-318">Alterar o modo de disponibilidade de uma réplica de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-318">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
|<span data-ttu-id="88a85-319">**3.**</span><span class="sxs-lookup"><span data-stu-id="88a85-319">**3.**</span></span>|<span data-ttu-id="88a85-320">Quando a réplica secundária de confirmação síncrona no **Nó 03** (a réplica primária original) insere o estado de sincronização HEALTHY, o DBA executa um failover manual planejado para essa réplica, para que ele se torne novamente a réplica primária.</span><span class="sxs-lookup"><span data-stu-id="88a85-320">Once the synchronous-commit secondary replica on **Node 03** (the original primary replica) enters the HEALTHY synchronization state, the DBA performs a planned manual failover to that replica, to make it the primary replica again.</span></span> <span data-ttu-id="88a85-321">A réplica no **Nó 04** volta a ser uma réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="88a85-321">The replica on **Node 04** returns to being a secondary replica.</span></span>|[<span data-ttu-id="88a85-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)<br /><br /> [<span data-ttu-id="88a85-323">Use políticas AlwaysOn para exibir a integridade de um grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-323">Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;</span></span>](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="88a85-324">Executar um failover manual planejado de um grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-324">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)|  
|<span data-ttu-id="88a85-325">**4.**</span><span class="sxs-lookup"><span data-stu-id="88a85-325">**4.**</span></span>|<span data-ttu-id="88a85-326">O DBA conecta-se à nova réplica primária e:</span><span class="sxs-lookup"><span data-stu-id="88a85-326">The DBA connects to the new primary replica and:</span></span><br /><br /> <span data-ttu-id="88a85-327">1) Altera a réplica primária antiga (no centro remoto) de volta para o modo de confirmação assíncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-327">1) Changes the former primary replica (in the remote center) back to asynchronous-commit mode.</span></span><br /><span data-ttu-id="88a85-328">2) Altera a réplica secundária de confirmação assíncrona no data center principal de volta para o modo de confirmação síncrona.</span><span class="sxs-lookup"><span data-stu-id="88a85-328">2) Changes the asynchronous-commit secondary replica in the main data center back to synchronous-commit mode.</span></span>|[<span data-ttu-id="88a85-329">Alterar o modo de disponibilidade de uma réplica de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-329">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="88a85-330">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="88a85-330">Related Tasks</span></span>  
 <span data-ttu-id="88a85-331">**Para ajustar votos de quorum**</span><span class="sxs-lookup"><span data-stu-id="88a85-331">**To adjust quorum votes**</span></span>  
  
-   [<span data-ttu-id="88a85-332">Exibir configurações de NodeWeight de quorum do cluster</span><span class="sxs-lookup"><span data-stu-id="88a85-332">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="88a85-333">Definir configurações de NodeWeight de quorum do cluster</span><span class="sxs-lookup"><span data-stu-id="88a85-333">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="88a85-334">Forçar um cluster WSFC para iniciar sem um quorum</span><span class="sxs-lookup"><span data-stu-id="88a85-334">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
 <span data-ttu-id="88a85-335">**Failover manual planejado:**</span><span class="sxs-lookup"><span data-stu-id="88a85-335">**Planned manual failover:**</span></span>  
  
-   [<span data-ttu-id="88a85-336">Executar um failover manual planejado de um grupo de disponibilidade &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-336">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="88a85-337">Usar o Assistente de Grupo de Disponibilidade de Failover &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-337">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
 <span data-ttu-id="88a85-338">**Para solucionar problemas:**</span><span class="sxs-lookup"><span data-stu-id="88a85-338">**To troubleshoot:**</span></span>  
  
-   [<span data-ttu-id="88a85-339">Solucionar problemas de Grupos de Disponibilidade AlwaysOn &#40;de configuração SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-339">Troubleshoot AlwaysOn Availability Groups Configuration &#40;SQL Server&#41;</span></span>](troubleshoot-always-on-availability-groups-configuration-sql-server.md) 
  
-   [<span data-ttu-id="88a85-340">Solucionar problemas de uma operação de adição de arquivo com falha &#40;Grupos de Disponibilidade AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="88a85-340">Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;</span></span>](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="88a85-341">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="88a85-341">Related Content</span></span>  
  
-   <span data-ttu-id="88a85-342">**Blogs:**</span><span class="sxs-lookup"><span data-stu-id="88a85-342">**Blogs:**</span></span>  
  
     [<span data-ttu-id="88a85-343">Blogs da equipe do SQL Server AlwaysOn: o blog oficial da equipe do SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="88a85-343">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="88a85-344">Blogs dos engenheiros do CSS SQL Server</span><span class="sxs-lookup"><span data-stu-id="88a85-344">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="88a85-345">**Whitepapers:**</span><span class="sxs-lookup"><span data-stu-id="88a85-345">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="88a85-346">Guia de soluções AlwaysOn do Microsoft SQL Server para alta disponibilidade e recuperação de desastre</span><span class="sxs-lookup"><span data-stu-id="88a85-346">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="88a85-347">White papers da Microsoft para SQL Server 2012</span><span class="sxs-lookup"><span data-stu-id="88a85-347">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="88a85-348">White papers da equipe de consultoria do cliente do SQL Server</span><span class="sxs-lookup"><span data-stu-id="88a85-348">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="88a85-349">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="88a85-349">See Also</span></span>  
 <span data-ttu-id="88a85-350">[Visão geral do Grupos de Disponibilidade AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="88a85-350">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="88a85-351">[Modos de disponibilidade &#40;Grupos de Disponibilidade AlwaysOn&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="88a85-351">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="88a85-352">[Failover e modos de failover &#40;Grupos de Disponibilidade AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="88a85-352">[Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="88a85-353">[Sobre o acesso de conexão de cliente a réplicas de disponibilidade &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="88a85-353">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="88a85-354">[Monitoramento de grupos de disponibilidade &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="88a85-354">[Monitoring of Availability Groups &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="88a85-355">WSFC &#40;Windows Server Failover Clustering&#41; com o SQL Server</span><span class="sxs-lookup"><span data-stu-id="88a85-355">Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server</span></span>](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)  
  
  
