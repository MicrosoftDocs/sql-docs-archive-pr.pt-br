---
title: Opção de configuração de servidor affinity mask | Microsoft Docs
ms.custom: ''
ms.date: 10/20/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- default affinity mask option
- reloading processor cache
- processor cache [SQL Server]
- CPU [SQL Server], licensing
- deferred process call
- affinity mask option
- processor affinity [SQL Server]
- SMP
- DPC
ms.assetid: 5823ba29-a75d-4b3e-ba7b-421c07ab3ac1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: dfebde8a9431026e8faedb2a1e76eb2f2d82e207
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87575356"
---
# <a name="affinity-mask-server-configuration-option"></a><span data-ttu-id="d7cc3-102">Opção affinity mask de configuração de servidor</span><span class="sxs-lookup"><span data-stu-id="d7cc3-102">affinity mask Server Configuration Option</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureDontUse](../../includes/ssnotedepfuturedontuse-md.md)] <span data-ttu-id="d7cc3-103">Em vez disso, use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d7cc3-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) instead.</span></span>  
  
 <span data-ttu-id="d7cc3-104">Para realizar multitarefas, o [!INCLUDE[msCoName](../../includes/msconame-md.md)] , às vezes, movem threads de processos entre processadores diferentes.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-104">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sometimes move process threads among different processors.</span></span> <span data-ttu-id="d7cc3-105">Embora eficiente de um ponto de vista de sistema operacional, essa atividade pode reduzir o desempenho do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sob cargas de sistema pesadas, à medida que cada cache de processador é recarregado repetidamente com dados.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-105">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="d7cc3-106">Atribuir processadores a threads específicos poderá melhorar o desempenho nessas condições eliminando recargas de processador e reduzindo a migração de thread entre processadores (reduzindo portanto a alternância de contexto); tal associação entre um thread e um processador é chamada de afinidade do processador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-106">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads and reducing thread migration across processors (thereby reducing context switching); such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="d7cc3-107">dá suporte à afinidade de processador por meio de duas opções de máscara de afinidade: máscara de afinidade (também conhecida como **máscara de afinidade de CPU**) e máscara de e/s de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-107">supports processor affinity by means of two affinity mask options: affinity mask (also known as **CPU affinity mask**) and affinity I/O mask.</span></span> <span data-ttu-id="d7cc3-108">Para obter mais informações sobre a opção de máscara de opção de E/S de afinidade, veja [Opção de configuração de servidor de máscara de entrada/saída de afinidade](affinity-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="d7cc3-108">For more information on the affinity I/O maskoption, see [affinity Input-Output mask Server Configuration Option](affinity-input-output-mask-server-configuration-option.md).</span></span> <span data-ttu-id="d7cc3-109">O suporte para afinidade de CPU e E/S em servidores com 33 a 64 processadores exige o uso adicional da [Opção de configuração de servidor de máscara affinity64](affinity64-mask-server-configuration-option.md) e [Opção de configuração de servidor de máscara de entrada/saída affinity64](affinity64-input-output-mask-server-configuration-option.md), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-109">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md), respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d7cc3-110">O suporte à afinidade para servidores com 33 a 64 processadores só está disponível em sistemas operacionais de 64 bits.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-110">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="d7cc3-111">A opção de máscara de afinidade, que existia nas versões anteriores do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], controla dinamicamente a afinidade de CPU.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-111">The affinity mask option, which existed in earlier releases of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], dynamically controls CPU affinity.</span></span>  
  
 <span data-ttu-id="d7cc3-112">No [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a opção de máscara de afinidade pode ser configurada sem a necessidade de reiniciar a instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7cc3-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the affinity mask option can be configured without requiring a restart of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d7cc3-113">Ao usar sp_configure, você deve executar RECONFIGURE ou RECONFIGURE WITH OVERRIDE depois de definir uma opção de configuração.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-113">When you are using sp_configure, you must run either RECONFIGURE or RECONFIGURE WITH OVERRIDE after setting a configuration option.</span></span> <span data-ttu-id="d7cc3-114">Quando você estiver usando o [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], e a opção de máscara de afinidade for alterada, isso não exigirá uma reinicialização.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-114">When you are using [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], changing the affinity mask option does require a restart.</span></span>  
  
 <span data-ttu-id="d7cc3-115">As alterações nas máscaras de afinidade ocorrem dinamicamente, permitindo a inicialização e o encerramento sob demanda dos agendadores de CPU que associam threads de processo ao [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7cc3-115">Changes to the affinity masks occur dynamically, allowing for on-demand startup and shutdown of the CPU schedulers that bind process threads within [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d7cc3-116">Isso pode ocorrer enquanto são feitas alterações nas condições do servidor.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-116">This can occur as conditions change on the server.</span></span> <span data-ttu-id="d7cc3-117">Por exemplo, se uma instância nova do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] for adicionada ao servidor, talvez seja necessário fazer ajustes na opção de máscara de afinidade para redistribuição da carga do processador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-117">For example, if a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is added to the server, it may be necessary to make adjustments to the affinity mask option to redistribute processor load.</span></span>  
  
 <span data-ttu-id="d7cc3-118">Modificações em bitmasks de afinidade requerem o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para habilitar um novo agendador de CPU e desabilitar o agendador de CPU existente.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-118">Modifications to the affinity bitmasks require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to enable a new CPU scheduler and disable the existing CPU scheduler.</span></span> <span data-ttu-id="d7cc3-119">Novos lotes podem então ser processados nos agendadores novos ou restantes.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-119">New batches can then be processed on the new or remaining schedulers.</span></span>  
  
 <span data-ttu-id="d7cc3-120">Para iniciar um novo agendador de CPU, o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cria um novo agendador e o adiciona à lista de agendadores padrão.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-120">To start a new CPU scheduler, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates a new scheduler and adds it to the list of its standard schedulers.</span></span> <span data-ttu-id="d7cc3-121">O novo agendador só é considerado para os novos lotes de entrada.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-121">The new scheduler is considered only for the new incoming batches.</span></span> <span data-ttu-id="d7cc3-122">Os lotes atuais continuam sendo executados no mesmo agendador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-122">Current batches continue to run on the same scheduler.</span></span> <span data-ttu-id="d7cc3-123">Os trabalhadores migram para o agendador novo à medida que ficam livres, ou enquanto os novos trabalhadores são criados.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-123">The workers migrate to the new scheduler as they free up, or as new workers are created.</span></span>  
  
 <span data-ttu-id="d7cc3-124">Desligar um agendador requer que todos os lotes no agendador tenham concluído suas atividades e sejam encerrados.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-124">Shutting down a scheduler requires all batches on the scheduler to complete their activities and exit.</span></span> <span data-ttu-id="d7cc3-125">Um agendador que foi encerrado é marcado como offline, de forma que nenhum lote novo seja agendado nele.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-125">A scheduler that has been shut down is marked as offline so that no new batch is scheduled on it.</span></span>  
  
 <span data-ttu-id="d7cc3-126">Se um agendador novo for adicionado ou removido, as tarefas permanentes do sistema, como lockmonitor, ponto de verificação, thread de tarefa de sistema (processando DTC) e processo de sinal continuarão sendo executadas no agendador enquanto o servidor estiver em operação.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-126">Whether a new scheduler is added or removed, the permanent system tasks such as lockmonitor, checkpoint, system task thread (processing DTC), and signal process continue to run on the scheduler while the server is operational.</span></span> <span data-ttu-id="d7cc3-127">Essas tarefas permanentes de sistema não são migradas dinamicamente.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-127">These permanent system tasks do not dynamically migrate.</span></span> <span data-ttu-id="d7cc3-128">Para redistribuir a carga de processador para essas tarefas de sistema pelos agendadores, será necessário reinicializar a instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d7cc3-128">To redistribute processor load for these system tasks across schedulers, it is necessary to restart the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="d7cc3-129">Se o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tentar encerrar um agendador associado a uma tarefa permanente de sistema, a tarefa continuará sendo executada no agendador offline (sem migração).</span><span class="sxs-lookup"><span data-stu-id="d7cc3-129">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attempts to shut down a scheduler associated with a permanent system task, the task continues to run on the offline scheduler (no migration).</span></span> <span data-ttu-id="d7cc3-130">Esse agendador é associado aos processadores na máscara de afinidade modificada e não deverá colocar nenhuma carga no processador com o qual tinha afinidade antes da alteração.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-130">This scheduler is bound to the processors in the modified affinity mask and should not put any load on the processor it was affinitized with before the change.</span></span> <span data-ttu-id="d7cc3-131">A presença de agendadores offline adicionais não deve afetar de forma significativa a carga do sistema.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-131">Having extra offline schedulers, should not significantly affect the load of the system.</span></span> <span data-ttu-id="d7cc3-132">Se isso não acontecer, o servidor de banco de dados deverá ser reinicializado para reconfigurar essas tarefas.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-132">If this is not the case, a database server reboot is required to reconfigure these tasks.</span></span>  
  
 <span data-ttu-id="d7cc3-133">As tarefas de afinidade de E/S (como lazywriter e logwriter) são afetadas diretamente pela máscara de afinidade de E/S.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-133">The I/O affinity tasks (such as lazywriter and logwriter) are directly affected by the I/O affinity mask.</span></span> <span data-ttu-id="d7cc3-134">Se as tarefas lazywriter e logwriter não tiverem afinidade, elas seguirão as mesmas regras definidas para as outras tarefas permanentes, como lockmonitor ou ponto de verificação.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-134">If the lazywriter and logwriter tasks are not affinitized, they follow the same rules defined for the other permanent tasks such as lockmonitor or checkpoint.</span></span>  
  
 <span data-ttu-id="d7cc3-135">Para assegurar que a nova máscara de afinidade seja válida, o comando RECONFIGURE verifica se as afinidades de CPU e E/S normais são mutuamente exclusivas.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-135">To ensure that the new affinity mask is valid, the RECONFIGURE command verifies that the normal CPU and I/O affinities are mutually exclusive.</span></span> <span data-ttu-id="d7cc3-136">Se esse não for o caso, uma mensagem de erro será reportada à sessão do cliente e ao log de erros do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , indicando que essa configuração não é recomendada.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-136">If this is not the case, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, indicating that such a setting is not recommended.</span></span> <span data-ttu-id="d7cc3-137">A execução das opções RECONFIGURE WITH OVERRIDE permite afinidades de CPU e E/S que não sejam mutuamente exclusivas.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-137">Running RECONFIGURE WITH OVERRIDE options allows CPU and I/O affinities that are not mutually exclusive.</span></span>  
  
 <span data-ttu-id="d7cc3-138">Se você especificar uma máscara de afinidade que tenta fazer mapeamento para uma CPU inexistente, o comando RECONFIGURE reportará uma mensagem de erro à sessão do cliente e ao log de erros do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d7cc3-138">If you specify an affinity mask that attempts to map to a nonexistent CPU, the RECONFIGURE command reports an error message to both the client session and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="d7cc3-139">O uso da opção RECONFIGURE WITH OVERRIDE não tem nenhum efeito nesse caso, e o mesmo erro de configuração é reportado novamente.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-139">Using the RECONFIGURE WITH OVERRIDE option has no effect in this case, and the same configuration error is reported again.</span></span>  
  
 <span data-ttu-id="d7cc3-140">Você também pode excluir atividade do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] de processadores com atribuições de carga de trabalho específicas aos sistemas operacionais Windows 2000 ou Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-140">You can also exclude [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] activity from processors assigned specific workload assignments by the Windows 2000 or Windows Server 2003 operating system.</span></span> <span data-ttu-id="d7cc3-141">Se você definir um bit representando um processador como 1, esse processador será selecionado pelo Mecanismo de Banco de Dados do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para atribuição de thread.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-141">If you set a bit representing a processor to 1, that processor is selected by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine for thread assignment.</span></span> <span data-ttu-id="d7cc3-142">Quando você define `affinity mask` como 0 (o padrão), os algoritmos de agendamento do Microsoft windows 2000 ou do Windows Server 2003 definem a afinidade do thread.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-142">When you set `affinity mask` to 0 (the default), the Microsoft Windows 2000 or Windows Server 2003 scheduling algorithms set the thread's affinity.</span></span> <span data-ttu-id="d7cc3-143">Quando você define a `affinity mask` como qualquer valor diferente de zero, a afinidade do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] interpreta o valor como um bitmask que especifica esses processadores qualificados para seleção.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-143">When you set `affinity mask` to any nonzero value, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] affinity interprets the value as a bitmask that specifies those processors eligible for selection.</span></span>  
  
 <span data-ttu-id="d7cc3-144">Ao isolar threads do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] da execução em determinados processadores, o Microsoft Windows 2000 ou o Windows Server 2003 pode avaliar melhor como o sistema está controlando os processos específicos do Windows.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-144">By segregating [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads from running on particular processors, Microsoft Windows 2000 or Windows Server 2003 can better evaluate the system's handling of processes specific to Windows.</span></span> <span data-ttu-id="d7cc3-145">Por exemplo, em um servidor de 8 CPUs que executa duas instâncias do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instâncias A e B), o administrador do sistema poderia usar a opção de máscara de afinidade para atribuir o primeiro conjunto de 4 CPUs à instância A e o segundo conjunto de 4 CPUs à instância B. Para configurar mais de 32 processadores, defina a máscara de afinidade e a máscara de afinidade64.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-145">For example, on an 8-CPU server running two instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instance A and B), the system administrator could use the affinity mask option to assign the first set of 4 CPUs to instance A and the second set of 4 to instance B. To configure more than 32 processors, set both the affinity mask and the affinity64 mask.</span></span> <span data-ttu-id="d7cc3-146">Os valores para `affinity mask` são os seguintes:</span><span class="sxs-lookup"><span data-stu-id="d7cc3-146">The values for `affinity mask` are as follows:</span></span>  
  
-   <span data-ttu-id="d7cc3-147">Uma `affinity mask` de 1 byte abrange até 8 CPUs em um computador multiprocessador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-147">A one-byte `affinity mask` covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="d7cc3-148">Uma `affinity mask` de 2 bytes abrange até 16 CPUs em um computador multiprocessador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-148">A two-byte `affinity mask` covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="d7cc3-149">Uma `affinity mask` de 3 bytes abrange até 24 CPUs em um computador multiprocessador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-149">A three-byte `affinity mask` covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="d7cc3-150">Uma `affinity mask` de 4 bytes abrange até 32 CPUs em um computador multiprocessador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-150">A four-byte `affinity mask` covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="d7cc3-151">Para incluir mais de 32 CPUs, configure uma máscara de afinidade de 4 bytes para as primeiras 32 CPUs e uma máscara de afinidade64 de quatro bytes para as demais CPUs.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-151">To cover more than 32 CPUs, configure a four-byte affinity mask for the first 32 CPUs and up to a four-byte affinity64 mask for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="d7cc3-152">Como definir a opção de afinidade de processador do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] é uma operação especializada, recomenda-se que ela só seja usada quando necessário.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-152">Because setting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] processor affinity is a specialized operation, it is recommended that it be used only when necessary.</span></span> <span data-ttu-id="d7cc3-153">Na maioria dos casos, a afinidade padrão do Microsoft Windows 2000 ou Windows Server 2003 proporciona o melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-153">In most cases, the Microsoft Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span> <span data-ttu-id="d7cc3-154">Você também deve considerar os requisitos de CPU para outros aplicativos quando definir as máscaras de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-154">You should also consider the CPU requirements for other applications when setting the affinity masks.</span></span> <span data-ttu-id="d7cc3-155">Para obter mais informações, consulte a documentação do sistema operacional Windows.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-155">For more information, see your Windows operating system documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d7cc3-156">Você pode usar o Windows System Monitor para exibir e analisar o uso individual de processador.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-156">You can use the Windows System Monitor to view and analyze individual processor usage.</span></span>  
  
 <span data-ttu-id="d7cc3-157">Ao especificar a opção de máscara de afinidade de E/S, você deverá usá-la em conjunto com a opção de configuração de máscara de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-157">When specifying the affinity I/O mask option, you must use it in connection with the affinity mask configuration option.</span></span> <span data-ttu-id="d7cc3-158">Não habilite a mesma CPU na opção de `affinity mask` e na opção de máscara de E/S de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-158">Do not enable the same CPU in both the `affinity mask` switch and the affinity I/O mask option.</span></span> <span data-ttu-id="d7cc3-159">Os bits correspondentes em cada CPU devem estar em um destes três estados:</span><span class="sxs-lookup"><span data-stu-id="d7cc3-159">The bits corresponding to each CPU should be in one of these three states:</span></span>  
  
-   <span data-ttu-id="d7cc3-160">0 na opção de máscara de afinidade e na opção de máscara de afinidade de E/S.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-160">0 in both the affinity mask option and the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="d7cc3-161">1 na opção de máscara de afinidade e 0 na opção de máscara de E/S de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-161">1 in the affinity mask option and 0 in the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="d7cc3-162">0 na opção de máscara de afinidade e 1 na opção de máscara de E/S de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-162">0 in the affinity mask option and 1 in the affinity I/O mask option.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="d7cc3-163">Não configure afinidade de CPU no sistema operacional Windows e também configure a máscara de afinidade em [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7cc3-163">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d7cc3-164">Essas definições estão tentando alcançar o mesmo resultado e se as configurações forem inconsistentes, você poderá ter resultados imprevisíveis.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-164">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="d7cc3-165">Você poderá configurar melhor a afinidade de CPU no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]com a opção sp_configure.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-165">CPU affinity is best configured using the sp_configure option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="example"></a><span data-ttu-id="d7cc3-166">Exemplo</span><span class="sxs-lookup"><span data-stu-id="d7cc3-166">Example</span></span>  
 <span data-ttu-id="d7cc3-167">Como exemplo de configuração da opção de máscara de afinidade, se os processadores 1, 2 e 5 forem selecionados como disponíveis com os bits 1, 2 e 5 definidos como 1 e os bits 0, 3, 4, 6 e 7 definidos como 0, um valor hexadecimal de 0x26 ou o decimal equivalente de `38` será especificado.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-167">As an example of setting the affinity mask option, if processors 1, 2, and 5 are selected as available with bits 1, 2, and 5 set to 1 and bits 0, 3, 4, 6, and 7 set to 0, a hexadecimal value of 0x26 or the decimal equivalent of `38` is specified.</span></span> <span data-ttu-id="d7cc3-168">Numere os bits da direita para a esquerda.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-168">Number the bits from right to left.</span></span> <span data-ttu-id="d7cc3-169">A opção de máscara de afinidade inicia a contagem de processadores de 0 a 31, de forma que no exemplo a seguir o contador `1` represente o segundo processador no servidor.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-169">The affinity mask option starts counting processors from 0 to 31, so that in the following example the counter `1` represents the second processor on the server.</span></span>  
  
```  
sp_configure 'show advanced options', 1;  
RECONFIGURE;  
GO  
sp_configure 'affinity mask', 38;  
RECONFIGURE;  
GO  
```  
  
 <span data-ttu-id="d7cc3-170">Estes são valores da `affinity mask` para um sistema de 8 CPUs.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-170">These are `affinity mask` values for an 8-CPU system.</span></span>  
  
|<span data-ttu-id="d7cc3-171">Valor decimal</span><span class="sxs-lookup"><span data-stu-id="d7cc3-171">Decimal value</span></span>|<span data-ttu-id="d7cc3-172">Máscara de bit binário</span><span class="sxs-lookup"><span data-stu-id="d7cc3-172">Binary bit mask</span></span>|<span data-ttu-id="d7cc3-173">Permite threads do SQL Server em processadores</span><span class="sxs-lookup"><span data-stu-id="d7cc3-173">Allow SQL Server threads on processors</span></span>|  
|-------------------|---------------------|--------------------------------------------|  
|<span data-ttu-id="d7cc3-174">1</span><span class="sxs-lookup"><span data-stu-id="d7cc3-174">1</span></span>|<span data-ttu-id="d7cc3-175">00000001</span><span class="sxs-lookup"><span data-stu-id="d7cc3-175">00000001</span></span>|<span data-ttu-id="d7cc3-176">0</span><span class="sxs-lookup"><span data-stu-id="d7cc3-176">0</span></span>|  
|<span data-ttu-id="d7cc3-177">3</span><span class="sxs-lookup"><span data-stu-id="d7cc3-177">3</span></span>|<span data-ttu-id="d7cc3-178">00000011</span><span class="sxs-lookup"><span data-stu-id="d7cc3-178">00000011</span></span>|<span data-ttu-id="d7cc3-179">0 e 1</span><span class="sxs-lookup"><span data-stu-id="d7cc3-179">0 and 1</span></span>|  
|<span data-ttu-id="d7cc3-180">7</span><span class="sxs-lookup"><span data-stu-id="d7cc3-180">7</span></span>|<span data-ttu-id="d7cc3-181">00000111</span><span class="sxs-lookup"><span data-stu-id="d7cc3-181">00000111</span></span>|<span data-ttu-id="d7cc3-182">0, 1 e 2</span><span class="sxs-lookup"><span data-stu-id="d7cc3-182">0, 1, and 2</span></span>|  
|<span data-ttu-id="d7cc3-183">15</span><span class="sxs-lookup"><span data-stu-id="d7cc3-183">15</span></span>|<span data-ttu-id="d7cc3-184">00001111</span><span class="sxs-lookup"><span data-stu-id="d7cc3-184">00001111</span></span>|<span data-ttu-id="d7cc3-185">0, 1, 2 e 3</span><span class="sxs-lookup"><span data-stu-id="d7cc3-185">0, 1, 2, and 3</span></span>|  
|<span data-ttu-id="d7cc3-186">31</span><span class="sxs-lookup"><span data-stu-id="d7cc3-186">31</span></span>|<span data-ttu-id="d7cc3-187">00011111</span><span class="sxs-lookup"><span data-stu-id="d7cc3-187">00011111</span></span>|<span data-ttu-id="d7cc3-188">0, 1, 2, 3 e 4</span><span class="sxs-lookup"><span data-stu-id="d7cc3-188">0, 1, 2, 3, and 4</span></span>|  
|<span data-ttu-id="d7cc3-189">63</span><span class="sxs-lookup"><span data-stu-id="d7cc3-189">63</span></span>|<span data-ttu-id="d7cc3-190">00111111</span><span class="sxs-lookup"><span data-stu-id="d7cc3-190">00111111</span></span>|<span data-ttu-id="d7cc3-191">0, 1, 2, 3, 4 e 5</span><span class="sxs-lookup"><span data-stu-id="d7cc3-191">0, 1, 2, 3, 4, and 5</span></span>|  
|<span data-ttu-id="d7cc3-192">127</span><span class="sxs-lookup"><span data-stu-id="d7cc3-192">127</span></span>|<span data-ttu-id="d7cc3-193">01111111</span><span class="sxs-lookup"><span data-stu-id="d7cc3-193">01111111</span></span>|<span data-ttu-id="d7cc3-194">0, 1, 2, 3, 4, 5 e 6</span><span class="sxs-lookup"><span data-stu-id="d7cc3-194">0, 1, 2, 3, 4, 5, and 6</span></span>|  
|<span data-ttu-id="d7cc3-195">255</span><span class="sxs-lookup"><span data-stu-id="d7cc3-195">255</span></span>|<span data-ttu-id="d7cc3-196">11111111</span><span class="sxs-lookup"><span data-stu-id="d7cc3-196">11111111</span></span>|<span data-ttu-id="d7cc3-197">0, 1, 2, 3, 4, 5, 6 e 7</span><span class="sxs-lookup"><span data-stu-id="d7cc3-197">0, 1, 2, 3, 4, 5, 6, and 7</span></span>|  
  
 <span data-ttu-id="d7cc3-198">A opção de máscara de afinidade é uma opção avançada.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-198">The affinity mask option is an advanced option.</span></span> <span data-ttu-id="d7cc3-199">Se você estiver usando o procedimento armazenado do sistema sp_configure para alterar a configuração, poderá alterar `affinity mask` somente quando **Mostrar opções avançadas** estiver definido como 1.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-199">If you are using the sp_configure system stored procedure to change the setting, you can change `affinity mask` only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="d7cc3-200">Após executar o comando RECONFIGURE de [!INCLUDE[tsql](../../includes/tsql-md.md)] , a nova configuração terá efeito imediatamente sem a necessidade de reiniciar a instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d7cc3-200">After executing the [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, the new setting takes effect immediately without requiring a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
## <a name="non-uniform-memory-access-numa"></a><span data-ttu-id="d7cc3-201">Acesso de memória não uniforme (NUMA)</span><span class="sxs-lookup"><span data-stu-id="d7cc3-201">Non-uniform Memory Access (NUMA)</span></span>  
 <span data-ttu-id="d7cc3-202">Ao usar hardware baseado em NUMA com a máscara de afinidade definida, todo agendador em um nó terá uma afinidade com sua própria CPU.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-202">When using hardware based non-uniform memory access (NUMA) and the affinity mask is set, every scheduler in a node will be affinitized to its own CPU.</span></span> <span data-ttu-id="d7cc3-203">Quando a máscara de afinidade não estiver definida, cada agendador terá uma afinidade com o grupo de CPUs dentro do nó NUMA e um agendador mapeado para o nó NUMA N1 poderá agendar trabalho em qualquer CPU no nó, mas não em CPUs associadas a outro nó.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-203">When the affinity mask is not set, each scheduler is affinitized to the group of CPUs within the NUMA node and a scheduler mapped to NUMA node N1 can schedule work on any CPU in the node, but not on CPUs associated with another node.</span></span>  
  
 <span data-ttu-id="d7cc3-204">Qualquer operação sendo executada em um único nó NUMA só poderá usar páginas de buffer daquele nó.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-204">Any operation running on a single NUMA node can only use buffer pages from that node.</span></span> <span data-ttu-id="d7cc3-205">Quando uma operação é executada paralelamente nas CPUs a partir de vários nós, a memória poderá ser usada a partir de qualquer nó envolvido.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-205">When an operation is run in parallel on CPUs from multiple nodes, memory can be used from any node involved.</span></span>  
  
## <a name="licensing-issues"></a><span data-ttu-id="d7cc3-206">Problemas de licenciamento</span><span class="sxs-lookup"><span data-stu-id="d7cc3-206">Licensing Issues</span></span>  
 <span data-ttu-id="d7cc3-207">A afinidade dinâmica é restrita com rigor pelo licenciamento de CPU.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-207">Dynamic affinity is tightly constrained by CPU licensing.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="d7cc3-208">não permite nenhuma configuração de opções de máscara de afinidade que viole a política de licenciamento.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-208">does not allow any configuration of affinity mask options that violates the licensing policy.</span></span>  
  
### <a name="startup"></a><span data-ttu-id="d7cc3-209">Inicialização</span><span class="sxs-lookup"><span data-stu-id="d7cc3-209">Startup</span></span>  
 <span data-ttu-id="d7cc3-210">Se uma máscara de afinidade especificada violar a política de licenciamento durante a inicialização do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ou durante a anexação do banco de dados, a camada do mecanismo concluirá o processo de inicialização ou a operação de anexação/restauração do banco de dados e depois redefinirá o valor de execução de sp_configure da máscara de afinidade como zero, emitindo uma mensagem de erro para o log de erros do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d7cc3-210">If a specified affinity mask violates the licensing policy during [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] startup or during database attach, the engine layer will complete the startup process or database attach/restore operation, and then it will reset the sp_configure run value for the affinity mask to zero, issuing an error message to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span>  
  
### <a name="reconfigure"></a><span data-ttu-id="d7cc3-211">Reconfigurar</span><span class="sxs-lookup"><span data-stu-id="d7cc3-211">Reconfigure</span></span>  
 <span data-ttu-id="d7cc3-212">Se uma máscara de afinidade especificada violar a política de licenciamento ao executar o comando RECONFIGURE de [!INCLUDE[tsql](../../includes/tsql-md.md)] , uma mensagem de erro será reportada à sessão do cliente e ao log de erros do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] e o administrador do banco de dados terá que reconfigurar a máscara de afinidade.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-212">If a specified affinity mask violates the licensing policy when running [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, requiring the database administrator to reconfigure the affinity mask.</span></span> <span data-ttu-id="d7cc3-213">Nenhum comando RECONFIGURE WITH OVERRIDE é aceito nesse caso.</span><span class="sxs-lookup"><span data-stu-id="d7cc3-213">No RECONFIGURE WITH OVERRIDE command is accepted in this case.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d7cc3-214">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="d7cc3-214">See Also</span></span>  
 <span data-ttu-id="d7cc3-215">[Monitorar o uso de recursos &#40;Monitor do Sistema&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="d7cc3-215">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="d7cc3-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d7cc3-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="d7cc3-217">[Opções de configuração do servidor &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d7cc3-217">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 <span data-ttu-id="d7cc3-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d7cc3-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span></span>  
 [<span data-ttu-id="d7cc3-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d7cc3-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
