---
title: Transações em tabelas com otimização de memória | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 2cd07d26-a1f1-4034-8d6f-f196eed1b763
author: stevestein
ms.author: sstein
ms.openlocfilehash: bc9109c7243e609e5ddd820b61386183761167bf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685882"
---
# <a name="transactions-in-memory-optimized-tables"></a><span data-ttu-id="2c448-102">Transações em tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="2c448-102">Transactions in Memory-Optimized Tables</span></span>
  <span data-ttu-id="2c448-103">O controle de versão de linha em tabelas baseadas em disco (usando o isolamento SNAPSHOT ou READ_COMMITTED_SNAPSHOT) fornece um formulário de controle de simultaneidade otimista.</span><span class="sxs-lookup"><span data-stu-id="2c448-103">Row versioning on disk-based tables (using SNAPSHOT isolation or READ_COMMITTED_SNAPSHOT) provides a form of optimistic concurrency control.</span></span> <span data-ttu-id="2c448-104">Os leitores e gravadores não bloqueiam um ao outro.</span><span class="sxs-lookup"><span data-stu-id="2c448-104">Readers and writers do not block each other.</span></span> <span data-ttu-id="2c448-105">Com as tabelas com otimização de memória, gravadores não bloqueiam gravadores.</span><span class="sxs-lookup"><span data-stu-id="2c448-105">With memory-optimized tables, writers do not block writers.</span></span> <span data-ttu-id="2c448-106">Com o controle de versão de linha em tabelas baseadas em disco, uma transação bloqueia a linha e as transações simultâneas que tentassem atualizar a linha estariam bloqueadas.</span><span class="sxs-lookup"><span data-stu-id="2c448-106">With row versioning on disk-based tables, one transaction locks the row and concurrent transactions attempting to update the row are blocked.</span></span> <span data-ttu-id="2c448-107">Não há bloqueio com tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-107">There is no locking with memory-optimized tables.</span></span> <span data-ttu-id="2c448-108">Em vez disso, se duas transações tentassem atualizar a mesma linha, ocorreria um conflito de gravação/gravação (erro 41302).</span><span class="sxs-lookup"><span data-stu-id="2c448-108">Instead, if two transactions attempt to update the same row, a write/write conflict (error 41302) will occur.</span></span>

 <span data-ttu-id="2c448-109">Ao contrário das tabelas baseadas em disco, as tabelas com otimização de memória permitem o controle de simultaneidade otimista com os níveis de isolamento mais altos, REPEATABLE READ e SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="2c448-109">Unlike disk-based tables, memory-optimized tables allow optimistic concurrency control with the higher isolation levels, REPEATABLE READ and SERIALIZABLE.</span></span> <span data-ttu-id="2c448-110">Os bloqueios não são aplicados para impor os níveis de isolamento.</span><span class="sxs-lookup"><span data-stu-id="2c448-110">Locks are not taken to enforce the isolation levels.</span></span> <span data-ttu-id="2c448-111">Em vez disso, no final da transação, uma validação assegura as suposições de serialização ou leitura repetida.</span><span class="sxs-lookup"><span data-stu-id="2c448-111">Instead, at the end of the transaction validation ensures the repeatable read or serializability assumptions.</span></span> <span data-ttu-id="2c448-112">Se as suposições forem violadas, a transação será encerrada.</span><span class="sxs-lookup"><span data-stu-id="2c448-112">If the assumptions are violated, the transaction is terminated.</span></span> <span data-ttu-id="2c448-113">Para obter mais informações, consulte [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span><span class="sxs-lookup"><span data-stu-id="2c448-113">For more information, see [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span></span>

 <span data-ttu-id="2c448-114">As semânticas de transação importantes para tabelas com otimização de memória são:</span><span class="sxs-lookup"><span data-stu-id="2c448-114">The important transaction semantics for memory-optimized tables are:</span></span>

-   <span data-ttu-id="2c448-115">Controle de várias versões</span><span class="sxs-lookup"><span data-stu-id="2c448-115">Multi-versioning</span></span>

-   <span data-ttu-id="2c448-116">Isolamento de transação com base em instantâneo</span><span class="sxs-lookup"><span data-stu-id="2c448-116">Snapshot-based transaction isolation</span></span>

-   <span data-ttu-id="2c448-117">Otimistas</span><span class="sxs-lookup"><span data-stu-id="2c448-117">Optimistic</span></span>

-   <span data-ttu-id="2c448-118">Detecção de conflitos</span><span class="sxs-lookup"><span data-stu-id="2c448-118">Conflict detection</span></span>

 <span data-ttu-id="2c448-119">Cada uma dessas semânticas é explicada nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="2c448-119">Each of these semantics is explained in the following sections.</span></span>

## <a name="multi-versioning-in-memory-optimized-tables"></a><span data-ttu-id="2c448-120">Controle de várias versões em tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="2c448-120">Multi-Versioning in Memory-Optimized Tables</span></span>
 <span data-ttu-id="2c448-121">As linhas em tabelas com otimização de memória podem ter versões diferentes.</span><span class="sxs-lookup"><span data-stu-id="2c448-121">Rows in memory-optimized tables can have different versions.</span></span> <span data-ttu-id="2c448-122">As transações simultâneas possivelmente acessam versões diferentes da mesma linha.</span><span class="sxs-lookup"><span data-stu-id="2c448-122">Concurrent transactions access potentially different versions of the same row.</span></span>

 <span data-ttu-id="2c448-123">Os dados da tabela com otimização da memória são baseados em versão.</span><span class="sxs-lookup"><span data-stu-id="2c448-123">Memory-optimized table data is version-based.</span></span> <span data-ttu-id="2c448-124">Para qualquer linha pode haver diferentes versões de linha que são válidas em diferentes momentos.</span><span class="sxs-lookup"><span data-stu-id="2c448-124">For any row there may be different row versions that are valid at different points in time.</span></span> <span data-ttu-id="2c448-125">As tabelas baseadas em disco mantêm diferentes versões de linha quando READ_COMMITTED_SNAPSHOT ou ALLOW_SNAPSHOT_ISOLATION são definidos como ON.</span><span class="sxs-lookup"><span data-stu-id="2c448-125">Disk-based tables maintain different row versions when READ_COMMITTED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION is ON.</span></span> <span data-ttu-id="2c448-126">As tabelas com otimização de memória mantêm diferentes versões de linha, mesmo se READ_COMMITTED_SNAPSHOT e ALLOW_SNAPSHOT_ISOLATION estiverem OFF.</span><span class="sxs-lookup"><span data-stu-id="2c448-126">Memory-optimized tables maintain different row versions, even if READ_COMMITTED_SNAPSHOT and ALLOW_SNAPSHOT_ISOLATION are OFF.</span></span> <span data-ttu-id="2c448-127">As versões de linha das tabelas com otimização de memória não são mantidas em tempdb.</span><span class="sxs-lookup"><span data-stu-id="2c448-127">The row versions of memory-optimized tables are not maintained in tempdb.</span></span> <span data-ttu-id="2c448-128">Em vez disso, as versões de linha são mantidas embutidas, como parte das estruturas de dados com otimização de memória que armazenam as linhas na memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-128">Instead, the row versions are maintained in-line, as part of the memory-optimized data structures storing the rows in memory.</span></span>

## <a name="snapshot-based-transaction-isolation-for-memory-optimized-tables"></a><span data-ttu-id="2c448-129">Isolamento da transação com base em instantâneos para tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="2c448-129">Snapshot-Based Transaction Isolation for Memory-Optimized Tables</span></span>
 <span data-ttu-id="2c448-130">Todas as operações em uma única transação usam o mesmo instantâneo transacionalmente consistente das tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-130">All operations in a single transaction use the same transactionally-consistent snapshot of the memory-optimized tables.</span></span> <span data-ttu-id="2c448-131">Todo isolamento de transação para tabelas com otimização de memória se baseia em instantâneo.</span><span class="sxs-lookup"><span data-stu-id="2c448-131">All transaction isolation for memory-optimized tables is snapshot-based.</span></span> <span data-ttu-id="2c448-132">Por exemplo, uma transação que usa o nível de isolamento serializável para acessar tabelas com otimização de memória executará todas as operações no mesmo instantâneo transacionalmente consistente.</span><span class="sxs-lookup"><span data-stu-id="2c448-132">For example, a transaction using the serializable isolation level to access memory-optimized tables will perform all operations on the same transactionally consistent snapshot.</span></span>

 <span data-ttu-id="2c448-133">As transações que acessam tabelas com otimização de memória usam esse controle de versão de linha para obter um instantâneo transacionalmente consistente de linhas nas tabelas.</span><span class="sxs-lookup"><span data-stu-id="2c448-133">Transactions that access memory-optimized tables use this row versioning to obtain a transactionally consistent snapshot of the rows in the tables.</span></span> <span data-ttu-id="2c448-134">Os dados lidos por qualquer instrução na transação serão a versão transacionalmente consistente dos dados que existia no momento em que a transação foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="2c448-134">The data read by any statement in the transaction will be the transactionally consistent version of the data that existed at the time the transaction started.</span></span> <span data-ttu-id="2c448-135">Portanto, todas as modificações feitas pelas transações em execução simultaneamente não ficarão visíveis para instruções na transação atual.</span><span class="sxs-lookup"><span data-stu-id="2c448-135">Therefore, any modifications made by concurrently running transactions are not visible to statements in the current transaction.</span></span>

## <a name="optimistic-concurrency-control-for-memory-optimized-tables"></a><span data-ttu-id="2c448-136">Controle de simultaneidade otimista para tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="2c448-136">Optimistic Concurrency Control for Memory-Optimized Tables</span></span>
 <span data-ttu-id="2c448-137">Os conflitos e as falhas são raros e as transações em tabelas com otimização de memória supõem que não há conflitos com transações e operações simultâneas realizadas com êxito.</span><span class="sxs-lookup"><span data-stu-id="2c448-137">Conflicts and failures are rare and transactions on memory-optimized tables assume there are no conflicts with concurrent transactions and operations succeed.</span></span> <span data-ttu-id="2c448-138">As transações não utilizam bloqueios ou travas na tabela com otimização de memória para garantir o isolamento da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-138">Transactions do not take locks or latches on memory-optimized table to guarantee transaction isolation.</span></span> <span data-ttu-id="2c448-139">Os gravadores não bloqueiam leitores.</span><span class="sxs-lookup"><span data-stu-id="2c448-139">Writers do not block readers.</span></span> <span data-ttu-id="2c448-140">O gravadores não bloqueiam gravadores.</span><span class="sxs-lookup"><span data-stu-id="2c448-140">Writers do not block writers.</span></span> <span data-ttu-id="2c448-141">Em vez disso, as transações prosseguem sob a suposição (otimista) de que não haverá conflitos com outras transações.</span><span class="sxs-lookup"><span data-stu-id="2c448-141">Instead, transactions proceed under the (optimistic) assumption that there will be no conflicts with other transactions.</span></span> <span data-ttu-id="2c448-142">Não usar bloqueios e travas e não esperar outras transações para concluir o processamento das mesmas linhas melhora o desempenho.</span><span class="sxs-lookup"><span data-stu-id="2c448-142">Not using locks and latches and not waiting for other transactions to finish processing the same rows improves performance.</span></span>

 <span data-ttu-id="2c448-143">Além disso, se uma transação (TxA) ler linhas que foram inseridas ou modificadas por outra transação (TxB) que está no processo de confirmação, ela suporá, de forma otimista, que a outra transação será confirmada, em vez de aguardar que a confirmação ocorra.</span><span class="sxs-lookup"><span data-stu-id="2c448-143">In addition, if a transaction (TxA) reads rows that have been inserted or modified by another transaction (TxB) that is in the process of committing, it will optimistically assume the other transaction will commit rather than wait for the commit to occur.</span></span> <span data-ttu-id="2c448-144">Nesse caso, a transação TxA terá uma dependência de confirmação da transação TxB.</span><span class="sxs-lookup"><span data-stu-id="2c448-144">In this case, transaction TxA will take a commit dependency on transaction TxB.</span></span>

## <a name="conflict-detection-validation-and-commit-dependency-checks"></a><span data-ttu-id="2c448-145">Verificações de detecção de conflito, validação e dependência de confirmação</span><span class="sxs-lookup"><span data-stu-id="2c448-145">Conflict Detection, Validation, and Commit Dependency Checks</span></span>
 <span data-ttu-id="2c448-146">O [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detecta os conflitos entre transações simultâneas, bem como violações no nível de isolamento, e condenará uma das transações conflitantes.</span><span class="sxs-lookup"><span data-stu-id="2c448-146">[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detects conflicts between concurrent transactions, as well as isolation level violations, and will doom one of the conflicting transactions.</span></span> <span data-ttu-id="2c448-147">Essa transação precisará ser repetida.</span><span class="sxs-lookup"><span data-stu-id="2c448-147">This transaction will need to be retried.</span></span> <span data-ttu-id="2c448-148">(Para obter mais informações, consulte [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span><span class="sxs-lookup"><span data-stu-id="2c448-148">(For more information, see [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span></span>

 <span data-ttu-id="2c448-149">De modo otimista, o sistema supõe que não há conflitos nem violações de isolamento da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-149">The system optimistically assumes there are no conflicts and no violations of transaction isolation.</span></span> <span data-ttu-id="2c448-150">Se ocorrerem conflitos que possam causar inconsistências no banco de dados ou que possam violar o isolamento da transação, eles serão detectados e a transação será encerrada.</span><span class="sxs-lookup"><span data-stu-id="2c448-150">If any conflicts occur that may cause inconsistencies in the database or that may violate transaction isolation, these conflicts are detected, and the transaction is terminated.</span></span>

 <span data-ttu-id="2c448-151">Se um conflito for detectado, a transação será encerrada e o cliente precisará repetir.</span><span class="sxs-lookup"><span data-stu-id="2c448-151">If a conflict is detected, the transaction is terminated and the client needs to retry.</span></span>

 <span data-ttu-id="2c448-152">A tabela a seguir resume as condições de erro para transações que acessam tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-152">The following table summarizes the error conditions for transactions that accesses memory-optimized tables.</span></span>

### <a name="error-conditions-for-transactions-accessing-memory-optimized-tables"></a><span data-ttu-id="2c448-153">Condições de erro das transações que acessam tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-153">Error conditions for transactions accessing memory-optimized tables.</span></span>

|<span data-ttu-id="2c448-154">Erro</span><span class="sxs-lookup"><span data-stu-id="2c448-154">Error</span></span>|<span data-ttu-id="2c448-155">Cenário</span><span class="sxs-lookup"><span data-stu-id="2c448-155">Scenario</span></span>|
|-----------|--------------|
|<span data-ttu-id="2c448-156">Conflito de gravação.</span><span class="sxs-lookup"><span data-stu-id="2c448-156">Write conflict.</span></span> <span data-ttu-id="2c448-157">Tentando atualizar um registro que foi atualizado desde que a transação foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="2c448-157">Attempting to update a record that has been updated since the transaction started.</span></span>|<span data-ttu-id="2c448-158">ATUALIZAR ou EXCLUIR uma linha que foi atualizada ou excluída por uma transação simultânea.</span><span class="sxs-lookup"><span data-stu-id="2c448-158">UPDATE or DELETE a row that has been updated or deleted by a concurrent transaction.</span></span>|
|<span data-ttu-id="2c448-159">Falha de validação de leitura repetida.</span><span class="sxs-lookup"><span data-stu-id="2c448-159">Repeatable read validation failure.</span></span>|<span data-ttu-id="2c448-160">Uma linha que foi lida pela transação foi alterada (atualizada ou excluída) desde que a transação foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="2c448-160">A row that was read by the transaction has changed (updated or deleted) since the transaction started.</span></span> <span data-ttu-id="2c448-161">A validação de leitura repetida geralmente ocorre ao usar os níveis de isolamento da transação REPEATABLE READ e SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="2c448-161">Repeatable read validation is typically occurs when using REPEATABLE READ and SERIALIZABLE transaction isolation levels.</span></span>|
|<span data-ttu-id="2c448-162">Falha de validação serializável.</span><span class="sxs-lookup"><span data-stu-id="2c448-162">Serializable validation failure.</span></span>|<span data-ttu-id="2c448-163">Uma linha nova (fantasma) foi inserida em um dos intervalos de verificação na transação, desde que a transação foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="2c448-163">A new (phantom) row has been inserted in one of the scan ranges in the transaction, since the transaction started.</span></span> <span data-ttu-id="2c448-164">A linha estaria visível para a transação se a linha tivesse sido confirmada no banco de dados antes do início da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-164">The row would have been visible to the transaction if the row had been committed to the database before the transaction started.</span></span> <span data-ttu-id="2c448-165">A validação SERIALIZABLE normalmente ocorre ao usar o isolamento SERIALIZABLE e validar as restrições PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="2c448-165">SERIALIZABLE validation typically occurs when using SERIALIZABLE isolation and validating PRIMARY KEY constraints.</span></span>|
|<span data-ttu-id="2c448-166">Falha de dependência de confirmação.</span><span class="sxs-lookup"><span data-stu-id="2c448-166">Commit dependency failure.</span></span>|<span data-ttu-id="2c448-167">A transação obteve uma dependência em outra transação, que não foi confirmada, devido a uma das falhas nessa tabela, a uma condição de insuficiência de memória ou à falha de confirmação no log de transações.</span><span class="sxs-lookup"><span data-stu-id="2c448-167">The transaction took a dependency on another transaction that failed to commit, either due to one of the failures in this table, an out-of-memory condition, or due to failure to commit to the transaction log.</span></span> <span data-ttu-id="2c448-168">Essa falha pode ocorrer com transações de leitura/gravação e somente leitura.</span><span class="sxs-lookup"><span data-stu-id="2c448-168">This failure can occur with both read/write and read-only transactions.</span></span>|

### <a name="transaction-lifetime"></a><span data-ttu-id="2c448-169">Tempo de vida da transação</span><span class="sxs-lookup"><span data-stu-id="2c448-169">Transaction Lifetime</span></span>
 <span data-ttu-id="2c448-170">As falhas mencionadas na tabela anterior podem ocorrer em pontos diferentes durante a transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-170">The failures mentioned in the previous table can occur at different points during a transaction.</span></span> <span data-ttu-id="2c448-171">A figura a seguir ilustra as fases de uma transação que acessa tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-171">The following figure illustrates the phases of a transaction that accesses memory-optimized tables.</span></span>

 <span data-ttu-id="2c448-172">![Tempo de vida de uma transação.](../../2014/database-engine/media/hekaton-transactions.gif "Tempo de vida de uma transação.")</span><span class="sxs-lookup"><span data-stu-id="2c448-172">![Lifetime of a transaction.](../../2014/database-engine/media/hekaton-transactions.gif "Lifetime of a transaction.")</span></span>
<span data-ttu-id="2c448-173">Tempo de vida de uma transação que acessa tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-173">Lifetime of a transaction that accesses memory-optimized tables.</span></span>

#### <a name="regular-processing"></a><span data-ttu-id="2c448-174">Processamento regular</span><span class="sxs-lookup"><span data-stu-id="2c448-174">Regular Processing</span></span>
 <span data-ttu-id="2c448-175">Nessa fase, as instruções [!INCLUDE[tsql](../includes/tsql-md.md)] emitidas pelo usuário são executadas.</span><span class="sxs-lookup"><span data-stu-id="2c448-175">During this phase, the user-issued [!INCLUDE[tsql](../includes/tsql-md.md)] statements are executed.</span></span> <span data-ttu-id="2c448-176">As linhas são lidas das tabelas, e as novas versões de linha são gravadas no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2c448-176">Rows are read from the tables, and new row versions are written to the database.</span></span> <span data-ttu-id="2c448-177">A transação é isolada de todas as outras transações simultâneas.</span><span class="sxs-lookup"><span data-stu-id="2c448-177">The transaction is isolated from all other concurrent transactions.</span></span> <span data-ttu-id="2c448-178">A transação utiliza o instantâneo das tabelas com otimização de memória que existe no início da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-178">The transaction uses the snapshot of the memory-optimized tables that exists at the start of the transaction.</span></span>

 <span data-ttu-id="2c448-179">As gravações nas tabelas nessa fase da transação ainda não estão visíveis para outras transações, com uma exceção: as atualizações e exclusões de linha são visíveis para operações de atualização e exclusão em outras transações, de modo a detectar conflitos de gravação.</span><span class="sxs-lookup"><span data-stu-id="2c448-179">Writes to the tables in this phase of the transaction are not yet visible to other transactions, with one exception: row updates and deletes are visible to update and delete operations in other transactions, in order to detect write conflicts.</span></span>

 <span data-ttu-id="2c448-180">Se uma operação de atualização ou exclusão que vê que uma linha foi atualizada ou excluída desde o início lógico da transação, a operação falhará com o erro 41302.</span><span class="sxs-lookup"><span data-stu-id="2c448-180">If an update or delete operation sees that a row has been updated or deleted since the logical start of the transaction, the operation will fail with error 41302.</span></span> <span data-ttu-id="2c448-181">A mensagem do erro 41302 é "A transação atual tentou atualizar um registro na tabela X que foi atualizado desde que esta transação foi iniciada.</span><span class="sxs-lookup"><span data-stu-id="2c448-181">The message for error 41302 is "The current transaction attempted to update a record in table X that has been updated since this transaction started.</span></span> <span data-ttu-id="2c448-182">A transação foi anulada".</span><span class="sxs-lookup"><span data-stu-id="2c448-182">The transaction was aborted."</span></span>

 <span data-ttu-id="2c448-183">Esse erro sempre condena a transação (mesmo que XACT_ABORT esteja como OFF), o que significa que a transação será revertida quando a sessão do usuário termina.</span><span class="sxs-lookup"><span data-stu-id="2c448-183">This error dooms the transaction (even if XACT_ABORT is OFF), meaning that the transaction will be rolled back when the user session ends.</span></span> <span data-ttu-id="2c448-184">As transações condenadas não podem ser confirmadas e somente dão suporte a operações de leitura que não são gravadas no log e não acessam tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-184">Doomed transactions cannot be committed and only support read operations that do not write to the log and do not access memory-optimized tables.</span></span>

#####  <a name="commit-dependencies"></a><a name="cd"></a><span data-ttu-id="2c448-185">Dependências de confirmação</span><span class="sxs-lookup"><span data-stu-id="2c448-185">Commit Dependencies</span></span>
 <span data-ttu-id="2c448-186">Durante o processamento regular, uma transação pode ler as linhas gravadas por outras transações que estão na fase de validação ou confirmação, mas que ainda não foram confirmadas.</span><span class="sxs-lookup"><span data-stu-id="2c448-186">During regular processing, a transaction can read rows written by other transactions that are in the validation or commit phase, but have not yet committed.</span></span> <span data-ttu-id="2c448-187">As linhas são visíveis, pois a hora de término lógica das transações foi atribuída no início da fase de validação.</span><span class="sxs-lookup"><span data-stu-id="2c448-187">The rows are visible because the logical end time of the transactions has been assigned at the start of the validation phase.</span></span>

 <span data-ttu-id="2c448-188">Se uma transação ler essas linhas não confirmadas, ela obterá uma dependência de confirmação nessa transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-188">If a transaction reads such uncommitted rows, it will take a commit dependency on that transaction.</span></span> <span data-ttu-id="2c448-189">Isso tem duas consequências importantes:</span><span class="sxs-lookup"><span data-stu-id="2c448-189">This has two main implications:</span></span>

-   <span data-ttu-id="2c448-190">A transação não pode confirmar até que as transações das quais ela depende tenham sido confirmadas.</span><span class="sxs-lookup"><span data-stu-id="2c448-190">A transaction cannot commit until the transactions it depends on have committed.</span></span> <span data-ttu-id="2c448-191">Em outras palavras, ela não pode entrar na fase de confirmação até que todas as dependências tenham sido eliminadas.</span><span class="sxs-lookup"><span data-stu-id="2c448-191">In other words, it cannot enter the commit phase, until all dependencies have cleared.</span></span>

-   <span data-ttu-id="2c448-192">Além disso, os conjuntos de resultados não são retornados ao cliente até que todas as dependências tenham sido eliminadas.</span><span class="sxs-lookup"><span data-stu-id="2c448-192">In addition, result sets are not returned to the client until all dependencies have cleared.</span></span> <span data-ttu-id="2c448-193">Isso impede que o cliente observe dados não confirmados.</span><span class="sxs-lookup"><span data-stu-id="2c448-193">This prevents the client from observing uncommitted data.</span></span>

 <span data-ttu-id="2c448-194">Se alguma das transações dependentes não for confirmada, haverá uma falha de dependência de confirmação.</span><span class="sxs-lookup"><span data-stu-id="2c448-194">If any of the dependent transactions fails to commit, there is a commit dependency failure.</span></span> <span data-ttu-id="2c448-195">Isso significa que a transação falhará ao ser confirmada apresentando o erro 41301 ("Uma transação anterior na qual a transação atual obteve uma dependência foi anulada, e a transação atual não pode mais ser confirmada.").</span><span class="sxs-lookup"><span data-stu-id="2c448-195">This means the transaction will fail to commit with error 41301 ("A previous transaction that the current transaction took a dependency on has aborted, and the current transaction can no longer commit.").</span></span>

#### <a name="validation-phase"></a><span data-ttu-id="2c448-196">Fase de validação</span><span class="sxs-lookup"><span data-stu-id="2c448-196">Validation Phase</span></span>
 <span data-ttu-id="2c448-197">Durante a fase de validação, o sistema verifica se as suposições necessárias para o nível de isolamento da transação solicitado são verdadeiras entre o início e o término lógicos da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-197">During the validation phase, the system validates that the assumptions necessary for the requested transaction isolation level were true between the logical start and logical end of the transaction.</span></span>

 <span data-ttu-id="2c448-198">No início da fase de validação, a transação é atribuída a uma hora de término lógica.</span><span class="sxs-lookup"><span data-stu-id="2c448-198">At the start of the validation phase, the transaction is assigned a logical end time.</span></span> <span data-ttu-id="2c448-199">As versões de linha gravadas no banco de dados se tornarão visíveis para outras transações na hora de término lógica.</span><span class="sxs-lookup"><span data-stu-id="2c448-199">The row versions written in the database become visible to other transactions at the logical end time.</span></span> <span data-ttu-id="2c448-200">Para obter mais informações, consulte [Dependências de confirmação](#cd).</span><span class="sxs-lookup"><span data-stu-id="2c448-200">For more information, see [Commit Dependencies](#cd).</span></span>

##### <a name="repeatable-read-validation"></a><span data-ttu-id="2c448-201">Validação de leitura repetida</span><span class="sxs-lookup"><span data-stu-id="2c448-201">Repeatable Read Validation</span></span>
 <span data-ttu-id="2c448-202">Se o nível de isolamento da transação for REPEATABLE READ ou SERIALIZABLE, ou as tabelas forem acessadas no isolamento REPEATABLE READ ou SERIALIZABLE (para obter mais informações, consulte a seção sobre Isolamento de operações individuais em [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), o sistema confirmará que as leituras são repetidas.</span><span class="sxs-lookup"><span data-stu-id="2c448-202">If the isolation level of the transaction is REPEATABLE READ or SERIALIZABLE, or if tables are accessed under REPEATABLE READ or SERIALIZABLE isolation (for more information, see the section on Isolation of Individual Operations in [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), the system validates that the reads are repeatable.</span></span> <span data-ttu-id="2c448-203">Isso significa que ele confirmará que as versões das linhas lidas pela transação ainda são versões de linha válidas na hora de término lógica da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-203">This means it validates that the versions of the rows read by the transaction are still valid row versions at the logical end time of the transaction.</span></span>

 <span data-ttu-id="2c448-204">Se alguma das linhas for atualizada ou alterada, a transação falhará ao confirmar apresentando o erro 41305 ("A transação atual não foi confirmada devido a uma falha de validação de leitura repetida.").</span><span class="sxs-lookup"><span data-stu-id="2c448-204">If any of the rows have been updated or changed, the transaction fails to commit with error 41305 ("The current transaction failed to commit due to a repeatable read validation failure.").</span></span>

 <span data-ttu-id="2c448-205">Esse erro também poderá ocorrer se uma tabela for descartada após uma operação de inserção, atualização ou exclusão e antes da confirmação da transação.</span><span class="sxs-lookup"><span data-stu-id="2c448-205">This error can also occur if a table is dropped after an insert, update, or delete operation and before the transaction commits.</span></span> <span data-ttu-id="2c448-206">Isso se aplica apenas às operações de inserção, atualização ou exclusão em procedimentos armazenados compilados nativamente.</span><span class="sxs-lookup"><span data-stu-id="2c448-206">This applies only to insert, update, or delete operations in natively compiled stored procedures.</span></span> <span data-ttu-id="2c448-207">Essas operações de gravação executadas por meio do [!INCLUDE[tsql](../includes/tsql-md.md)] interpretado fazem com que a instrução DROP TABLE seja bloqueada e aguarde até que a transação seja confirmada.</span><span class="sxs-lookup"><span data-stu-id="2c448-207">Such write operations performed through interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] cause the DROP TABLE statement to block and wait until the transaction commits.</span></span>

##### <a name="serializable-validation"></a><span data-ttu-id="2c448-208">Validação serializável</span><span class="sxs-lookup"><span data-stu-id="2c448-208">Serializable Validation</span></span>
 <span data-ttu-id="2c448-209">A validação serializável é executada em dois casos:</span><span class="sxs-lookup"><span data-stu-id="2c448-209">Serializable validation is performed in two cases:</span></span>

-   <span data-ttu-id="2c448-210">Se o nível de isolamento da transação for SERIALIZABLE ou as tabelas forem acessadas no isolamento SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="2c448-210">If the isolation level of the transaction is SERIALIZABLE or tables are accessed under SERIALIZABLE isolation.</span></span>

-   <span data-ttu-id="2c448-211">Se as linhas forem inseridas em um índice exclusivo, como o índice criado para uma restrição PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="2c448-211">If rows are inserted in a unique index, such as the index created for a PRIMARY KEY constraint.</span></span> <span data-ttu-id="2c448-212">O sistema valida que nenhuma linha com a mesma chave foi inserida simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="2c448-212">The system validates that no rows with the same key have been concurrently inserted.</span></span>

 <span data-ttu-id="2c448-213">O sistema valida que nenhuma linha fantasma foi gravada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2c448-213">The system validates that no phantom rows have been written to the database.</span></span> <span data-ttu-id="2c448-214">As operações de leitura executadas pela transação são avaliadas para determinar que nenhuma linha nova foi inserida nos intervalos de verificação dessas operações de leitura.</span><span class="sxs-lookup"><span data-stu-id="2c448-214">The read operations performed by the transaction are evaluated to determine that no new rows were inserted in the scan ranges of these read operations.</span></span>

 <span data-ttu-id="2c448-215">A inserção de uma chave em um índice exclusivo inclui uma operação de leitura implícita, de modo a determinar que a chave não é uma duplicação.</span><span class="sxs-lookup"><span data-stu-id="2c448-215">Insertion of a key in a unique index includes an implicit read operation, to determine that the key is not a duplicate.</span></span> <span data-ttu-id="2c448-216">A validação serializável para índices exclusivos assegura que esses índices não possam ter duplicatas no caso de duas transações inserirem simultaneamente a mesma chave.</span><span class="sxs-lookup"><span data-stu-id="2c448-216">Serializable validation for unique indexes ensures these indexes cannot have duplicates in case two transactions concurrently insert the same key.</span></span>

 <span data-ttu-id="2c448-217">Se linhas fantasmas forem detectadas, a transação falhará ao confirmar apresentando o erro 41325 ("A transação atual não foi confirmada devido a uma falha de validação serializável.").</span><span class="sxs-lookup"><span data-stu-id="2c448-217">If phantom rows are detected, the transaction fails to commit with error 41325 ("The current transaction failed to commit due to a serializable validation failure.").</span></span>

#### <a name="commit-processing"></a><span data-ttu-id="2c448-218">Processamento de confirmação</span><span class="sxs-lookup"><span data-stu-id="2c448-218">Commit Processing</span></span>
 <span data-ttu-id="2c448-219">Se a validação for bem-sucedida e todas as dependências de transação forem eliminadas, a transação entrará na fase de processamento de confirmação.</span><span class="sxs-lookup"><span data-stu-id="2c448-219">If validation succeeds and all transaction dependencies clear, the transaction enters the commit processing phase.</span></span> <span data-ttu-id="2c448-220">Nessa fase, as alterações nas tabelas duráveis são gravadas no log e o log é gravado no disco, para garantir a durabilidade.</span><span class="sxs-lookup"><span data-stu-id="2c448-220">During this phase the changes to durable tables are written to the log, and the log is written to disk, to ensure durability.</span></span> <span data-ttu-id="2c448-221">Uma vez que o registro de log da transação foi gravado no disco, o controle é retornado para o cliente.</span><span class="sxs-lookup"><span data-stu-id="2c448-221">Once the log record for the transaction has been written to disk, control is returned to the client.</span></span>

 <span data-ttu-id="2c448-222">Todas as dependências de confirmação nessa transação serão eliminadas e todas as transações que estiveram aguardando por essa transação para serem confirmadas poderão prosseguir.</span><span class="sxs-lookup"><span data-stu-id="2c448-222">All commit dependencies on this transaction are cleared, and all transactions that had been waiting for this transaction to commit can proceed.</span></span>

## <a name="limitations"></a><span data-ttu-id="2c448-223">Limitações</span><span class="sxs-lookup"><span data-stu-id="2c448-223">Limitations</span></span>

-   <span data-ttu-id="2c448-224">As transações entre bancos de dados não têm suporte com tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-224">Cross-database transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="2c448-225">Cada transação que acessa tabelas com otimização de memória não pode acessar mais de um banco de dados, com exceção do acesso de leitura-gravação ao tempdb e o acesso somente leitura ao mestre do banco de dados do sistema.</span><span class="sxs-lookup"><span data-stu-id="2c448-225">Every transaction that accesses memory-optimized tables cannot access more than one database, with the exception of read-write access to tempdb and read-only access to the system database master.</span></span>

-   <span data-ttu-id="2c448-226">As transações distribuídas não têm suporte com tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-226">Distributed transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="2c448-227">As transações distribuídas iniciadas com BEGIN DISTRIBUTED TRANSACTION não podem acessar tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-227">Distributed transactions started with BEGIN DISTRIBUTED TRANSACTION cannot access memory-optimized tables.</span></span>

-   <span data-ttu-id="2c448-228">As tabelas com otimização de memória não oferecem suporte a bloqueio.</span><span class="sxs-lookup"><span data-stu-id="2c448-228">Memory-optimized tables do not support locking.</span></span> <span data-ttu-id="2c448-229">Os bloqueios explícitos por meio de dicas de bloqueio (como TABLOCK, XLOCK, ROWLOCK) não têm suporte com tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="2c448-229">Explicit locks through locking hints (such as TABLOCK, XLOCK, ROWLOCK) are not supported with memory-optimized tables.</span></span>

## <a name="see-also"></a><span data-ttu-id="2c448-230">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="2c448-230">See Also</span></span>
 [<span data-ttu-id="2c448-231">Compreendendo transações em tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="2c448-231">Understanding Transactions on Memory-Optimized Tables</span></span>](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md)


