---
title: Suporte a SPN (Nome da Entidade de Serviço) em conexões de cliente | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client, SPNs
- ODBC, SPNs
- OLE DB, SPNs
- SPNs [SQL Server]
ms.assetid: 96598c69-ce9a-4090-aacb-d546591e8af7
author: rothja
ms.author: jroth
ms.openlocfilehash: 10a64baa17bd070d9354beaf6ff8c2e460682318
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570668"
---
# <a name="service-principal-name-spn-support-in-client-connections"></a><span data-ttu-id="f61f3-102">Suporte a SPN (Nome da entidade de serviço) em conexões com o cliente</span><span class="sxs-lookup"><span data-stu-id="f61f3-102">Service Principal Name (SPN) Support in Client Connections</span></span>
  <span data-ttu-id="f61f3-103">Do [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)] em diante, o suporte para SPNs (nomes das entidades de serviço) foi estendido para habilitar a autenticação mútua em todos os protocolos.</span><span class="sxs-lookup"><span data-stu-id="f61f3-103">Beginning with [!INCLUDE[ssKatmai](../../../includes/sskatmai-md.md)], support for service principal names (SPNs) has been extended to enable mutual authentication across all protocols.</span></span> <span data-ttu-id="f61f3-104">Em versões anteriores do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], apenas havia suporte para SPNs no Kerberos via TCP quando o SPN padrão da instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] era registrado no Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f61f3-104">In previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], SPNs were only supported for Kerberos over TCP when the default SPN for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance was registered with Active Directory.</span></span>  
  
 <span data-ttu-id="f61f3-105">Os SPNs são usados pelo protocolo de autenticação para determinar a conta na qual uma instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] é executada.</span><span class="sxs-lookup"><span data-stu-id="f61f3-105">SPNs are used by the authentication protocol to determine the account in which a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance runs.</span></span> <span data-ttu-id="f61f3-106">Se a conta da instância for conhecida, autenticação Kerberos poderá ser usada para fornecer autenticação mútua pelo cliente e servidor.</span><span class="sxs-lookup"><span data-stu-id="f61f3-106">If the instance account is known, Kerberos authentication can be used to provide mutual authentication by the client and server.</span></span> <span data-ttu-id="f61f3-107">Se a conta de instância não for conhecida, a autenticação NTLM, que só fornece autenticação do cliente pelo servidor, será usada.</span><span class="sxs-lookup"><span data-stu-id="f61f3-107">If the instance account is not known, NTLM authentication, which only provides authentication of the client by the server, is used.</span></span> <span data-ttu-id="f61f3-108">Atualmente, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client executa a pesquisa de autenticação, derivando o SPN das propriedades de nome da instância e conexão de rede.</span><span class="sxs-lookup"><span data-stu-id="f61f3-108">Currently, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client performs the authentication lookup, deriving the SPN from the instance name and network connection properties.</span></span> <span data-ttu-id="f61f3-109">As instâncias do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tentarão registrar os SPNs na inicialização, ou eles podem ser registrados manualmente.</span><span class="sxs-lookup"><span data-stu-id="f61f3-109">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instances will attempt to register SPNs on startup, or they can be registered manually.</span></span> <span data-ttu-id="f61f3-110">Porém, o registro falhará se houver direitos de acesso insuficientes para a conta que tenta registrar os SPNs.</span><span class="sxs-lookup"><span data-stu-id="f61f3-110">However, registration will fail if there are insufficient access rights for the account that attempts to register the SPNs.</span></span>  
  
 <span data-ttu-id="f61f3-111">As contas de domínio e computador são registradas automaticamente no Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f61f3-111">Domain and computer accounts are registered automatically in Active Directory.</span></span> <span data-ttu-id="f61f3-112">Elas podem ser usadas como SPNs ou os administradores podem definir seus próprios SPNs.</span><span class="sxs-lookup"><span data-stu-id="f61f3-112">These can be used as SPNs, or administators can define their own SPNs.</span></span> <span data-ttu-id="f61f3-113">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] torna a autenticação segura mais gerenciável e confiável, permitindo que os clientes especifiquem diretamente o SPN a ser usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-113">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] makes secure authentication more manageable and reliable by allowing clients to directly specify the SPN to use.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f61f3-114">Um SPN especificado por um aplicativo cliente é usado somente quando uma conexão é feita com a segurança integrada pelo Windows.</span><span class="sxs-lookup"><span data-stu-id="f61f3-114">An SPN specified by a client application is only used when a connection is made with Windows integrated security.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="f61f3-115">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** é uma ferramenta de diagnóstico que ajuda a solucionar problemas de Kerberos relativos à conectividade com [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f61f3-115">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f61f3-116">Para obter mais informações, consulte [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="f61f3-116">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="f61f3-117">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** é uma ferramenta de diagnóstico que ajuda a solucionar problemas de Kerberos relativos à conectividade com [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f61f3-117">**[!INCLUDE[msCoName](../../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f61f3-118">Para obter mais informações, consulte [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="f61f3-118">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="f61f3-119">Para obter mais informações sobre Kerberos, consulte os artigos a seguir:</span><span class="sxs-lookup"><span data-stu-id="f61f3-119">For more information about Kerberos, see the following articles:</span></span>  
  
-   [<span data-ttu-id="f61f3-120">Suplemento técnico do Kerberos para Windows</span><span class="sxs-lookup"><span data-stu-id="f61f3-120">Kerberos Technical Supplement for Windows</span></span>](https://go.microsoft.com/fwlink/?LinkId=101449)  
  
-   [<span data-ttu-id="f61f3-121">Microsoft Kerberos</span><span class="sxs-lookup"><span data-stu-id="f61f3-121">Microsoft Kerberos</span></span>](https://go.microsoft.com/fwlink/?LinkID=100758)  
  
## <a name="usage"></a><span data-ttu-id="f61f3-122">Uso</span><span class="sxs-lookup"><span data-stu-id="f61f3-122">Usage</span></span>  
 <span data-ttu-id="f61f3-123">A tabela a seguir descreve os cenários mais comuns nos quais os aplicativos cliente podem habilitar a autenticação segura.</span><span class="sxs-lookup"><span data-stu-id="f61f3-123">The following table describes the most common scenarios in which client applications can enable secure authentication.</span></span>  
  
|<span data-ttu-id="f61f3-124">Cenário</span><span class="sxs-lookup"><span data-stu-id="f61f3-124">Scenario</span></span>|<span data-ttu-id="f61f3-125">Descrição</span><span class="sxs-lookup"><span data-stu-id="f61f3-125">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="f61f3-126">Um aplicativo herdado não especifica um SPN.</span><span class="sxs-lookup"><span data-stu-id="f61f3-126">A legacy application does not specify an SPN.</span></span>|<span data-ttu-id="f61f3-127">Este cenário de compatibilidade garante que não haverá nenhuma alteração de comportamento para aplicativos desenvolvidos para versões anteriores do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f61f3-127">This compatibility scenario guarantees that there will be no behavior change for applications developed for previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f61f3-128">Se nenhum SPN for especificado, o aplicativo confiará nos SPNs gerados e não terá nenhum conhecimento de qual método de autenticação será usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-128">If no SPN is specified, the application relies on generated SPNs and has no knowledge of which authentication method is used.</span></span>|  
|<span data-ttu-id="f61f3-129">Um aplicativo cliente que usa a versão anterior do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client especifica um SPN na cadeia de conexão como um usuário do domínio ou uma conta de computador, como um SPN específico da instância ou uma cadeia definida pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="f61f3-129">A client application using the current version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client specifies an SPN in the connection string as a domain user or computer account, as an instance-specific SPN, or as a user-defined string.</span></span>|<span data-ttu-id="f61f3-130">A palavra-chave `ServerSPN` pode ser usada em um provedor, uma inicialização ou uma cadeia de conexão para fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="f61f3-130">The `ServerSPN` keyword can be used in a provider, initialization, or connection string to do the following:</span></span><br /><br /> <span data-ttu-id="f61f3-131">-Especifique a conta usada pela [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instância para uma conexão.</span><span class="sxs-lookup"><span data-stu-id="f61f3-131">-   Specify the account used by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance for a connection.</span></span> <span data-ttu-id="f61f3-132">Isto simplifica o acesso à autenticação Kerberos.</span><span class="sxs-lookup"><span data-stu-id="f61f3-132">This simplifies access to Kerberos authentication.</span></span> <span data-ttu-id="f61f3-133">Se um KDC (Centro de Distribuição de Chaves) Kerberos estiver presente e a conta correta for especificada, a autenticação Kerberos provavelmente será mais usada que NTLM.</span><span class="sxs-lookup"><span data-stu-id="f61f3-133">If a Kerberos Key Distribution Center (KDC) is present and the correct account is specified, Kerberos authentication is more likely to be used than NTLM.</span></span> <span data-ttu-id="f61f3-134">O KDC normalmente reside no mesmo computador que o controlador de domínio.</span><span class="sxs-lookup"><span data-stu-id="f61f3-134">The KDC usually resides on the same computer as the domain controller.</span></span><br /><span data-ttu-id="f61f3-135">-Especifique um SPN para pesquisar a conta de serviço da [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instância.</span><span class="sxs-lookup"><span data-stu-id="f61f3-135">-   Specify an SPN to look up the service account for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="f61f3-136">Para cada instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], são gerados dois SPNs padrão que podem ser usados para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="f61f3-136">For every [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, two default SPNs are generated that can be used for this purpose.</span></span> <span data-ttu-id="f61f3-137">Não há garantia de que estas chaves estejam presentes no Active Directory. Entretanto, nesta situação, a autenticação Kerberos não é garantida.</span><span class="sxs-lookup"><span data-stu-id="f61f3-137">These keys are not guaranteed to be present in Active Directory, however, so in this situation Kerberos authentication is not guaranteed.</span></span><br /><span data-ttu-id="f61f3-138">-Especifique um SPN que será usado para pesquisar a conta de serviço da [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instância.</span><span class="sxs-lookup"><span data-stu-id="f61f3-138">-   Specify an SPN that will be used to look up the service account for the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="f61f3-139">Esta poderá ser qualquer cadeia de caracteres definida pelo usuário que mapeia para a conta de serviço.</span><span class="sxs-lookup"><span data-stu-id="f61f3-139">This can be any user-defined string that maps to the service account.</span></span> <span data-ttu-id="f61f3-140">Neste caso, a chave deve ser registrada manualmente no KDC e deve satisfazer as regras para um SPN definido pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="f61f3-140">In this case, the key must be registered manually in the KDC and must satisfy the rules for a user-defined SPN.</span></span><br /><br /> <span data-ttu-id="f61f3-141">A palavra-chave `FailoverPartnerSPN` pode ser usada para especificar o SPN para o servidor de parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f61f3-141">The `FailoverPartnerSPN` keyword can be used to specify the SPN for the failover partner server.</span></span> <span data-ttu-id="f61f3-142">O intervalo de conta e valores de chave do Active Directory é igual aos valores que você pode especificar para o servidor principal.</span><span class="sxs-lookup"><span data-stu-id="f61f3-142">The range of account and Active Directory key values is the same as the values you can specify for the principal server.</span></span>|  
|<span data-ttu-id="f61f3-143">Um aplicativo ODBC especifica um SPN como um atributo de conexão para o servidor principal ou servidor de parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f61f3-143">An ODBC application specifies an SPN as a connection attribute for the principal server or failover partner server.</span></span>|<span data-ttu-id="f61f3-144">O atributo de conexão `SQL_COPT_SS_SERVER_SPN` pode ser usado para especificar o SPN para uma conexão com o servidor principal.</span><span class="sxs-lookup"><span data-stu-id="f61f3-144">The connection attribute `SQL_COPT_SS_SERVER_SPN` can be used to specify the SPN for a connection to the principal server.</span></span><br /><br /> <span data-ttu-id="f61f3-145">O atributo de conexão `SQL_COPT_SS_FAILOVER_PARTNER_SPN` pode ser usado para especificar o SPN para o servidor de parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f61f3-145">The connection attribute `SQL_COPT_SS_FAILOVER_PARTNER_SPN` can be used to specify the SPN for the failover partner server.</span></span>|  
|<span data-ttu-id="f61f3-146">Um aplicativo OLE DB especifica um SPN como uma propriedade de inicialização de fonte de dados para o servidor principal ou para um servidor de parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f61f3-146">An OLE DB application specifies an SPN as a data source initialization property for the principal server or for a failover partner server.</span></span>|<span data-ttu-id="f61f3-147">A propriedade de conexão `SSPROP_INIT_SERVER_SPN` no conjunto de propriedades `DBPROPSET_SQLSERVERDBINIT` pode ser usada para especificar o SPN para uma conexão.</span><span class="sxs-lookup"><span data-stu-id="f61f3-147">The connection property `SSPROP_INIT_SERVER_SPN` in the `DBPROPSET_SQLSERVERDBINIT` property set can be used to specify the SPN for a connection.</span></span><br /><br /> <span data-ttu-id="f61f3-148">A propriedade de conexão `SSPROP_INIT_FAILOVER_PARTNER_SPN` na `DBPROPSET_SQLSERVERDBINIT` pode ser usada para especificar o SPN para o servidor de parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f61f3-148">The connection property `SSPROP_INIT_FAILOVER_PARTNER_SPN` in the `DBPROPSET_SQLSERVERDBINIT` can be used to specify the SPN for the failover partner server.</span></span>|  
|<span data-ttu-id="f61f3-149">Um usuário especifica um SPN para um servidor ou servidor de parceiro de failover em um DSN (nome de fonte de dados) ODBC.</span><span class="sxs-lookup"><span data-stu-id="f61f3-149">A user specifies an SPN for a server or failover partner server in an ODBC data source name (DSN).</span></span>|<span data-ttu-id="f61f3-150">O SPN pode ser especificado em um DSN ODBC pelas caixas de diálogo de configuração do DSN.</span><span class="sxs-lookup"><span data-stu-id="f61f3-150">The SPN can be specified in an ODBC DSN through the DSN setup dialog boxes.</span></span>|  
|<span data-ttu-id="f61f3-151">O usuário especifica um SPN para um servidor ou servidor de parceiro de failover em uma caixa de diálogo **Vínculo de Dados** ou **Logon** no OLE DB.</span><span class="sxs-lookup"><span data-stu-id="f61f3-151">The user specifies an SPN for a server or failover partner server in an OLE DB **Data Link** or **Login** dialog box.</span></span>|<span data-ttu-id="f61f3-152">O SPN pode ser especificado em uma caixa de diálogo **Vínculo de Dados** ou **Logon** .</span><span class="sxs-lookup"><span data-stu-id="f61f3-152">The SPN can be specified in a **Data Link** or **Login** dialog box.</span></span> <span data-ttu-id="f61f3-153">A caixa de diálogo **Logon** pode ser usada com ODBC ou OLE DB.</span><span class="sxs-lookup"><span data-stu-id="f61f3-153">The **Login** dialog box can be used with either ODBC or OLE DB.</span></span>|  
|<span data-ttu-id="f61f3-154">Um aplicativo ODBC determina o método de autenticação usado para estabelecer uma conexão.</span><span class="sxs-lookup"><span data-stu-id="f61f3-154">An ODBC application determines the authentication method used to establish a connection.</span></span>|<span data-ttu-id="f61f3-155">Quando uma conexão foi aberta com êxito, um aplicativo pode consultar o atributo de conexão `SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD` para determinar qual método de autenticação foi usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-155">When a connection has been opened successfully, an application can query the connection attribute `SQL_COPT_SS_INTEGRATED_AUTHENTICATION_METHOD` to determine which authentication method was used.</span></span> <span data-ttu-id="f61f3-156">Os valores incluirão (mas não estarão limitados a) `NTLM` e `Kerberos`.</span><span class="sxs-lookup"><span data-stu-id="f61f3-156">The values will include, but are not limited to, `NTLM` and `Kerberos`.</span></span>|  
|<span data-ttu-id="f61f3-157">Um aplicativo OLE DB determina o método de autenticação usado para estabelecer uma conexão.</span><span class="sxs-lookup"><span data-stu-id="f61f3-157">An OLE DB application determines the authentication method used to establish a connection.</span></span>|<span data-ttu-id="f61f3-158">Quando uma conexão foi aberta com êxito, um aplicativo pode consultar a propriedade de conexão `SSPROP_AUTHENTICATION_METHOD` no conjunto de propriedades `DBPROPSET_SQLSERVERDATASOURCEINFO` para determinar qual método de autenticação foi usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-158">When a connection has been opened successfully, an application can query the connection property `SSPROP_AUTHENTICATION_METHOD` in the `DBPROPSET_SQLSERVERDATASOURCEINFO` property set to determine which authentication method was used.</span></span> <span data-ttu-id="f61f3-159">Os valores incluirão (mas não estarão limitados a) `NTLM` e `Kerberos`.</span><span class="sxs-lookup"><span data-stu-id="f61f3-159">The values will include, but are not limited to, `NTLM` and `Kerberos`.</span></span>|  
  
## <a name="failover"></a><span data-ttu-id="f61f3-160">Failover</span><span class="sxs-lookup"><span data-stu-id="f61f3-160">Failover</span></span>  
 <span data-ttu-id="f61f3-161">Os SPNs não são armazenados no cache de failover e, portanto, não podem ser transmitidos entre conexões.</span><span class="sxs-lookup"><span data-stu-id="f61f3-161">SPNs are not stored in the failover cache and therefore cannot be passed between connections.</span></span> <span data-ttu-id="f61f3-162">Os SPNs serão usados em todas as tentativas de conexão com a entidade e o parceiro quando especificados na cadeia de conexão ou nos atributos de conexão.</span><span class="sxs-lookup"><span data-stu-id="f61f3-162">SPNs will be used on all connection attempts to the principal and partner when specified in the connection string or connection attributes.</span></span>  
  
## <a name="connection-pooling"></a><span data-ttu-id="f61f3-163">Pool de conexões</span><span class="sxs-lookup"><span data-stu-id="f61f3-163">Connection Pooling</span></span>  
 <span data-ttu-id="f61f3-164">Os aplicativos devem estar atentos que especificar SPNs em algumas, mas não em todas as cadeias de conexão, podem contribuir para o agrupamento da fragmentação.</span><span class="sxs-lookup"><span data-stu-id="f61f3-164">Applications should be aware that specifying SPNs in some but not all connection strings can contribute to pool fragmentation.</span></span>  
  
 <span data-ttu-id="f61f3-165">Os aplicativos podem especificar SPNs programaticamente como atributos de conexão, em vez de especificar palavras-chave da cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="f61f3-165">Applications can programmatically specify SPNs as connection attributes, instead of specifying connection string keywords.</span></span> <span data-ttu-id="f61f3-166">Isto pode ajudar no gerenciamento da fragmentação do pool de conexões.</span><span class="sxs-lookup"><span data-stu-id="f61f3-166">This can help manage connection pool fragmentation.</span></span>  
  
 <span data-ttu-id="f61f3-167">Os aplicativos deverão saber que os SPNs nas cadeias de conexão possam ser substituídos definindo os atributos de conexão correspondentes, mas as cadeias de conexão usadas pelo pool de conexões usarão os valores da cadeia de conexão para fins de pool.</span><span class="sxs-lookup"><span data-stu-id="f61f3-167">Applications should be aware that SPNs in connection strings can be overridden by setting the corresponding connection attributes, but connection strings used by connection pooling will use the connection string values for pooling purposes.</span></span>  
  
## <a name="down-level-server-behavior"></a><span data-ttu-id="f61f3-168">Comportamento de servidor de versão anterior</span><span class="sxs-lookup"><span data-stu-id="f61f3-168">Down-Level Server Behavior</span></span>  
 <span data-ttu-id="f61f3-169">O novo comportamento de conexão é implementado pelo cliente; portanto, ele não é específico para uma versão do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f61f3-169">The new connection behavior is implemented by the client; therefore, it is not specific to a version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="linked-servers-and-delegation"></a><span data-ttu-id="f61f3-170">Servidores vinculados e delegação</span><span class="sxs-lookup"><span data-stu-id="f61f3-170">Linked Servers and Delegation</span></span>  
 <span data-ttu-id="f61f3-171">Quando servidores vinculados são criados, o parâmetro `@provstr` de [sp_addlinkedserver](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql) pode ser usado para especificar os SPNs do servidor e do parceiro de failover.</span><span class="sxs-lookup"><span data-stu-id="f61f3-171">When linked servers are created, the `@provstr` parameter of [sp_addlinkedserver](/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql) can be used to specify the server and failover partner SPNs.</span></span> <span data-ttu-id="f61f3-172">Os benefícios disso é o mesmo que especificar SPNs em cadeias de conexão de cliente. É mais simples e confiável estabelecer conexões que usam autenticação Kerberos.</span><span class="sxs-lookup"><span data-stu-id="f61f3-172">The benefits of doing this are the same as specifying SPNs in client connection strings: It is simpler and more reliable to establish connections that use Kerberos authentication.</span></span>  
  
 <span data-ttu-id="f61f3-173">A delegação com servidores vinculados exige a autenticação Kerberos.</span><span class="sxs-lookup"><span data-stu-id="f61f3-173">Delegation with linked servers requires Kerberos authentication.</span></span>  
  
## <a name="management-aspects-of-spns-specified-by-applications"></a><span data-ttu-id="f61f3-174">Aspectos de gerenciamento de SPNs especificados por aplicativos</span><span class="sxs-lookup"><span data-stu-id="f61f3-174">Management Aspects of SPNs Specified by Applications</span></span>  
 <span data-ttu-id="f61f3-175">Ao escolher se deseja especificar SPNs em um aplicativo (por meio de cadeias de conexão) ou, programaticamente, por meio de propriedades de conexão (em vez de confiar no provedor padrão gerado por SPNs), considere os seguintes fatores:</span><span class="sxs-lookup"><span data-stu-id="f61f3-175">When choosing whether to specify SPNs in an application (through connection strings) or programmatically through connection properties (rather than relying on the defalt provider generated SPNs), consider the following factors:</span></span>  
  
-   <span data-ttu-id="f61f3-176">Segurança: o SPN especificado divulga informações que estão protegidas?</span><span class="sxs-lookup"><span data-stu-id="f61f3-176">Security: Does the specified SPN disclose information that is protected?</span></span>  
  
-   <span data-ttu-id="f61f3-177">Confiabilidade: para permitir o uso de SPNs padrão, a conta de serviço na qual a instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] é executada precisa ter privilégios suficientes para atualizar o Active Directory no KDC.</span><span class="sxs-lookup"><span data-stu-id="f61f3-177">Reliability: To enable the use of default SPNs, the service account in which the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance runs must have sufficient privileges to update the Active Directory on the KDC.</span></span>  
  
-   <span data-ttu-id="f61f3-178">Conveniência e transparência de local: como os SPNs de um aplicativo serão afetados se seu banco de dados for movido para uma instância diferente do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ?</span><span class="sxs-lookup"><span data-stu-id="f61f3-178">Convenience and location transparency: How will an application's SPNs be affected if its database moves to a different [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance?</span></span> <span data-ttu-id="f61f3-179">Isto se aplicará ao servidor principal e seu parceiro de failover se você usar espelhamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f61f3-179">This applies to both the principal server and its failover partner if you use database mirroring.</span></span> <span data-ttu-id="f61f3-180">Se uma alteração de servidor significar que os SPNs devem ser alterados, como isto afetará os aplicativos?</span><span class="sxs-lookup"><span data-stu-id="f61f3-180">If a server change means that SPNs must be changed, how will this affect applications?</span></span> <span data-ttu-id="f61f3-181">Qualquer alteração será gerenciada?</span><span class="sxs-lookup"><span data-stu-id="f61f3-181">Will any changes be managed?</span></span>  
  
## <a name="specifying-the-spn"></a><span data-ttu-id="f61f3-182">Especificando o SPN</span><span class="sxs-lookup"><span data-stu-id="f61f3-182">Specifying the SPN</span></span>  
 <span data-ttu-id="f61f3-183">Você pode especificar um SPN em caixas de diálogo e em código.</span><span class="sxs-lookup"><span data-stu-id="f61f3-183">You can specify an SPN in dialog boxes and in code.</span></span> <span data-ttu-id="f61f3-184">Esta seção discute como você pode especificar um SPN.</span><span class="sxs-lookup"><span data-stu-id="f61f3-184">This section discusses how you can specify an SPN.</span></span>  
  
 <span data-ttu-id="f61f3-185">O tamanho máximo de um SPN é 260 caracteres.</span><span class="sxs-lookup"><span data-stu-id="f61f3-185">The maximum length for an SPN is 260 characters.</span></span>  
  
 <span data-ttu-id="f61f3-186">A sintaxe que os SPNs usam em cadeia de conexão ou atributos de conexão é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="f61f3-186">The syntax that SPNs use in connection string or connection attributes is as follows:</span></span>  
  
|<span data-ttu-id="f61f3-187">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="f61f3-187">Syntax</span></span>|<span data-ttu-id="f61f3-188">Descrição</span><span class="sxs-lookup"><span data-stu-id="f61f3-188">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="f61f3-189">MSSQLSvc/*FQDN*</span><span class="sxs-lookup"><span data-stu-id="f61f3-189">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="f61f3-190">O SPN padrão gerado pelo provedor para uma instância padrão quando um protocolo diferente de TCP é usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-190">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span><br /><br /> <span data-ttu-id="f61f3-191">*FQDN* é um nome de domínio totalmente qualificado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-191">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="f61f3-192">MSSQLSvc/*fqdn*:*port*</span><span class="sxs-lookup"><span data-stu-id="f61f3-192">MSSQLSvc/*fqdn*:*port*</span></span>|<span data-ttu-id="f61f3-193">O SPN padrão gerado pelo provedor quando o protocolo TCP é usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-193">The provider-generated, default SPN when TCP is used.</span></span><br /><br /> <span data-ttu-id="f61f3-194">*port* é um número de porta TCP.</span><span class="sxs-lookup"><span data-stu-id="f61f3-194">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="f61f3-195">MSSQLSvc/*FQDN*:*InstanceName*</span><span class="sxs-lookup"><span data-stu-id="f61f3-195">MSSQLSvc/*fqdn*:*InstanceName*</span></span>|<span data-ttu-id="f61f3-196">O SPN padrão gerado pelo provedor para uma instância nomeada quando um protocolo diferente de TCP é usado.</span><span class="sxs-lookup"><span data-stu-id="f61f3-196">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span><br /><br /> <span data-ttu-id="f61f3-197">*InstanceName* é um nome de instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f61f3-197">*InstanceName* is a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance name.</span></span>|  
|<span data-ttu-id="f61f3-198">HOST/*fqdn*</span><span class="sxs-lookup"><span data-stu-id="f61f3-198">HOST/*fqdn*</span></span><br /><br /> <span data-ttu-id="f61f3-199">HOST/*MachineName*</span><span class="sxs-lookup"><span data-stu-id="f61f3-199">HOST/*MachineName*</span></span>|<span data-ttu-id="f61f3-200">O SPN que mapeia para contas internas do computador que são automaticamente registradas pelo Windows.</span><span class="sxs-lookup"><span data-stu-id="f61f3-200">The SPN that maps to built-in computer accounts that are automatically registered by Windows.</span></span>|  
|<span data-ttu-id="f61f3-201">*Nome de usuário* @ *Domínio* do</span><span class="sxs-lookup"><span data-stu-id="f61f3-201">*Username*@*Domain*</span></span>|<span data-ttu-id="f61f3-202">Especificação direta de uma conta de domínio.</span><span class="sxs-lookup"><span data-stu-id="f61f3-202">Direct specification of a domain account.</span></span><br /><br /> <span data-ttu-id="f61f3-203">*Username* é um nome de conta de usuário do Windows.</span><span class="sxs-lookup"><span data-stu-id="f61f3-203">*Username* is a Windows user account name.</span></span><br /><br /> <span data-ttu-id="f61f3-204">*Domain* é um nome de domínio ou nome de domínio totalmente qualificado do Windows.</span><span class="sxs-lookup"><span data-stu-id="f61f3-204">*Domain* is a Windows domain name or fully-qualified domain name.</span></span>|  
|<span data-ttu-id="f61f3-205">*MachineName* $@ *Domínio* do</span><span class="sxs-lookup"><span data-stu-id="f61f3-205">*MachineName*$@*Domain*</span></span>|<span data-ttu-id="f61f3-206">Especificação direta de uma conta de computador.</span><span class="sxs-lookup"><span data-stu-id="f61f3-206">Direct specification of a computer account.</span></span><br /><br /> <span data-ttu-id="f61f3-207">(Se o servidor ao qual você está se conectando estiver sendo executado em contas do sistema local ou serviço de rede, para obter a autenticação Kerberos, `ServerSPN` poderá estar no formato de *MachineName* $@ *domínio* MachineName.)</span><span class="sxs-lookup"><span data-stu-id="f61f3-207">(If the server you are connecting to is running under LOCAL SYSTEM or NETWORK SERVICE accounts, to get Kerberos authentication, `ServerSPN` can be in the *MachineName*$@*Domain* format.)</span></span>|  
|<span data-ttu-id="f61f3-208">*KDCKey* / *MachineName*</span><span class="sxs-lookup"><span data-stu-id="f61f3-208">*KDCKey*/*MachineName*</span></span>|<span data-ttu-id="f61f3-209">Um SPN especificado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="f61f3-209">A user-specified SPN.</span></span><br /><br /> <span data-ttu-id="f61f3-210">*KDCKey* é uma cadeia de caracteres alfanumérica que está em conformidade com as regras para uma chave do KDC.</span><span class="sxs-lookup"><span data-stu-id="f61f3-210">*KDCKey* is an alphanumeric string that conforms to the rules for a KDC key.</span></span>|  
  
## <a name="odbc-and-ole-db-syntax-supporting-spns"></a><span data-ttu-id="f61f3-211">Sintaxe do ODBC e OLE DB que dão suporte a SPNs</span><span class="sxs-lookup"><span data-stu-id="f61f3-211">ODBC and OLE DB Syntax Supporting SPNs</span></span>  
 <span data-ttu-id="f61f3-212">Para informações específicas de sintaxe, consulte os seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="f61f3-212">For syntax-specific information, see the following topics:</span></span>  
  
-   [<span data-ttu-id="f61f3-213">SPNs &#40;Nomes da Entidade de Serviço&#41; em conexões de cliente &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="f61f3-213">Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;</span></span>](../odbc/service-principal-names-spns-in-client-connections-odbc.md)  
  
-   [<span data-ttu-id="f61f3-214">SPNs &#40;Nomes da Entidade de Serviço&#41; em conexões de cliente &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="f61f3-214">Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;</span></span>](../ole-db/service-principal-names-spns-in-client-connections-ole-db.md)  
  
 <span data-ttu-id="f61f3-215">Para obter informações sobre aplicativos de exemplo que demonstram esse recurso, consulte [Exemplos de programabilidade de dados do SQL Server](https://msftdpprodsamples.codeplex.com/).</span><span class="sxs-lookup"><span data-stu-id="f61f3-215">For information about sample applications that demonstrate this feature, see [SQL Server Data Programmability Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f61f3-216">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="f61f3-216">See Also</span></span>  
 [<span data-ttu-id="f61f3-217">Recursos do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="f61f3-217">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
