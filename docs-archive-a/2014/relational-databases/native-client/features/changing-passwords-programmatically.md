---
title: Alterando senhas programaticamente | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], password expiration
- SQL Server Native Client ODBC driver, passwords
- SQL Server Native Client OLE DB provider, passwords
- passwords [SQL Server], expiration
- SQLNCLI, password expiration
- expiration [SQL Server Native Client]
- passwords [SQL Server], modifying
- expired passwords [SQL Server Native Client]
- SQL Server Native Client, password expiration
- modifying passwords
ms.assetid: 624ad949-5fed-4ce5-b319-878549f9487b
author: rothja
ms.author: jroth
ms.openlocfilehash: 86085f8ba7c54cfcab1a3c7f6e8ade30ecf9d0da
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87679921"
---
# <a name="changing-passwords-programmatically"></a><span data-ttu-id="cea99-102">Alterando senhas programaticamente</span><span class="sxs-lookup"><span data-stu-id="cea99-102">Changing Passwords Programmatically</span></span>
  <span data-ttu-id="cea99-103">Antes do [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], quando a senha de um usuário expirava, somente um administrador poderia redefini-la.</span><span class="sxs-lookup"><span data-stu-id="cea99-103">Before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], when a user's password expired, only an administrator could reset it.</span></span> <span data-ttu-id="cea99-104">A partir [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] do, o Native Client dá suporte ao tratamento de expiração de senha programaticamente por meio do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo e do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client e por meio de alterações nas caixas de diálogo de **logon do SQL Server** .</span><span class="sxs-lookup"><span data-stu-id="cea99-104">Beginning with [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client supports handling password expiration programmatically through both the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider and the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver, and through changes to the **SQL Server Login** dialog boxes.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cea99-105">Quando possível, solicite aos usuários que insiram suas credenciais em tempo de execução e que evitem armazená-las em um formato persistente.</span><span class="sxs-lookup"><span data-stu-id="cea99-105">When possible, prompt users to enter their credentials at run time and avoid storing their credentials in a persisted format.</span></span> <span data-ttu-id="cea99-106">Caso precise persistir as credenciais, criptografe-as usando a [Win32 crypto API](https://go.microsoft.com/fwlink/?LinkId=64532).</span><span class="sxs-lookup"><span data-stu-id="cea99-106">If you must persist their credentials, you should encrypt them using the [Win32 crypto API](https://go.microsoft.com/fwlink/?LinkId=64532).</span></span> <span data-ttu-id="cea99-107">Para obter mais informações sobre o uso de senhas, confira [Senhas fortes](../../security/strong-passwords.md).</span><span class="sxs-lookup"><span data-stu-id="cea99-107">For more information about the use of passwords, see [Strong Passwords](../../security/strong-passwords.md).</span></span>  
  
## <a name="sql-server-login-error-codes"></a><span data-ttu-id="cea99-108">Códigos de erro de logon do SQL Server</span><span class="sxs-lookup"><span data-stu-id="cea99-108">SQL Server Login Error Codes</span></span>  
 <span data-ttu-id="cea99-109">Quando não é possível estabelecer uma conexão devido a problemas de autenticação, um dos seguintes códigos de erro do SQL Server estará disponível para o aplicativo, de forma a auxiliar no diagnóstico e na recuperação.</span><span class="sxs-lookup"><span data-stu-id="cea99-109">When a connection cannot be made because of authentication problems, one of the following SQL Server error codes will be available to the application to assist diagnosis and recovery.</span></span>  
  
|<span data-ttu-id="cea99-110">Código de erro do SQL Server</span><span class="sxs-lookup"><span data-stu-id="cea99-110">SQL Server Error Code</span></span>|<span data-ttu-id="cea99-111">Mensagem de erro</span><span class="sxs-lookup"><span data-stu-id="cea99-111">Error Message</span></span>|  
|---------------------------|-------------------|  
|<span data-ttu-id="cea99-112">15113</span><span class="sxs-lookup"><span data-stu-id="cea99-112">15113</span></span>|<span data-ttu-id="cea99-113">Falha no logon do usuário '%.\*ls'. Motivo: falha na validação da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-113">Login failed for user '%.\*ls' Reason: Password validation failed.</span></span> <span data-ttu-id="cea99-114">A conta está bloqueada.</span><span class="sxs-lookup"><span data-stu-id="cea99-114">The account is locked out.</span></span>|  
|<span data-ttu-id="cea99-115">18463</span><span class="sxs-lookup"><span data-stu-id="cea99-115">18463</span></span>|<span data-ttu-id="cea99-116">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-116">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-117">Motivo: falha na alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-117">Reason: Password change failed.</span></span> <span data-ttu-id="cea99-118">A senha não pode ser usada neste momento.</span><span class="sxs-lookup"><span data-stu-id="cea99-118">The password cannot be used at this time.</span></span>|  
|<span data-ttu-id="cea99-119">18464</span><span class="sxs-lookup"><span data-stu-id="cea99-119">18464</span></span>|<span data-ttu-id="cea99-120">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-120">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-121">Motivo: falha na alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-121">Reason: Password change failed.</span></span> <span data-ttu-id="cea99-122">A senha não atende aos requisitos de política, pois é muito curta.</span><span class="sxs-lookup"><span data-stu-id="cea99-122">The password does not meet policy requirements because it is too short.</span></span>|  
|<span data-ttu-id="cea99-123">18465</span><span class="sxs-lookup"><span data-stu-id="cea99-123">18465</span></span>|<span data-ttu-id="cea99-124">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-124">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-125">Motivo: falha na alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-125">Reason: Password change failed.</span></span> <span data-ttu-id="cea99-126">A senha não atende aos requisitos de política, pois é muito longa.</span><span class="sxs-lookup"><span data-stu-id="cea99-126">The password does not meet policy requirements because it is too long.</span></span>|  
|<span data-ttu-id="cea99-127">18466</span><span class="sxs-lookup"><span data-stu-id="cea99-127">18466</span></span>|<span data-ttu-id="cea99-128">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-128">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-129">Motivo: falha na alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-129">Reason: Password change failed.</span></span> <span data-ttu-id="cea99-130">A senha não atende aos requisitos de política, pois não é complexa o bastante.</span><span class="sxs-lookup"><span data-stu-id="cea99-130">The password does not meet policy requirements because it is not complex enough.</span></span>|  
|<span data-ttu-id="cea99-131">18467</span><span class="sxs-lookup"><span data-stu-id="cea99-131">18467</span></span>|<span data-ttu-id="cea99-132">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-132">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-133">Motivo: falha na alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-133">Reason: Password change failed.</span></span> <span data-ttu-id="cea99-134">A senha não atende aos requisitos da DLL de filtragem de senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-134">The password does not meet the requirements of the password filter DLL.</span></span>|  
|<span data-ttu-id="cea99-135">18468</span><span class="sxs-lookup"><span data-stu-id="cea99-135">18468</span></span>|<span data-ttu-id="cea99-136">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-136">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-137">Motivo: falha na alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-137">Reason: Password change failed.</span></span> <span data-ttu-id="cea99-138">Ocorreu um erro inesperado durante a validação da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-138">An unexpected error occurred during password validation.</span></span>|  
|<span data-ttu-id="cea99-139">18487</span><span class="sxs-lookup"><span data-stu-id="cea99-139">18487</span></span>|<span data-ttu-id="cea99-140">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-140">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-141">Motivo: a senha da conta expirou.</span><span class="sxs-lookup"><span data-stu-id="cea99-141">Reason: The password of the account has expired.</span></span>|  
|<span data-ttu-id="cea99-142">18488</span><span class="sxs-lookup"><span data-stu-id="cea99-142">18488</span></span>|<span data-ttu-id="cea99-143">Falha no logon do usuário '%.\*ls'.</span><span class="sxs-lookup"><span data-stu-id="cea99-143">Login failed for user '%.\*ls'.</span></span> <span data-ttu-id="cea99-144">Motivo: a senha da conta deve ser alterada.</span><span class="sxs-lookup"><span data-stu-id="cea99-144">Reason: The password of the account must be changed.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="cea99-145">Provedor OLE DB do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cea99-145">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="cea99-146">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo dá suporte à expiração de senha por meio de uma interface do usuário e programatica</span><span class="sxs-lookup"><span data-stu-id="cea99-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration though a user interface and programmatically.</span></span>  
  
### <a name="ole-db-user-interface-password-expiration"></a><span data-ttu-id="cea99-147">Expiração de senha da interface do usuário OLE DB</span><span class="sxs-lookup"><span data-stu-id="cea99-147">OLE DB User Interface Password Expiration</span></span>  
 <span data-ttu-id="cea99-148">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo dá suporte à expiração de senha por meio de alterações feitas nas caixas de diálogo de **logon do SQL Server** .</span><span class="sxs-lookup"><span data-stu-id="cea99-148">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration through changes made to the **SQL Server Login** dialog boxes.</span></span> <span data-ttu-id="cea99-149">Se o valor de DBPROP_INIT_PROMPT for definido como DBPROMPT_NOPROMPT, a tentativa de conexão inicial irá falhar, caso a senha tenha expirado.</span><span class="sxs-lookup"><span data-stu-id="cea99-149">If the value of DBPROP_INIT_PROMPT is set to DBPROMPT_NOPROMPT, the initial connection attempt will fail if the password has expired.</span></span>  
  
 <span data-ttu-id="cea99-150">Se DBPROP_INIT_PROMPT tiver sido definido com outro valor, o usuário verá a caixa de diálogo **Logon do SQL Server**, independentemente de a senha ter expirado ou não.</span><span class="sxs-lookup"><span data-stu-id="cea99-150">If DBPROP_INIT_PROMPT has been set to any other value, the user sees the **SQL Server Login** dialog, regardless of whether or not the password has expired.</span></span> <span data-ttu-id="cea99-151">O usuário pode clicar no botão **Opções** e marcar **Alterar Senha** para alterar a senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-151">The user can click on the **Options** button and check **Change Password** to change the password.</span></span>  
  
 <span data-ttu-id="cea99-152">Se o usuário clicar em OK e a senha tiver expirado, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] solicitará que o usuário insira e confirme uma nova senha usando a caixa de diálogo **Alterar Senha do SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="cea99-152">If the user clicks OK and the password has expired, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prompts the user to enter and confirm a new password using the **Change SQL Server Password** dialog.</span></span>  
  
#### <a name="ole-db-prompt-behavior-and-locked-accounts"></a><span data-ttu-id="cea99-153">Contas bloqueadas e comportamento do prompt do OLE DB</span><span class="sxs-lookup"><span data-stu-id="cea99-153">OLE DB Prompt Behavior and Locked Accounts</span></span>  
 <span data-ttu-id="cea99-154">As tentativas de conexão podem falhar devido ao bloqueio da conta.</span><span class="sxs-lookup"><span data-stu-id="cea99-154">Connection attempts may fail due to the account being locked.</span></span> <span data-ttu-id="cea99-155">Se isso ocorrer após a exibição da caixa de diálogo **Logon do SQL Server**, a mensagem de erro do servidor será exibida para o usuário e a tentativa de conexão será anulada.</span><span class="sxs-lookup"><span data-stu-id="cea99-155">If this occurs following the display of the **SQL Server Login** dialog, the server error message is displayed to the user and the connection attempt is aborted.</span></span> <span data-ttu-id="cea99-156">Isso também poderá ocorrer após a exibição da caixa de diálogo **Alterar Senha do SQL Server** se o usuário inserir um valor incorreto para a senha antiga.</span><span class="sxs-lookup"><span data-stu-id="cea99-156">It may also occur following the display of the **Change SQL Server Password** dialog if the user enters a bad value for the old password.</span></span> <span data-ttu-id="cea99-157">Neste caso, a mesma mensagem de erro será exibida e a tentativa de conexão será anulada.</span><span class="sxs-lookup"><span data-stu-id="cea99-157">In this case the same error message is displayed, and the connection attempt is aborted.</span></span>  
  
#### <a name="ole-db-connection-pooling-password-expiration-and-locked-accounts"></a><span data-ttu-id="cea99-158">Contas bloqueadas, expiração de senha e pool de conexão do OLE DB</span><span class="sxs-lookup"><span data-stu-id="cea99-158">OLE DB Connection Pooling, Password Expiration, and Locked Accounts</span></span>  
 <span data-ttu-id="cea99-159">Uma conta pode ser bloqueada ou sua senha pode expirar enquanto a conexão ainda está ativa em um pool de conexão.</span><span class="sxs-lookup"><span data-stu-id="cea99-159">An account may be locked or its password may expire while the connection is still active in a connection pool.</span></span> <span data-ttu-id="cea99-160">O servidor verifica senhas expiradas e contas bloqueadas em duas ocasiões.</span><span class="sxs-lookup"><span data-stu-id="cea99-160">The server checks for expired passwords and locked accounts on two occasions.</span></span> <span data-ttu-id="cea99-161">A primeiro ao criar uma conexão pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="cea99-161">The first is when a connection is first created.</span></span> <span data-ttu-id="cea99-162">A segunda ocasião é ao redefinir a conexão, quando ela é tirada do pool.</span><span class="sxs-lookup"><span data-stu-id="cea99-162">The second occasion is upon connection reset, when the connection is taken from the pool.</span></span>  
  
 <span data-ttu-id="cea99-163">Quando a tentativa de redefinição falha, a conexão é removida do pool e um erro é retornado.</span><span class="sxs-lookup"><span data-stu-id="cea99-163">When the reset attempt fails, the connection is removed from the pool and an error is returned.</span></span>  
  
### <a name="ole-db-programmatic-password-expiration"></a><span data-ttu-id="cea99-164">Expiração de senha programática do OLE DB</span><span class="sxs-lookup"><span data-stu-id="cea99-164">OLE DB Programmatic Password Expiration</span></span>  
 <span data-ttu-id="cea99-165">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo dá suporte à expiração de senha por meio da adição da propriedade SSPROP_AUTH_OLD_PASSWORD (tipo VT_BSTR) que foi adicionada ao conjunto de propriedades DBPROPSET_SQLSERVERDBINIT.</span><span class="sxs-lookup"><span data-stu-id="cea99-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration through the addition of the SSPROP_AUTH_OLD_PASSWORD (type VT_BSTR) property that has been added to the DBPROPSET_SQLSERVERDBINIT property set.</span></span>  
  
 <span data-ttu-id="cea99-166">A propriedade "Password" existente referencia DBPROP_AUTH_PASSWORD e é usada para armazenar a nova senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-166">The existing "Password" property refers to DBPROP_AUTH_PASSWORD and is used to store the new password.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cea99-167">Na cadeia de conexão, a propriedade "Old Password" define SSPROP_AUTH_OLD_PASSWORD, que é a senha atual (provavelmente expirada) que não está disponível por meio de uma propriedade de cadeia de caracteres do provedor.</span><span class="sxs-lookup"><span data-stu-id="cea99-167">In the connection string, the "Old Password" property sets SSPROP_AUTH_OLD_PASSWORD, which is the current (possibly expired) password that is not available via a provider string property.</span></span>  
  
 <span data-ttu-id="cea99-168">O provedor não mantém o valor desta propriedade.</span><span class="sxs-lookup"><span data-stu-id="cea99-168">The provider does not persist the value of this property.</span></span> <span data-ttu-id="cea99-169">Quando esta propriedade é definida, o provedor não usa o pool de conexão na primeira conexão, pois ocorrerá uma nova conexão.</span><span class="sxs-lookup"><span data-stu-id="cea99-169">When this property is set, the provider does not use the connection pool for the first connection because a new connection will occur.</span></span> <span data-ttu-id="cea99-170">Se a alteração da senha tiver êxito, não será possível reutilizar a conexão atual, pois ela ainda conterá a senha antiga, que será inválida após a alteração da senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-170">If the password change is successful, the current connection cannot be reused since it still contains the old password, which will be invalid after the password change.</span></span> <span data-ttu-id="cea99-171">Além disso, se o logon for bem-sucedido, o provedor limpará essa propriedade.</span><span class="sxs-lookup"><span data-stu-id="cea99-171">Also, if the login succeeds, the provider clears this property.</span></span> <span data-ttu-id="cea99-172">As tentativas subsequentes de recuperar a senha antiga retornarão VT_EMPTY.</span><span class="sxs-lookup"><span data-stu-id="cea99-172">Subsequent attempts to retrieve the old password return VT_EMPTY.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="cea99-173">SSPROP_AUTH_OLD_PASSWORD nunca deve ser mantido, pois ele é usado somente quando uma senha expirou.</span><span class="sxs-lookup"><span data-stu-id="cea99-173">SSPROP_AUTH_OLD_PASSWORD should never be persisted since it is only used when a password has expired.</span></span>  
  
 <span data-ttu-id="cea99-174">Sempre que a propriedade "Old Password" é definida, o provedor supõe que está sendo feita uma tentativa de alterar a senha, a menos que a Autenticação do Windows também seja especificada; nesse caso, ela sempre terá precedência.</span><span class="sxs-lookup"><span data-stu-id="cea99-174">Note that whenever the "Old Password" property is set, the provider assumes that an attempt to change the password is being made, unless Windows Authentication is also specified, in which case it always takes precedence.</span></span>  
  
 <span data-ttu-id="cea99-175">Se a Autenticação do Windows for usada, a especificação da senha antiga resultará em DB_E_ERRORSOCCURRED ou DB_S_ERRORSOCCURRED, dependendo de a senha antiga ter sido especificada como REQUIRED ou OPTIONAL, respectivamente, e o valor de status de DBPROPSTATUS_CONFLICTINGBADVALUE será retornado em *dwStatus*.</span><span class="sxs-lookup"><span data-stu-id="cea99-175">If Windows Authentication is used, specifying the old password results in either DB_E_ERRORSOCCURRED or DB_S_ERRORSOCCURRED depending on whether the old password was specified as REQUIRED or OPTIONAL respectively, and the status value of DBPROPSTATUS_CONFLICTINGBADVALUE is returned in *dwStatus*.</span></span> <span data-ttu-id="cea99-176">Isto é detectado quando **IDBInitialize::Initialize** é chamado.</span><span class="sxs-lookup"><span data-stu-id="cea99-176">This is detected when **IDBInitialize::Initialize** is called.</span></span>  
  
 <span data-ttu-id="cea99-177">Se uma tentativa de alterar a senha falhar inesperadamente, o servidor retornará o código de erro 18468.</span><span class="sxs-lookup"><span data-stu-id="cea99-177">If an attempt to change the password fails unexpectedly, the server returns error code 18468.</span></span> <span data-ttu-id="cea99-178">Um erro OLEDB padrão é retornado da tentativa de conexão.</span><span class="sxs-lookup"><span data-stu-id="cea99-178">A standard OLEDB error is returned from the connection attempt.</span></span>  
  
 <span data-ttu-id="cea99-179">Para obter mais informações sobre o conjunto de propriedades DBPROPSET_SQLSERVERDBINIT, confira [Propriedades de inicialização e autorização](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span><span class="sxs-lookup"><span data-stu-id="cea99-179">For more information about the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="cea99-180">Driver ODBC do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cea99-180">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="cea99-181">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo dá suporte à expiração de senha por meio de uma interface do usuário e programatica</span><span class="sxs-lookup"><span data-stu-id="cea99-181">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports password expiration though a user interface and programmatically.</span></span>  
  
### <a name="odbc-user-interface-password-expiration"></a><span data-ttu-id="cea99-182">Expiração de senha da interface do usuário ODBC</span><span class="sxs-lookup"><span data-stu-id="cea99-182">ODBC User Interface Password Expiration</span></span>  
 <span data-ttu-id="cea99-183">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client dá suporte à expiração de senha por meio de alterações feitas nas caixas de diálogo de **SQL Server logon** .</span><span class="sxs-lookup"><span data-stu-id="cea99-183">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports password expiration through changes made to the **SQL Server Login** dialog boxes.</span></span>  
  
 <span data-ttu-id="cea99-184">Se [SQLDriverConnect](../../native-client-odbc-api/sqldriverconnect.md) for chamado e o valor de **DriverCompletion** for definido como SQL_DRIVER_NOPROMPT, a tentativa de conexão inicial falhará se a senha tiver expirado.</span><span class="sxs-lookup"><span data-stu-id="cea99-184">If [SQLDriverConnect](../../native-client-odbc-api/sqldriverconnect.md) is called and the value of **DriverCompletion** is set to SQL_DRIVER_NOPROMPT, the initial connection attempt fails if the password has expired.</span></span> <span data-ttu-id="cea99-185">O valor SQLSTATE 28000 e o valor de código de erro nativo 18487 são retornados por chamadas subsequentes para **SqlError** ou **SQLGetDiagRec**.</span><span class="sxs-lookup"><span data-stu-id="cea99-185">The SQLSTATE value 28000 and the native error code value 18487 are returned by subsequent calls to **SQLError** or **SQLGetDiagRec**.</span></span>  
  
 <span data-ttu-id="cea99-186">Se **DriverCompletion** tiver sido definido como qualquer outro valor, o usuário verá a caixa de diálogo **SQL Server logon** , independentemente de a senha ter expirado ou não.</span><span class="sxs-lookup"><span data-stu-id="cea99-186">If **DriverCompletion** has been set to any other value, the user sees the **SQL Server Login** dialog, regardless of whether or not the password has expired.</span></span> <span data-ttu-id="cea99-187">O usuário pode clicar no botão **Opções** e marcar **Alterar Senha** para alterar a senha.</span><span class="sxs-lookup"><span data-stu-id="cea99-187">The user can click on the **Options** button and check **Change Password** to change the password.</span></span>  
  
 <span data-ttu-id="cea99-188">Se o usuário clicar em OK e a senha tiver expirado, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] solicitará a inserção e a confirmação de uma nova senha usando a caixa de diálogo **alterar SQL Server senha** .</span><span class="sxs-lookup"><span data-stu-id="cea99-188">If the user clicks OK and the password has expired, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prompts to enter and confirm a new password using the **Change SQL Server Password** dialog.</span></span>  
  
#### <a name="odbc-prompt-behavior-and-locked-accounts"></a><span data-ttu-id="cea99-189">Contas bloqueadas e comportamento do prompt do ODBC</span><span class="sxs-lookup"><span data-stu-id="cea99-189">ODBC Prompt Behavior and Locked Accounts</span></span>  
 <span data-ttu-id="cea99-190">As tentativas de conexão podem falhar devido ao bloqueio da conta.</span><span class="sxs-lookup"><span data-stu-id="cea99-190">Connection attempts may fail due to the account being locked.</span></span> <span data-ttu-id="cea99-191">Se isso ocorrer após a exibição da caixa de diálogo **Logon do SQL Server**, a mensagem de erro do servidor será exibida para o usuário e a tentativa de conexão será anulada.</span><span class="sxs-lookup"><span data-stu-id="cea99-191">If this occurs following the display of the **SQL Server Login** dialog, the server error message is displayed to the user and the connection attempt is aborted.</span></span> <span data-ttu-id="cea99-192">Isso também poderá ocorrer após a exibição da caixa de diálogo **Alterar Senha do SQL Server** se o usuário inserir um valor incorreto para a senha antiga.</span><span class="sxs-lookup"><span data-stu-id="cea99-192">It may also occur following the display of the **Change SQL Server Password** dialog if the user enters a bad value for the old password.</span></span> <span data-ttu-id="cea99-193">Neste caso, a mesma mensagem de erro será exibida e a tentativa de conexão será anulada.</span><span class="sxs-lookup"><span data-stu-id="cea99-193">In this case the same error message is displayed, and the connection attempt is aborted.</span></span>  
  
#### <a name="odbc-connection-pooling-password-expiry-and-locked-accounts"></a><span data-ttu-id="cea99-194">Contas bloqueadas, expiração de senha e pool de conexão do ODBC</span><span class="sxs-lookup"><span data-stu-id="cea99-194">ODBC Connection Pooling, Password Expiry, and Locked Accounts</span></span>  
 <span data-ttu-id="cea99-195">Uma conta pode ser bloqueada ou sua senha pode expirar enquanto a conexão ainda está ativa em um pool de conexão.</span><span class="sxs-lookup"><span data-stu-id="cea99-195">An account may be locked or its password may expire while the connection is still active in a connection pool.</span></span> <span data-ttu-id="cea99-196">O servidor verifica senhas expiradas e contas bloqueadas em duas ocasiões.</span><span class="sxs-lookup"><span data-stu-id="cea99-196">The server checks for expired passwords and locked accounts on two occasions.</span></span> <span data-ttu-id="cea99-197">A primeiro ao criar uma conexão pela primeira vez.</span><span class="sxs-lookup"><span data-stu-id="cea99-197">The first is when a connection is first created.</span></span> <span data-ttu-id="cea99-198">A segunda ocasião é ao redefinir a conexão, quando ela é tirada do pool.</span><span class="sxs-lookup"><span data-stu-id="cea99-198">The second occasion is upon connection reset, when the connection is taken from the pool.</span></span>  
  
 <span data-ttu-id="cea99-199">Quando a tentativa de redefinição falha, a conexão é removida do pool e um erro é retornado.</span><span class="sxs-lookup"><span data-stu-id="cea99-199">When the reset attempt fails, the connection is removed from the pool and an error is returned.</span></span>  
  
### <a name="odbc-programmatic-password-expiration"></a><span data-ttu-id="cea99-200">Expiração de senha programática do ODBC</span><span class="sxs-lookup"><span data-stu-id="cea99-200">ODBC Programmatic Password Expiration</span></span>  
 <span data-ttu-id="cea99-201">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client dá suporte à expiração de senha por meio da adição do atributo SQL_COPT_SS_OLDPWD, que é definido antes da conexão com o servidor usando a função [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) .</span><span class="sxs-lookup"><span data-stu-id="cea99-201">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports password expiration through the addition of the SQL_COPT_SS_OLDPWD attribute which is set before connecting to the server using the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) function.</span></span>  
  
 <span data-ttu-id="cea99-202">O atributo SQL_COPT_SS_OLDPWD do identificador de conexão referencia a senha expirada.</span><span class="sxs-lookup"><span data-stu-id="cea99-202">The SQL_COPT_SS_OLDPWD attribute of the connection handle refers to the expired password.</span></span> <span data-ttu-id="cea99-203">Não há nenhum atributo de cadeia de conexão para esse atributo, pois isto interferiria com o pool de conexão.</span><span class="sxs-lookup"><span data-stu-id="cea99-203">There is no connection string attribute for this attribute, as this would interfere with connection pooling.</span></span> <span data-ttu-id="cea99-204">Se o logon tiver êxito, o driver limpará esse atributo.</span><span class="sxs-lookup"><span data-stu-id="cea99-204">If the login succeeds, the driver clears this attribute.</span></span>  
  
 <span data-ttu-id="cea99-205">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client retorna SQL_ERROR em quatro casos para esse recurso: expiração de senha, conflito de política de senha, bloqueio de conta e quando a propriedade de senha antiga é definida ao usar a autenticação do Windows.</span><span class="sxs-lookup"><span data-stu-id="cea99-205">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver returns SQL_ERROR in four cases for this feature: password expiration, password policy conflict, account lockout, and when the old password property is set while using Windows Authentication.</span></span> <span data-ttu-id="cea99-206">O driver retorna as mensagens de erro apropriadas ao usuário quando [SQLGetDiagField](../../native-client-odbc-api/sqlgetdiagfield.md) é invocado.</span><span class="sxs-lookup"><span data-stu-id="cea99-206">The driver returns the appropriate error messages to the user when [SQLGetDiagField](../../native-client-odbc-api/sqlgetdiagfield.md) is invoked.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cea99-207">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="cea99-207">See Also</span></span>  
 [<span data-ttu-id="cea99-208">Recursos do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="cea99-208">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
