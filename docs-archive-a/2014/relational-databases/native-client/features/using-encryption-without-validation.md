---
title: Usando criptografia sem validação | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], encryption
- cryptography [SQL Server Native Client]
- SQLNCLI, encryption
- encryption [SQL Server Native Client]
- SQL Server Native Client, encryption
ms.assetid: f4c63206-80bb-4d31-84ae-ccfcd563effa
author: rothja
ms.author: jroth
ms.openlocfilehash: 0a6d2e8b3d696a92e3fa3e1b7de7604551d4f9ce
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570662"
---
# <a name="using-encryption-without-validation"></a><span data-ttu-id="b2c8b-102">Usando criptografia sem validação</span><span class="sxs-lookup"><span data-stu-id="b2c8b-102">Using Encryption Without Validation</span></span>
  <span data-ttu-id="b2c8b-103">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] sempre criptografa pacotes de rede associados a logon.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-103">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] always encrypts network packets associated with logging in.</span></span> <span data-ttu-id="b2c8b-104">Se nenhum certificado tiver sido provisionado no servidor quando ele foi inicializado, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] gerará um certificado autoassinado usado para criptografar pacotes de login.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-104">If no certificate has been provisioned on the server when it starts up, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] generates a self-signed certificate which is used to encrypt login packets.</span></span>  
  
 <span data-ttu-id="b2c8b-105">Os aplicativos também podem solicitar a criptografia de todo o tráfego de rede usando palavras-chave de cadeia de conexão ou propriedades de conexão.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-105">Applications may also request encryption of all network traffic by using connection string keywords or connection properties.</span></span> <span data-ttu-id="b2c8b-106">As palavras-chave são "Encrypt" para ODBC e OLE DB ao usar uma cadeia de caracteres de provedor com **IDBInitialize:: Initialize**ou "usar criptografia para dados" para ADO e OLE DB ao usar uma cadeia de inicialização com **IDataInitialize**.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-106">The keywords are "Encrypt" for ODBC and OLE DB when using a provider string with **IDbInitialize::Initialize**, or "Use Encryption for Data" for ADO and OLE DB when using an initialization string with **IDataInitialize**.</span></span> <span data-ttu-id="b2c8b-107">Isso também pode ser configurado por [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager usando a opção **forçar criptografia de protocolo** .</span><span class="sxs-lookup"><span data-stu-id="b2c8b-107">This may also be configured by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager using the **Force Protocol Encryption** option.</span></span> <span data-ttu-id="b2c8b-108">Por padrão, a criptografia de todo o tráfego de rede para uma conexão requer que um certificado seja aprovisionado no servidor.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-108">By default, encryption of all network traffic for a connection requires that a certificate be provisioned on the server.</span></span>  
  
 <span data-ttu-id="b2c8b-109">Para obter informações sobre palavras-chave da cadeia de conexão, consulte [usando palavras-chave da cadeia de conexão com SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="b2c8b-109">For information about connection string keywords, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="b2c8b-110">Para permitir o uso da criptografia quando um certificado não for provisionado no servidor, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager poderá ser usado para definir as opções **Forçar Criptografia de Protocolo** e **Confiar em Certificado do Servidor**.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-110">To enable encryption to be used when a certificate has not been provisioned on the server, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Configuration Manager can be used to set both the **Force Protocol Encryption** and the **Trust Server Certificate** options.</span></span> <span data-ttu-id="b2c8b-111">Neste caso, a criptografia usará um certificado do servidor autoassinado sem validação, se nenhum certificado verificável tiver sido provisionado no servidor.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-111">In this case, encryption will use a self-signed server certificate without validation if no verifiable certificate has been provisioned on the server.</span></span>  
  
 <span data-ttu-id="b2c8b-112">Os aplicativos também podem usar a palavra-chave "TrustServerCertificate" ou seu atributo de conexão associado para garantir a criptografia.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-112">Applications may also use the "TrustServerCertificate" keyword or its associated connection attribute to guarantee that encryption takes place.</span></span> <span data-ttu-id="b2c8b-113">As configurações do aplicativo nunca reduzem o nível de segurança definido pelo [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Gerenciador de Configurações de Cliente, mas podem fortalecê-la.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-113">Application settings never reduce the level of security set by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Client Configuration Manager, but may strengthen it.</span></span> <span data-ttu-id="b2c8b-114">Por exemplo, se a opção **Forçar Criptografia de Protocolo** não for definida para o cliente, um aplicativo poderá solicitar a criptografia por conta própria.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-114">For example, if **Force Protocol Encryption** is not set for the client, an application may request encryption itself.</span></span> <span data-ttu-id="b2c8b-115">Para garantir a criptografia até mesmo quando um certificado do servidor não foi provisionado, um aplicativo pode solicitar a criptografia e "TrustServerCertificate".</span><span class="sxs-lookup"><span data-stu-id="b2c8b-115">To guarantee encryption even when a server certificate has not been provisioned, an application may request encryption and "TrustServerCertificate".</span></span> <span data-ttu-id="b2c8b-116">Porém, se "TrustServerCertificate" não for habilitado na configuração do cliente, um certificado do servidor provisionado ainda será necessário.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-116">However, if "TrustServerCertificate" is not enabled in the client configuration, a provisioned server certificate is still required.</span></span> <span data-ttu-id="b2c8b-117">A tabela a seguir descreve todos os casos:</span><span class="sxs-lookup"><span data-stu-id="b2c8b-117">The following table describes all cases:</span></span>  
  
|<span data-ttu-id="b2c8b-118">Configuração do cliente Forçar Criptografia de Protocolo</span><span class="sxs-lookup"><span data-stu-id="b2c8b-118">Force Protocol Encryption client setting</span></span>|<span data-ttu-id="b2c8b-119">Configuração do cliente Confiar em Certificado do Servidor</span><span class="sxs-lookup"><span data-stu-id="b2c8b-119">Trust Server Certificate client setting</span></span>|<span data-ttu-id="b2c8b-120">Atributo de conexão/cadeia de conexão Criptografar/Usar criptografia de dados</span><span class="sxs-lookup"><span data-stu-id="b2c8b-120">Connection string/connection attribute Encrypt/Use Encryption for Data</span></span>|<span data-ttu-id="b2c8b-121">Atributo de conexão/cadeia de conexão Confiar em Certificado do Servidor</span><span class="sxs-lookup"><span data-stu-id="b2c8b-121">Connection string/connection attribute Trust Server Certificate</span></span>|<span data-ttu-id="b2c8b-122">Result</span><span class="sxs-lookup"><span data-stu-id="b2c8b-122">Result</span></span>|  
|----------------------------------------------|---------------------------------------------|------------------------------------------------------------------------------|----------------------------------------------------------------------|------------|  
|<span data-ttu-id="b2c8b-123">Não</span><span class="sxs-lookup"><span data-stu-id="b2c8b-123">No</span></span>|<span data-ttu-id="b2c8b-124">N/D</span><span class="sxs-lookup"><span data-stu-id="b2c8b-124">N/A</span></span>|<span data-ttu-id="b2c8b-125">Não (padrão)</span><span class="sxs-lookup"><span data-stu-id="b2c8b-125">No (default)</span></span>|<span data-ttu-id="b2c8b-126">Ignored</span><span class="sxs-lookup"><span data-stu-id="b2c8b-126">Ignored</span></span>|<span data-ttu-id="b2c8b-127">Não ocorre criptografia.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-127">No encryption occurs.</span></span>|  
|<span data-ttu-id="b2c8b-128">Não</span><span class="sxs-lookup"><span data-stu-id="b2c8b-128">No</span></span>|<span data-ttu-id="b2c8b-129">N/D</span><span class="sxs-lookup"><span data-stu-id="b2c8b-129">N/A</span></span>|<span data-ttu-id="b2c8b-130">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-130">Yes</span></span>|<span data-ttu-id="b2c8b-131">Não (padrão)</span><span class="sxs-lookup"><span data-stu-id="b2c8b-131">No (default)</span></span>|<span data-ttu-id="b2c8b-132">A criptografia só ocorrerá se houver um certificado de servidor verificável; caso contrário, a tentativa de conexão falhará.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-132">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="b2c8b-133">Não</span><span class="sxs-lookup"><span data-stu-id="b2c8b-133">No</span></span>|<span data-ttu-id="b2c8b-134">N/D</span><span class="sxs-lookup"><span data-stu-id="b2c8b-134">N/A</span></span>|<span data-ttu-id="b2c8b-135">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-135">Yes</span></span>|<span data-ttu-id="b2c8b-136">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-136">Yes</span></span>|<span data-ttu-id="b2c8b-137">A criptografia sempre ocorre, mas pode usar um certificado do servidor autoassinado.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-137">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="b2c8b-138">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-138">Yes</span></span>|<span data-ttu-id="b2c8b-139">Não</span><span class="sxs-lookup"><span data-stu-id="b2c8b-139">No</span></span>|<span data-ttu-id="b2c8b-140">Ignored</span><span class="sxs-lookup"><span data-stu-id="b2c8b-140">Ignored</span></span>|<span data-ttu-id="b2c8b-141">Ignored</span><span class="sxs-lookup"><span data-stu-id="b2c8b-141">Ignored</span></span>|<span data-ttu-id="b2c8b-142">A criptografia só ocorrerá se houver um certificado de servidor verificável; caso contrário, a tentativa de conexão falhará.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-142">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="b2c8b-143">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-143">Yes</span></span>|<span data-ttu-id="b2c8b-144">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-144">Yes</span></span>|<span data-ttu-id="b2c8b-145">Não (padrão)</span><span class="sxs-lookup"><span data-stu-id="b2c8b-145">No (default)</span></span>|<span data-ttu-id="b2c8b-146">Ignored</span><span class="sxs-lookup"><span data-stu-id="b2c8b-146">Ignored</span></span>|<span data-ttu-id="b2c8b-147">A criptografia sempre ocorre, mas pode usar um certificado do servidor autoassinado.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-147">Encryption always occurs, but may use a self-signed server certificate.</span></span>|  
|<span data-ttu-id="b2c8b-148">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-148">Yes</span></span>|<span data-ttu-id="b2c8b-149">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-149">Yes</span></span>|<span data-ttu-id="b2c8b-150">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-150">Yes</span></span>|<span data-ttu-id="b2c8b-151">Não (padrão)</span><span class="sxs-lookup"><span data-stu-id="b2c8b-151">No (default)</span></span>|<span data-ttu-id="b2c8b-152">A criptografia só ocorrerá se houver um certificado de servidor verificável; caso contrário, a tentativa de conexão falhará.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-152">Encryption occurs only if there is a verifiable server certificate, otherwise the connection attempt fails.</span></span>|  
|<span data-ttu-id="b2c8b-153">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-153">Yes</span></span>|<span data-ttu-id="b2c8b-154">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-154">Yes</span></span>|<span data-ttu-id="b2c8b-155">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-155">Yes</span></span>|<span data-ttu-id="b2c8b-156">Sim</span><span class="sxs-lookup"><span data-stu-id="b2c8b-156">Yes</span></span>|<span data-ttu-id="b2c8b-157">A criptografia sempre ocorre, mas pode usar um certificado de servidor autoassinado.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-157">Encryption always occurs, but might use a self-signed server certificate.</span></span>|  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="b2c8b-158">Provedor OLE DB do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="b2c8b-158">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="b2c8b-159">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo dá suporte à criptografia sem validação por meio da adição da propriedade de inicialização da fonte de dados SSPROP_INIT_TRUST_SERVER_CERTIFICATE, que é implementada no conjunto de propriedades DBPROPSET_SQLSERVERDBINIT.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-159">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports encryption without validation through the addition of the SSPROP_INIT_TRUST_SERVER_CERTIFICATE data source initialization property, which is implemented in the DBPROPSET_SQLSERVERDBINIT property set.</span></span> <span data-ttu-id="b2c8b-160">Além disso, uma nova palavra-chave de cadeia de conexão, "TrustServerCertificate", foi adicionada.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-160">In addition, a new connection string keyword, "TrustServerCertificate", as been added.</span></span> <span data-ttu-id="b2c8b-161">Ela aceita os valores sim ou não; não é o padrão.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-161">It accepts yes or no values; no is the default.</span></span> <span data-ttu-id="b2c8b-162">Ao usar componentes de serviço, aceita os valores true ou false; false é o padrão.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-162">When using service components, it accepts true or false values; false is the default.</span></span>  
  
 <span data-ttu-id="b2c8b-163">Para obter mais informações sobre aprimoramentos realizados no conjunto de propriedades DBPROPSET_SQLSERVERDBINIT, confira [Propriedades de inicialização e autorização](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span><span class="sxs-lookup"><span data-stu-id="b2c8b-163">For more information about enhancements made to the DBPROPSET_SQLSERVERDBINIT property set, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="b2c8b-164">Driver ODBC do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="b2c8b-164">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="b2c8b-165">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client dá suporte à criptografia sem validação por meio de adições às funções [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) e [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) .</span><span class="sxs-lookup"><span data-stu-id="b2c8b-165">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports encryption without validation through additions to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions.</span></span> <span data-ttu-id="b2c8b-166">SQL_COPT_SS_TRUST_SERVER_CERTIFICATE foi adicionado para aceitar SQL_TRUST_SERVER_CERTIFICATE_YES ou SQL_TRUST_SERVER_CERTIFICATE_NO, com SQL_TRUST_SERVER_CERTIFICATE_NO sendo padrão.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-166">SQL_COPT_SS_TRUST_SERVER_CERTIFICATE has been added to accept either SQL_TRUST_SERVER_CERTIFICATE_YES or SQL_TRUST_SERVER_CERTIFICATE_NO, with SQL_TRUST_SERVER_CERTIFICATE_NO being the default.</span></span> <span data-ttu-id="b2c8b-167">Além disso, uma nova palavra-chave de cadeia de conexão, “TrustServerCertificate”, foi adicionada.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-167">In addition, a new connection string keyword, "TrustServerCertificate", has been added.</span></span> <span data-ttu-id="b2c8b-168">Ele aceita sim ou nenhum valor; "não" é o padrão.</span><span class="sxs-lookup"><span data-stu-id="b2c8b-168">It accepts yes or no values; "no" is the default.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b2c8b-169">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="b2c8b-169">See Also</span></span>  
 [<span data-ttu-id="b2c8b-170">Recursos do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="b2c8b-170">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
