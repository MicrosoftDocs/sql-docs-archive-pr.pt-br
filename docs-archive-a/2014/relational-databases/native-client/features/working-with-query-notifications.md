---
title: Trabalhando com notificações de consulta | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], query notifications
- rowsets [SQL Server], notifications
- SQL Server Native Client, query notifications
- notifications [SQL Server Native Client]
- query notifications [SQL Server], SQL Server Native Client
- canceling rowset changes
- IRowsetNotify interface
- SQLNCLI, query notifications
- SQL Server Native Client OLE DB provider, query notifications
- consumer notification for rowset changes [SQL Server Native Client]
ms.assetid: 2f906fff-5ed9-4527-9fd3-9c0d27c3dff7
author: rothja
ms.author: jroth
ms.openlocfilehash: ba30bfc8df05a55e297ae8fcb8e2253de57e3ca6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87576313"
---
# <a name="working-with-query-notifications"></a><span data-ttu-id="093bf-102">Trabalhando com notificações de consulta</span><span class="sxs-lookup"><span data-stu-id="093bf-102">Working with Query Notifications</span></span>
  <span data-ttu-id="093bf-103">As notificações de consulta foram introduzidas no [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] e [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="093bf-103">Query notifications were introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="093bf-104">Baseadas na infraestrutura do Service Broker, introduzida no [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], as notificações de consulta permitem que os aplicativos sejam notificados em caso de alteração nos dados.</span><span class="sxs-lookup"><span data-stu-id="093bf-104">Built upon the Service Broker infrastructure introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], query notifications allow applications to be notified when data has changed.</span></span> <span data-ttu-id="093bf-105">Esse recurso é particularmente útil para aplicativos que fornecem um cache de informações de um banco de dados, como um aplicativo da Web, e precisam ser notificados quando os dados de origem são alterados.</span><span class="sxs-lookup"><span data-stu-id="093bf-105">This feature is particularly useful for applications that provide a cache of information from a database, such as a Web application, and need to be notified when the source data is changed.</span></span>  
  
 <span data-ttu-id="093bf-106">As notificações de consulta permitem que você solicite uma notificação em um tempo limite especificado quando os dados subjacentes de uma consulta são alterados.</span><span class="sxs-lookup"><span data-stu-id="093bf-106">Query notifications allow you to request notification within a specified time-out period when the underlying data of a query changes.</span></span> <span data-ttu-id="093bf-107">A solicitação por notificação especifica as opções de notificação, que incluem o nome do serviço, o texto da mensagem e o valor do tempo limite do servidor.</span><span class="sxs-lookup"><span data-stu-id="093bf-107">The request for notification specifies the notification options, which include the service name, message text, and time-out value to the server.</span></span> <span data-ttu-id="093bf-108">As notificações são entregues através de uma fila do Service Broker na qual os aplicativos podem sondar as notificações disponíveis.</span><span class="sxs-lookup"><span data-stu-id="093bf-108">Notifications are delivered through a Service Broker queue that applications may poll for available notifications.</span></span>  
  
 <span data-ttu-id="093bf-109">A sintaxe da cadeia de caracteres das opções de notificação de consulta é:</span><span class="sxs-lookup"><span data-stu-id="093bf-109">The syntax of the query notifications options string is:</span></span>  
  
 `service=<service-name>[;(local database=<database> | broker instance=<broker instance>)]`  
  
 <span data-ttu-id="093bf-110">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="093bf-110">For example:</span></span>  
  
 `service=mySSBService;local database=mydb`  
  
 <span data-ttu-id="093bf-111">As assinaturas de notificação duram mais tempo do que o processo que as inicia, já que um aplicativo pode criar uma assinatura de notificação e, em seguida, ser encerrado.</span><span class="sxs-lookup"><span data-stu-id="093bf-111">Notification subscriptions outlive the process that initiates them, as an application may create a notification subscription and then terminate.</span></span> <span data-ttu-id="093bf-112">A assinatura permanece válida e a notificação será feita se os dados forem alterados no tempo limite especificado na criação da assinatura.</span><span class="sxs-lookup"><span data-stu-id="093bf-112">The subscription remains valid, and the notification will occur if the data changes within the time-out period specified when the subscription was created.</span></span> <span data-ttu-id="093bf-113">Uma notificação é identificada pela consulta executada, pelas opções de notificação e pelo texto da mensagem, podendo ser cancelada definindo-se o valor de seu tempo limite como zero.</span><span class="sxs-lookup"><span data-stu-id="093bf-113">A notification is identified by the query executed, the notification options, and the message text, and may be cancelled by setting its time-out value to zero.</span></span>  
  
 <span data-ttu-id="093bf-114">As notificações só são enviadas uma vez.</span><span class="sxs-lookup"><span data-stu-id="093bf-114">Notifications are sent only once.</span></span> <span data-ttu-id="093bf-115">Para que as notificações de alteração de dados sejam contínuas, é preciso criar uma nova assinatura e executar novamente a consulta depois que cada notificação foi processada.</span><span class="sxs-lookup"><span data-stu-id="093bf-115">For continuous notification of data change, a new subscription must be created by re-executing the query after each notification is processed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="093bf-116">Os aplicativos cliente nativos normalmente recebem notificações usando o [!INCLUDE[tsql](../../../includes/tsql-md.md)] comando [Receive](/sql/t-sql/statements/receive-transact-sql) para ler notificações da fila associada ao serviço especificado nas opções de notificação.</span><span class="sxs-lookup"><span data-stu-id="093bf-116">Native Client applications typically receive notifications by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [RECEIVE](/sql/t-sql/statements/receive-transact-sql) command to read notifications from the queue associated with the service specified in the notification options.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="093bf-117">Os nomes de tabela devem ser qualificados nas consultas para as quais a notificação é requerida, por exemplo, `dbo.myTable`.</span><span class="sxs-lookup"><span data-stu-id="093bf-117">Table names must be qualified in queries for which notification is required, for example, `dbo.myTable`.</span></span> <span data-ttu-id="093bf-118">Os nomes de tabela devem ser qualificados com nomes de duas partes.</span><span class="sxs-lookup"><span data-stu-id="093bf-118">Table names must be qualified with two part names.</span></span> <span data-ttu-id="093bf-119">A assinatura é considerada inválida se nomes com três ou quatro partes são usados.</span><span class="sxs-lookup"><span data-stu-id="093bf-119">Subscription is invalid if three- or four-part names are used.</span></span>  
  
 <span data-ttu-id="093bf-120">A infraestrutura de notificação baseia-se em um recurso de fila introduzido no [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="093bf-120">The notification infrastructure is built on top of a queuing feature introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="093bf-121">Em geral, as notificações geradas no servidor são enviadas através dessas filas para serem processadas posteriormente.</span><span class="sxs-lookup"><span data-stu-id="093bf-121">In general, notifications generated at the server are sent through these queues to be processed later.</span></span>  
  
 <span data-ttu-id="093bf-122">Para usar notificações de consulta, uma fila e um serviço devem existir no servidor.</span><span class="sxs-lookup"><span data-stu-id="093bf-122">To use query notifications a queue and a service must exist on the server.</span></span> <span data-ttu-id="093bf-123">Eles podem ser criados usando [!INCLUDE[tsql](../../../includes/tsql-md.md)] da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="093bf-123">These can be created using [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar to the following:</span></span>  
  
```  
CREATE QUEUE myQueue  
CREATE SERVICE myService ON QUEUE myQueue   
  
([https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification])  
```  
  
> [!NOTE]  
>  <span data-ttu-id="093bf-124">O serviço deve usar o contrato predefinido `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` como mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="093bf-124">The service must use the predefined contract `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` as shown above.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="093bf-125">Provedor OLE DB do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="093bf-125">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="093bf-126">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo dá suporte à notificação do consumidor na modificação do conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="093bf-126">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports consumer notification on rowset modification.</span></span> <span data-ttu-id="093bf-127">O consumidor recebe uma notificação em cada fase da modificação do conjunto de linhas e em qualquer tentativa de alteração.</span><span class="sxs-lookup"><span data-stu-id="093bf-127">The consumer receives notification at every phase of rowset modification and on any attempted change.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="093bf-128">Passar uma consulta de notificações para o servidor com **ICommand:: execute** é a única maneira válida de assinar notificações de consulta com o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo.</span><span class="sxs-lookup"><span data-stu-id="093bf-128">Passing a notifications query to the server with **ICommand::Execute** is the only valid way to subscribe to query notifications with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
### <a name="the-dbpropset_sqlserverrowset-property-set"></a><span data-ttu-id="093bf-129">O conjunto de propriedades DBPROPSET_SQLSERVERROWSET</span><span class="sxs-lookup"><span data-stu-id="093bf-129">The DBPROPSET_SQLSERVERROWSET Property Set</span></span>  
 <span data-ttu-id="093bf-130">Para dar suporte a notificações de consulta por meio do OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] o Native Client adiciona as novas propriedades a seguir ao conjunto de propriedades DBPROPSET_SQLSERVERROWSET.</span><span class="sxs-lookup"><span data-stu-id="093bf-130">In order to support query notifications through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds the following new properties to the DBPROPSET_SQLSERVERROWSET property set.</span></span>  
  
|<span data-ttu-id="093bf-131">Nome</span><span class="sxs-lookup"><span data-stu-id="093bf-131">Name</span></span>|<span data-ttu-id="093bf-132">Type</span><span class="sxs-lookup"><span data-stu-id="093bf-132">Type</span></span>|<span data-ttu-id="093bf-133">Descrição</span><span class="sxs-lookup"><span data-stu-id="093bf-133">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="093bf-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="093bf-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span></span>|<span data-ttu-id="093bf-135">VT_UI4</span><span class="sxs-lookup"><span data-stu-id="093bf-135">VT_UI4</span></span>|<span data-ttu-id="093bf-136">O número de segundos que a notificação de consulta permanece ativa.</span><span class="sxs-lookup"><span data-stu-id="093bf-136">The number of seconds that the query notification is to remain active.</span></span><br /><br /> <span data-ttu-id="093bf-137">O padrão é 432000 segundos (5 dias).</span><span class="sxs-lookup"><span data-stu-id="093bf-137">The default is 432000 seconds (5 days).</span></span> <span data-ttu-id="093bf-138">O valor mínimo é 1 segundo e o valor máximo é 2^31-1 segundos.</span><span class="sxs-lookup"><span data-stu-id="093bf-138">The minimum value is 1 second, and the maximum value is 2^31-1 seconds.</span></span>|  
|<span data-ttu-id="093bf-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="093bf-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span></span>|<span data-ttu-id="093bf-140">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="093bf-140">VT_BSTR</span></span>|<span data-ttu-id="093bf-141">O texto da mensagem da notificação.</span><span class="sxs-lookup"><span data-stu-id="093bf-141">The message text of the notification.</span></span> <span data-ttu-id="093bf-142">É definido pelo usuário e não tem um formato predefinido.</span><span class="sxs-lookup"><span data-stu-id="093bf-142">This is user defined, and has no predefined format.</span></span><br /><br /> <span data-ttu-id="093bf-143">Por padrão, a cadeia de caracteres fica vazia.</span><span class="sxs-lookup"><span data-stu-id="093bf-143">By default, the string is empty.</span></span> <span data-ttu-id="093bf-144">Você pode especificar uma mensagem que contenha entre 1-2000 caracteres.</span><span class="sxs-lookup"><span data-stu-id="093bf-144">You can specify a message using 1-2000 characters.</span></span>|  
|<span data-ttu-id="093bf-145">SSPROP_QP_NOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="093bf-145">SSPROP_QP_NOTIFICATION_OPTIONS</span></span>|<span data-ttu-id="093bf-146">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="093bf-146">VT_BSTR</span></span>|<span data-ttu-id="093bf-147">As opções de notificação de consulta.</span><span class="sxs-lookup"><span data-stu-id="093bf-147">The query notification options.</span></span> <span data-ttu-id="093bf-148">Eles são especificados em uma cadeia de caracteres com a sintaxe de valor de *nome* = *value* .</span><span class="sxs-lookup"><span data-stu-id="093bf-148">These are specified in a string with *name*=*value* syntax.</span></span> <span data-ttu-id="093bf-149">O usuário é responsável por criar o serviço e ler as notificações da fila.</span><span class="sxs-lookup"><span data-stu-id="093bf-149">The user is responsible for creating the service and reading notifications off of the queue.</span></span><br /><br /> <span data-ttu-id="093bf-150">O padrão é uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="093bf-150">The default is an empty string.</span></span>|  
  
 <span data-ttu-id="093bf-151">A assinatura de notificação é sempre confirmada, independentemente do fato de a instrução ter sido executada em uma transação de usuário ou em uma confirmação automática ou se a transação na qual a instrução foi executada tiver sido confirmada ou revertida.</span><span class="sxs-lookup"><span data-stu-id="093bf-151">The notification subscription is always committed, regardless of whether the statement ran in a user transaction or in auto commit or whether the transaction in which the statement ran committed or rolled back.</span></span> <span data-ttu-id="093bf-152">A notificação do servidor é acionada mediante uma das seguintes condições inválidas de notificação: alteração dos dados subjacentes ou do esquema ou quando o tempo limite expira; a que ocorrer primeiro.</span><span class="sxs-lookup"><span data-stu-id="093bf-152">The server notification fires upon any of the following invalid notification conditions: change of underlying data or schema, or when the timeout period is reached; whichever is first.</span></span> <span data-ttu-id="093bf-153">Os registros de notificação são excluídos assim que são disparados.</span><span class="sxs-lookup"><span data-stu-id="093bf-153">Notification registrations are deleted as soon as they are fired.</span></span> <span data-ttu-id="093bf-154">Consequentemente, em caso de recebimento de notificações, o aplicativo deve realizar uma nova assinatura caso queira obter mais atualizações.</span><span class="sxs-lookup"><span data-stu-id="093bf-154">Hence upon receiving notifications, the application must subscribe again in case they want to get further updates.</span></span>  
  
 <span data-ttu-id="093bf-155">Outra conexão ou thread pode verificar se há notificações na fila de destino.</span><span class="sxs-lookup"><span data-stu-id="093bf-155">Another connection or thread can check the destination queue for notifications.</span></span> <span data-ttu-id="093bf-156">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="093bf-156">For example:</span></span>  
  
```  
WAITFOR (RECEIVE * FROM MyQueue);   // Where MyQueue is the queue name.   
```  
  
 <span data-ttu-id="093bf-157">Observe que SELECT \* não exclui a entrada da Fila, ao contrário de RECEIVE \* FROM.</span><span class="sxs-lookup"><span data-stu-id="093bf-157">Note that SELECT \* does not delete the entry from the Queue, however RECEIVE \* FROM does.</span></span> <span data-ttu-id="093bf-158">Isso irá interromper um thread de servidor se a fila estiver vazia.</span><span class="sxs-lookup"><span data-stu-id="093bf-158">This stalls a server thread if the queue is empty.</span></span> <span data-ttu-id="093bf-159">Se houver entradas na fila durante o momento da chamada, elas serão retornadas imediatamente; caso contrário, a chamada aguardará até que seja feita a entrada na fila.</span><span class="sxs-lookup"><span data-stu-id="093bf-159">If there are queue entries at the time of the call, they are returned immediately; otherwise the call waits until a queue entry is made.</span></span>  
  
```  
RECEIVE * FROM MyQueue  
```  
  
 <span data-ttu-id="093bf-160">Essa instrução retornará imediatamente um conjunto de resultados vazio se a fila estiver vazia; caso contrário, retornará todas as notificações da fila.</span><span class="sxs-lookup"><span data-stu-id="093bf-160">This statement immediately returns an empty result set if the queue is empty; otherwise it returns all queue notifications.</span></span>  
  
 <span data-ttu-id="093bf-161">Se SSPROP_QP_NOTIFICATION_MSGTEXT e SSPROP_QP_NOTIFICATION_OPTIONS forem não nulos e não vazios, o cabeçalho do TDS para notificações de consulta que contém as três propriedades definidas acima é enviado ao servidor em cada execução do comando.</span><span class="sxs-lookup"><span data-stu-id="093bf-161">If SSPROP_QP_NOTIFICATION_MSGTEXT and SSPROP_QP_NOTIFICATION_OPTIONS are non-NULL and non-empty, the query notifications TDS header containing the three properties defined above are sent to the server with each execution of the command.</span></span> <span data-ttu-id="093bf-162">Se algum deles for nulo (ou vazio), o cabeçalho não será enviado e DB_E_ERRORSOCCURRED será usado, (ou DB_S_ERRORSOCCURRED se as propriedades estiverem marcadas como opcionais), e o valor do status será definido como DBPROPSTATUS_BADVALUE.</span><span class="sxs-lookup"><span data-stu-id="093bf-162">If either of them is null (or empty), the header is not sent and DB_E_ERRORSOCCURRED is raised, (or DB_S_ERRORSOCCURRED if the properties are both marked as optional), and the status value is set to DBPROPSTATUS_BADVALUE.</span></span> <span data-ttu-id="093bf-163">A validação é feita em Execute/Prepare.</span><span class="sxs-lookup"><span data-stu-id="093bf-163">The validation occurs on Execute/Prepare.</span></span> <span data-ttu-id="093bf-164">De modo semelhante, DB_S_ERRORSOCCURED será acionado quando as propriedades de notificação da consulta forem definidas para conexões com versões do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anteriores a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="093bf-164">Similarly, DB_S_ERRORSOCCURED is raised when the query notification properties are set for connections to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="093bf-165">O valor de status nesse caso é DBPROPSTATUS_NOTSUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="093bf-165">The status value in this case is DBPROPSTATUS_NOTSUPPORTED.</span></span>  
  
 <span data-ttu-id="093bf-166">Iniciar uma assinatura não garante que as mensagens subsequentes sejam entregues com êxito.</span><span class="sxs-lookup"><span data-stu-id="093bf-166">Initiating a subscription does not guarantee that subsequent messages will be successfully delivered.</span></span> <span data-ttu-id="093bf-167">Além disso, nenhuma verificação é feita em relação à validade do nome de serviço especificado.</span><span class="sxs-lookup"><span data-stu-id="093bf-167">In addition, no check is made as to the validity of the service name specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="093bf-168">A preparação de assinaturas nunca fará com que a assinatura seja iniciada; somente a execução da instrução iniciará a assinatura e as notificações de consulta não são impactadas pelo uso dos serviços principais do OLE DB.</span><span class="sxs-lookup"><span data-stu-id="093bf-168">Preparing statements will never cause the subscription to be initiated; only statement execution will achieve this and query notifications are not impacted by the use of OLE DB core services.</span></span>  
  
 <span data-ttu-id="093bf-169">Para obter mais informações sobre o conjunto de propriedades DBPROPSET_SQLSERVERROWSET, consulte [Propriedades e comportamentos](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)do conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="093bf-169">For more information about the DBPROPSET_SQLSERVERROWSET property set, see [Rowset Properties and Behaviors](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="093bf-170">Driver ODBC do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="093bf-170">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="093bf-171">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client dá suporte a notificações de consulta através da adição de três novos atributos às funções [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) e [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) :</span><span class="sxs-lookup"><span data-stu-id="093bf-171">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports query notifications through the addition of three new attributes to the [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) and [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) functions:</span></span>  
  
-   <span data-ttu-id="093bf-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="093bf-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span></span>  
  
-   <span data-ttu-id="093bf-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="093bf-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span></span>  
  
-   <span data-ttu-id="093bf-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="093bf-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span></span>  
  
 <span data-ttu-id="093bf-175">Se SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT e SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS não forem NULOS, o cabeçalho do TDS das notificações de consulta que contém os três atributos definidos acima será enviado para o servidor toda vez que o comando for executado.</span><span class="sxs-lookup"><span data-stu-id="093bf-175">If SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT and SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS are not NULL, the query notifications TDS header containing the three attributes defined above will be sent to the server each time the command is executed.</span></span> <span data-ttu-id="093bf-176">Se um deles for nulo, o cabeçalho não será enviado e SQL_SUCCESS_WITH_INFO será retornado.</span><span class="sxs-lookup"><span data-stu-id="093bf-176">If either of them is null, the header is not sent, and SQL_SUCCESS_WITH_INFO is returned.</span></span> <span data-ttu-id="093bf-177">A validação ocorre na [função SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**e **SqlExecute**, todas que falham se os atributos não forem válidos.</span><span class="sxs-lookup"><span data-stu-id="093bf-177">The validation occurs on [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**, and **SqlExecute**, all of which fail if the attributes are not valid.</span></span> <span data-ttu-id="093bf-178">De modo semelhante, quando esses atributos de notificação de consulta são definidos para versões do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anteriores ao [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], ocorre uma falha na execução com SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="093bf-178">Similarly, when these query notification attributes are set for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the execution fails with SQL_SUCCESS_WITH_INFO.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="093bf-179">A preparação de instruções nunca iniciará a assinatura; a assinatura pode ser iniciada com a execução da instrução.</span><span class="sxs-lookup"><span data-stu-id="093bf-179">Prepare statements will never cause the subscription to be initiated; subscription can be initiated by statement execution.</span></span>  
  
## <a name="special-cases-and-restrictions"></a><span data-ttu-id="093bf-180">Casos especiais e restrições</span><span class="sxs-lookup"><span data-stu-id="093bf-180">Special Cases and Restrictions</span></span>  
 <span data-ttu-id="093bf-181">Os seguintes tipos de dados não são suportados para notificações:</span><span class="sxs-lookup"><span data-stu-id="093bf-181">The following data types are not supported for notifications:</span></span>  
  
-   `text`  
  
-   `ntext`  
  
-   `image`  
  
 <span data-ttu-id="093bf-182">Se for feita uma solicitação de notificação para um consulta que retorna um desses tipos, a notificação será disparada imediatamente, especificando que não foi possível realizar a assinatura na notificação.</span><span class="sxs-lookup"><span data-stu-id="093bf-182">If a notification request is made for a query which returns any of these types, the notification fires immediately, specifying that notification subscription was not possible.</span></span>  
  
 <span data-ttu-id="093bf-183">Se uma solicitação de assinatura for feita para um lote ou procedimento armazenado, outra solicitação de assinatura será feita para cada instrução executada no lote ou procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="093bf-183">If a subscription request is made for a batch or stored procedure, a separate subscription request is made for each statement executed within the batch or stored procedure.</span></span> <span data-ttu-id="093bf-184">As instruções EXECUTE não registrarão notificações, mas enviarão a solicitação de notificação para o comando executado.</span><span class="sxs-lookup"><span data-stu-id="093bf-184">EXECUTE statements will not register a notification, but will send the notification request to the executed command.</span></span> <span data-ttu-id="093bf-185">Se for um lote, o contexto será aplicado às instruções executadas e as mesmas regras descritas anteriormente serão aplicadas.</span><span class="sxs-lookup"><span data-stu-id="093bf-185">If it is a batch, the context will be applied to the executed statements and the same rules described above apply.</span></span>  
  
 <span data-ttu-id="093bf-186">Envio de uma consulta para notificação que foi enviada pelo mesmo usuário no mesmo contexto de banco de dados e tem o mesmo modelo, os mesmos valores de parâmetro, a mesma ID de notificação e o mesmo local de entrega de uma assinatura ativa existente, renovará a assinatura existente, redefinindo o novo tempo limite especificado. Isso significa que, se a notificação for solicitada para consultas idênticas, apenas uma notificação será enviada.</span><span class="sxs-lookup"><span data-stu-id="093bf-186">Submission of a query for notification that was submitted by the same user under the same database context and has the same template, same parameter values, same notification ID, and same delivery location of an existing active subscription, will renew the existing subscription, resetting the new specified time-out. This means that if notification is requested for identical queries, only one notification will be sent.</span></span> <span data-ttu-id="093bf-187">Isso se aplica a uma consulta duplicada em um lote ou a uma consulta em um procedimento armazenado chamada várias vezes.</span><span class="sxs-lookup"><span data-stu-id="093bf-187">This would apply to a query duplicated in a batch, or a query in a stored procedure that was called multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="093bf-188">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="093bf-188">See Also</span></span>  
 [<span data-ttu-id="093bf-189">Recursos do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="093bf-189">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
