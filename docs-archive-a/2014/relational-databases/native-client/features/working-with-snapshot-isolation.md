---
title: Trabalhando com isolamento de instantâneo | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], snapshot isolation
- SQLNCLI, snapshot isolation
- isolation levels [SQL Server], snapshot
- DBPROPSET_SESSION property set
- DBDROPSET_DATASOURCEINFO property set
- snapshot isolation [SQL Server Native Client]
- SQL Server Native Client OLE DB provider, snapshot isolation
- SQL Server Native Client ODBC driver, snapshot isolation
- SQL Server Native Client, snapshot isolation
- SQLGetInfo function
- concurrency [SQL Server Native Client]
- SQLSetConnectAttr function
ms.assetid: 39e87eb1-677e-45dd-bc61-83a4025a7756
author: rothja
ms.author: jroth
ms.openlocfilehash: 242d054a5fd2ad12a8811bebc834d423f547a499
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87576309"
---
# <a name="working-with-snapshot-isolation"></a><span data-ttu-id="6b6af-102">Trabalhando com isolamento de instantâneo</span><span class="sxs-lookup"><span data-stu-id="6b6af-102">Working with Snapshot Isolation</span></span>
  <span data-ttu-id="6b6af-103">O [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduziu um novo nível de isolamento de "instantâneo" cujo objeto é aumentar a simultaneidade para aplicativos OLTP (online transaction processing).</span><span class="sxs-lookup"><span data-stu-id="6b6af-103">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduced a new "snapshot" isolation level that is intended to enhance concurrency for online transaction processing (OLTP) applications.</span></span> <span data-ttu-id="6b6af-104">Nas versões anteriores do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a simultaneidade baseava-se apenas no bloqueio, o que pode causar problemas de bloqueio e de deadlock em alguns aplicativos.</span><span class="sxs-lookup"><span data-stu-id="6b6af-104">In earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], concurrency was based solely on locking, which can cause blocking and deadlocking problems for some applications.</span></span> <span data-ttu-id="6b6af-105">O isolamento de instantâneo depende de aprimoramentos no controle de versão de linha e seu objetivo é melhorar o desempenho evitando cenários de bloqueio de leitor/gravador.</span><span class="sxs-lookup"><span data-stu-id="6b6af-105">Snapshot isolation depends on enhancements to row versioning and is intended to improve performance by avoiding reader-writer blocking scenarios.</span></span>  
  
 <span data-ttu-id="6b6af-106">As transações que iniciam com o isolamento de instantâneo leem um instantâneo de banco de dados a partir da hora em que a transação inicia.</span><span class="sxs-lookup"><span data-stu-id="6b6af-106">Transactions that start under snapshot isolation read a database snapshot as of the time when the transaction starts.</span></span> <span data-ttu-id="6b6af-107">Um dos resultados é que os cursores de servidor de conjunto de chaves, dinâmicos e estáticos, quando abertos em um contexto de transação de instantâneo, comportam-se de modo semelhante aos cursores estáticos abertos em transações serializáveis.</span><span class="sxs-lookup"><span data-stu-id="6b6af-107">One result of this is that keyset, dynamic and static server cursors, when opened within a snapshot transaction context, behave much like static cursors opened within serializable transactions.</span></span> <span data-ttu-id="6b6af-108">Porém, quando os cursores são abertos com o nível de isolamento de instantâneo os bloqueios não são considerados, o que pode reduzir o bloqueio no servidor.</span><span class="sxs-lookup"><span data-stu-id="6b6af-108">However, when the cursors are opened under the snapshot isolation level locks are not taken, which can reduce blocking on the server.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="6b6af-109">Provedor OLE DB do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="6b6af-109">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="6b6af-110">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo tem aprimoramentos que aproveitam o isolamento de instantâneo introduzido no [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6b6af-110">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider has enhancements that take advantage of the snapshot isolation introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="6b6af-111">Esses aprimoramentos incluem alterações aos conjuntos de propriedades DBPROPSET_DATASOURCEINFO e DBPROPSET_SESSION.</span><span class="sxs-lookup"><span data-stu-id="6b6af-111">These enhancements include changes to the DBPROPSET_DATASOURCEINFO and DBPROPSET_SESSION property sets.</span></span>  
  
### <a name="dbpropset_datasourceinfo"></a><span data-ttu-id="6b6af-112">DBPROPSET_DATASOURCEINFO</span><span class="sxs-lookup"><span data-stu-id="6b6af-112">DBPROPSET_DATASOURCEINFO</span></span>  
 <span data-ttu-id="6b6af-113">O conjunto de propriedades DBPROPSET_DATASOURCEINFO tem sido alterado para indicar que o nível de isolamento de instantâneo é suportado pela adição do valor DBPROPVAL_TI_SNAPSHOT usado na propriedade DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="6b6af-113">The DBPROPSET_DATASOURCEINFO property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SUPPORTEDTXNISOLEVELS property.</span></span> <span data-ttu-id="6b6af-114">Esse novo valor indica que haverá suporte para o nível de isolamento do instantâneo se o controle de versão tiver sido ou não habilitado no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="6b6af-114">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="6b6af-115">Esta é uma lista dos valores DBPROP_SUPPORTEDTXNISOLEVELS:</span><span class="sxs-lookup"><span data-stu-id="6b6af-115">The following is a list of the DBPROP_SUPPORTEDTXNISOLEVELS values:</span></span>  
  
|<span data-ttu-id="6b6af-116">ID da propriedade</span><span class="sxs-lookup"><span data-stu-id="6b6af-116">Property ID</span></span>|<span data-ttu-id="6b6af-117">Descrição</span><span class="sxs-lookup"><span data-stu-id="6b6af-117">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="6b6af-118">DBPROP_SUPPORTEDTXNISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="6b6af-118">DBPROP_SUPPORTEDTXNISOLEVELS</span></span>|<span data-ttu-id="6b6af-119">Tipo: VT_I4</span><span class="sxs-lookup"><span data-stu-id="6b6af-119">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="6b6af-120">R/W: somente leitura</span><span class="sxs-lookup"><span data-stu-id="6b6af-120">R/W: Read only</span></span><br /><br /> <span data-ttu-id="6b6af-121">Descrição: Um bitmask que especifica os níveis de isolamento da transação com suporte.</span><span class="sxs-lookup"><span data-stu-id="6b6af-121">Description: A bitmask specifying the supported transaction isolation levels.</span></span> <span data-ttu-id="6b6af-122">Uma combinação de zeros ou mais do seguinte:</span><span class="sxs-lookup"><span data-stu-id="6b6af-122">A combination of zero or more of the following:</span></span><br /><br /> <span data-ttu-id="6b6af-123">-DBPROPVAL_TI_CHAOS</span><span class="sxs-lookup"><span data-stu-id="6b6af-123">-   DBPROPVAL_TI_CHAOS</span></span><br /><span data-ttu-id="6b6af-124">-DBPROPVAL_TI_READUNCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="6b6af-124">-   DBPROPVAL_TI_READUNCOMMITTED</span></span><br /><span data-ttu-id="6b6af-125">-DBPROPVAL_TI_BROWSE</span><span class="sxs-lookup"><span data-stu-id="6b6af-125">-   DBPROPVAL_TI_BROWSE</span></span><br /><span data-ttu-id="6b6af-126">-DBPROPVAL_TI_CURSORSTABILITY</span><span class="sxs-lookup"><span data-stu-id="6b6af-126">-   DBPROPVAL_TI_CURSORSTABILITY</span></span><br /><span data-ttu-id="6b6af-127">-DBPROPVAL_TI_READCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="6b6af-127">-   DBPROPVAL_TI_READCOMMITTED</span></span><br /><span data-ttu-id="6b6af-128">-DBPROPVAL_TI_REPEATABLEREAD</span><span class="sxs-lookup"><span data-stu-id="6b6af-128">-   DBPROPVAL_TI_REPEATABLEREAD</span></span><br /><span data-ttu-id="6b6af-129">-DBPROPVAL_TI_SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="6b6af-129">-   DBPROPVAL_TI_SERIALIZABLE</span></span><br /><span data-ttu-id="6b6af-130">-DBPROPVAL_TI_ISOLATED</span><span class="sxs-lookup"><span data-stu-id="6b6af-130">-   DBPROPVAL_TI_ISOLATED</span></span><br /><span data-ttu-id="6b6af-131">-DBPROPVAL_TI_SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="6b6af-131">-   DBPROPVAL_TI_SNAPSHOT</span></span>|  
  
### <a name="dbpropset_session"></a><span data-ttu-id="6b6af-132">DBPROPSET_SESSION</span><span class="sxs-lookup"><span data-stu-id="6b6af-132">DBPROPSET_SESSION</span></span>  
 <span data-ttu-id="6b6af-133">O conjunto de propriedades DBPROPSET_SESSION tem sido alterado para indicar que o nível de isolamento de instantâneo é suportado pela adição do valor DBPROPVAL_TI_SNAPSHOT usado na propriedade DBPROP_SESS_AUTOCOMMITISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="6b6af-133">The DBPROPSET_SESSION property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SESS_AUTOCOMMITISOLEVELS property.</span></span> <span data-ttu-id="6b6af-134">Esse novo valor indica que haverá suporte para o nível de isolamento do instantâneo se o controle de versão tiver sido ou não habilitado no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="6b6af-134">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="6b6af-135">Esta é uma lista dos valores DBPROP_SESS_AUTOCOMMITISOLEVELS:</span><span class="sxs-lookup"><span data-stu-id="6b6af-135">The following is a list of the DBPROP_SESS_AUTOCOMMITISOLEVELS values:</span></span>  
  
|<span data-ttu-id="6b6af-136">ID da propriedade</span><span class="sxs-lookup"><span data-stu-id="6b6af-136">Property ID</span></span>|<span data-ttu-id="6b6af-137">Descrição</span><span class="sxs-lookup"><span data-stu-id="6b6af-137">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="6b6af-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="6b6af-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span></span>|<span data-ttu-id="6b6af-139">Tipo: VT_I4</span><span class="sxs-lookup"><span data-stu-id="6b6af-139">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="6b6af-140">R/W: somente leitura</span><span class="sxs-lookup"><span data-stu-id="6b6af-140">R/W: Read only</span></span><br /><br /> <span data-ttu-id="6b6af-141">Descrição: Especifica um bitmask que indica o nível de isolamento da transação enquanto estiver no modo de confirmação automática.</span><span class="sxs-lookup"><span data-stu-id="6b6af-141">Description: Specifies a bitmask that indicates the transaction isolation level while in auto-commit mode.</span></span> <span data-ttu-id="6b6af-142">Os valores que podem ser definidos nesse bitmask são os mesmos que podem ser definidos para DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="6b6af-142">The values that can be set in this bitmask are the same as those that can be set for DBPROP_SUPPORTEDTXNISOLEVELS.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="6b6af-143">Os erros DB_S_ERRORSOCCURRED ou DB_E_ERRORSOCCURRED ocorrerão se DBPROPVAL_TI_SNAPSHOT for definido durante o uso de versões do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anteriores a [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6b6af-143">The errors DB_S_ERRORSOCCURRED or DB_E_ERRORSOCCURRED will occur if DBPROPVAL_TI_SNAPSHOT is set when using versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] earlier than [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>  
  
 <span data-ttu-id="6b6af-144">Para obter informações sobre o suporte ao isolamento de instantâneo em transações, confira [Suporte a transações locais](../../native-client-ole-db-transactions/transactions.md).</span><span class="sxs-lookup"><span data-stu-id="6b6af-144">For information about how snapshot isolation is supported in transactions, see [Supporting Local Transactions](../../native-client-ole-db-transactions/transactions.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="6b6af-145">Driver ODBC do SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="6b6af-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="6b6af-146">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client fornece suporte para isolamento de instantâneos, por meio de aprimoramentos feitos nas funções [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) e [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="6b6af-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver provides support for snapshot isolation though enhancements made to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) functions.</span></span>  
  
### <a name="sqlsetconnectattr"></a><span data-ttu-id="6b6af-147">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="6b6af-147">SQLSetConnectAttr</span></span>  
 <span data-ttu-id="6b6af-148">A função **SQLSetConnectAttr** agora dá suporte ao uso do atributo SQL_COPT_SS_TXN_ISOLATION.</span><span class="sxs-lookup"><span data-stu-id="6b6af-148">The **SQLSetConnectAttr** function now supports the use of the SQL_COPT_SS_TXN_ISOLATION attribute.</span></span> <span data-ttu-id="6b6af-149">Configurar SQL_COPT_SS_TXN_ISOLATION como SQL_TXN_SS_SNAPSHOT indica que a transação ocorrerá no nível de isolamento do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="6b6af-149">Setting SQL_COPT_SS_TXN_ISOLATION to SQL_TXN_SS_SNAPSHOT indicates that the transaction will take place under the snapshot isolation level.</span></span>  
  
### <a name="sqlgetinfo"></a><span data-ttu-id="6b6af-150">SQLGetInfo</span><span class="sxs-lookup"><span data-stu-id="6b6af-150">SQLGetInfo</span></span>  
 <span data-ttu-id="6b6af-151">A função [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) agora dá suporte ao valor SQL_TXN_SS_SNAPSHOT que foi adicionado ao tipo de informações SQL_TXN_ISOLATION_OPTION.</span><span class="sxs-lookup"><span data-stu-id="6b6af-151">The [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) function now supports the SQL_TXN_SS_SNAPSHOT value that has been added to the SQL_TXN_ISOLATION_OPTION info type.</span></span>  
  
 <span data-ttu-id="6b6af-152">Para obter informações sobre como o isolamento de instantâneo tem suporte em transações, consulte [cursor TRANSACTION ISOLATION LEVEL](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span><span class="sxs-lookup"><span data-stu-id="6b6af-152">For information about how snapshot isolation is supported in transactions, see [Cursor Transaction Isolation Level](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6b6af-153">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="6b6af-153">See Also</span></span>  
 <span data-ttu-id="6b6af-154">[Recursos do SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="6b6af-154">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="6b6af-155">Propriedades e comportamentos do conjunto de linhas</span><span class="sxs-lookup"><span data-stu-id="6b6af-155">Rowset Properties and Behaviors</span></span>](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)  
  
  
