---
title: Usando IMultipleResults para processar vários conjuntos de resultados | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- multiple rowsets
- rowsets [OLE DB], multiple
- IMultipleResults interface
- multiple-rowset results
ms.assetid: 754d3f30-7d94-4b67-8dac-baf2699ce9c6
author: rothja
ms.author: jroth
ms.openlocfilehash: c7acac7e6ce75189e522b503707e101c0a13c345
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685088"
---
# <a name="using-imultipleresults-to-process-multiple-result-sets"></a><span data-ttu-id="57c63-102">Usando IMultipleResults para processar vários conjuntos de resultados</span><span class="sxs-lookup"><span data-stu-id="57c63-102">Using IMultipleResults to Process Multiple Result Sets</span></span>
  <span data-ttu-id="57c63-103">Os consumidores usam a interface **IMultipleResults** para processar resultados retornados pela [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] execução do comando do provedor de OLE DB de cliente nativo.</span><span class="sxs-lookup"><span data-stu-id="57c63-103">Consumers use the **IMultipleResults** interface to process results returned by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider command execution.</span></span> <span data-ttu-id="57c63-104">Quando o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo envia um comando para execução, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] o executa as instruções e retorna os resultados.</span><span class="sxs-lookup"><span data-stu-id="57c63-104">When the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider submits a command for execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] executes the statements and returns any results.</span></span>  
  
 <span data-ttu-id="57c63-105">Um cliente deve processar todos os resultados a partir da execução do comando.</span><span class="sxs-lookup"><span data-stu-id="57c63-105">A client must process all results from command execution.</span></span> <span data-ttu-id="57c63-106">Como a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] execução do comando do provedor de OLE DB de cliente nativo pode gerar objetos de vários conjuntos de linhas como resultados, use a interface **IMultipleResults** para garantir que a recuperação de dados do aplicativo conclua a viagem de ida e volta iniciada pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="57c63-106">Because the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider command execution can generate multiple-rowset objects as results, use the **IMultipleResults** interface to ensure that application data retrieval completes the client-initiated round trip.</span></span>  
  
 <span data-ttu-id="57c63-107">A seguinte instrução [!INCLUDE[tsql](../../includes/tsql-md.md)] gera vários conjuntos de linhas, alguns contendo dados de linhas da tabela **OrderDetails** e alguns contendo resultados da cláusula COMPUTE BY:</span><span class="sxs-lookup"><span data-stu-id="57c63-107">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement generates multiple rowsets, some containing row data from the **OrderDetails** table and some containing results of the COMPUTE BY clause:</span></span>  
  
```  
SELECT OrderID, FullPrice = (UnitPrice * Quantity), Discount,  
    Discounted = UnitPrice * (1 - Discount) * Quantity  
FROM OrderDetails  
ORDER BY OrderID  
COMPUTE  
    SUM(UnitPrice * Quantity), SUM(UnitPrice * (1 - Discount) * Quantity)  
    BY OrderID  
```  
  
 <span data-ttu-id="57c63-108">Se um consumidor executar um comando que contém esse texto e solicitar um conjunto de linhas como a interface de resultados retornados, apenas o primeiro conjunto de linhas será retornado.</span><span class="sxs-lookup"><span data-stu-id="57c63-108">If a consumer executes a command containing this text and requests a rowset as the returned results interface, only the first set of rows is returned.</span></span> <span data-ttu-id="57c63-109">O consumidor pode processar todas as linhas no conjunto de linhas retornado.</span><span class="sxs-lookup"><span data-stu-id="57c63-109">The consumer may process all rows in the rowset returned.</span></span> <span data-ttu-id="57c63-110">Mas, se a propriedade de fonte de dados DBPROP_MULTIPLECONNECTIONS for definida como VARIANT_FALSE e o MARS não estiver habilitado na conexão, nenhum outro comando poderá ser executado no objeto de sessão (o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provedor de OLE DB do cliente nativo não criará outra conexão) até que o comando seja cancelado.</span><span class="sxs-lookup"><span data-stu-id="57c63-110">But, if the DBPROP_MULTIPLECONNECTIONS data source property is set to VARIANT_FALSE, and MARS is not enabled on the connection, no other commands can be executed on the session object (the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider will not create another connection) until the command is canceled.</span></span> <span data-ttu-id="57c63-111">Se o MARS não estiver habilitado na conexão, o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo retornará um erro de DB_E_OBJECTOPEN se DBPROP_MULTIPLECONNECTIONS for VARIANT_FALSE e retornar E_FAIL se houver uma transação ativa.</span><span class="sxs-lookup"><span data-stu-id="57c63-111">If MARS is not enabled on the connection, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider returns a DB_E_OBJECTOPEN error if DBPROP_MULTIPLECONNECTIONS is VARIANT_FALSE and returns E_FAIL if there is an active transaction.</span></span>  
  
 <span data-ttu-id="57c63-112">O [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo também retornará DB_E_OBJECTOPEN ao usar parâmetros de saída em fluxo e o aplicativo não consumiu todos os valores de parâmetro de saída retornados antes de chamar **IMultipleResults:: GetResults** para obter o próximo conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="57c63-112">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider will also return DB_E_OBJECTOPEN when using streamed output parameters and the application has not consumed all the returned output parameter values before calling **IMultipleResults::GetResults** to get the next result set.</span></span> <span data-ttu-id="57c63-113">Se o MARS não estiver habilitado e a conexão estiver ocupada executando um comando que não produz um conjunto de linhas ou que produz um conjunto de linhas que não é um cursor de servidor, e se a propriedade de fonte de dados DBPROP_MULTIPLECONNECTIONS for definida como VARIANT_TRUE, o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provedor de OLE DB de cliente nativo criará conexões adicionais para dar suporte a objetos de comando simultâneos, a menos que uma transação esteja ativa; nesse</span><span class="sxs-lookup"><span data-stu-id="57c63-113">If MARS is not enabled and the connection is busy running a command that does not produce a rowset or that produces a rowset that is not a server cursor, and if the DBPROP_MULTIPLECONNECTIONS data source property is set to VARIANT_TRUE, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB provider creates additional connections to support concurrent command objects, unless a transaction is active, in which case it returns an error.</span></span> <span data-ttu-id="57c63-114">As transações e o bloqueio são gerenciados pelo [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] por conexão.</span><span class="sxs-lookup"><span data-stu-id="57c63-114">Transactions and locking are managed by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] on a per connection basis.</span></span> <span data-ttu-id="57c63-115">Se uma segunda conexão for gerada, o comando nas conexões separadas não compartilhará bloqueios.</span><span class="sxs-lookup"><span data-stu-id="57c63-115">If a second connection is generated, the command on the separate connections does not share locks.</span></span> <span data-ttu-id="57c63-116">É necessário ser cuidadoso em assegurar que um comando não bloqueie outro ao manter bloqueios em linhas solicitadas pelo outro comando.</span><span class="sxs-lookup"><span data-stu-id="57c63-116">Care must be taken to ensure that one command does not block another by holding locks on rows requested by the other command.</span></span> <span data-ttu-id="57c63-117">Se o MARS estiver habilitado, vários comandos poderão estar ativos nas conexões e, se estiverem sendo usadas transações explícitas, todos os comandos compartilharão uma transação comum.</span><span class="sxs-lookup"><span data-stu-id="57c63-117">If MARS is enabled, multiple commands can be active on the connections and if explicit transactions are being used, the commands all share a common transaction.</span></span>  
  
 <span data-ttu-id="57c63-118">O consumidor pode cancelar o comando usando [ISSAbort::Abort](../native-client-ole-db-interfaces/issabort-abort-ole-db.md) ou liberando todas as referências mantidas no objeto de comando e no conjunto de linhas derivado.</span><span class="sxs-lookup"><span data-stu-id="57c63-118">The consumer can cancel the command either by using [ISSAbort::Abort](../native-client-ole-db-interfaces/issabort-abort-ole-db.md) or by releasing all references held on the command object and the derived rowset.</span></span>  
  
 <span data-ttu-id="57c63-119">O uso de **IMultipleResults** em todas as instâncias permite que o consumidor obtenha todos os conjuntos de linhas gerados pela execução do comando e permite que os consumidores determinem apropriadamente quando cancelar a execução do comando e liberar um objeto de sessão para uso por outros comandos.</span><span class="sxs-lookup"><span data-stu-id="57c63-119">Using **IMultipleResults** in all instances allows the consumer to get all rowsets generated by command execution and allows consumers to appropriately determine when to cancel command execution and free a session object for use by other commands.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="57c63-120">Ao usar cursores do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a execução de comandos cria o cursor.</span><span class="sxs-lookup"><span data-stu-id="57c63-120">When you use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cursors, command execution creates the cursor.</span></span> <span data-ttu-id="57c63-121">O [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] retorna o êxito ou a falha da criação do cursor; assim, a viagem de ida e volta à instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] é concluída no retorno da execução do comando.</span><span class="sxs-lookup"><span data-stu-id="57c63-121">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] returns success or failure on the cursor creation; therefore, the round trip to the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is complete upon the return from command execution.</span></span> <span data-ttu-id="57c63-122">Em seguida, cada chamada de **GetNextRows** se torna uma viagem de ida e volta.</span><span class="sxs-lookup"><span data-stu-id="57c63-122">Each **GetNextRows** call then becomes a round trip.</span></span> <span data-ttu-id="57c63-123">Dessa forma, podem existir vários objetos de comando ativos, cada um processando um conjunto de linhas que é o resultado uma busca do cursor de servidor.</span><span class="sxs-lookup"><span data-stu-id="57c63-123">In this way, multiple active command objects can exist, each processing a rowset that is the result of a fetch from the server cursor.</span></span> <span data-ttu-id="57c63-124">Para obter mais informações, confira [Conjuntos de linha e cursores do SQL Server](../native-client-ole-db-rowsets/rowsets-and-sql-server-cursors.md).</span><span class="sxs-lookup"><span data-stu-id="57c63-124">For more information, see [Rowsets and SQL Server Cursors](../native-client-ole-db-rowsets/rowsets-and-sql-server-cursors.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="57c63-125">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="57c63-125">See Also</span></span>  
 [<span data-ttu-id="57c63-126">Comandos</span><span class="sxs-lookup"><span data-stu-id="57c63-126">Commands</span></span>](commands.md)  
  
  
