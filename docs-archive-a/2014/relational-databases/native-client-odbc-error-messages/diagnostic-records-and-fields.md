---
title: Registros e campos de diagnóstico | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
ms.assetid: 4949530c-62d1-4f1a-b592-144244444ce0
author: rothja
ms.author: jroth
ms.openlocfilehash: 4fe52b211eb6d5a0e4d875264609d036702b2b0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87684197"
---
# <a name="diagnostic-records-and-fields"></a><span data-ttu-id="3f740-102">Registros e campos de diagnóstico</span><span class="sxs-lookup"><span data-stu-id="3f740-102">Diagnostic Records and Fields</span></span>
  <span data-ttu-id="3f740-103">Os registros de diagnóstico são associados com ambiente, conexão, instrução ou identificadores de descritor ODBC.</span><span class="sxs-lookup"><span data-stu-id="3f740-103">Diagnostic records are associated with ODBC environment, connection, statement, or descriptor handles.</span></span> <span data-ttu-id="3f740-104">Quando uma função ODBC gera um código de retorno diferente de SQL_SUCCESS ou SQL_INVALID_HANDLE, o identificador chamado pela função possui registros de diagnóstico associados que contêm mensagens de erro ou mensagens informativas.</span><span class="sxs-lookup"><span data-stu-id="3f740-104">When any ODBC function raises a return code other than SQL_SUCCESS or SQL_INVALID_HANDLE, the handle called by the function has associated diagnostic records that contain informational or error messages.</span></span> <span data-ttu-id="3f740-105">Esses registros são retidos até que outra função seja chamada com aquele identificador. Depois disso, são descartados.</span><span class="sxs-lookup"><span data-stu-id="3f740-105">These records are retained until another function is called using that handle, at which time they are discarded.</span></span> <span data-ttu-id="3f740-106">Não há limite para o número de registros de diagnóstico que podem ser associados a um identificador de uma só vez.</span><span class="sxs-lookup"><span data-stu-id="3f740-106">There is no limit to the number of diagnostic records that can be associated with a handle at any one time.</span></span>  
  
 <span data-ttu-id="3f740-107">Há dois tipos de registros de diagnóstico: cabeçalho e status.</span><span class="sxs-lookup"><span data-stu-id="3f740-107">There are two types of diagnostic records: header and status.</span></span> <span data-ttu-id="3f740-108">O registro de cabeçalho é registro 0; quando há registros de status, eles são registros 1 e posteriores.</span><span class="sxs-lookup"><span data-stu-id="3f740-108">The header record is record 0; when there are status records, they are records 1 and later.</span></span> <span data-ttu-id="3f740-109">Os registros de diagnóstico contêm campos diferentes para o registro de cabeçalho e os registros de status.</span><span class="sxs-lookup"><span data-stu-id="3f740-109">Diagnostic records contain different fields for the header record and the status records.</span></span> <span data-ttu-id="3f740-110">Os componentes ODBC também podem definir seus próprios campos de registro de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="3f740-110">ODBC components can also define their own diagnostic record fields.</span></span>  
  
 <span data-ttu-id="3f740-111">Os campos no registro de cabeçalho contêm informações gerais sobre a execução de uma função, incluindo o código de retorno, a contagem de linhas, o número de registros de status e o tipo de instruções executadas.</span><span class="sxs-lookup"><span data-stu-id="3f740-111">Fields in the header record contain general information about a function's execution, including the return code, row count, number of status records, and type of statement executed.</span></span> <span data-ttu-id="3f740-112">O registro de cabeçalho sempre é criado, a menos que uma função ODBC retorne SQL_INVALID_HANDLE.</span><span class="sxs-lookup"><span data-stu-id="3f740-112">The header record is always created unless an ODBC function returns SQL_INVALID_HANDLE.</span></span> <span data-ttu-id="3f740-113">Para obter uma lista completa de campos no registro de cabeçalho, consulte [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span><span class="sxs-lookup"><span data-stu-id="3f740-113">For a complete list of fields in the header record, see [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span></span>  
  
 <span data-ttu-id="3f740-114">Os campos dos registros de status contêm informações sobre erros ou avisos específicos retornados pelo Gerenciador de Driver ODBC, driver ou fonte de dados, incluindo o SQLSTATE, número do erro nativo, mensagem de diagnóstico, número da coluna e número da linha.</span><span class="sxs-lookup"><span data-stu-id="3f740-114">Fields in the status records contain information about specific errors or warnings returned by the ODBC Driver Manager, driver, or data source, including the SQLSTATE, native error number, diagnostic message, column number, and row number.</span></span> <span data-ttu-id="3f740-115">Os registros de status só são criados se a função retornar SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA ou SQL_STILL_EXECUTING.</span><span class="sxs-lookup"><span data-stu-id="3f740-115">Status records are created only if the function returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA, or SQL_STILL_EXECUTING.</span></span> <span data-ttu-id="3f740-116">Para obter uma lista completa de campos nos registros de status, consulte **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="3f740-116">For a complete list of fields in the status records, see **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="3f740-117">**SQLGetDiagRec** recupera um único registro de diagnóstico junto com seus campos do ODBC SQLSTATE, número de erro nativo e diagnóstico-Message.</span><span class="sxs-lookup"><span data-stu-id="3f740-117">**SQLGetDiagRec** retrieves a single diagnostic record along with its ODBC SQLSTATE, native error number, and diagnostic-message fields.</span></span> <span data-ttu-id="3f740-118">Essa funcionalidade é semelhante ao ODBC 2. função _x_**SqlError** .</span><span class="sxs-lookup"><span data-stu-id="3f740-118">This functionality is similar to the ODBC 2._x_**SQLError** function.</span></span> <span data-ttu-id="3f740-119">A função de tratamento de erros mais simples no ODBC 3. *x* é chamar repetidamente **SQLGetDiagRec** começando com o parâmetro *RecNumber* definido como 1 e incrementando *RecNumber* em 1 até que **SQLGetDiagRec** retorne SQL_NO_DATA.</span><span class="sxs-lookup"><span data-stu-id="3f740-119">The simplest error-handling function in ODBC 3.*x* is to repeatedly call **SQLGetDiagRec** starting with the *RecNumber* parameter set to 1 and incrementing *RecNumber* by 1 until **SQLGetDiagRec** returns SQL_NO_DATA.</span></span> <span data-ttu-id="3f740-120">Isso é equivalente a um ODBC 2. aplicativo *x* chamando **SqlError** até que ele retorne SQL_NO_DATA_FOUND.</span><span class="sxs-lookup"><span data-stu-id="3f740-120">This is equivalent to an ODBC 2.*x* application calling **SQLError** until it returns SQL_NO_DATA_FOUND.</span></span>  
  
 <span data-ttu-id="3f740-121">ODBC 3. *x* dá suporte a muito mais informações de diagnóstico do que o ODBC 2. *x*.</span><span class="sxs-lookup"><span data-stu-id="3f740-121">ODBC 3.*x* supports much more diagnostic information than ODBC 2.*x*.</span></span> <span data-ttu-id="3f740-122">Essas informações são armazenadas em campos adicionais nos registros de diagnóstico recuperados usando **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="3f740-122">This information is stored in additional fields in diagnostic records retrieved by using **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="3f740-123">O [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC do Native Client tem campos de diagnóstico específicos do driver que podem ser recuperados com **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="3f740-123">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver has driver-specific diagnostic fields that can be retrieved with **SQLGetDiagField**.</span></span> <span data-ttu-id="3f740-124">Os rótulos para esses campos específicos de driver são definidos em sqlncli.h.</span><span class="sxs-lookup"><span data-stu-id="3f740-124">Labels for these driver-specific fields are defined in sqlncli.h.</span></span> <span data-ttu-id="3f740-125">Use esses rótulos para recuperar o estado [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], nível de severidade, nome do servidor, nome do procedimento e número de linha associado a cada registro de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="3f740-125">Use these labels to retrieve the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] state, severity level, server name, procedure name, and line number associated with each diagnostic record.</span></span> <span data-ttu-id="3f740-126">Além disso, sqlncli. h contém definições dos códigos que o driver usa para identificar instruções Transact-SQL se um aplicativo chama **SQLGetDiagField** com *DiagIdentifier* definido como SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span><span class="sxs-lookup"><span data-stu-id="3f740-126">Also, sqlncli.h contains definitions of the codes the driver uses to identify Transact-SQL statements if an application calls **SQLGetDiagField** with *DiagIdentifier* set to SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span></span>  
  
 <span data-ttu-id="3f740-127">O **SQLGetDiagField** é processado pelo Gerenciador de driver ODBC usando informações de erro que ele armazena em cache do driver subjacente.</span><span class="sxs-lookup"><span data-stu-id="3f740-127">**SQLGetDiagField** is processed by the ODBC Driver Manager using error information it caches from the underlying driver.</span></span> <span data-ttu-id="3f740-128">O Gerenciador de Driver ODBC não armazena em cache os campos de diagnóstico específicos de driver até que seja estabelecida uma conexão bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="3f740-128">The ODBC Driver Manager does not cache driver-specific diagnostic fields until after a successful connection has been made.</span></span> <span data-ttu-id="3f740-129">**SQLGetDiagField** retornará SQL_ERROR se for chamado para obter campos de diagnóstico específicos do driver antes da conclusão de uma conexão bem-sucedida.</span><span class="sxs-lookup"><span data-stu-id="3f740-129">**SQLGetDiagField** returns SQL_ERROR if it is called to get driver-specific diagnostic fields before a successful connection has been completed.</span></span> <span data-ttu-id="3f740-130">Se uma função de conexão ODBC retornar SQL_SUCCESS_WITH_INFO, os campos de diagnóstico específicos de driver para a função de conexão ainda não estarão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="3f740-130">If an ODBC connect function returns SQL_SUCCESS_WITH_INFO, the driver-specific diagnostic fields for the connect function are not yet available.</span></span> <span data-ttu-id="3f740-131">Você pode iniciar a chamada de **SQLGetDiagField** para campos de diagnóstico específicos do driver somente depois de ter feito outra chamada de função ODBC após a função de conexão.</span><span class="sxs-lookup"><span data-stu-id="3f740-131">You can start calling **SQLGetDiagField** for driver-specific diagnostic fields only after you have made another ODBC function call after the connect function.</span></span>  
  
 <span data-ttu-id="3f740-132">A maioria dos erros relatados pelo [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC do Native Client pode ser efetivamente diagnosticada usando apenas as informações retornadas pelo **SQLGetDiagRec**.</span><span class="sxs-lookup"><span data-stu-id="3f740-132">Most errors reported by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver can be effectively diagnosed using only the information returned by **SQLGetDiagRec**.</span></span> <span data-ttu-id="3f740-133">Em alguns casos, porém, as informações retornadas pelos campos de diagnóstico específicos de driver são importantes no diagnóstico de um erro.</span><span class="sxs-lookup"><span data-stu-id="3f740-133">In some cases, however, the information returned by the driver-specific diagnostic fields is important in diagnosing an error.</span></span> <span data-ttu-id="3f740-134">Ao codificar um manipulador de erro ODBC para aplicativos que usam o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC do Native Client, também é uma boa ideia usar o **SQLGetDiagField** para recuperar pelo menos os SQL_DIAG_SS_MSGSTATE e SQL_DIAG_SS_SEVERITY campos específicos do driver.</span><span class="sxs-lookup"><span data-stu-id="3f740-134">When coding an ODBC error handler for applications using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver, it is a good idea to also use **SQLGetDiagField** to retrieve at least the SQL_DIAG_SS_MSGSTATE and SQL_DIAG_SS_SEVERITY driver-specific fields.</span></span> <span data-ttu-id="3f740-135">Se um erro em particular for gerado em vários locais no código [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], SQL_DIAG_SS_MSGSTATE indicará a um engenheiro de suporte da Microsoft onde especificamente o erro foi gerado, o que muitas vezes ajuda no diagnóstico de um problema.</span><span class="sxs-lookup"><span data-stu-id="3f740-135">If a particular error can be raised at several locations in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] code, SQL_DIAG_SS_MSGSTATE indicates to a Microsoft support engineer specifically where an error was raised, which sometimes aids in diagnosing a problem.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3f740-136">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="3f740-136">See Also</span></span>  
 [<span data-ttu-id="3f740-137">Tratando de erros e mensagens</span><span class="sxs-lookup"><span data-stu-id="3f740-137">Handling Errors and Messages</span></span>](handling-errors-and-messages.md)  
  
  
