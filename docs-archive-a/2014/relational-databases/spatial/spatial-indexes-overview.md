---
title: Visão geral de índices espaciais | Microsoft Docs
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- spatial indexes [SQL Server]
ms.assetid: b1ae7b78-182a-459e-ab28-f743e43f8293
author: MladjoA
ms.author: mlandzic
ms.openlocfilehash: 36406bd60b4204469aca3d20862020870a8832fe
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87575064"
---
# <a name="spatial-indexes-overview"></a><span data-ttu-id="be07d-102">Visão geral de índices espaciais</span><span class="sxs-lookup"><span data-stu-id="be07d-102">Spatial Indexes Overview</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="be07d-103">dá suporte a dados e índices espaciais.</span><span class="sxs-lookup"><span data-stu-id="be07d-103">supports spatial data and spatial indexes.</span></span> <span data-ttu-id="be07d-104">Um *índice espacial* é um tipo de índice estendido que permite indexar uma coluna espacial.</span><span class="sxs-lookup"><span data-stu-id="be07d-104">A *spatial index* is a type of extended index that allows you to index a spatial column.</span></span> <span data-ttu-id="be07d-105">Uma coluna espacial é uma coluna de uma tabela que contém tipo de dados espaciais, como `geometry` ou `geography`.</span><span class="sxs-lookup"><span data-stu-id="be07d-105">A spatial column is a table column that contains data of a spatial data type, such as `geometry` or `geography`.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="be07d-106">Para obter uma descrição detalhada e exemplos dos recursos espaciais introduzidos no [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], incluindo recursos que afetam índices espaciais, baixe o white paper sobre [Novos recursos espaciais no SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407).</span><span class="sxs-lookup"><span data-stu-id="be07d-106">For a detailed description and examples of spatial features introduced in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], including features that affect spatial indexes, download the white paper, [New Spatial Features in SQL Server 2012](https://go.microsoft.com/fwlink/?LinkId=226407).</span></span>

##  <a name="about-spatial-indexes"></a><a name="about"></a> <span data-ttu-id="be07d-107">Sobre índices espaciais</span><span class="sxs-lookup"><span data-stu-id="be07d-107">About Spatial Indexes</span></span>

###  <a name="decomposing-indexed-space-into-a-grid-hierarchy"></a><a name="decompose"></a> <span data-ttu-id="be07d-108">Decompondo espaço indexado em uma hierarquia de grade</span><span class="sxs-lookup"><span data-stu-id="be07d-108">Decomposing Indexed Space into a Grid Hierarchy</span></span>
 <span data-ttu-id="be07d-109">No [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], índices espaciais são criados usando árvores B, o que significa que os índices devem representar os dados espaciais bidimensionais na ordem linear de árvores B.</span><span class="sxs-lookup"><span data-stu-id="be07d-109">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes are built using B-trees, which means that the indexes must represent the 2-dimensional spatial data in the linear order of B-trees.</span></span> <span data-ttu-id="be07d-110">Portanto, antes de ler dados em um índice espacial, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] implementa uma decomposição uniforme hierárquica do espaço.</span><span class="sxs-lookup"><span data-stu-id="be07d-110">Therefore, before reading data into a spatial index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] implements a hierarchical uniform decomposition of space.</span></span> <span data-ttu-id="be07d-111">O processo de criação de índice *decompõe* o espaço em uma *hierarquia de grade*de quatro níveis.</span><span class="sxs-lookup"><span data-stu-id="be07d-111">The index-creation process *decomposes* the space into a four-level *grid hierarchy*.</span></span> <span data-ttu-id="be07d-112">Esses níveis são chamados de *nível 1* (o nível superior), *nível 2*, *nível 3*e *nível 4*.</span><span class="sxs-lookup"><span data-stu-id="be07d-112">These levels are referred to as *level 1* (the top level), *level 2*, *level 3*, and *level 4*.</span></span>

 <span data-ttu-id="be07d-113">Cada nível sucessivo decompõe ainda mais o nível acima dele, de forma que cada célula de nível superior contém uma grade completa no próximo nível.</span><span class="sxs-lookup"><span data-stu-id="be07d-113">Each successive level further decomposes the level above it, so each upper-level cell contains a complete grid at the next level.</span></span> <span data-ttu-id="be07d-114">Em um determinado nível, todas as grades têm o mesmo número de células ao longo dos dois eixos (por exemplo, 4x4 ou 8x8) e as células são todas de um único tamanho.</span><span class="sxs-lookup"><span data-stu-id="be07d-114">On a given level, all the grids have the same number of cells along both axes (for example, 4x4 or 8x8), and the cells are all one size.</span></span>

 <span data-ttu-id="be07d-115">A ilustração a seguir mostra a decomposição da célula superior direita em cada nível da hierarquia de uma grade de 4x4.</span><span class="sxs-lookup"><span data-stu-id="be07d-115">The following illustration shows the decomposition for the upper-right cell at each level of the grid hierarchy into a 4x4 grid.</span></span> <span data-ttu-id="be07d-116">Na realidade, todas as células são decompostas dessa maneira.</span><span class="sxs-lookup"><span data-stu-id="be07d-116">In reality, all the cells are decomposed in this way.</span></span> <span data-ttu-id="be07d-117">Assim, por exemplo, a decomposição de um espaço em quatro níveis de grades de 4x4 realmente produz um total de 65.536 células de quatro níveis.</span><span class="sxs-lookup"><span data-stu-id="be07d-117">Thus, for example, decomposing a space into four levels of 4x4 grids actually produces a total of 65,536 level-four cells.</span></span>

 <span data-ttu-id="be07d-118">![Quatro níveis de mosaico recursivo](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Quatro níveis de mosaico recursivo")</span><span class="sxs-lookup"><span data-stu-id="be07d-118">![Four-levels of recursive tessellation](../../database-engine/media/spndx-recursive-levels-telescoped.gif "Four-levels of recursive tessellation")</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-119">A decomposição de espaço para um índice espacial depende da unidade de medida usada pelos dados do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="be07d-119">The decomposition of space for a spatial index is independent of the unit of measurement that the application data uses.</span></span>

 <span data-ttu-id="be07d-120">As células da hierarquia de grade são numeradas de maneira linear usando uma variação da curva de preenchimento de espaço de Hilbert.</span><span class="sxs-lookup"><span data-stu-id="be07d-120">Grid hierarchy cells are numbered in a linear fashion by using a variation of the Hilbert space-filling curve.</span></span> <span data-ttu-id="be07d-121">No entanto, para fins ilustrativos, esta discussão usa uma numeração baseada em linhas, em vez da numeração realmente produzida pela curva de Hilbert.</span><span class="sxs-lookup"><span data-stu-id="be07d-121">For the purpose of illustration, however, this discussion uses a simple row-wise numbering, instead of the numbering that is actually produced by the Hilbert curve.</span></span> <span data-ttu-id="be07d-122">Na ilustração a seguir, vários polígonos que representam prédios e linhas que representam ruas já foram colocados em uma grade 4x4 de nível 1.</span><span class="sxs-lookup"><span data-stu-id="be07d-122">In the following illustration, several polygons that represent buildings, and lines that represent streets, have already been placed into a 4x4, level-1 grid.</span></span> <span data-ttu-id="be07d-123">As células de nível 1 são numeradas de 1 a 16, a partir da célula superior esquerda.</span><span class="sxs-lookup"><span data-stu-id="be07d-123">The level-1 cells are numbered from 1 through 16, starting with the upper-left cell.</span></span>

 <span data-ttu-id="be07d-124">![Polígonos e linhas colocados em uma grade 4x4 de nível 1](../../database-engine/media/spndx-level-1-objects.gif "Polígonos e linhas colocados em uma grade 4 x 4 de nível 1")</span><span class="sxs-lookup"><span data-stu-id="be07d-124">![Polygons and lines placed into a 4x4 level-1 grid](../../database-engine/media/spndx-level-1-objects.gif "Polygons and lines placed into a 4x4 level-1 grid")</span></span>

#### <a name="grid-density"></a><span data-ttu-id="be07d-125">Densidade da grade</span><span class="sxs-lookup"><span data-stu-id="be07d-125">Grid Density</span></span>
 <span data-ttu-id="be07d-126">O número de células ao longo dos eixos de uma grade determina sua *densidade*: quanto maior o número, mais densa a grade.</span><span class="sxs-lookup"><span data-stu-id="be07d-126">The number of cells along the axes of a grid determines its *density*: the larger the number, the denser the grid.</span></span> <span data-ttu-id="be07d-127">Por exemplo, uma grade de 8x8 (que produz 64 células) é mais densa do que uma grade de 4x4 (que produz 16 células).</span><span class="sxs-lookup"><span data-stu-id="be07d-127">For example, an 8x8 grid (which produces 64 cells), is denser than a 4x4 grid (which produces 16 cells).</span></span> <span data-ttu-id="be07d-128">A densidade da grade é definida em uma base por nível.</span><span class="sxs-lookup"><span data-stu-id="be07d-128">Grid density is defined on a per-level basis.</span></span>

 <span data-ttu-id="be07d-129">A instrução [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] dá suporte a uma cláusula GRIDS que permite especificar diferentes densidades de grade em diferentes níveis.</span><span class="sxs-lookup"><span data-stu-id="be07d-129">The [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a GRIDS clause that enables you to specify different grid densities at different levels.</span></span> <span data-ttu-id="be07d-130">A densidade da grade em um determinado nível é especificada com uma das palavras-chave a seguir.</span><span class="sxs-lookup"><span data-stu-id="be07d-130">The grid density for a given level is specified by using one of the following keywords.</span></span>

|<span data-ttu-id="be07d-131">Palavra-chave</span><span class="sxs-lookup"><span data-stu-id="be07d-131">Keyword</span></span>|<span data-ttu-id="be07d-132">Configuração da grade</span><span class="sxs-lookup"><span data-stu-id="be07d-132">Grid configuration</span></span>|<span data-ttu-id="be07d-133">Número de células</span><span class="sxs-lookup"><span data-stu-id="be07d-133">Number of cells</span></span>|
|-------------|------------------------|---------------------|
|<span data-ttu-id="be07d-134">LOW</span><span class="sxs-lookup"><span data-stu-id="be07d-134">LOW</span></span>|<span data-ttu-id="be07d-135">4X4</span><span class="sxs-lookup"><span data-stu-id="be07d-135">4X4</span></span>|<span data-ttu-id="be07d-136">16</span><span class="sxs-lookup"><span data-stu-id="be07d-136">16</span></span>|
|<span data-ttu-id="be07d-137">MEDIUM</span><span class="sxs-lookup"><span data-stu-id="be07d-137">MEDIUM</span></span>|<span data-ttu-id="be07d-138">8X8</span><span class="sxs-lookup"><span data-stu-id="be07d-138">8X8</span></span>|<span data-ttu-id="be07d-139">64</span><span class="sxs-lookup"><span data-stu-id="be07d-139">64</span></span>|
|<span data-ttu-id="be07d-140">HIGH</span><span class="sxs-lookup"><span data-stu-id="be07d-140">HIGH</span></span>|<span data-ttu-id="be07d-141">16X16</span><span class="sxs-lookup"><span data-stu-id="be07d-141">16X16</span></span>|<span data-ttu-id="be07d-142">256</span><span class="sxs-lookup"><span data-stu-id="be07d-142">256</span></span>|

 <span data-ttu-id="be07d-143">No [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], quando o nível de compatibilidade do banco de dados é definido como 100 ou abaixo, o padrão é MEDIUM em todos os níveis.</span><span class="sxs-lookup"><span data-stu-id="be07d-143">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], when the database compatibility level is set to 100 or lower, then the default is MEDIUM on all levels.</span></span> <span data-ttu-id="be07d-144">Quando o nível de compatibilidade do banco de dados é definido como 110 ou acima, o padrão é um esquema de grade automática.</span><span class="sxs-lookup"><span data-stu-id="be07d-144">When the database compatibility level is set to 110 or higher, then the default is an auto grid scheme.</span></span>

 <span data-ttu-id="be07d-145">Você pode controlar o processo de decomposição especificando densidades de grade não padrão.</span><span class="sxs-lookup"><span data-stu-id="be07d-145">You can control the decomposition process by specifying non-default grid densities.</span></span> <span data-ttu-id="be07d-146">Por exemplo, densidades diferentes de grade em diferentes níveis podem ser úteis para ajuste fino de um índice com base no tamanho do espaço indexado e nos objetos na coluna espacial.</span><span class="sxs-lookup"><span data-stu-id="be07d-146">For example, different grid densities on different levels might be useful for fine tuning an index based on the size of the indexed space and the objects in the spatial column.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-147">As densidades de grade de um índice espacial são visíveis nas colunas level_1_grid, level_2_grid, level_3_grid, e level_4_grid da exibição de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) quando o nível de compatibilidade do banco de dados é definido como 100 ou abaixo.</span><span class="sxs-lookup"><span data-stu-id="be07d-147">The grid densities of a spatial index are visible in the level_1_grid, level_2_grid, level_3_grid, and level_4_grid columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view when the database compatibility level is set to 100 or lower.</span></span> <span data-ttu-id="be07d-148">As `GEOMETRY_AUTO_GRID` / `GEOGRAPHY_AUTO_GRID` Opções de esquema de mosaico não preenchem essas colunas.</span><span class="sxs-lookup"><span data-stu-id="be07d-148">The `GEOMETRY_AUTO_GRID`/`GEOGRAPHY_AUTO_GRID` tessellation scheme options do not populate these columns.</span></span> <span data-ttu-id="be07d-149">a exibição de catálogo sys. spatial_index_tessellations tem `NULL` valores para essas colunas quando as opções de grade automática são usadas.</span><span class="sxs-lookup"><span data-stu-id="be07d-149">sys.spatial_index_tessellations catalog view has `NULL` values for these columns when the auto grid options are used.</span></span>

###  <a name="tessellation"></a><a name="tessellation"></a> <span data-ttu-id="be07d-150">Mosaico</span><span class="sxs-lookup"><span data-stu-id="be07d-150">Tessellation</span></span>
 <span data-ttu-id="be07d-151">Após a decomposição de um espaço indexado em uma hierarquia de grade, o índice espacial lê os dados da coluna espacial, linha a linha.</span><span class="sxs-lookup"><span data-stu-id="be07d-151">After decomposition of an indexed space into a grid hierarchy, the spatial index reads the data from the spatial column, row by row.</span></span> <span data-ttu-id="be07d-152">Depois de ler os dados de um objeto espacial (ou instância), o índice espacial executa um *processo de mosaico* para esse objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-152">After reading the data for a spatial object (or instance), the spatial index performs a *tessellation process* for that object.</span></span> <span data-ttu-id="be07d-153">O processo de mosaico ajusta o objeto na hierarquia da grade associando o objeto a um conjunto de células da grade tocadas por ele (*células tocadas*).</span><span class="sxs-lookup"><span data-stu-id="be07d-153">The tessellation processfits the object into the grid hierarchy by associating the object with a set of grid cells that it touches (*touched cells*).</span></span> <span data-ttu-id="be07d-154">Iniciando no nível 1 da hierarquia de grade, o processo de mosaico continua com *amplitude primeiro* em todo o nível.</span><span class="sxs-lookup"><span data-stu-id="be07d-154">Starting at level 1 of the grid hierarchy, the tessellation process proceeds *breadth first* across the level.</span></span> <span data-ttu-id="be07d-155">Potencialmente, o processo pode continuar por todos os quatro níveis, um nível de cada vez.</span><span class="sxs-lookup"><span data-stu-id="be07d-155">Potentially, the process can continue through all four levels, one level at a time.</span></span>

 <span data-ttu-id="be07d-156">A saída do processo de mosaico é um conjunto de células tocadas que são registradas no índice espacial do objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-156">The output of the tessellation process is a set of touched cells that are recorded in the spatial index for the object.</span></span> <span data-ttu-id="be07d-157">Consultando essas células registradas, o índice espacial pode localizar o objeto no espaço em relação a outros objetos na coluna espacial que também são armazenados no índice.</span><span class="sxs-lookup"><span data-stu-id="be07d-157">By referring to these recorded cells, the spatial index can locate the object in space relative to other objects in the spatial column that are also stored in the index.</span></span>

#### <a name="tessellation-rules"></a><span data-ttu-id="be07d-158">Regras do mosaico</span><span class="sxs-lookup"><span data-stu-id="be07d-158">Tessellation Rules</span></span>
 <span data-ttu-id="be07d-159">Para limitar o número de células tocadas registradas para um objeto, o processo de mosaico aplica várias regras de mosaico.</span><span class="sxs-lookup"><span data-stu-id="be07d-159">To limit the number of touched cells that are recorded for an object, the tessellation process applies several tessellation rules.</span></span> <span data-ttu-id="be07d-160">Essas regras determinam a profundidade do processo de mosaico e quais das células tocadas são registradas no índice espacial do objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-160">These rules determine the depth of the tessellation process and which of the touched cells are recorded in the index.</span></span>

 <span data-ttu-id="be07d-161">Essas regras são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="be07d-161">These rules are as follows:</span></span>

-   <span data-ttu-id="be07d-162">A regra de cobertura</span><span class="sxs-lookup"><span data-stu-id="be07d-162">The covering rule</span></span>

     <span data-ttu-id="be07d-163">Se o objeto cobrir uma célula completamente, a célula será considerada *coberta* pelo objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-163">If the object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="be07d-164">Uma célula coberta é contada e não é incluída no mosaico.</span><span class="sxs-lookup"><span data-stu-id="be07d-164">A covered cell is counted and is not tessellated.</span></span> <span data-ttu-id="be07d-165">Essa regra se aplica a todos os níveis da hierarquia de grade.</span><span class="sxs-lookup"><span data-stu-id="be07d-165">This rule applies at all levels of the grid hierarchy.</span></span> <span data-ttu-id="be07d-166">A regra de cobertura simplifica o processo de mosaico e reduz a quantidade de dados que um índice espacial registra.</span><span class="sxs-lookup"><span data-stu-id="be07d-166">The covering rule simplifies the tessellation process and reduces the amount of data that a spatial index records.</span></span>

-   <span data-ttu-id="be07d-167">A regra de células por objeto</span><span class="sxs-lookup"><span data-stu-id="be07d-167">The cells-per-object rule</span></span>

     <span data-ttu-id="be07d-168">Essa regra impõe o *limite de células por objeto*, que determina o número máximo de células que podem ser contadas para cada objeto, exceto no nível 1.</span><span class="sxs-lookup"><span data-stu-id="be07d-168">This rule enforces the *cells-per-object limit*, which determines the maximum number of cells that can be counted for each object, except on level 1.</span></span> <span data-ttu-id="be07d-169">Em níveis inferiores, a regra de células por objeto controla a quantidade de informações que podem ser registradas sobre o objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-169">At lower levels, the cells-per-object rule controls the amount of information that can be recorded about the object.</span></span>

-   <span data-ttu-id="be07d-170">A regra de célula mais profunda</span><span class="sxs-lookup"><span data-stu-id="be07d-170">The deepest-cell rule</span></span>

     <span data-ttu-id="be07d-171">A regra de célula mais profunda gera a melhor aproximação de um objeto registrando apenas as células mais inferiores que foram incluídas no mosaico do objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-171">The deepest-cell rule generates the best approximation of an object by recording only the bottom-most cells that have been tessellated for the object.</span></span> <span data-ttu-id="be07d-172">Células pai não contribuem com a contagem de células por objeto e não são registradas no índice.</span><span class="sxs-lookup"><span data-stu-id="be07d-172">Parent cells do not contribute to the cells-per-object count, and they are not recorded in the index.</span></span>

 <span data-ttu-id="be07d-173">Estas regras de mosaico são aplicadas recursivamente em cada nível de grade.</span><span class="sxs-lookup"><span data-stu-id="be07d-173">These tessellation rules are applied recursively on each grid level.</span></span> <span data-ttu-id="be07d-174">O restante desta seção descreve as regras de mosaico em mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="be07d-174">The rest of this section describes the tessellation rules in more detail.</span></span>

#### <a name="covering-rule"></a><span data-ttu-id="be07d-175">Regra de cobertura</span><span class="sxs-lookup"><span data-stu-id="be07d-175">Covering Rule</span></span>
 <span data-ttu-id="be07d-176">Se o objeto cobrir uma célula completamente, a célula será considerada *coberta* pelo objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-176">If an object completely covers a cell, that cell is said to be *covered* by the object.</span></span> <span data-ttu-id="be07d-177">Por exemplo, na ilustração a seguir, uma das células de segundo nível, 15.11, está completamente coberta pela parte do meio de um octógono.</span><span class="sxs-lookup"><span data-stu-id="be07d-177">For example, in the following illustration, one of the second-level cells, 15.11, is completely covered by the middle portion of an octagon.</span></span>

 <span data-ttu-id="be07d-178">![Otimização da cobertura](../../database-engine/media/spndx-opt-covering.gif "Otimização da cobertura")</span><span class="sxs-lookup"><span data-stu-id="be07d-178">![Covering optimization](../../database-engine/media/spndx-opt-covering.gif "Covering optimization")</span></span>

 <span data-ttu-id="be07d-179">Uma célula coberta é contada e registrada no índice e não é mais incluída no mosaico.</span><span class="sxs-lookup"><span data-stu-id="be07d-179">A covered cell is counted and recorded in the index, and the cell is not tessellated any further.</span></span>

#### <a name="cells-per-object-rule"></a><span data-ttu-id="be07d-180">Regra de células por objeto</span><span class="sxs-lookup"><span data-stu-id="be07d-180">Cells-Per-Object Rule</span></span>
 <span data-ttu-id="be07d-181">A extensão do mosaico de cada objeto depende principalmente do *limite células por objeto* do índice espacial.</span><span class="sxs-lookup"><span data-stu-id="be07d-181">The extent of tessellation of each object depends primarily on the *cells-per-object limit* of the spatial index.</span></span> <span data-ttu-id="be07d-182">Esse limite define o número máximo de células que o mosaico pode contar por objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-182">This limit defines the maximum number of cells that tessellation can count per object.</span></span> <span data-ttu-id="be07d-183">No entanto, observe que a regra de células por objeto não é imposta para o nível 1, portanto esse limite pode ser excedido.</span><span class="sxs-lookup"><span data-stu-id="be07d-183">Note, however, that the cells-per-object rule is not enforced for level 1, so it is possible to exceed this limit.</span></span> <span data-ttu-id="be07d-184">Se a contagem de nível 1 atingir ou exceder o limite de células por objeto, nenhum mosaico adicional ocorrerá nos níveis inferiores.</span><span class="sxs-lookup"><span data-stu-id="be07d-184">If the level-1 count reaches, or exceeds, the cells-per-object limit, no further tessellation occurs at the lower levels.</span></span>

 <span data-ttu-id="be07d-185">Desde que a contagem seja menor do que o limite de células por objeto, o processo de mosaico continua.</span><span class="sxs-lookup"><span data-stu-id="be07d-185">As long as the count is less than the cells-per-object limit, the tessellation process continues.</span></span> <span data-ttu-id="be07d-186">Começando com a célula tocada de número inferior (por exemplo, a célula 15.6 na ilustração anterior), o processo testa cada célula para avaliar se deve contá-la ou incluí-la no mosaico.</span><span class="sxs-lookup"><span data-stu-id="be07d-186">Starting with the lowest-number touched cell (for example, cell 15.6 in the preceding illustration), the process tests each cell to evaluate whether to count it or tessellate it.</span></span> <span data-ttu-id="be07d-187">Se a inclusão de uma célula no mosaico exceder o limite de células por objeto, a célula será contada e não será incluída no mosaico.</span><span class="sxs-lookup"><span data-stu-id="be07d-187">If tessellating a cell would exceed the cells-per-object limit, the cell is counted and not tessellated.</span></span> <span data-ttu-id="be07d-188">Caso contrário, a célula será incluída no mosaico e as células de nível inferior que são tocadas pelo objeto serão contadas.</span><span class="sxs-lookup"><span data-stu-id="be07d-188">Otherwise, the cell is tessellated, and the lower-level cells that are touched by the object are counted.</span></span> <span data-ttu-id="be07d-189">O processo de mosaico continua dessa maneira, em modo de amplitude, em todo o nível.</span><span class="sxs-lookup"><span data-stu-id="be07d-189">The tessellation process continues in this way, breadth-wise, across the level.</span></span> <span data-ttu-id="be07d-190">Esse processo é repetido recursivamente para as grades de nível inferior das células incluídas no mosaico até que o limite seja atingido ou não existam mais células para contar.</span><span class="sxs-lookup"><span data-stu-id="be07d-190">This process is repeated recursively for the lower-level grids of the tessellated cells until the limit is reached or there are no more cells to count.</span></span>

 <span data-ttu-id="be07d-191">Por exemplo, considere a ilustração anterior que mostra um octógono que se ajusta completamente à célula 15 da grade de nível 1.</span><span class="sxs-lookup"><span data-stu-id="be07d-191">For example, consider the preceding illustration, which shows an octagon that fits completely into cell 15 of the level-1 grid.</span></span> <span data-ttu-id="be07d-192">Na figura, a célula 15 foi incluída no mosaico, dissecando o octógono em nove células de nível 2.</span><span class="sxs-lookup"><span data-stu-id="be07d-192">In the figure, cell 15 has been tessellated, dissecting the octagon into nine level-2 cells.</span></span> <span data-ttu-id="be07d-193">Esta ilustração pressupõe que o limite de células por objeto é 9 ou maior.</span><span class="sxs-lookup"><span data-stu-id="be07d-193">This illustration assumes that the cells-per-object limit is 9 or more.</span></span> <span data-ttu-id="be07d-194">No entanto, se o limite de células por objeto fosse 8 ou menor, a célula 15 não seria incluída no mosaico e a apenas a célula 15 seria contada para o objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-194">If the cells-per-object limit were 8 or less, however, cell 15 would not be tessellated, and only that cell 15 would be counted for the object.</span></span>

 <span data-ttu-id="be07d-195">Por padrão, o limite de células por objeto é de 16, o que fornece uma troca satisfatória entre espaço e precisão para a maior parte dos índices espaciais.</span><span class="sxs-lookup"><span data-stu-id="be07d-195">By default, the cells-per-object limit is 16 cells per object, which provides a satisfactory trade-off between space and precision for most spatial indexes.</span></span> <span data-ttu-id="be07d-196">No entanto, a instrução [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] dá suporte a uma cláusula CELLS_PER_OBJECT `=` *n* que permite especificar um limite de células por objeto entre 1 e 8192, inclusive.</span><span class="sxs-lookup"><span data-stu-id="be07d-196">However, the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement supports a CELLS_PER_OBJECT`=`*n* clause that enables you to specify a cells-per-object limit between 1 and 8192, inclusive.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-197">A configuração **cells_per_object** de um índice espacial é visível na exibição de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="be07d-197">The **cells_per_object** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="deepest-cell-rule"></a><span data-ttu-id="be07d-198">Regra de célula mais profunda</span><span class="sxs-lookup"><span data-stu-id="be07d-198">Deepest-Cell Rule</span></span>
 <span data-ttu-id="be07d-199">A regra da célula mais profunda explora o fato de que cada célula de nível inferior pertence à célula acima dela: uma célula de nível 4 pertence a uma célula de nível 3, uma célula de nível 3 pertence a uma célula de nível 2 e uma célula de nível 2 pertence a uma célula de nível 1.</span><span class="sxs-lookup"><span data-stu-id="be07d-199">The deepest-cell rule exploits the fact that every lower-level cell belongs to the cell above it: a level-4 cell belongs to a level-3 cell, a level-3 cell belongs to a level-2 cell, and a level-2 cell belongs to a level-1 cell.</span></span> <span data-ttu-id="be07d-200">Por exemplo, um objeto que pertence à célula 1.1.1.1 também pertence à célula 1.1.1, à célula 1.1 e à célula 1.</span><span class="sxs-lookup"><span data-stu-id="be07d-200">For example, an object that belongs to cell 1.1.1.1 also belongs to cell 1.1.1, cell 1.1, and cell 1.</span></span> <span data-ttu-id="be07d-201">O conhecimento de tais relações da hierarquia de células é incorporado ao processador de consultas.</span><span class="sxs-lookup"><span data-stu-id="be07d-201">Knowledge of such cell-hierarchy relationships is built into the query processor.</span></span> <span data-ttu-id="be07d-202">Portanto apenas as células de nível mais profundo precisam ser registradas no índice minimizando as informações que o índice precisa armazenar.</span><span class="sxs-lookup"><span data-stu-id="be07d-202">Therefore, only the deepest-level cells need to be recorded in the index, minimizing the information that the index needs to store.</span></span>

 <span data-ttu-id="be07d-203">Na ilustração seguinte, um polígono em forma de diamante relativamente pequeno é incluído no mosaico.</span><span class="sxs-lookup"><span data-stu-id="be07d-203">In the following illustration, a relatively small diamond-shaped polygon is tessellated.</span></span> <span data-ttu-id="be07d-204">O índice usa o limite de células por objeto padrão de 16 que não é atingido para esse objeto pequeno.</span><span class="sxs-lookup"><span data-stu-id="be07d-204">The index uses the default cells-per-object limit of 16, which is not reached for this small object.</span></span> <span data-ttu-id="be07d-205">Portanto, o mosaico continua descendo até o nível 4.</span><span class="sxs-lookup"><span data-stu-id="be07d-205">Therefore, tessellation continues down to level 4.</span></span> <span data-ttu-id="be07d-206">O polígono reside nas células de nível 1 até as células de nível 3: 4, 4.4 e 4.4.10 e 4.4.14.</span><span class="sxs-lookup"><span data-stu-id="be07d-206">The polygon resides in the following level-1 through level-3 cells: 4, 4.4, and 4.4.10 and 4.4.14.</span></span> <span data-ttu-id="be07d-207">Entretanto, usando a regra da célula mais profunda, o mosaico conta apenas doze células de nível 4: 4.4.10.13-15 e 4.4.14.1-3, 4.4.14.5-7 e 4.4.14.9-11.</span><span class="sxs-lookup"><span data-stu-id="be07d-207">However, using the deepest-cell rule, the tessellation counts only the twelve level-4 cells: 4.4.10.13-15 and 4.4.14.1-3, 4.4.14.5-7, and 4.4.14.9-11.</span></span>

 <span data-ttu-id="be07d-208">![Otimização de célula mais profunda](../../database-engine/media/spndx-opt-deepest-cell.gif "Otimização de célula mais profunda")</span><span class="sxs-lookup"><span data-stu-id="be07d-208">![Deepest-cell optimization](../../database-engine/media/spndx-opt-deepest-cell.gif "Deepest-cell optimization")</span></span>

###  <a name="tessellation-schemes"></a><a name="schemes"></a> <span data-ttu-id="be07d-209">Esquemas de mosaico</span><span class="sxs-lookup"><span data-stu-id="be07d-209">Tessellation Schemes</span></span>
 <span data-ttu-id="be07d-210">O comportamento de um índice espacial depende parcialmente de seu *esquema de mosaico*.</span><span class="sxs-lookup"><span data-stu-id="be07d-210">The behavior of a spatial index depends partly on its *tessellation scheme*.</span></span> <span data-ttu-id="be07d-211">O esquema de mosaico é específico ao tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="be07d-211">The tessellation scheme is data-type specific.</span></span> <span data-ttu-id="be07d-212">No [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], índices espaciais oferecem suporte a dois esquemas de mosaico:</span><span class="sxs-lookup"><span data-stu-id="be07d-212">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spatial indexes support two tessellation schemes:</span></span>

-   <span data-ttu-id="be07d-213">*Mosaico de grade geométrica*, que é o esquema para o `geometry` tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="be07d-213">*Geometry grid tessellation*, which is the scheme for the `geometry` data type.</span></span>

-   <span data-ttu-id="be07d-214">*Mosaico de grade geography*, que se aplica a colunas do `geography` tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="be07d-214">*Geography grid tessellation*, which applies to columns of the `geography` data type.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-215">A configuração **tessellation_scheme** de um índice espacial é visível na exibição de catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="be07d-215">The **tessellation_scheme** setting of a spatial index is visible in the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="geometry-grid-tessellation-scheme"></a><span data-ttu-id="be07d-216">Esquema de mosaico de grade geométrica</span><span class="sxs-lookup"><span data-stu-id="be07d-216">Geometry Grid Tessellation Scheme</span></span>
 <span data-ttu-id="be07d-217">O mosaico GEOMETRY_AUTO_GRID é o esquema de mosaico padrão para o tipo de dados `geometry` no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e versões posteriores.</span><span class="sxs-lookup"><span data-stu-id="be07d-217">GEOMETRY_AUTO_GRID tessellation is the default tessellation scheme for the `geometry` data type for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and later.</span></span>  <span data-ttu-id="be07d-218">O mosaico GEOMETRY_GRID é o único esquema de mosaico disponível para tipos de dados geometry no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="be07d-218">GEOMETRY_GRID tessellation is the only tessellation scheme available for geometry data types in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="be07d-219">Esta seção discute aspectos do mosaico de grade geométrica que são relevantes para trabalhar com índices espaciais: métodos com suporte e caixas delimitadoras.</span><span class="sxs-lookup"><span data-stu-id="be07d-219">This section discusses aspects of geometry grid tessellation that are relevant to working with spatial indexes: supported methods and bounding boxes.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-220">Você pode especificar explicitamente esse esquema de mosaico usando a cláusula USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) da instrução [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="be07d-220">You can explicitly specify this tessellation scheme by using the USING (GEOMETRY_AUTO_GRID/GEOMETRY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="the-bounding-box"></a><span data-ttu-id="be07d-221">A caixa delimitadora</span><span class="sxs-lookup"><span data-stu-id="be07d-221">The Bounding Box</span></span>
 <span data-ttu-id="be07d-222">Dados geométricos ocupam um plano que pode ser infinito.</span><span class="sxs-lookup"><span data-stu-id="be07d-222">Geometric data occupies a plane that can be infinite.</span></span> <span data-ttu-id="be07d-223">Porém, no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], um índice espacial requer um espaço finito.</span><span class="sxs-lookup"><span data-stu-id="be07d-223">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], however, a spatial index requires a finite space.</span></span> <span data-ttu-id="be07d-224">Para estabelecer um espaço finito para decomposição, o esquema de mosaico de grade geométrica requer uma *caixa delimitadora*retangular.</span><span class="sxs-lookup"><span data-stu-id="be07d-224">To establish a finite space for decomposition, the geometry grid tessellation scheme requires a rectangular *bounding box*.</span></span> <span data-ttu-id="be07d-225">A caixa delimitadora é definida por quatro coordenadas, `(` _x-min_**,**_y-min_ `)` e `(` _x-Max_**,**_y-Max_ `)` , que são armazenadas como propriedades do índice espacial.</span><span class="sxs-lookup"><span data-stu-id="be07d-225">The bounding box is defined by four coordinates, `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)`, which are stored as properties of the spatial index.</span></span> <span data-ttu-id="be07d-226">Essas coordenadas representam o seguinte:</span><span class="sxs-lookup"><span data-stu-id="be07d-226">These coordinates represent the following:</span></span>

-   <span data-ttu-id="be07d-227">*x-min* é a coordenada X do canto inferior esquerdo da caixa delimitadora.</span><span class="sxs-lookup"><span data-stu-id="be07d-227">*x-min* is the x-coordinate of the lower-left corner of the bounding box.</span></span>

-   <span data-ttu-id="be07d-228">*y-min* é a coordenada y do canto inferior esquerdo.</span><span class="sxs-lookup"><span data-stu-id="be07d-228">*y-min* is the y-coordinate of the lower-left corner.</span></span>

-   <span data-ttu-id="be07d-229">*x-max* é a coordenada X do canto superior direito.</span><span class="sxs-lookup"><span data-stu-id="be07d-229">*x-max* is the x-coordinate of the upper-right corner.</span></span>

-   <span data-ttu-id="be07d-230">*y-max* é a coordenada y do canto superior direito.</span><span class="sxs-lookup"><span data-stu-id="be07d-230">*y-max* is the y-coordinate of upper-right corner.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-231">Essas coordenadas são especificadas pela cláusula BOUNDING_BOX da instrução [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="be07d-231">These coordinates are specified by the BOUNDING_BOX clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

 <span data-ttu-id="be07d-232">As `(` coordenadas _x-min_**,**_y-min_ `)` e `(` _x-Max_**,**_y-Max_ `)` determinam o posicionamento e as dimensões da caixa delimitadora.</span><span class="sxs-lookup"><span data-stu-id="be07d-232">The `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates determine the placement and dimensions of the bounding box.</span></span> <span data-ttu-id="be07d-233">O espaço fora da caixa delimitadora é tratado como uma única célula numerada como 0.</span><span class="sxs-lookup"><span data-stu-id="be07d-233">The space outside of the bounding box is treated as a single cell that is numbered 0.</span></span>

 <span data-ttu-id="be07d-234">O índice espacial decompõe o espaço dentro da caixa delimitadora.</span><span class="sxs-lookup"><span data-stu-id="be07d-234">The spatial index decomposes the space inside the bounding box.</span></span> <span data-ttu-id="be07d-235">A grade de nível 1 da hierarquia de grade preenche a caixa delimitadora.</span><span class="sxs-lookup"><span data-stu-id="be07d-235">The level-1 grid of the grid hierarchy fills the bounding box.</span></span> <span data-ttu-id="be07d-236">Para colocar um objeto geométrico na hierarquia da grade, o índice espacial compara as coordenadas do objeto com as coordenadas da caixa delimitadora.</span><span class="sxs-lookup"><span data-stu-id="be07d-236">To place a geometric object in the grid hierarchy, the spatial index compares the coordinates of the object to the bounding-box coordinates.</span></span>

 <span data-ttu-id="be07d-237">A ilustração a seguir mostra os pontos definidos pelas `(` coordenadas _x-min_**,**_y-min_ `)` e `(` _x-Max_**,**_y-Max_ `)` da caixa delimitadora.</span><span class="sxs-lookup"><span data-stu-id="be07d-237">The following illustration shows the points defined by the `(`_x-min_**,**_y-min_`)` and `(`_x-max_**,**_y-max_`)` coordinates of the bounding box.</span></span> <span data-ttu-id="be07d-238">O nível superior da hierarquia da grade é mostrado como uma grade de 4x4.</span><span class="sxs-lookup"><span data-stu-id="be07d-238">The top-level of the grid hierarchy is shown as a 4x4 grid.</span></span> <span data-ttu-id="be07d-239">Para fins ilustrativos, os níveis inferiores são omitidos.</span><span class="sxs-lookup"><span data-stu-id="be07d-239">For the purpose of illustration, the lower levels are omitted.</span></span> <span data-ttu-id="be07d-240">O espaço fora da caixa delimitadora é indicado por um zero (0).</span><span class="sxs-lookup"><span data-stu-id="be07d-240">The space outside of the bounding box is indicated by a zero (0).</span></span> <span data-ttu-id="be07d-241">Observe que o objeto 'A' se estende parcialmente além da caixa e o objeto 'B' está completamente fora da caixa na célula 0.</span><span class="sxs-lookup"><span data-stu-id="be07d-241">Note that object 'A' extends partly beyond the box, and object 'B' lies completely outside the box in cell 0.</span></span>

 <span data-ttu-id="be07d-242">![Caixa delimitadora mostrando coordenadas e a célula 0.](../../database-engine/media/spndx-bb-4x4-objects.gif "Caixa delimitadora mostrando coordenadas e a célula 0.")</span><span class="sxs-lookup"><span data-stu-id="be07d-242">![Bounding box showing coordinates and cell 0.](../../database-engine/media/spndx-bb-4x4-objects.gif "Bounding box showing coordinates and cell 0.")</span></span>

 <span data-ttu-id="be07d-243">Uma caixa delimitadora corresponde a uma parte dos dados espaciais de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="be07d-243">A bounding box corresponds to some portion of an application's spatial data.</span></span> <span data-ttu-id="be07d-244">Se a caixa delimitadora do índice contém completamente os dados armazenados na coluna espacial ou apenas uma parte é responsabilidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="be07d-244">Whether the bounding-box of the index completely contains the data stored in the spatial column, or only contains a portion, is up to the application.</span></span> <span data-ttu-id="be07d-245">Apenas operações computadas em objetos que estão completamente dentro da caixa delimitadora se beneficiam do índice espacial.</span><span class="sxs-lookup"><span data-stu-id="be07d-245">Only operations computed on objects that are entirely inside of the bounding box benefit from the spatial index.</span></span> <span data-ttu-id="be07d-246">Portanto, para obter o máximo benefício de um índice espacial em uma coluna `geometry`, é necessário especificar uma caixa delimitadora que contenha todos ou a maior parte dos objetos.</span><span class="sxs-lookup"><span data-stu-id="be07d-246">Therefore, to gain the greatest advantage from a spatial index on a `geometry` column, you need to specify a bounding-box that contains all or most of the objects.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-247">As densidades da grade de um índice espacial são visíveis nas colunas bounding_box_xmin, bounding_box_ymin, bounding_box_xmax e bounding_box_ymax da exibição dr catálogo [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="be07d-247">The grid densities of a spatial index are visible in the bounding_box_xmin, bounding_box_ymin, bounding_box_xmax, and bounding_box_ymax columns of the [sys.spatial_index_tessellations](/sql/relational-databases/system-catalog-views/sys-spatial-index-tessellations-transact-sql) catalog view.</span></span>

#### <a name="the-geography-grid-tessellation-scheme"></a><span data-ttu-id="be07d-248">Esquema de mosaico de grade geográfica</span><span class="sxs-lookup"><span data-stu-id="be07d-248">The Geography Grid Tessellation Scheme</span></span>
 <span data-ttu-id="be07d-249">Este esquema de mosaico aplica-se apenas a uma coluna de `geography`.</span><span class="sxs-lookup"><span data-stu-id="be07d-249">This tessellation scheme applies only to a `geography` column.</span></span> <span data-ttu-id="be07d-250">Esta seção resume os métodos que têm suporte do mosaico de grade geográfica e discute como o espaço geodésico é projetado em um plano que, em seguida, é decomposto em uma hierarquia de grade.</span><span class="sxs-lookup"><span data-stu-id="be07d-250">This section summarizes the methods that are supported by geography grid tessellation and discusses how geodetic space is projected onto a plane, which is then decomposed into a grid hierarchy.</span></span>

> [!NOTE]
>  <span data-ttu-id="be07d-251">Você pode especificar explicitamente esse esquema de mosaico usando a cláusula USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) da instrução [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql) [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="be07d-251">You can explicitly specify this tessellation scheme by using the USING (GEOGRAPHY_AUTO_GRID/GEOGRAPHY_GRID) clause of the [CREATE SPATIAL INDEX](/sql/t-sql/statements/create-spatial-index-transact-sql)[!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span>

##### <a name="projection-of-the-geodetic-space-onto-a-plane"></a><span data-ttu-id="be07d-252">Projeção do espaço geodésico em um plano</span><span class="sxs-lookup"><span data-stu-id="be07d-252">Projection of the Geodetic Space onto a Plane</span></span>
 <span data-ttu-id="be07d-253">Computações em instâncias (objetos) de `geography` tratam o espaço que contém os objetos como um elipsoide geodésico.</span><span class="sxs-lookup"><span data-stu-id="be07d-253">Computations on `geography` instances (objects) treat the space containing the objects as a geodetic ellipsoid.</span></span> <span data-ttu-id="be07d-254">Para decompor esse espaço, o esquema de mosaico de grade geográfica divide a superfície do elipsoide em seus hemisférios superior e inferior e executa as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="be07d-254">To decompose this space, the geography grid tessellation scheme divides the surface of the ellipsoid into its upper and lower hemispheres and then performs the following steps:</span></span>

1.  <span data-ttu-id="be07d-255">Projeta cada hemisfério sobre as facetas de uma pirâmide quadrilátera.</span><span class="sxs-lookup"><span data-stu-id="be07d-255">Projects each hemisphere onto the facets of a quadrilateral pyramid.</span></span>

2.  <span data-ttu-id="be07d-256">Achata as duas pirâmides.</span><span class="sxs-lookup"><span data-stu-id="be07d-256">Flattens the two pyramids.</span></span>

3.  <span data-ttu-id="be07d-257">Une as pirâmides achatadas para formar um plano não euclidiano.</span><span class="sxs-lookup"><span data-stu-id="be07d-257">Joins the flattened pyramids to form a non-Euclidean plane.</span></span>

 <span data-ttu-id="be07d-258">A ilustração a seguir mostra uma exibição esquemática do processo de decomposição de três etapas.</span><span class="sxs-lookup"><span data-stu-id="be07d-258">The following illustration shows a schematic view of the three-step decomposition process.</span></span> <span data-ttu-id="be07d-259">Nas pirâmides, as linhas pontilhadas representam os limites das quatro facetas de cada pirâmide.</span><span class="sxs-lookup"><span data-stu-id="be07d-259">In the pyramids, the dotted lines represent the boundaries of the four facets of each pyramid.</span></span> <span data-ttu-id="be07d-260">As etapas 1 e 2 ilustram o elipsoide geodésico usando uma linha horizontal verde para representar a longitude equatorial e uma série de linhas verticais verdes para representar várias linhas longitudinais.</span><span class="sxs-lookup"><span data-stu-id="be07d-260">Steps 1 and 2 illustrate the geodetic ellipsoid, using a green horizontal line to represent the equatorial longitude line and a series of green vertical lines to represent several latitude lines.</span></span> <span data-ttu-id="be07d-261">A etapa 1 mostra as pirâmides sendo projetadas sobre os dois hemisférios.</span><span class="sxs-lookup"><span data-stu-id="be07d-261">Step 1 shows the pyramids being projected over the two hemispheres.</span></span> <span data-ttu-id="be07d-262">A etapa 2 mostra as pirâmides sendo achatadas.</span><span class="sxs-lookup"><span data-stu-id="be07d-262">Step 2 shows the pyramids being flattened.</span></span> <span data-ttu-id="be07d-263">A etapa 3 ilustra as pirâmides achatadas após terem sido combinadas para formar um plano mostrando várias linhas longitudinais projetadas.</span><span class="sxs-lookup"><span data-stu-id="be07d-263">Step 3 illustrates the flattened pyramids, after they have been combined to form a plane, showing a number of projected longitude lines.</span></span> <span data-ttu-id="be07d-264">Observe que essas linhas projetadas se tornam retas e variam em comprimento, dependendo de sua localização nas pirâmides.</span><span class="sxs-lookup"><span data-stu-id="be07d-264">Notice that these projected lines are straightened and vary in length, depending on where they fall on the pyramids.</span></span>

 <span data-ttu-id="be07d-265">![Projeção do elipsoide em um plano](../../database-engine/media/spndx-geodetic-projection.gif "Projeção do elipsoide em um plano")</span><span class="sxs-lookup"><span data-stu-id="be07d-265">![Projection of the ellipsoid onto a plane](../../database-engine/media/spndx-geodetic-projection.gif "Projection of the ellipsoid onto a plane")</span></span>

 <span data-ttu-id="be07d-266">Depois do espaço ser projetado no plano, o plano é decomposto na hierarquia de grade de quatro níveis.</span><span class="sxs-lookup"><span data-stu-id="be07d-266">Once the space has been projected onto the plane, the plane is decomposed into the four-level grid hierarchy.</span></span> <span data-ttu-id="be07d-267">Níveis diferentes podem usar diferentes densidades de grade.</span><span class="sxs-lookup"><span data-stu-id="be07d-267">Different levels can use different grid densities.</span></span> <span data-ttu-id="be07d-268">A ilustração a seguir mostra o plano depois de decomposto em uma grade 4x4 de nível 1.</span><span class="sxs-lookup"><span data-stu-id="be07d-268">The following illustration shows the plane after it has been decomposed into a 4x4 level-1 grid.</span></span> <span data-ttu-id="be07d-269">Para fins ilustrativos, os níveis inferiores da hierarquia da grade são omitidos.</span><span class="sxs-lookup"><span data-stu-id="be07d-269">For the purposes of illustration, the lower-levels of the grid hierarchy are omitted.</span></span> <span data-ttu-id="be07d-270">Na realidade, o plano é decomposto completamente em uma hierarquia de grade de quatro níveis.</span><span class="sxs-lookup"><span data-stu-id="be07d-270">In actuality, the plane is fully decomposed into a four-level grid hierarchy.</span></span> <span data-ttu-id="be07d-271">Após o término do processo de decomposição, os dados geográficos são lidos, linha por linha, na coluna de geografia, e o processo de mosaico é executado em cada objeto.</span><span class="sxs-lookup"><span data-stu-id="be07d-271">After the decomposition process finishes, the geographic data is read, row by row, from the geography column, and the tessellation process is performed for each object in turn.</span></span>

 <span data-ttu-id="be07d-272">![Grade de geografia de nível 1](../../database-engine/media/spndx-geodetic-level1grid.gif "Grade de geografia de nível 1")</span><span class="sxs-lookup"><span data-stu-id="be07d-272">![Level-1 geography grid](../../database-engine/media/spndx-geodetic-level1grid.gif "Level-1 geography grid")</span></span>

##  <a name="methods-supported-by-spatial-indexes"></a><a name="methods"></a><span data-ttu-id="be07d-273">Métodos com suporte de índices espaciais</span><span class="sxs-lookup"><span data-stu-id="be07d-273">Methods Supported by Spatial Indexes</span></span>

###  <a name="geometry-methods-supported-by-spatial-indexes"></a><a name="geometry"></a><span data-ttu-id="be07d-274">Métodos Geometry com suporte de índices espaciais</span><span class="sxs-lookup"><span data-stu-id="be07d-274">Geometry Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="be07d-275">Índices espaciais dão suporte aos seguintes métodos geometry orientados por conjunto em determinadas condições: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches() e STWithin().</span><span class="sxs-lookup"><span data-stu-id="be07d-275">Spatial indexes support the following set-oriented geometry methods under certain conditions: STContains(), STDistance(), STEquals(), STIntersects(), STOverlaps(), STTouches(), and STWithin().</span></span> <span data-ttu-id="be07d-276">Para que tenham suporte em um índice espacial, esses métodos devem ser usados dentro da cláusula WHERE ou JOIN ON de uma consulta e ocorrer dentro de um predicado com o seguinte formato geral:</span><span class="sxs-lookup"><span data-stu-id="be07d-276">To be supported by a spatial index, these methods must be used within the WHERE or JOIN ON clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="be07d-277">*Geometry1*. *method_name*(*Geometry2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="be07d-277">*geometry1*.*method_name*(*geometry2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="be07d-278">Para retornar um resultado não nulo, *geometry1* e *geometry2* devem ter o mesmo [SRID (identificador de referência espacial)](../spatial/spatial-reference-identifiers-srids.md).</span><span class="sxs-lookup"><span data-stu-id="be07d-278">To return a non-null result, *geometry1* and *geometry2* must have the same [spatial reference identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="be07d-279">Caso contrário, o método retorna NULL.</span><span class="sxs-lookup"><span data-stu-id="be07d-279">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="be07d-280">Índices espaciais oferecem suporte aos seguintes formulários de predicado:</span><span class="sxs-lookup"><span data-stu-id="be07d-280">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="be07d-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="be07d-281">*geometry1*.[STContains](/sql/t-sql/spatial-geometry/stcontains-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="be07d-282">*Geometry1*. *Número* de < de*Geometry2*(de [distância](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type))</span><span class="sxs-lookup"><span data-stu-id="be07d-282">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) < *number*</span></span>

-   <span data-ttu-id="be07d-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span><span class="sxs-lookup"><span data-stu-id="be07d-283">*geometry1*.[STDistance](/sql/t-sql/spatial-geometry/stdistance-geometry-data-type)(*geometry2*) <= *number*</span></span>

-   <span data-ttu-id="be07d-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="be07d-284">*geometry1*.[STEquals](/sql/t-sql/spatial-geometry/stequals-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="be07d-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="be07d-285">*geometry1*.[STIntersects](/sql/t-sql/spatial-geometry/stintersects-geometry-data-type)(*geometry2*)= 1</span></span>

-   <span data-ttu-id="be07d-286">*geometry1.*</span><span class="sxs-lookup"><span data-stu-id="be07d-286">*geometry1.*</span></span> <span data-ttu-id="be07d-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span><span class="sxs-lookup"><span data-stu-id="be07d-287">[STOverlaps](/sql/t-sql/spatial-geometry/stoverlaps-geometry-data-type) *(geometry2) = 1*</span></span>

-   <span data-ttu-id="be07d-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span><span class="sxs-lookup"><span data-stu-id="be07d-288">*geometry1*.[STTouches](/sql/t-sql/spatial-geometry/sttouches-geometry-data-type)(*geometry2*) = 1</span></span>

-   <span data-ttu-id="be07d-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span><span class="sxs-lookup"><span data-stu-id="be07d-289">*geometry1*.[STWithin](/sql/t-sql/spatial-geometry/stwithin-geometry-data-type)(*geometry2*)= 1</span></span>

###  <a name="geography-methods-supported-by-spatial-indexes"></a><a name="geography"></a><span data-ttu-id="be07d-290">Métodos de Geografia com suporte de índices espaciais</span><span class="sxs-lookup"><span data-stu-id="be07d-290">Geography Methods Supported by Spatial Indexes</span></span>
 <span data-ttu-id="be07d-291">Em determinadas condições, índices espaciais dão suporte aos seguintes métodos de geografia orientados a conjunto: STIntersects(), STEquals() e STDistance().</span><span class="sxs-lookup"><span data-stu-id="be07d-291">Under certain conditions, spatial indexes support the following set-oriented geography methods: STIntersects(),STEquals(), and STDistance().</span></span> <span data-ttu-id="be07d-292">Para que tenham suporte de um índice espacial, esses métodos devem ser usados dentro da cláusula WHERE de uma consulta e ocorrer dentro de um predicado do seguinte formulário geral:</span><span class="sxs-lookup"><span data-stu-id="be07d-292">To be supported by a spatial index, these methods must be used within the WHERE clause of a query, and they must occur within a predicate of the following general form:</span></span>

 <span data-ttu-id="be07d-293">*geography1*. *method_name*(*geography2*)*comparison_operator \* \* valid_number*</span><span class="sxs-lookup"><span data-stu-id="be07d-293">*geography1*.*method_name*(*geography2*)*comparison_operator\*\*valid_number*</span></span>

 <span data-ttu-id="be07d-294">Para retornar um resultado não nulo, *geography1* e *geography2* devem ter o mesmo [SRID (Identificador de Referência Espacial)](../spatial/spatial-reference-identifiers-srids.md).</span><span class="sxs-lookup"><span data-stu-id="be07d-294">To return a non-null result, *geography1* and *geography2* must have the same [Spatial Reference Identifier (SRID)](../spatial/spatial-reference-identifiers-srids.md).</span></span> <span data-ttu-id="be07d-295">Caso contrário, o método retorna NULL.</span><span class="sxs-lookup"><span data-stu-id="be07d-295">Otherwise, the method returns NULL.</span></span>

 <span data-ttu-id="be07d-296">Índices espaciais oferecem suporte aos seguintes formulários de predicado:</span><span class="sxs-lookup"><span data-stu-id="be07d-296">Spatial indexes support the following predicate forms:</span></span>

-   <span data-ttu-id="be07d-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="be07d-297">*geography1*.[STIntersects](/sql/t-sql/spatial-geography/stintersects-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="be07d-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span><span class="sxs-lookup"><span data-stu-id="be07d-298">*geography1*.[STEquals](/sql/t-sql/spatial-geography/stequals-geography-data-type)(*geography2*)= 1</span></span>

-   <span data-ttu-id="be07d-299">*geography1*. *Número* de < de*Geography2*(de [distância](/sql/t-sql/spatial-geography/stdistance-geography-data-type))</span><span class="sxs-lookup"><span data-stu-id="be07d-299">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) < *number*</span></span>

-   <span data-ttu-id="be07d-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span><span class="sxs-lookup"><span data-stu-id="be07d-300">*geography1*.[STDistance](/sql/t-sql/spatial-geography/stdistance-geography-data-type)(*geography2*) <= *number*</span></span>

### <a name="queries-that-use-spatial-indexes"></a><span data-ttu-id="be07d-301">Consultas que usam um índices espaciais</span><span class="sxs-lookup"><span data-stu-id="be07d-301">Queries that use Spatial Indexes</span></span>
 <span data-ttu-id="be07d-302">Os índices espaciais só têm suporte em consultas que incluem um operador espacial indexado na cláusula `WHERE`.</span><span class="sxs-lookup"><span data-stu-id="be07d-302">Spatial indexes are only supported in queries that include an indexed spatial operator in the `WHERE` clause.</span></span> <span data-ttu-id="be07d-303">Por exemplo, a seguinte sintaxe:</span><span class="sxs-lookup"><span data-stu-id="be07d-303">For example syntax such as:</span></span>

```
[spatial object].SpatialMethod([reference spatial object]) [ = | < ] [const literal or variable]
```

 <span data-ttu-id="be07d-304">O otimizador de consulta compreende a intercambialidade de operações espaciais (que `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span><span class="sxs-lookup"><span data-stu-id="be07d-304">The query optimizer understands the commutativity of spatial operations (that `@a.STIntersects(@b) = @b.STInterestcs(@a)` ).</span></span> <span data-ttu-id="be07d-305">Mas, o índice espacial não será usado se o início de uma comparação não contiver o operador espacial (por exemplo, `WHERE 1 = spatial op` não usará o índice espacial).</span><span class="sxs-lookup"><span data-stu-id="be07d-305">However, the spatial index will not be used if the beginning of a comparison does not contain the spatial operator (for example `WHERE 1 = spatial op` will not use the spatial index).</span></span> <span data-ttu-id="be07d-306">Para usar o índice espacial, reescreva a comparação (por exemplo, `WHERE spatial op = 1`).</span><span class="sxs-lookup"><span data-stu-id="be07d-306">To use the spatial index, rewrite the comparison (for example `WHERE spatial op = 1`).</span></span>

 <span data-ttu-id="be07d-307">Assim como em qualquer outro índice, quando um índice espacial tem suporte, o uso do índice espacial é escolhido com base em custo; então, talvez o otimizador de consulta não opte por usar o índice espacial, embora todos os requisitos para seu uso sejam atendidos.</span><span class="sxs-lookup"><span data-stu-id="be07d-307">As with any other index, when a spatial index is supported, the use of the spatial index is chosen based on cost, so the query optimizer might not choose to use the spatial index even though all requirements for using it are met.</span></span> <span data-ttu-id="be07d-308">Use o plano de execução para verificar se o índice espacial foi usado e, se necessário, fornecer dicas de consulta para forçar um plano de consulta desejado.</span><span class="sxs-lookup"><span data-stu-id="be07d-308">Use showplan to see if the spatial index was used and if necessary provide query hints to force a desired query plan.</span></span>

 <span data-ttu-id="be07d-309">O tipo de consulta de vizinho mais próximo também dará suporte a índices espaciais, embora apenas se uma sintaxe de consulta específica for escrita.</span><span class="sxs-lookup"><span data-stu-id="be07d-309">The nearest neighbor type of query also supports spatial indexes however only if a specific query syntax is written.</span></span> <span data-ttu-id="be07d-310">A sintaxe apropriada é:</span><span class="sxs-lookup"><span data-stu-id="be07d-310">The appropriate syntax is:</span></span>

```
SELECT TOP(K) [WITH TIES] * 
FROM <Table> AS T [WITH(INDEX(<SpatialIndex>))]
WHERE <SpatialColumn>.STDistance(@reference_object) IS NOT NULL
ORDER BY <SpatialColumn>.STDistance(@reference_object) [;]
```

## <a name="see-also"></a><span data-ttu-id="be07d-311">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="be07d-311">See Also</span></span>
 [<span data-ttu-id="be07d-312">Dados espaciais &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="be07d-312">Spatial Data &#40;SQL Server&#41;</span></span>](../spatial/spatial-data-sql-server.md)


