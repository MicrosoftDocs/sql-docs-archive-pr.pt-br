---
title: Sobre o Change Data Capture (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], about
- change data capture [SQL Server]
- 22832 (Database Engine error)
ms.assetid: 7d8c4684-9eb1-4791-8c3b-0f0bb15d9634
author: rothja
ms.author: jroth
ms.openlocfilehash: cf8045ff45e7467a626bee85857ae8319f5d2649
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87575699"
---
# <a name="about-change-data-capture-sql-server"></a><span data-ttu-id="e5e87-102">Sobre o change data capture (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e5e87-102">About Change Data Capture (SQL Server)</span></span>
  <span data-ttu-id="e5e87-103">Os registros do Change Data Capture inserem, atualizam e excluem atividades aplicadas a uma tabela do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e5e87-103">Change data capture records insert, update, and delete activity that is applied to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table.</span></span> <span data-ttu-id="e5e87-104">Ele também disponibiliza os detalhes das mudanças em um formato relacional facilmente utilizável.</span><span class="sxs-lookup"><span data-stu-id="e5e87-104">This makes the details of the changes available in an easily consumed relational format.</span></span> <span data-ttu-id="e5e87-105">As informações de coluna e os metadados exigidos para a aplicação de alterações em um ambiente de destino são capturados para as linhas modificadas e armazenados nas tabelas de alteração que espelham a estrutura da coluna das tabelas de origem rastreadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-105">Column information and the metadata that is required to apply the changes to a target environment is captured for the modified rows and stored in change tables that mirror the column structure of the tracked source tables.</span></span> <span data-ttu-id="e5e87-106">As funções avaliadas da tabela são fornecidas para permitir acesso sistemático aos dados de alteração pelos consumidores.</span><span class="sxs-lookup"><span data-stu-id="e5e87-106">Table-valued functions are provided to allow systematic access to the change data by consumers.</span></span>  
  
 <span data-ttu-id="e5e87-107">Um bom exemplo de um consumidor de dados visado por esta tecnologia é uma extração, transformação e aplicativo de carregamento (ETL).</span><span class="sxs-lookup"><span data-stu-id="e5e87-107">A good example of a data consumer that is targeted by this technology is an extraction, transformation, and loading (ETL) application.</span></span> <span data-ttu-id="e5e87-108">Um aplicativo ETL carrega incrementalmente dados de alteração das tabelas de origem de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para um data warehouse ou data mart.</span><span class="sxs-lookup"><span data-stu-id="e5e87-108">An ETL application incrementally loads change data from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] source tables to a data warehouse or data mart.</span></span> <span data-ttu-id="e5e87-109">Embora a representação das tabelas de fonte dentro do data warehouse deva refletir as alterações nessas tabelas de origem, uma tecnologia ponta-a-ponta que atualize uma réplica da origem não é apropriada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-109">Although the representation of the source tables within the data warehouse must reflect changes in the source tables, an end-to-end technology that refreshes a replica of the source is not appropriate.</span></span> <span data-ttu-id="e5e87-110">Em vez disso, é necessário um fluxo seguro de dados de alteração, estruturado de forma que consumidores possam aplicá-lo às representações dos dados de destino.</span><span class="sxs-lookup"><span data-stu-id="e5e87-110">Instead, you need a reliable stream of change data that is structured so that consumers can apply it to dissimilar target representations of the data.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="e5e87-111">a captura de dados de alterações fornece essa tecnologia.</span><span class="sxs-lookup"><span data-stu-id="e5e87-111">change data capture provides this technology.</span></span>  
  
## <a name="change-data-capture-data-flow"></a><span data-ttu-id="e5e87-112">Fluxo de dados do Change Data Capture</span><span class="sxs-lookup"><span data-stu-id="e5e87-112">Change Data Capture Data Flow</span></span>  
 <span data-ttu-id="e5e87-113">A ilustração seguinte mostra o fluxo de dados principal para a captura de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-113">The following illustration shows the principal data flow for change data capture.</span></span>  
  
 <span data-ttu-id="e5e87-114">![Fluxo de dados da captura de dados de alterações](../../database-engine/media/cdcdataflow.gif "Fluxo de dados da captura de dados de alterações")</span><span class="sxs-lookup"><span data-stu-id="e5e87-114">![Change data capture data flow](../../database-engine/media/cdcdataflow.gif "Change data capture data flow")</span></span>  
  
 <span data-ttu-id="e5e87-115">A origem de dados de alterações para a captura de dados de alterações é o log de transações do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e5e87-115">The source of change data for change data capture is the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log.</span></span> <span data-ttu-id="e5e87-116">Como inserções, atualizações e exclusões são aplicadas às tabelas de origem rastreadas, as entradas que descrevem essas alterações são adicionadas ao log.</span><span class="sxs-lookup"><span data-stu-id="e5e87-116">As inserts, updates, and deletes are applied to tracked source tables, entries that describe those changes are added to the log.</span></span> <span data-ttu-id="e5e87-117">O log atua como entrada para o processo de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-117">The log serves as input to the capture process.</span></span> <span data-ttu-id="e5e87-118">O processo lê o log e adiciona informações sobre alterações à tabela de alteração associada da tabela controlada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-118">This reads the log and adds information about changes to the tracked table's associated change table.</span></span> <span data-ttu-id="e5e87-119">As funções são fornecidas para enumerar as alterações exibidas nas tabelas de alteração em um intervalo especificado, retornando informações em um conjunto de resultados filtrados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-119">Functions are provided to enumerate the changes that appear in the change tables over a specified range, returning the information in the form of a filtered result set.</span></span> <span data-ttu-id="e5e87-120">O conjunto de resultados filtrados é normalmente usado por um processo de aplicativo para atualizar uma representação da origem em algum ambiente externo.</span><span class="sxs-lookup"><span data-stu-id="e5e87-120">The filtered result set is typically used by an application process to update a representation of the source in some external environment.</span></span>  
  
## <a name="understanding-change-data-capture-and-the-capture-instance"></a><span data-ttu-id="e5e87-121">Compreendendo o Change Data Capture e a instância de captura</span><span class="sxs-lookup"><span data-stu-id="e5e87-121">Understanding Change Data Capture and the Capture Instance</span></span>  
 <span data-ttu-id="e5e87-122">Antes do rastreamento das alterações em qualquer tabela individual dentro de um banco de dados, a captura de dados de alterações deve ser explicitamente habilitada para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-122">Before changes to any individual tables within a database can be tracked, change data capture must be explicitly enabled for the database.</span></span> <span data-ttu-id="e5e87-123">Isso é feito usando o procedimento armazenado [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e5e87-123">This is done by using the stored procedure [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span></span> <span data-ttu-id="e5e87-124">Quando o banco de dados está habilitado, é possível identificar as tabelas de origem como tabelas controladas usando o procedimento armazenado [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e5e87-124">When the database is enabled, source tables can be identified as tracked tables by using the stored procedure [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span></span> <span data-ttu-id="e5e87-125">Quando uma tabela está habilitada para Change Data Capture, uma instância de captura associada é criada para dar suporte à disseminação dos dados de alteração na tabela de origem.</span><span class="sxs-lookup"><span data-stu-id="e5e87-125">When a table is enabled for change data capture, an associated capture instance is created to support the dissemination of the change data in the source table.</span></span> <span data-ttu-id="e5e87-126">A instância de captura consiste em uma tabela de alteração e até duas funções de consulta.</span><span class="sxs-lookup"><span data-stu-id="e5e87-126">The capture instance consists of a change table and up to two query functions.</span></span> <span data-ttu-id="e5e87-127">Os metadados que descrevem os detalhes da configuração de uma instância de captura são mantidos nas tabelas de metadados de captura de dados de alteração `cdc.change_tables`, `cdc.index_columns` e `cdc.captured_columns`.</span><span class="sxs-lookup"><span data-stu-id="e5e87-127">Metadata that describes the configuration details of the capture instance is retained in the change data capture metadata tables `cdc.change_tables`, `cdc.index_columns`, and `cdc.captured_columns`.</span></span> <span data-ttu-id="e5e87-128">Estas informações podem ser recuperadas usando o procedimento armazenado [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e5e87-128">This information can be retrieved by using the stored procedure [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span></span>  
  
 <span data-ttu-id="e5e87-129">Todos os objetos associados a uma instância de captura são criados no esquema de captura de dados de alteração do banco de dados habilitado.</span><span class="sxs-lookup"><span data-stu-id="e5e87-129">All objects that are associated with a capture instance are created in the change data capture schema of the enabled database.</span></span> <span data-ttu-id="e5e87-130">Os requisitos para o nome da instância de captura deve ser um nome de objeto válido e exclusivo entre as instâncias de captura de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-130">The requirements for the capture instance name is that it be a valid object name, and that it be unique across the database capture instances.</span></span> <span data-ttu-id="e5e87-131">Por padrão, o nome é \<*schema name*_*table name*> da tabela de origem.</span><span class="sxs-lookup"><span data-stu-id="e5e87-131">By default, the name is \<*schema name*_*table name*> of the source table.</span></span> <span data-ttu-id="e5e87-132">Sua tabela de alteração associada é nomeada acrescentando `_CT` ao nome da instância de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-132">Its associated change table is named by appending `_CT` to the capture instance name.</span></span> <span data-ttu-id="e5e87-133">A função que é usada para consultar todas as alterações é nomeada acrescentando `fn_cdc_get_all_changes_` ao nome da instância de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-133">The function that is used to query for all changes is named by prepending `fn_cdc_get_all_changes_` to the capture instance name.</span></span> <span data-ttu-id="e5e87-134">Se a instância de captura estiver configurada para oferecer suporte `net changes` , a `net_changes` função de consulta também será criada e nomeada pelo \*\*fn_cdc_get_net_changes \_ \*\* por prependentes para o nome da instância de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-134">If the capture instance is configured to support `net changes`, the `net_changes` query function is also created and named by prepending **fn_cdc_get_net_changes\_** to the capture instance name.</span></span>  
  
## <a name="change-table"></a><span data-ttu-id="e5e87-135">Tabela de alteração</span><span class="sxs-lookup"><span data-stu-id="e5e87-135">Change Table</span></span>  
 <span data-ttu-id="e5e87-136">As primeiras cinco colunas de uma tabela de alteração de captura de dados de alterações são colunas de metadados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-136">The first five columns of a change data capture change table are metadata columns.</span></span> <span data-ttu-id="e5e87-137">Elas fornecem informações adicionais pertinentes à alteração registrada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-137">These provide additional information that is relevant to the recorded change.</span></span> <span data-ttu-id="e5e87-138">As colunas restantes espelham as colunas capturadas identificadas da tabela de origem em nome e, geralmente, em tipo.</span><span class="sxs-lookup"><span data-stu-id="e5e87-138">The remaining columns mirror the identified captured columns from the source table in name and, typically, in type.</span></span> <span data-ttu-id="e5e87-139">Estas colunas mantêm os dados de coluna capturados que são juntados na tabela de origem.</span><span class="sxs-lookup"><span data-stu-id="e5e87-139">These columns hold the captured column data that is gathered from the source table.</span></span>  
  
 <span data-ttu-id="e5e87-140">Cada operação de inserção ou exclusão que é aplicada a uma tabela de origem aparece como uma única linha dentro da tabela de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-140">Each insert or delete operation that is applied to a source table appears as a single row within the change table.</span></span> <span data-ttu-id="e5e87-141">As colunas de dados da linha, que é o resultado de uma operação de inserção, contêm os valores de coluna depois da inserção.</span><span class="sxs-lookup"><span data-stu-id="e5e87-141">The data columns of the row that results from an insert operation contain the column values after the insert.</span></span> <span data-ttu-id="e5e87-142">As colunas de dados da linha, que é o resultado uma operação de exclusão, contêm valores de coluna antes da exclusão.</span><span class="sxs-lookup"><span data-stu-id="e5e87-142">The data columns of the row that results from a delete operation contain the column values before the delete.</span></span> <span data-ttu-id="e5e87-143">Uma operação de atualização requer uma entrada de linha para identificar os valores da coluna antes da atualização e uma segunda entrada para identificar os valores da coluna depois da atualização.</span><span class="sxs-lookup"><span data-stu-id="e5e87-143">An update operation requires one row entry to identify the column values before the update, and a second row entry to identify the column values after the update.</span></span>  
  
 <span data-ttu-id="e5e87-144">Cada linha em uma tabela de alteração também contém metadados adicionais para permitir interpretação da atividade de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-144">Each row in a change table also contains additional metadata to allow interpretation of the change activity.</span></span> <span data-ttu-id="e5e87-145">A coluna __$start_lsn identifica o número da sequência do log de confirmação (LSN) que foi atribuído à alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-145">The column __$start_lsn identifies the commit log sequence number (LSN) that was assigned to the change.</span></span> <span data-ttu-id="e5e87-146">O LSN de confirmação não só identifica alterações que foram confirmadas dentro da mesma transação, mas também ordena essas transações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-146">The commit LSN both identifies changes that were committed within the same transaction, and orders those transactions.</span></span> <span data-ttu-id="e5e87-147">A coluna \_\_$seqval podem ser usados para ordenar mais alterações que acontecem na mesma transação.</span><span class="sxs-lookup"><span data-stu-id="e5e87-147">The column \_\_$seqval can be used to order more changes that occur in the same transaction.</span></span> <span data-ttu-id="e5e87-148">A coluna \_\_$operation registra a operação associada à alteração: 1 = excluir, 2 = inserir, 3 = atualizar (antes da imagem) e 4 = atualizar (depois da imagem).</span><span class="sxs-lookup"><span data-stu-id="e5e87-148">The column \_\_$operation records the operation that is associated with the change: 1 = delete, 2 = insert, 3 = update (before image), and 4 = update (after image).</span></span> <span data-ttu-id="e5e87-149">A coluna \_\_$update_mask é uma máscara de bit variável com um bit definido para cada coluna capturada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-149">The column \_\_$update_mask is a variable bit mask with one defined bit for each captured column.</span></span> <span data-ttu-id="e5e87-150">Para inserir e excluir entradas, a máscara de atualização sempre terá todos os bits definidos.</span><span class="sxs-lookup"><span data-stu-id="e5e87-150">For insert and delete entries, the update mask will always have all bits set.</span></span> <span data-ttu-id="e5e87-151">No entanto, as linhas de atualização terão definidos apenas os bits que correspondam às colunas alteradas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-151">Update rows, however, will only have those bits set that correspond to changed columns.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-database"></a><span data-ttu-id="e5e87-152">Intervalo de validade de captura de dados de alteração para um banco de dados</span><span class="sxs-lookup"><span data-stu-id="e5e87-152">Change Data Capture Validity Interval for a Database</span></span>  
 <span data-ttu-id="e5e87-153">O intervalo de validade da captura de dados de alteração para um banco de dados é o tempo durante o qual os dados de alteração estão disponíveis para as instâncias de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-153">The change data capture validity interval for a database is the time during which change data is available for capture instances.</span></span> <span data-ttu-id="e5e87-154">O intervalo de validade começa quando a primeira instância de captura é criada para uma tabela de banco de dados e continua no momento atual.</span><span class="sxs-lookup"><span data-stu-id="e5e87-154">The validity interval begins when the first capture instance is created for a database table, and continues to the present time.</span></span>  
  
 <span data-ttu-id="e5e87-155">Os dados depositados nas tabelas de alteração aumentam de modo não gerenciável se você não diminuir periódica e sistematicamente os dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-155">Data that is deposited in change tables will grow unmanageably if you do not periodically and systematically prune the data.</span></span> <span data-ttu-id="e5e87-156">O processo de limpeza da captura de dados de alterações é responsável pela aplicação da política de limpeza com base em retenção.</span><span class="sxs-lookup"><span data-stu-id="e5e87-156">The change data capture cleanup process is responsible for enforcing the retention-based cleanup policy.</span></span> <span data-ttu-id="e5e87-157">Primeiro, ele move o ponto de extremidade inferior do intervalo de validade para atender à restrição de hora.</span><span class="sxs-lookup"><span data-stu-id="e5e87-157">First, it moves the low endpoint of the validity interval to satisfy the time restriction.</span></span> <span data-ttu-id="e5e87-158">Então, ele remove as entradas da tabela de alteração expiradas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-158">Then, it removes expired change table entries.</span></span> <span data-ttu-id="e5e87-159">Por padrão, são retidos três dias de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-159">By default, three days of data is retained.</span></span>  
  
 <span data-ttu-id="e5e87-160">No high-end, conforme o processo de captura confirma cada novo lote de dados de alteração, novas entradas são adicionadas ao `cdc.lsn_time_mapping` para cada transação que tem entradas da tabela de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-160">At the high end, as the capture process commits each new batch of change data, new entries are added to `cdc.lsn_time_mapping` for each transaction that has change table entries.</span></span> <span data-ttu-id="e5e87-161">Na tabela de mapeamento, um número da sequência do log de confirmação (LSN) e um tempo de confirmação da transação (colunas start_lsn e tran_end_time, respectivamente) são mantidos.</span><span class="sxs-lookup"><span data-stu-id="e5e87-161">Within the mapping table, both a commit Log Sequence Number (LSN) and a transaction commit time (columns start_lsn and tran_end_time, respectively) are retained.</span></span> <span data-ttu-id="e5e87-162">O valor máximo de LSN que é encontrado em `cdc.lsn_time_mapping` representa a marca d’água superior da janela de validade do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-162">The maximum LSN value that is found in `cdc.lsn_time_mapping` represents the high water mark of the database validity window.</span></span> <span data-ttu-id="e5e87-163">Seu tempo de confirmação correspondente é usado como a base da qual a limpeza baseada em retenção calcula uma nova marca d'água inferior.</span><span class="sxs-lookup"><span data-stu-id="e5e87-163">Its corresponding commit time is used as the base from which retention based cleanup computes a new low water mark.</span></span>  
  
 <span data-ttu-id="e5e87-164">Como o processo de captura extrai dados de alteração de um log de transação, há um built em latência entre a hora em que uma alteração é confirmada para uma tabela de origem e a hora em que a alteração é exibida dentro de sua tabela de alteração associada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-164">Because the capture process extracts change data from the transaction log, there is a built in latency between the time that a change is committed to a source table and the time that the change appears within its associated change table.</span></span> <span data-ttu-id="e5e87-165">Embora essa latência seja normalmente pequena, nunca é demais lembrar que os dados de alteração não ficam disponíveis até que o processo de captura processe as entradas de log relacionadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-165">While this latency is typically small, it is nevertheless important to remember that change data is not available until the capture process has processed the related log entries.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-capture-instance"></a><span data-ttu-id="e5e87-166">Intervalo de validade de captura de dados de alterações para uma instância de captura</span><span class="sxs-lookup"><span data-stu-id="e5e87-166">Change Data Capture Validity Interval for a Capture Instance</span></span>  
 <span data-ttu-id="e5e87-167">Embora seja comum a coincidência entre o intervalo de validade de banco de dados e o intervalo de validade de uma instância de captura individual, isso não é sempre verdadeiro.</span><span class="sxs-lookup"><span data-stu-id="e5e87-167">Although it is common for the database validity interval and the validity interval of individual capture instance to coincide, this is not always true.</span></span> <span data-ttu-id="e5e87-168">O intervalo de validade da instância de captura começa quando o processo de captura reconhece a instância de captura e inicia o registro de alterações associadas a sua tabela de alterações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-168">The validity interval of the capture instance starts when the capture process recognizes the capture instance and starts to log associated changes to its change table.</span></span> <span data-ttu-id="e5e87-169">Como resultado, se forem criadas instâncias de captura em horas diferentes, cada uma terá um ponto de extremidade inferior diferente inicialmente.</span><span class="sxs-lookup"><span data-stu-id="e5e87-169">As a result, if capture instances are created at different times, each will initially have a different low endpoint.</span></span> <span data-ttu-id="e5e87-170">A coluna start_lsn do conjunto de resultados que é retornado por [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) mostra o ponto de extremidade inferior atual de cada instância de captura definida.</span><span class="sxs-lookup"><span data-stu-id="e5e87-170">The start_lsn column of the result set that is returned by [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) shows the current low endpoint for each defined capture instance.</span></span> <span data-ttu-id="e5e87-171">Quando um processo de limpeza limpa as entradas da tabela de alterações, ele ajusta os valores de start_lsn para todas as instâncias de captura para refletir a nova marca d'água inferior em dados de alteração disponíveis.</span><span class="sxs-lookup"><span data-stu-id="e5e87-171">When the cleanup process cleans up change table entries, it adjusts the start_lsn values for all capture instances to reflect the new low water mark for available change data.</span></span> <span data-ttu-id="e5e87-172">Somente essas instâncias de captura que têm valores start_lsn que sejam atualmente menores que a nova marca d'água inferior são ajustadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-172">Only those capture instances that have start_lsn values that are currently less than the new low water mark are adjusted.</span></span> <span data-ttu-id="e5e87-173">Com o tempo, se nenhuma nova instância de captura for criada, os intervalos de validade para todas as instâncias individuais tenderão a coincidir com o intervalo de validade do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-173">Over time, if no new capture instances are created, the validity intervals for all individual instances will tend to coincide with the database validity interval.</span></span>  
  
 <span data-ttu-id="e5e87-174">O intervalo de validade é importante para os consumidores de dados de alteração, porque o intervalo de extração para um pedido deve ser totalmente coberto pelo intervalo de validade da captura de dados de alteração atual para a instância de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-174">The validity interval is important to consumers of change data because the extraction interval for a request must be fully covered by the current change data capture validity interval for the capture instance.</span></span> <span data-ttu-id="e5e87-175">Se o ponto de extremidade inferior do intervalo de extração estiver à esquerda do ponto de extremidade inferior do intervalo de validade, pode ser que dados de alteração estejam faltando devido a uma limpeza intensa.</span><span class="sxs-lookup"><span data-stu-id="e5e87-175">If the low endpoint of the extraction interval is to the left of the low endpoint of the validity interval, there could be missing change data due to aggressive cleanup.</span></span> <span data-ttu-id="e5e87-176">Se o ponto de extremidade superior do intervalo de extração estiver à direita do ponto de extremidade superior do intervalo de validade, e o processo de captura ainda não tiver sido processado naquele período representado pelo intervalo de extração, dados de alteração também poderão estar faltando.</span><span class="sxs-lookup"><span data-stu-id="e5e87-176">If the high endpoint of the extraction interval is to the right of the high endpoint of the validity interval, the capture process has not yet processed through the time period that is represented by the extraction interval, and change data could also be missing.</span></span>  
  
 <span data-ttu-id="e5e87-177">A função [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) é usada para recuperar o LSN mínimo atual de uma instância de captura, enquanto [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) é usada para recuperar o valor máximo atual do LSN.</span><span class="sxs-lookup"><span data-stu-id="e5e87-177">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) is used to retrieve the current minimum LSN for a capture instance, while [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) is used to retrieve the current maximum LSN value.</span></span> <span data-ttu-id="e5e87-178">Ao procurar dados de alteração, se o intervalo de LSN especificado não estiver dentro desses dois valores de LSN, as funções de consulta da captura de dados de alteração falhará.</span><span class="sxs-lookup"><span data-stu-id="e5e87-178">When querying for change data, if the specified LSN range does not lie within these two LSN values, the change data capture query functions will fail.</span></span>  
  
## <a name="handling-changes-to-source-tables"></a><span data-ttu-id="e5e87-179">Tratando alterações nas tabelas de origem</span><span class="sxs-lookup"><span data-stu-id="e5e87-179">Handling Changes to Source Tables</span></span>  
 <span data-ttu-id="e5e87-180">Acomodar alterações de coluna nas tabelas de origem que estão sendo rastreadas é um assunto difícil para consumidores de downstream.</span><span class="sxs-lookup"><span data-stu-id="e5e87-180">To accommodate column changes in the source tables that are being tracked is a difficult issue for downstream consumers.</span></span> <span data-ttu-id="e5e87-181">Apesar de a habilitação da captura de dados de alteração em uma tabela de origem não impedir que alterações de DDL ocorram, a captura de dados de alteração ajuda a reduzir o efeito para os consumidores, permitindo que os conjuntos de resultados fornecidos, retornados pela API, permaneçam inalterados mesmo que a estrutura da coluna da tabela de origem subjacente seja alterada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-181">Although enabling change data capture on a source table does not prevent such DDL changes from occurring, change data capture helps to mitigate the effect on consumers by allowing the delivered result sets that are returned through the API to remain unchanged even as the column structure of the underlying source table changes.</span></span> <span data-ttu-id="e5e87-182">Essa estrutura de coluna fixa também é refletida na tabela de alteração subjacente que as funções de consulta definidas acessam.</span><span class="sxs-lookup"><span data-stu-id="e5e87-182">This fixed column structure is also reflected in the underlying change table that the defined query functions access.</span></span>  
  
 <span data-ttu-id="e5e87-183">Para acomodar uma tabela de alteração com estrutura de coluna fixa, o processo de captura responsável pela população da tabela de alteração irá ignorar qualquer nova coluna que não seja identificada pela captura quando a tabela de origem não estiver habilitada para a captura de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-183">To accommodate a fixed column structure change table, the capture process responsible for populating the change table will ignore any new columns that are not identified for capture when the source table was enabled for change data capture.</span></span> <span data-ttu-id="e5e87-184">Se uma coluna rastreada for descartada, serão fornecidos valores nulos para a coluna nas entradas de alteração subsequentes.</span><span class="sxs-lookup"><span data-stu-id="e5e87-184">If a tracked column is dropped, null values will be supplied for the column in the subsequent change entries.</span></span> <span data-ttu-id="e5e87-185">Entretanto, se uma coluna existente sofrer uma alteração em seu tipo de dados, a alteração será propagada para a tabela de alteração para garantir que o mecanismo de captura não insira perda de dados nas colunas rastreadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-185">However, if an existing column undergoes a change in its data type, the change is propagated to the change table to ensure that the capture mechanism does not introduce data loss to tracked columns.</span></span> <span data-ttu-id="e5e87-186">O processo de captura também envia qualquer alteração detectada para a estrutura de coluna de tabelas rastreadas para a tabela cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="e5e87-186">The capture process also posts any detected changes to the column structure of tracked tables to the cdc.ddl_history table.</span></span> <span data-ttu-id="e5e87-187">Os consumidores que desejam ser alertados sobre ajustes que tenham de ser feitos em aplicativos downstream usam o procedimento armazenado [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e5e87-187">Consumers wishing to be alerted of adjustments that might have to be made in downstream applications, use the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
 <span data-ttu-id="e5e87-188">Normalmente, a instância de captura atual continuará a manter sua forma quando alterações de DDL forem aplicadas à sua tabela de origem associada.</span><span class="sxs-lookup"><span data-stu-id="e5e87-188">Typically, the current capture instance will continue to retain its shape when DDL changes are applied to its associated source table.</span></span> <span data-ttu-id="e5e87-189">Porém, é possível criar uma segunda instância de captura para a tabela que reflete a nova estrutura de coluna.</span><span class="sxs-lookup"><span data-stu-id="e5e87-189">However, it is possible to create a second capture instance for the table that reflects the new column structure.</span></span> <span data-ttu-id="e5e87-190">Isso permite que o processo de captura faça alterações na mesma tabela de origem em duas tabelas de alteração diferentes com duas estruturas de coluna distintas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-190">This allows the capture process to make changes to the same source table into two distinct change tables having two different column structures.</span></span> <span data-ttu-id="e5e87-191">Portanto, enquanto uma tabela de alteração pode continuar a alimentar os programas em operação atualmente, a segunda pode orientar um ambiente de desenvolvimento que está tentando inserir dados à nova coluna</span><span class="sxs-lookup"><span data-stu-id="e5e87-191">Thus, while one change table can continue to feed current operational programs, the second one can drive a development environment that is trying to incorporate the new column data.</span></span> <span data-ttu-id="e5e87-192">Permitir que o mecanismo de captura preencha ambas as tabelas de alteração em tandem significa que uma transição de uma para a outra pode ser cumprida sem a perda de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-192">Allowing the capture mechanism to populate both change tables in tandem means that a transition from one to the other can be accomplished without loss of change data.</span></span> <span data-ttu-id="e5e87-193">Isso pode acontecer quando as duas linhas de tempo da captura de dados de alterações se sobrepuserem.</span><span class="sxs-lookup"><span data-stu-id="e5e87-193">This can happen any time the two change data capture timelines overlap.</span></span> <span data-ttu-id="e5e87-194">Quando a transição é efetuada, a instância de captura obsoleta pode ser removida.</span><span class="sxs-lookup"><span data-stu-id="e5e87-194">When the transition is effected, the obsolete capture instance can be removed.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e5e87-195">O número de máximo de instâncias de captura que podem ser associadas simultaneamente a uma única tabela de origem é dois.</span><span class="sxs-lookup"><span data-stu-id="e5e87-195">The maximum number of capture instances that can be concurrently associated with a single source table is two.</span></span>  
  
## <a name="relationship-between-the-capture-job-and-the-transactional-replication-logreader"></a><span data-ttu-id="e5e87-196">Relação entre o trabalho de captura e o leitor de log da replicação transacional</span><span class="sxs-lookup"><span data-stu-id="e5e87-196">Relationship Between the Capture Job and the Transactional Replication Logreader</span></span>  
 <span data-ttu-id="e5e87-197">A lógica do processo de captura de dados de alterações é inserida ao procedimento armazenado [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), uma função de servidor interna criada como parte de sqlservr.exe e também usada pela replicação transacional para coletar alterações do log de transações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-197">The logic for change data capture process is embedded in the stored procedure [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), an internal server function built as part of sqlservr.exe and also used by transactional replication to harvest changes from the transaction log.</span></span> <span data-ttu-id="e5e87-198">Quando somente o Change Data Capture está habilitado para um banco de dados, você cria o trabalho de captura do SQL Agent do Change Data Capture como o veículo para chamar sp_replcmds.</span><span class="sxs-lookup"><span data-stu-id="e5e87-198">When change data capture alone is enabled for a database, you create the change data capture SQL Server Agent capture job as the vehicle for invoking sp_replcmds.</span></span> <span data-ttu-id="e5e87-199">Quando a replicação também está presente, o leitor de log transacional sozinho é utilizado para atender às necessidades de dados de alteração de ambos esses consumidores.</span><span class="sxs-lookup"><span data-stu-id="e5e87-199">When replication is also present, the transactional logreader alone is used to satisfy the change data needs for both of these consumers.</span></span> <span data-ttu-id="e5e87-200">Essa estratégia reduz significativamente a contenção de log quando são habilitadas a replicação e a captura de dados de alterações para o mesmo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-200">This strategy significantly reduces log contention when both replication and change data capture are enabled for the same database.</span></span>  
  
 <span data-ttu-id="e5e87-201">A alternância entre esses dois modos operacionais para a captura de dados de alteração ocorre automaticamente onde houver uma alteração no status de replicação de um banco de dados habilitado para captura de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-201">The switch between these two operational modes for capturing change data occurs automatically whenever there is a change in the replication status of a change data capture enabled database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="e5e87-202">Ambas as instâncias da lógica de captura exigem que o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent esteja em execução para que o processo seja executado.</span><span class="sxs-lookup"><span data-stu-id="e5e87-202">Both instances of the capture logic require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to be running for the process to execute.</span></span>  
  
 <span data-ttu-id="e5e87-203">A principal tarefa do processo de captura é verificar o log e gravar dados da coluna e informações relacionadas à transação nas tabelas de alteração do change data capture.</span><span class="sxs-lookup"><span data-stu-id="e5e87-203">The principal task of the capture process is to scan the log and write column data and transaction related information to the change data capture change tables.</span></span> <span data-ttu-id="e5e87-204">Para garantir um limite consistente transacionalmente entre todas as tabelas de alteração de captura de dados de alteração preenchidas, o processo de captura abre e confirma sua própria transação em cada ciclo de verificação.</span><span class="sxs-lookup"><span data-stu-id="e5e87-204">To ensure a transactionally consistent boundary across all the change data capture change tables that it populates, the capture process opens and commits its own transaction on each scan cycle.</span></span> <span data-ttu-id="e5e87-205">Ele detecta quando tabelas são recém-habilitadas para a captura de dados de alteração e automaticamente os inclui no conjunto de tabelas ativamente monitoradas para as entradas de alteração no log.</span><span class="sxs-lookup"><span data-stu-id="e5e87-205">It detects when tables are newly enabled for change data capture, and automatically includes them in the set of tables that are actively monitored for change entries in the log.</span></span> <span data-ttu-id="e5e87-206">De modo semelhante, a desabilitação da captura de dados de alteração também será detectadas, fazendo com que a tabela de origem seja removida do conjunto de tabelas monitoradas ativamente para dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-206">Similarly, disabling change data capture will also be detected, causing the source table to be removed from the set of tables actively monitored for change data.</span></span> <span data-ttu-id="e5e87-207">Quando o processamento para uma seção de log é concluído, o processo de captura emite um sinal para a lógica de truncamento do log de servidor, que usa essa informação para identificar entradas de log qualificadas para truncamento.</span><span class="sxs-lookup"><span data-stu-id="e5e87-207">When processing for a section of the log is finished, the capture process signals the server log truncation logic, which uses this information to identify log entries eligible for truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e5e87-208">Quando um banco de dados está habilitado para captura de dados de alteração, mesmo que o modo de recuperação esteja definido como recuperação simples, o ponto de truncamento do log não avançará até que todas as alterações marcadas para captura tenham sido coletadas pelo processo de captura.</span><span class="sxs-lookup"><span data-stu-id="e5e87-208">When a database is enabled for change data capture, even if the recovery mode is set to simple recovery the log truncation point will not advance until all the changes that are marked for capture have been gathered by the capture process.</span></span> <span data-ttu-id="e5e87-209">Se o processo de captura não estiver sendo executado e houver alterações a serem coletadas, a execução de CHECKPOINT não truncará o log.</span><span class="sxs-lookup"><span data-stu-id="e5e87-209">If the capture process is not running and there are changes to be gathered, executing CHECKPOINT will not truncate the log.</span></span>  
  
 <span data-ttu-id="e5e87-210">O processo de captura também é usado para manter o histórico nas alterações de DDL para tabelas rastreadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-210">The capture process is also used to maintain history on the DDL changes to tracked tables.</span></span> <span data-ttu-id="e5e87-211">As instruções DDL que estão associadas ao Change Data Capture criam entradas no log de transações do banco de dados sempre que um banco de dados ou uma tabela habilitados para o Change Data Capture são descartados ou que colunas de uma tabela habilitada para o Change Data Capture são adicionadas, modificadas ou descartadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-211">The DDL statements that are associated with change data capture make entries to the database transaction log whenever a change data capture-enabled database or table is dropped or columns of a change data capture-enabled table are added, modified, or dropped.</span></span> <span data-ttu-id="e5e87-212">Essas entradas de log são processadas pelo processo de captura, que então envia os eventos de DDL associados para a tabela cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="e5e87-212">These log entries are processed by the capture process, which then posts the associated DDL events to the cdc.ddl_history table.</span></span> <span data-ttu-id="e5e87-213">Você pode obter informações sobre eventos de DDL que afetam tabelas controladas usando o procedimento armazenado [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e5e87-213">You can obtain information about DDL events that affect tracked tables by using the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
## <a name="change-data-capture-agent-jobs"></a><span data-ttu-id="e5e87-214">Trabalhos do Change Data Capture Agent</span><span class="sxs-lookup"><span data-stu-id="e5e87-214">Change Data Capture Agent Jobs</span></span>  
 <span data-ttu-id="e5e87-215">Dois trabalhos do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent, normalmente, são associados a um banco de dados habilitado para a captura de dados de alterações: um que é usado para popular as tabelas de alteração de banco de dados e outro que é responsável pela limpeza da tabela de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-215">Two [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs are typically associated with a change data capture enabled database: one that is used to populate the database change tables, and one that is responsible for change table cleanup.</span></span> <span data-ttu-id="e5e87-216">Ambos os trabalhos consistem em uma única etapa que executa um comando [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e5e87-216">Both jobs consist of a single step that runs a [!INCLUDE[tsql](../../includes/tsql-md.md)] command.</span></span> <span data-ttu-id="e5e87-217">O comando [!INCLUDE[tsql](../../includes/tsql-md.md)] chamado é um procedimento armazenado definido para a captura de dados de alterações que implementa a lógica do trabalho.</span><span class="sxs-lookup"><span data-stu-id="e5e87-217">The [!INCLUDE[tsql](../../includes/tsql-md.md)] command that is invoked is a change data capture defined stored procedure that implements the logic of the job.</span></span> <span data-ttu-id="e5e87-218">Os trabalhos são criados quando a primeira tabela do banco de dados é habilitada para captura de dados de alterações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-218">The jobs are created when the first table of the database is enabled for change data capture.</span></span> <span data-ttu-id="e5e87-219">O Trabalho de Limpeza sempre é criado.</span><span class="sxs-lookup"><span data-stu-id="e5e87-219">The Cleanup Job is always created.</span></span> <span data-ttu-id="e5e87-220">O trabalho de captura só será criado se não existir uma publicação transacional definida para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-220">The capture job will only be created if there are no defined transactional publications for the database.</span></span> <span data-ttu-id="e5e87-221">Um trabalho de captura é criado também quando a captura de dados de alterações e a replicação transacional são habilitadas para um banco de dados e o trabalho do leitor de log transacional é removido porque o banco de dados não definiu mais as publicações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-221">The capture job is also created when both change data capture and transactional replication are enabled for a database, and the transactional logreader job is removed because the database no longer has defined publications.</span></span>  
  
 <span data-ttu-id="e5e87-222">Ambos os trabalhos de captura e limpeza são criados usando parâmetros padrão.</span><span class="sxs-lookup"><span data-stu-id="e5e87-222">Both the capture and cleanup jobs are created by using default parameters.</span></span> <span data-ttu-id="e5e87-223">O trabalho de captura é iniciado imediatamente.</span><span class="sxs-lookup"><span data-stu-id="e5e87-223">The capture job is started immediately.</span></span> <span data-ttu-id="e5e87-224">Ele é executado continuamente, processando um máximo de 1000 transações por ciclo de verificação com uma espera de cinco segundos entre os ciclos.</span><span class="sxs-lookup"><span data-stu-id="e5e87-224">It runs continuously, processing a maximum of 1000 transactions per scan cycle with a wait of 5 seconds between cycles.</span></span> <span data-ttu-id="e5e87-225">O trabalho de limpeza é executado diariamente às 2 horas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-225">The cleanup job runs daily at 2 A.M.</span></span> <span data-ttu-id="e5e87-226">Ele retém as entradas da tabela de alteração por 4320 minutos ou 3 dias, removendo um máximo de 5000 entradas com uma única instrução de exclusão.</span><span class="sxs-lookup"><span data-stu-id="e5e87-226">It retains change table entries for 4320 minutes or 3 days, removing a maximum of 5000 entries with a single delete statement.</span></span>  
  
 <span data-ttu-id="e5e87-227">Os trabalhos de agente de captura de dados de alterações são removidos quando a captura de dados de alterações é desabilitada para um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-227">The change data capture agent jobs are removed when change data capture is disabled for a database.</span></span> <span data-ttu-id="e5e87-228">O trabalho de captura também pode ser removido quando a primeira publicação é adicionada a um banco de dados e tanto a captura de dados de alteração quanto a replicação transacional estão habilitadas.</span><span class="sxs-lookup"><span data-stu-id="e5e87-228">The capture job can also be removed when the first publication is added to a database, and both change data capture and transactional replication are enabled.</span></span>  
  
 <span data-ttu-id="e5e87-229">Internamente, os trabalhos de agente da captura de dados de alterações são criados e removidos usando os procedimentos armazenados [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) e [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="e5e87-229">Internally, change data capture agent jobs are created and dropped by using the stored procedures [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) and [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectively.</span></span> <span data-ttu-id="e5e87-230">Esses procedimentos armazenados também são expostos de forma que administradores possam controlar a criação e remoção desses trabalhos.</span><span class="sxs-lookup"><span data-stu-id="e5e87-230">These stored procedures are also exposed so that administrators can control the creation and removal of these jobs.</span></span>  
  
 <span data-ttu-id="e5e87-231">Um administrador não tem nenhum controle explícito sobre a configuração padrão dos trabalhos de agente de captura de dados de alterações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-231">An administrator has no explicit control over the default configuration of the change data capture agent jobs.</span></span> <span data-ttu-id="e5e87-232">O procedimento armazenado [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) é fornecido para permitir que os parâmetros de configuração padrão sejam modificados.</span><span class="sxs-lookup"><span data-stu-id="e5e87-232">The stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) is provided to allow the default configuration parameters to be modified.</span></span> <span data-ttu-id="e5e87-233">Além disso, o procedimento armazenado [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) permite exibir os parâmetros de configuração atuais.</span><span class="sxs-lookup"><span data-stu-id="e5e87-233">In addition, the stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) allows current configuration parameters to be viewed.</span></span> <span data-ttu-id="e5e87-234">Os trabalhos de captura e de limpeza extraem os parâmetros de configuração da tabela msdb.dbo.cdc_jobs na inicialização.</span><span class="sxs-lookup"><span data-stu-id="e5e87-234">Both the capture job and the cleanup job extract configuration parameters from the table msdb.dbo.cdc_jobs on startup.</span></span> <span data-ttu-id="e5e87-235">Qualquer alteração feita nesses valores utilizando [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) não terá efeito até que o trabalho seja interrompido e reiniciado.</span><span class="sxs-lookup"><span data-stu-id="e5e87-235">Any changes made to these values by using [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) will not take effect until the job is stopped and restarted.</span></span>  
  
 <span data-ttu-id="e5e87-236">Dois procedimentos armazenados adicionais são fornecidos para permitir que os trabalhos de agente da captura de dados de alterações sejam iniciados e interrompidos: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) e [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e5e87-236">Two additional stored procedures are provided to allow the change data capture agent jobs to be started and stopped: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) and [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e5e87-237">Iniciar e interromper o trabalho de captura não resulta em uma perda de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-237">Starting and stopping the capture job does not result in a loss of change data.</span></span> <span data-ttu-id="e5e87-238">Isso impede apenas o processo de captura de verificar ativamente o log quanto a entradas de alteração a serem colocadas nas tabelas de alteração.</span><span class="sxs-lookup"><span data-stu-id="e5e87-238">It only prevents the capture process from actively scanning the log for change entries to deposit in the change tables.</span></span> <span data-ttu-id="e5e87-239">Uma estratégia razoável para impedir que a verificação do log adicione carga durante os períodos de pico de demanda é interromper o trabalho de captura e reiniciá-lo quando houver redução de demanda.</span><span class="sxs-lookup"><span data-stu-id="e5e87-239">A reasonable strategy to prevent log scanning from adding load during periods of peak demand is to stop the capture job and restart it when demand is reduced.</span></span>  
  
 <span data-ttu-id="e5e87-240">Os dois trabalhos do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent foram projetados para serem flexíveis e configuráveis o suficiente para atender às necessidades básicas dos ambientes de captura de dados de alterações.</span><span class="sxs-lookup"><span data-stu-id="e5e87-240">Both [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs were designed to be flexible enough and sufficiently configurable to meet the basic needs of change data capture environments.</span></span> <span data-ttu-id="e5e87-241">Nos dois casos, entretanto, os procedimentos armazenados subjacentes que fornecem funcionalidade principal têm sido expostos para que seja possível a personalização posterior.</span><span class="sxs-lookup"><span data-stu-id="e5e87-241">In both cases, however, the underlying stored procedures that provide the core functionality have been exposed so that further customization is possible.</span></span>  
  
 <span data-ttu-id="e5e87-242">O Change Data Capture não funciona corretamente quando o serviço Mecanismo de Banco de Dados ou o serviço SQL Server Agent está sendo executado na conta NETWORK SERVICE.</span><span class="sxs-lookup"><span data-stu-id="e5e87-242">Change data capture cannot function properly when the Database Engine service or the SQL Server Agent service is running under the NETWORK SERVICE account.</span></span> <span data-ttu-id="e5e87-243">Isso pode resultar no erro 22832.</span><span class="sxs-lookup"><span data-stu-id="e5e87-243">This can result in error 22832.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e5e87-244">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="e5e87-244">See Also</span></span>  
 <span data-ttu-id="e5e87-245">[Controle de alterações de dados &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e5e87-245">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="e5e87-246">[Habilitar e desabilitar a captura de dados de alterações &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e5e87-246">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="e5e87-247">[Trabalhar com dados de alterações &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e5e87-247">[Work with Change Data &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span></span>  
 [<span data-ttu-id="e5e87-248">Administrar e monitorar a captura de dados de alteração &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e5e87-248">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
