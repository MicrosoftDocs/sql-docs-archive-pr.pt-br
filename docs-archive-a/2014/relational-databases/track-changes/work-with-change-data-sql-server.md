---
title: Trabalhar com os dados de alteração (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data [SQL Server]
- change data capture [SQL Server], query function scenarios
- change data capture [SQL Server], LSN boundaries
- change data capture [SQL Server], query functions
ms.assetid: 5346b852-1af8-4080-b278-12efb9b735eb
author: rothja
ms.author: jroth
ms.openlocfilehash: 018d5add95e5d0936f6055e1c6710b6a8ddabdab
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87575682"
---
# <a name="work-with-change-data-sql-server"></a><span data-ttu-id="453f8-102">Trabalhar com dados de alterações (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="453f8-102">Work with Change Data (SQL Server)</span></span>
  <span data-ttu-id="453f8-103">Os dados de alteração ficam disponíveis para consumidores de Change Data Capture através das TVFs (funções com valor de tabela).</span><span class="sxs-lookup"><span data-stu-id="453f8-103">Change data is made available to change data capture consumers through table-valued functions (TVFs).</span></span> <span data-ttu-id="453f8-104">Todas as consultas dessas funções exigem dois parâmetros para definir o intervalo de LSNs (números de sequência de log) qualificados para serem considerados no desenvolvimento do conjunto de dados retornado.</span><span class="sxs-lookup"><span data-stu-id="453f8-104">All queries of these functions require two parameters to define the range of Log Sequence Numbers (LSNs) that are eligible for consideration when developing the returned result set.</span></span> <span data-ttu-id="453f8-105">Tanto o valor superior quanto o valor inferior do LSN indica que o limite do intervalo é considerado ao ser incluído no intervalo.</span><span class="sxs-lookup"><span data-stu-id="453f8-105">Both the upper and lower LSN values that bound the interval are considered to be included within the interval.</span></span>  
  
 <span data-ttu-id="453f8-106">Muitas funções são fornecidas para ajudar a determinar os valores LSN apropriados para serem usados em uma consulta a uma TVF.</span><span class="sxs-lookup"><span data-stu-id="453f8-106">Several functions are provided to help determine appropriate LSN values for use in querying a TVF.</span></span> <span data-ttu-id="453f8-107">A função [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) retorna o menor LSN associado a um intervalo de validade da instância de captura.</span><span class="sxs-lookup"><span data-stu-id="453f8-107">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) returns the smallest LSN that is associated with a capture instance validity interval.</span></span> <span data-ttu-id="453f8-108">O intervalo de validade é o intervalo de tempo durante o qual os dados de alteração ficam disponíveis para as instâncias de captura.</span><span class="sxs-lookup"><span data-stu-id="453f8-108">The validity interval is the time interval for which change data is currently available for its capture instances.</span></span> <span data-ttu-id="453f8-109">A função [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) retorna o maior LSN no intervalo de validade.</span><span class="sxs-lookup"><span data-stu-id="453f8-109">The function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) returns the largest LSN in the validity interval.</span></span> <span data-ttu-id="453f8-110">As funções [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) e [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) estão disponíveis para ajudar a colocar valores LSN em uma linha do tempo convencional.</span><span class="sxs-lookup"><span data-stu-id="453f8-110">The functions [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) and [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) are available to help place LSN values on a conventional timeline.</span></span> <span data-ttu-id="453f8-111">Como a captura de dados de alteração usa intervalos fechados, algumas vezes é necessário gerar o próximo valor LSN em uma sequência para garantir que as alterações não serão duplicadas em janelas de consulta consecutivas.</span><span class="sxs-lookup"><span data-stu-id="453f8-111">Because change data capture uses closed query intervals, it is sometimes necessary to generate the next LSN value in a sequence to ensure that changes are not duplicated in consecutive query windows.</span></span> <span data-ttu-id="453f8-112">As funções [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) e [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) são úteis quando é necessário um ajuste incremental em um valor LSN.</span><span class="sxs-lookup"><span data-stu-id="453f8-112">The functions [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) and [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) are useful when an incremental adjustment to an LSN value is required.</span></span>  
  
##  <a name="validating-lsn-boundaries"></a><a name="LSN"></a> <span data-ttu-id="453f8-113">Validando limites de LSN</span><span class="sxs-lookup"><span data-stu-id="453f8-113">Validating LSN Boundaries</span></span>  
 <span data-ttu-id="453f8-114">Antes de utilizar os limites de LSN que devem ser usados em uma consulta de TVF, é recomendável validá-los.</span><span class="sxs-lookup"><span data-stu-id="453f8-114">We recommend validating the LSN boundaries that are to be used in a TVF query before their use.</span></span> <span data-ttu-id="453f8-115">Os pontos de extremidades nulos ou pontos de extremidade que ficam fora do intervalo de validade da instância de captura forçará um erro que será retornado por uma TVF de captura de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-115">Null endpoints or endpoints that lie outside the validity interval for a capture instance will force an error to be returned by a change data capture TVF.</span></span>  
  
 <span data-ttu-id="453f8-116">Por exemplo, o erro abaixo é retornado para uma consulta de todas as alterações quando um parâmetro que é utilizado para definir o intervalo de consultas não é válido ou está fora do intervalo válido ou quando a opção de filtro de linhas é inválida.</span><span class="sxs-lookup"><span data-stu-id="453f8-116">For example, the following error is returned for a query for all changes when a parameter that is used to define the query interval is not valid, or is out of range, or the row filter option is invalid.</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_all_changes_ ...`  
  
 <span data-ttu-id="453f8-117">O erro correspondente retornado para uma consulta `net changes` é o seguinte:</span><span class="sxs-lookup"><span data-stu-id="453f8-117">The corresponding error returned for a `net changes` query is the following:</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_net_changes_ ...`  
  
> [!NOTE]  
>  <span data-ttu-id="453f8-118">É sabido que a mensagem Msg 313 é equivocada e não informa a causa real da falha.</span><span class="sxs-lookup"><span data-stu-id="453f8-118">It is recognized that the message for Msg 313 is misleading and does not convey the actual cause of the failure.</span></span> <span data-ttu-id="453f8-119">Esse uso inadequado é originário da falta de habilidade para elevar um erro explícito de dentro de uma TVF.</span><span class="sxs-lookup"><span data-stu-id="453f8-119">This awkward usage stems from the inability to raise an explicit error from within a TVF.</span></span> <span data-ttu-id="453f8-120">No entanto, o valor de retorno de um erro reconhecido, mesmo inexato, foi considerado preferível ao retorno de apenas um resultado vazio.</span><span class="sxs-lookup"><span data-stu-id="453f8-120">Nevertheless, the value of returning a recognizable, if inaccurate, error was deemed preferable to simply returning an empty result.</span></span> <span data-ttu-id="453f8-121">Um conjunto de resultados vazio não seria perceptível a partir de uma consulta válida que não retorna nenhuma alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-121">An empty result set would not be distinguishable from a valid query returning no changes.</span></span>  
  
 <span data-ttu-id="453f8-122">Falhas de autorização retornarão falhas ao consultar todas as alterações, como a seguir:</span><span class="sxs-lookup"><span data-stu-id="453f8-122">Authorization failures will return failures when querying for all changes, as shown:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object 'fn_cdc_get_all_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="453f8-123">O mesmo ocorre ao realizar consultas em alterações líquidas:</span><span class="sxs-lookup"><span data-stu-id="453f8-123">The same is true when querying for net changes:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object fn_cdc_get_net_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="453f8-124">Consulte o modelo Enumerar Alterações Delta Usando TRY CATCH para ver uma demonstração de como interceptar esses erros de TVF conhecidos e retornar informações mais pertinentes sobre a falha.</span><span class="sxs-lookup"><span data-stu-id="453f8-124">See the template Enumerate Net Changes Using TRY CATCH for a demonstration of how to intercept these known TVF errors and return more meaningful information about the failure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="453f8-125">Para localizar modelos de Captura de Dados de Alterações no SQL Server Management Studio, no menu **Exibir** , clique em **Gerenciador de Modelos**, expanda **Modelos do SQL Server** e expanda a pasta **Captura de Dados de Alterações** .</span><span class="sxs-lookup"><span data-stu-id="453f8-125">To locate change data capture templates in SQL Server Management Studio, on the **View** menu, click **Template Explorer**, expand **SQL Server Templates** and then expand the **Change Data Capture** folder.</span></span>  
  
##  <a name="query-functions"></a><a name="Functions"></a> <span data-ttu-id="453f8-126">Funções de consulta</span><span class="sxs-lookup"><span data-stu-id="453f8-126">Query Functions</span></span>  
 <span data-ttu-id="453f8-127">Dependendo das características da tabela de origem que estiver sendo rastreada e da configuração da instância de captura, serão geradas uma ou duas TVFs para consultar dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-127">Depending on the characteristics of the source table being tracked and the way in which its capture instance is configured, either one or two TVFs for querying change data are generated.</span></span>  
  
-   <span data-ttu-id="453f8-128">A função [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) retorna todas as alterações ocorridas para o intervalo especificado.</span><span class="sxs-lookup"><span data-stu-id="453f8-128">The function [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) returns all changes that occurred for the specified interval.</span></span> <span data-ttu-id="453f8-129">Essa função sempre é gerada.</span><span class="sxs-lookup"><span data-stu-id="453f8-129">This function is always generated.</span></span> <span data-ttu-id="453f8-130">As entradas sempre são retornadas em ordem, a primeira pelo LSN de confirmação da transação da alteração e, em seguida, por um valor que ordena a alteração dentro de sua transação.</span><span class="sxs-lookup"><span data-stu-id="453f8-130">Entries are always returned sorted, first by the transaction commit LSN of the change, and then by a value that sequences the change within its transaction.</span></span> <span data-ttu-id="453f8-131">Dependendo da opção de filtro de linhas escolhida, ou a linha final é retornada na atualização (opção de filtro de linhas "all") ou os valores novos e antigos são retornados na atualização (opção de filtro de linhas "all update old").</span><span class="sxs-lookup"><span data-stu-id="453f8-131">Depending on the row filter option chosen, either the final row is returned on update (row filter option "all") or both the new and old values are returned on update (row filter option "all update old"').</span></span>  
  
-   <span data-ttu-id="453f8-132">A função [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) é gerada quando o parâmetro @supports_net_changes é definido como 1 e a tabela de origem está habilitada.</span><span class="sxs-lookup"><span data-stu-id="453f8-132">The function [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) is generated when the parameter @supports_net_changes is set to 1 when the source table is enabled.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="453f8-133">Esta opção só terá suporte se a tabela de origem tiver uma chave primária definida ou se o parâmetro @index_name tiver sido usado para identificar um índice exclusivo.</span><span class="sxs-lookup"><span data-stu-id="453f8-133">This option is only supported if the source table has a defined primary key or if the parameter @index_name has been used to identify a unique index.</span></span>  
  
     <span data-ttu-id="453f8-134">A função **netchanges** retorna uma alteração por linha modificada da tabela de origem.</span><span class="sxs-lookup"><span data-stu-id="453f8-134">The **netchanges** function returns one change per modified source table row.</span></span> <span data-ttu-id="453f8-135">Se forem registradas mais de uma alteração para a linha durante o intervalo especificado, os valores da coluna refletirão o conteúdo final da linha.</span><span class="sxs-lookup"><span data-stu-id="453f8-135">If more than one change is logged for the row during the specified interval, the column values will reflect the final contents of the row.</span></span> <span data-ttu-id="453f8-136">Para identificar corretamente a operação necessária para atualizar o ambiente de destino, a TVF deverá considerar tanto a operação inicial na linha durante o intervalo quanto a operação final na linha.</span><span class="sxs-lookup"><span data-stu-id="453f8-136">To correctly identify the operation that is necessary to update the target environment, the TVF must consider both the initial operation on the row during the interval and the final operation on the row.</span></span> <span data-ttu-id="453f8-137">Quando a opção de filtro de linha 'all' for especificada, as operações retornadas por uma consulta `net changes` serão inserção, exclusão ou atualização (novos valores).</span><span class="sxs-lookup"><span data-stu-id="453f8-137">When the row filter option 'all' is specified, the operations that are returned by a `net changes` query will either be insert, delete, or update (new values).</span></span> <span data-ttu-id="453f8-138">Esta opção sempre retorna a máscara de atualização como nula, pois há um custo associado ao cálculo de uma máscara de agregação.</span><span class="sxs-lookup"><span data-stu-id="453f8-138">This option always returns the update mask as null because there is a cost associated with computing an aggregate mask.</span></span> <span data-ttu-id="453f8-139">Caso queira uma máscara de agregação que reflita todas as alterações em uma linha, use a opção 'all with mask'.</span><span class="sxs-lookup"><span data-stu-id="453f8-139">If you require an aggregate mask that reflects all changes to a row, use the 'all with mask' option.</span></span> <span data-ttu-id="453f8-140">Se o processamento downstream não exigir que inserções e atualizações sejam diferenciadas, use a opção 'all with merge'.</span><span class="sxs-lookup"><span data-stu-id="453f8-140">If downstream processing does not require inserts and updates to be distinguished, use the 'all with merge' option.</span></span> <span data-ttu-id="453f8-141">Nesse caso, a operação aceitará somente dois valores: 1 para exclusão e 5 para uma operação que pode ser uma inserção ou uma atualização.</span><span class="sxs-lookup"><span data-stu-id="453f8-141">In this case, the operation value will only take on two values: 1 for delete and 5 for an operation that could be either an insert or an update.</span></span> <span data-ttu-id="453f8-142">Esta opção elimina o processamento adicional necessário para determinar se a operação derivada deveria ser uma inserção ou uma atualização e pode melhorar o desempenho da consulta quando essa diferenciação não é necessária.</span><span class="sxs-lookup"><span data-stu-id="453f8-142">This option eliminates the additional processing needed to determine whether the derived operation should be an insert or an update, and can improve the performance of the query when this differentiation is not necessary.</span></span>  
  
 <span data-ttu-id="453f8-143">A máscara de atualização retornada de uma função de consulta é uma representação compacta que identifica todas as colunas que foram alteradas em uma linha de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-143">The update mask that is returned from a query function is a compact representation that identifies all columns that changed in a row of change data.</span></span> <span data-ttu-id="453f8-144">Normalmente, essas informações são necessárias apenas para um pequeno subconjunto de colunas capturadas.</span><span class="sxs-lookup"><span data-stu-id="453f8-144">Typically, this information is only required for a small subset of the captured columns.</span></span> <span data-ttu-id="453f8-145">Há funções disponíveis para ajudar a extrair informações da máscara em uma forma que seja mais diretamente utilizável por aplicativos.</span><span class="sxs-lookup"><span data-stu-id="453f8-145">Functions are available to assist in extracting information from the mask in a form that is more directly usable by applications.</span></span> <span data-ttu-id="453f8-146">A função [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) retorna a posição ordinal de uma coluna nomeada relativa a uma dada instância de captura, ao passo que a função [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) retorna a paridade do bit da máscara fornecida com base no ordinal passado na chamada de função.</span><span class="sxs-lookup"><span data-stu-id="453f8-146">The function [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) returns the ordinal position of a named column for a given capture instance, whereas the function [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) returns the parity of the bit in the provided mask based on the ordinal that was passed in the function call.</span></span> <span data-ttu-id="453f8-147">Juntas, essas duas funções permitem que as informações da coluna atualizada sejam extraídas de maneira eficaz e retornadas com a solicitação de dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-147">Together, these two functions allow information from the update mask to be efficiently extracted and returned with the request for change data.</span></span> <span data-ttu-id="453f8-148">Consulte o modelo Enumerar Alterações Delta Usando All With Mask para ver uma demonstração de como estas funções são utilizadas.</span><span class="sxs-lookup"><span data-stu-id="453f8-148">See the template Enumerate Net Changes Using All With Mask for a demonstration of how these functions are used.</span></span>  
  
##  <a name="query-function-scenarios"></a><a name="Scenarios"></a> <span data-ttu-id="453f8-149">Cenários de funções de consulta</span><span class="sxs-lookup"><span data-stu-id="453f8-149">Query Function Scenarios</span></span>  
 <span data-ttu-id="453f8-150">As próximas seções descrevem cenários comuns para consultar dados de Change Data Capture usando as funções de consulta cdc.fn_cdc_get_all_changes_<instância_de_captura> e cdc.fn_cdc_get_net_changes_<instância_de_captura>.</span><span class="sxs-lookup"><span data-stu-id="453f8-150">The following sections describe common scenarios for querying change data capture data by using the query functions cdc.fn_cdc_get_all_changes_<capture_instance> and cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-changes-within-the-capture-instance-validity-interval"></a><span data-ttu-id="453f8-151">Consultando todas as alterações ocorridas no intervalo de validade de captura da instância de captura</span><span class="sxs-lookup"><span data-stu-id="453f8-151">Querying for All Changes Within the Capture Instance Validity Interval</span></span>  
 <span data-ttu-id="453f8-152">A solicitação mais objetiva de dados de alteração é a que retorna todos os dados de alteração atuais em um intervalo de validade da instância de captura.</span><span class="sxs-lookup"><span data-stu-id="453f8-152">The most straightforward request for change data is one that returns all of the current change data in a capture instance's validity interval.</span></span> <span data-ttu-id="453f8-153">Para fazer essa solicitação, primeiro determine os limites de LSN inferior e superior do intervalo de validade.</span><span class="sxs-lookup"><span data-stu-id="453f8-153">To make this request, first determine the lower and upper LSN boundaries of the validity interval.</span></span> <span data-ttu-id="453f8-154">Em seguida, use esses valores para identificar os parâmetros @from_lsn e @to_lsn passados para a função de consulta cdc.fn_cdc_get_all_changes_<capture_instance> ou cdc.fn_cdc_get_net_changes_<capture_instance>.</span><span class="sxs-lookup"><span data-stu-id="453f8-154">Then, use these values to identify the parameters @from_lsn and @to_lsn passed to the query function cdc.fn_cdc_get_all_changes_<capture_instance> or cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span> <span data-ttu-id="453f8-155">Use a função [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) para obter o limite inferior e [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) para obter o limite superior.</span><span class="sxs-lookup"><span data-stu-id="453f8-155">Use the function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) to obtain the lower bound, and [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the upper bound.</span></span> <span data-ttu-id="453f8-156">Consulte o modelo Enumerar Todas as Consultas no Intervalo Válido para que o código de exemplo consulte todas as alterações válidas usando a função de consulta cdc.fn_cdc_get_all_changes_<instância_de_captura>.</span><span class="sxs-lookup"><span data-stu-id="453f8-156">See the template Enumerate All Changes for the Valid Range for sample code to query for all current valid changes by using the query function cdc.fn_cdc_get_all_changes_<capture_instance>.</span></span> <span data-ttu-id="453f8-157">Consulte o modelo Enumerar Consultas Delta no Intervalo Válido para ver um exemplo semelhante de como usar a função cdc.fn_cdc_get_net_changes_<instância_de_captura>.</span><span class="sxs-lookup"><span data-stu-id="453f8-157">See the template Enumerate Net Changes for the Valid Range for a similar example of using the function cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-new-changes-since-the-last-set-of-changes"></a><span data-ttu-id="453f8-158">Consultando todas as novas alterações feitas desde o último conjunto de alterações</span><span class="sxs-lookup"><span data-stu-id="453f8-158">Querying for All New Changes Since the Last Set of Changes</span></span>  
 <span data-ttu-id="453f8-159">Em aplicativos típicos, consultar dados de alteração será um processo constante, fazendo solicitações periódicas de todas as alterações ocorridas desde a última solicitação.</span><span class="sxs-lookup"><span data-stu-id="453f8-159">For typical applications, querying for change data will be an ongoing process, making periodic requests for all of the changes that occurred since the last request.</span></span> <span data-ttu-id="453f8-160">Para tais consultas, você pode usar a função [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) para derivar o limite inferior da consulta atual com base no limite superior da consulta anterior.</span><span class="sxs-lookup"><span data-stu-id="453f8-160">For such queries, you can use the function [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) to derive the lower bound of the current query from the upper bound of the previous query.</span></span> <span data-ttu-id="453f8-161">Este método assegura que nenhuma linha seja repetida porque o intervalo de consulta é sempre tratado como um intervalo fechado, onde os dois pontos de extremidade estão incluídos no intervalo.</span><span class="sxs-lookup"><span data-stu-id="453f8-161">This method ensures that no rows are repeated because the query interval is always treated as a closed interval where both end-points are included in the interval.</span></span> <span data-ttu-id="453f8-162">Em seguida, use a função [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) para obter o ponto de extremidade superior relativo ao intervalo de solicitação.</span><span class="sxs-lookup"><span data-stu-id="453f8-162">Then, use the function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the high end-point for the new request interval.</span></span> <span data-ttu-id="453f8-163">Consulte o modelo Enumerar Todas as Alterações desde a Solicitação Anterior para ver o código de exemplo para mover sistematicamente a janela de consulta e obter todas as alterações feitas desde a última solicitação.</span><span class="sxs-lookup"><span data-stu-id="453f8-163">See the template Enumerate All Changes Since Previous Request for sample code to systematically move the query window to obtain all changes since the last request.</span></span>  
  
### <a name="querying-for-all-new-changes-up-until-now"></a><span data-ttu-id="453f8-164">Consultando todas as novas alterações feitas até agora</span><span class="sxs-lookup"><span data-stu-id="453f8-164">Querying for all New Changes Up Until Now</span></span>  
 <span data-ttu-id="453f8-165">Uma restrição típica imposta sobre as alterações retornadas por uma função de consulta é incluir apenas as alterações que ocorreram entre a solicitação anterior e a data e a hora atuais.</span><span class="sxs-lookup"><span data-stu-id="453f8-165">A typical constraint that is placed on the changes returned by a query function is to include only the changes that occurred between the previous request until the current date and time.</span></span> <span data-ttu-id="453f8-166">Para esta consulta, aplique a função sys.fn_cdc_increment_lsn ao valor @from_lsn que foi usado na solicitação anterior para determinar o limite inferior.</span><span class="sxs-lookup"><span data-stu-id="453f8-166">For this query, apply the function sys.fn_cdc_increment_lsn to the @from_lsn value that was used in the previous request to determine the lower bound.</span></span> <span data-ttu-id="453f8-167">Como o limite superior sobre o intervalo de tempo é expresso como um momento determinado, ele deve ser convertido em um valor LSN para que possa ser usado por uma função de consulta.</span><span class="sxs-lookup"><span data-stu-id="453f8-167">Because the upper bound on the time interval is expressed as a specific point in time, it must be converted to an LSN value before it can be used by a query function.</span></span> <span data-ttu-id="453f8-168">Para que o valor de data e hora seja convertido em um valor LSN correspondente, você deve assegurar que o processo de captura processou todas as alterações confirmadas através do limite superior especificado.</span><span class="sxs-lookup"><span data-stu-id="453f8-168">Before the datetime value can be converted to a corresponding LSN value, you must ensure that the capture process has processed all changes that were committed through the specified upper bound.</span></span> <span data-ttu-id="453f8-169">Isso é necessário para garantir que todas as alterações qualificadas foram propagadas na tabela de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-169">This is required to ensure that all the qualifying changes have been propagated to the change table.</span></span> <span data-ttu-id="453f8-170">Uma forma de fazer isso é estruturar um loop de espera que verifique periodicamente se o lsn de confirmação máximo atual registrado para qualquer tabela de alteração do banco de dados ultrapassa a hora de término desejada do intervalo de solicitação.</span><span class="sxs-lookup"><span data-stu-id="453f8-170">One way to do this is to structure a wait loop that periodically checks to see if the current maximum commit lsn recorded for any database change table exceeds the desired end time of the request interval.</span></span>  
  
 <span data-ttu-id="453f8-171">Depois que o loop de atraso verificar se o processo de captura já processou todas as entradas de log relevantes, use a função [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) para determinar o novo ponto de extremidade superior expresso como um valor LSN.</span><span class="sxs-lookup"><span data-stu-id="453f8-171">After the delay loop verifies that the capture process has already processed all the relevant log entries, use the function [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) to determine the new high end-point expressed as an LSN value.</span></span> <span data-ttu-id="453f8-172">Para assegurar que todas as entradas que foram confirmadas através da hora especificada sejam recuperadas, chame a função sys.fn_cdc_map_time_to_lsn e use a opção 'maior menor que ou igual'.</span><span class="sxs-lookup"><span data-stu-id="453f8-172">To ensure that all entries that were committed through the specified time are retrieved, call the function sys.fn_cdc_map_time_to_lsn, and use the option 'largest less than or equal'.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="453f8-173">Em períodos de inatividade, uma entrada fictícia é adicionada à tabela cdc.lsn_time_mapping para indicar que o processo de captura processou as alterações até uma determinada hora de confirmação.</span><span class="sxs-lookup"><span data-stu-id="453f8-173">In periods of inactivity, a dummy entry is added to the table cdc.lsn_time_mapping to mark the fact that the capture process has processed the changes up to a given commit time.</span></span> <span data-ttu-id="453f8-174">Isso impede que se tenha a impressão de que o processo de captura não foi executado quando simplesmente não existem alterações a serem processadas.</span><span class="sxs-lookup"><span data-stu-id="453f8-174">This prevents it from appearing that the capture process has fallen behind when there are simply no recent changes to process.</span></span>  
  
 <span data-ttu-id="453f8-175">O modelo Enumerar Todas as Alterações Feitas até Agora demonstra como usar a estratégia anterior para consultar dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-175">The template Enumerate All Changes Up Until Now demonstrates how to use the previous strategy to query for change data.</span></span>  
  
### <a name="adding-a-commit-time-to-an-all-changes-result-set"></a><span data-ttu-id="453f8-176">Adicionando uma hora de confirmação a um conjunto de resultados Todas as Alterações</span><span class="sxs-lookup"><span data-stu-id="453f8-176">Adding a Commit Time to an All Changes Result Set</span></span>  
 <span data-ttu-id="453f8-177">A hora de confirmação de cada transação com uma entrada associada de uma tabela de alterações do banco de dados fica disponível na tabela [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="453f8-177">The commit time of each transaction with an associated entry in a database change table is available in the table [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span></span> <span data-ttu-id="453f8-178">Ao unir o valor __$start_lsn retornado em uma solicitação de todas as alterações com o valor start_lsn de uma entrada da tabela cdc.lsn_time_mapping, você consegue retornar tran_end_time junto com os dados de alteração para gravar a alteração com a hora de confirmação da transação na origem.</span><span class="sxs-lookup"><span data-stu-id="453f8-178">By joining the __$start_lsn value returned in a request for all changes with the start_lsn value of a cdc.lsn_time_mapping table entry, you can return the tran_end_time along with the change data to stamp the change with the commit time of the transaction at the source.</span></span> <span data-ttu-id="453f8-179">O modelo Acrescentar Hora de Confirmação ao Conjunto de Resultados Todas as Alterações demonstra como fazer esta junção.</span><span class="sxs-lookup"><span data-stu-id="453f8-179">The template Append Commit Time to All Changes Result Set demonstrates how to perform this join.</span></span>  
  
### <a name="joining-change-data-with-other-data-from-the-same-transaction"></a><span data-ttu-id="453f8-180">Unindo dados de alteração com outros dados da mesma transação</span><span class="sxs-lookup"><span data-stu-id="453f8-180">Joining Change Data with Other Data from the Same Transaction</span></span>  
 <span data-ttu-id="453f8-181">De vez em quando é útil unir dados de alteração com outras informações coletadas sobre a transação quando confirmada na origem.</span><span class="sxs-lookup"><span data-stu-id="453f8-181">Occasionally, it is useful to join change data with other information gathered about the transaction when it committed at the source.</span></span> <span data-ttu-id="453f8-182">A coluna tran_begin_lsn da tabela cdc.lsn_time_mapping fornece as informações necessárias para fazer tal junção.</span><span class="sxs-lookup"><span data-stu-id="453f8-182">The tran_begin_lsn column in the table cdc.lsn_time_mapping provides the information needed to perform such a join.</span></span> <span data-ttu-id="453f8-183">Quando ocorre a atualização da origem, o valor de database_transaction_begin_lsn da exibição dinâmica do sistema [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) deve ser salvo junto com qualquer outra informação a ser unida aos dados de alteração.</span><span class="sxs-lookup"><span data-stu-id="453f8-183">When the update of the source occurs, the value for database_transaction_begin_lsn from the system dynamic view [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) must be saved along with any other information to be joined with the change data.</span></span> <span data-ttu-id="453f8-184">Use a função fn_convertnumericlsntobinary para comparar os valores database_transaction_begin_lsn e tran_begin_lsn.</span><span class="sxs-lookup"><span data-stu-id="453f8-184">Use the function fn_convertnumericlsntobinary to compare the database_transaction_begin_lsn and tran_begin_lsn values.</span></span> <span data-ttu-id="453f8-185">O código para criar esta função está disponível no modelo Criar Função fn_convertnumericlsntobinary.</span><span class="sxs-lookup"><span data-stu-id="453f8-185">The code to create this function is available in the template Create Function fn_convertnumericlsntobinary.</span></span> <span data-ttu-id="453f8-186">O modelo Retornar Todas as Alterações com um Dado tran_begin_lsn demonstra como efetuar a junção.</span><span class="sxs-lookup"><span data-stu-id="453f8-186">The template Return All Changes with a Given tran_begin_lsn demonstrates how to effect the join.</span></span>  
  
### <a name="querying-using-datetime-wrapper-functions"></a><span data-ttu-id="453f8-187">Consultando com funções de wrapper de data e hora</span><span class="sxs-lookup"><span data-stu-id="453f8-187">Querying Using Datetime Wrapper Functions</span></span>  
 <span data-ttu-id="453f8-188">Um cenário de aplicativo típico para consultar dados de alteração é solicitar dados de alteração periodicamente usando uma janela deslizante vinculada por valores de data e hora.</span><span class="sxs-lookup"><span data-stu-id="453f8-188">A typical application scenario for querying for change data is to periodically request change data by using a sliding window bounded by datetime values.</span></span> <span data-ttu-id="453f8-189">Para esta classe de consumidores, o Change Data Capture oferece o procedimento armazenado [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) que gera scripts para criar funções de wrapper personalizadas para as funções de consulta do Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="453f8-189">For this class of consumers, change data capture provides the stored procedure [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) that generates scripts to create custom wrapper functions for the change data capture query functions.</span></span> <span data-ttu-id="453f8-190">Esses wrappers personalizados permitem que o intervalo de consulta seja expresso como um par de data/hora.</span><span class="sxs-lookup"><span data-stu-id="453f8-190">These custom wrappers allow the query interval to be expressed as a datetime pair.</span></span>  
  
 <span data-ttu-id="453f8-191">Chamar opções do procedimento armazenado permite que wrappers sejam gerados para todas as instâncias de captura às quais o chamador tem acesso ou apenas para uma instância de captura especificada.</span><span class="sxs-lookup"><span data-stu-id="453f8-191">Calling options for the stored procedure allow for wrappers to be generated for all capture instances that the caller has access to, or only a specified capture instance.</span></span> <span data-ttu-id="453f8-192">As opções com suporte também incluem a capacidade de especificar se o ponto de extremidade superior do intervalo de captura deve ser aberto ou fechado, quais colunas capturadas disponíveis devem ser incluídas no conjunto de resultados e quais colunas incluídas devem ter sinalizadores de atualização associados.</span><span class="sxs-lookup"><span data-stu-id="453f8-192">Supported options also include the ability to specify whether the high end-point of the capture interval should be open or closed, which of the available captured columns should be included in the result set and which of the included columns should have associated update flags.</span></span> <span data-ttu-id="453f8-193">O procedimento retorna um conjunto de resultados com duas colunas: o nome de função gerado que é derivado do nome da instância de captura, e a instrução de criação para o procedimento armazenado do wrapper.</span><span class="sxs-lookup"><span data-stu-id="453f8-193">The procedure returns a result set with two columns: the generated function name, which is derivable from the capture instance name, and the create statement for the wrapper stored procedure.</span></span> <span data-ttu-id="453f8-194">A função usada para incluir a consulta de todas as alterações sempre é gerada.</span><span class="sxs-lookup"><span data-stu-id="453f8-194">The function to wrap the all changes query is always generated.</span></span> <span data-ttu-id="453f8-195">Se o parâmetro @supports_net_changes foi definido durante a criação da instância de captura, a função usada para encapsular as alterações delta também é gerada.</span><span class="sxs-lookup"><span data-stu-id="453f8-195">If the @supports_net_changes parameter was set when the capture instance was created, the function to wrap the net changes function is also generated.</span></span>  
  
 <span data-ttu-id="453f8-196">É de responsabilidade do designer do aplicativo chamar o procedimento armazenado de geração de script para gerar as instruções de criação para os procedimentos armazenados do wrapper, bem como executar os scripts de criação resultantes para criar as funções.</span><span class="sxs-lookup"><span data-stu-id="453f8-196">It is the responsibility of the application designer to call the script generation stored procedure to generate the create statements for the wrapper stored procedures, and to execute the resulting create scripts to create the functions.</span></span> <span data-ttu-id="453f8-197">Isso não ocorre automaticamente quando uma instância de captura é criada.</span><span class="sxs-lookup"><span data-stu-id="453f8-197">This does not occur automatically when a capture instance is created.</span></span>  
  
 <span data-ttu-id="453f8-198">Os wrappers de data e hora pertencem ao usuário e não são criados no esquema padrão do chamador.</span><span class="sxs-lookup"><span data-stu-id="453f8-198">Datetime wrappers are owned by the user, and not are created in the default schema of the caller.</span></span> <span data-ttu-id="453f8-199">A função gerada é adequada e não requer modificação para a maioria dos usuários.</span><span class="sxs-lookup"><span data-stu-id="453f8-199">The generated function is suitable without modification for most users.</span></span> <span data-ttu-id="453f8-200">Todavia, antes de criar a função sempre é possível aplicar mais personalizações ao script gerado.</span><span class="sxs-lookup"><span data-stu-id="453f8-200">However, further customization can always be applied to the generated script prior to creating the function.</span></span>  
  
 <span data-ttu-id="453f8-201">O nome da função usada para incluir a consulta de todas as alterações é fn_all_changes_ seguido pelo nome da instância de captura.</span><span class="sxs-lookup"><span data-stu-id="453f8-201">The name of the function to wrap the all changes query is fn_all_changes_ followed by the capture instance name.</span></span> <span data-ttu-id="453f8-202">O prefixo usado para o wrapper de alterações delta é fn_net_changes_.</span><span class="sxs-lookup"><span data-stu-id="453f8-202">The prefix that is used for the net changes wrapper is fn_net_changes_.</span></span> <span data-ttu-id="453f8-203">Ambas as funções usam três argumentos, assim como suas TVFs associadas do Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="453f8-203">Both functions take three arguments, just as their associated change data capture TVFs do.</span></span> <span data-ttu-id="453f8-204">No entanto, o intervalo de consulta para os wrappers é vinculado por dois valores de data e hora, e não por dois valores LSN.</span><span class="sxs-lookup"><span data-stu-id="453f8-204">However, the query interval for the wrappers is bounded by two datetime values instead of than by two LSN values.</span></span> <span data-ttu-id="453f8-205">O parâmetro @row_filter_option para os dois conjuntos de funções é o mesmo.</span><span class="sxs-lookup"><span data-stu-id="453f8-205">The @row_filter_option parameter for both sets of functions are the same.</span></span>  
  
 <span data-ttu-id="453f8-206">As funções de wrapper geradas dão suporte à seguinte convenção para percorrer sistematicamente a linha do tempo da alteração de captura de dados: espera-se que o parâmetro @end_time do intervalo anterior seja usado como o parâmetro @start_time do intervalo subsequente.</span><span class="sxs-lookup"><span data-stu-id="453f8-206">The generated wrapper functions support the following convention for systematically walking the change data capture timeline: It is expected that the @end_time parameter of the previous interval be used as the @start_time parameter of the subsequent interval.</span></span> <span data-ttu-id="453f8-207">A função de wrapper mapeia os valores de data e hora para valores LSN e assegura que nenhum dado seja perdido ou repetido se esta convenção for seguida.</span><span class="sxs-lookup"><span data-stu-id="453f8-207">The wrapper function takes care of mapping the datetime values to LSN values and ensuring that no data is lost or repeated if this convention is followed.</span></span>  
  
 <span data-ttu-id="453f8-208">Os wrappers podem ser gerados para dar suporte a um limite superior fechado e a um limite superior aberto na janela de consulta especificada.</span><span class="sxs-lookup"><span data-stu-id="453f8-208">The wrappers can be generated to support either a closed upper bound or an open upper bound on the specified query window.</span></span> <span data-ttu-id="453f8-209">Ou seja, o chamador pode especificar se as entradas que têm uma hora de confirmação igual ao limite superior do intervalo de extração devem ser incluídas no intervalo.</span><span class="sxs-lookup"><span data-stu-id="453f8-209">That is, the caller can specify whether entries having a commit time equal to the upper bound of the extraction interval are to be included within the interval.</span></span> <span data-ttu-id="453f8-210">Por padrão, o limite superior é incluído.</span><span class="sxs-lookup"><span data-stu-id="453f8-210">By default, the upper bound is included.</span></span>  
  
 <span data-ttu-id="453f8-211">Embora as TVFs da consulta gerada falhem se for indicado um valor nulo para o valor @from_lsn ou @to_lsn, as funções de wrapper de data e hora usam nulo para permitir que esses wrappers retornem todas as alterações atuais.</span><span class="sxs-lookup"><span data-stu-id="453f8-211">While the generated query TVFs fail if supplied a null value for either the @from_lsn value or the @to_lsn value, the datetime wrapper functions use null to allow the datetime wrappers to return all current changes.</span></span> <span data-ttu-id="453f8-212">Ou seja, se nulo for passado como o ponto de extremidade inferior da janela de consulta para o wrapper de data e hora, o ponto de extremidade inferior do intervalo de validade da instância de captura será usado na instrução SELECT subjacente aplicada à TVF da consulta.</span><span class="sxs-lookup"><span data-stu-id="453f8-212">That is, if null is passed as the low end-point of the query window to the datetime wrapper, the low end point of the capture instance validity interval is used in the underlying SELECT statement that is applied to the query TVF.</span></span> <span data-ttu-id="453f8-213">De maneira semelhante, se nulo for passado como o ponto de extremidade superior da janela de consulta, o ponto de extremidade superior do intervalo de validade da instância de captura será usado para fazer uma seleção na TVF da consulta.</span><span class="sxs-lookup"><span data-stu-id="453f8-213">Similarly, if null is passed as the high end-point of the query window, the high end-point of the capture instance validity interval is used when selecting from the query TVF.</span></span>  
  
 <span data-ttu-id="453f8-214">O conjunto de resultados retornado por uma função de wrapper inclui todas as colunas solicitadas seguidas por uma coluna de operação, gravada como um ou dois caracteres que identificam a operação associada à linha.</span><span class="sxs-lookup"><span data-stu-id="453f8-214">The result set returned by a wrapper function includes all the requested columns followed by an operation column, recoded as one or two characters to identify the operation that is associated with the row.</span></span> <span data-ttu-id="453f8-215">Caso sinalizadores de atualização tenham sido solicitados, serão exibidos como colunas de bit após o código da operação, na ordem especificada no parâmetro @update_flag_list.</span><span class="sxs-lookup"><span data-stu-id="453f8-215">If update flags have been requested, they appear as bit columns after the operation code, in the order specified in the @update_flag_list parameter.</span></span> <span data-ttu-id="453f8-216">Para obter informações sobre as opções de chamada para personalizar os wrappers de data e hora gerados, consulte [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="453f8-216">For information about the calling options for customizing the generated datetime wrappers, see [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span></span>  
  
 <span data-ttu-id="453f8-217">O modelo Instanciar uma TVF de Wrapper com Sinalizador de Atualização mostra como personalizar uma função de wrapper gerada para acrescentar um sinalizador de atualização de uma coluna especificada ao conjunto de resultados retornado por uma consulta de alterações delta.</span><span class="sxs-lookup"><span data-stu-id="453f8-217">The template Instantiate a Wrapper TVF With Update Flag shows how to customize a generated wrapper function to append an update flag for a specified column to the result set returned by a net changes query.</span></span> <span data-ttu-id="453f8-218">O modelo Criar uma Instância de TVFs de Wrapper CDC para Esquema mostra como instanciar os Wrappers de Data e Hora das TVFs de Consulta para todas as instâncias de captura criadas para as tabelas de origem em um dado esquema de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="453f8-218">The template Instantiate CDC Wrapper TVFs for a Schema shows how to instantiate the Datetime Wrappers for the Query TVFs for all of the capture instances created for the source tables in a given database schema.</span></span>  
  
 <span data-ttu-id="453f8-219">Para ver um exemplo que utiliza um wrapper de data e hora para consultar dados de alteração, consulte o modelo Obter Alterações Delta Usando Wrapper com Sinalizadores de Atualização.</span><span class="sxs-lookup"><span data-stu-id="453f8-219">For an example that uses a datetime wrapper to query for change data, see the template Get Net Changes Using Wrapper With Update Flags.</span></span> <span data-ttu-id="453f8-220">Este modelo demonstra como consultar alterações delta com uma função de wrapper quando o wrapper está configurado para retornar sinalizadores de atualização.</span><span class="sxs-lookup"><span data-stu-id="453f8-220">This template demonstrates how to query for net changes with a wrapper function when the wrapper is configured to return update flags.</span></span> <span data-ttu-id="453f8-221">Observe que a opção de filtro de linhas 'all with mask' é necessária para que a função de consulta subjacente retorne uma máscara de atualização não nula na atualização.</span><span class="sxs-lookup"><span data-stu-id="453f8-221">Note that the row filter option 'all with mask' is required for the underlying query function to return a non-null update mask on update.</span></span> <span data-ttu-id="453f8-222">Valores nulos são passados para os limites de intervalo de data e hora inferior e superior para indicar que a função deve usar o ponto de extremidade inferior e o ponto de extremidade superior do intervalo de validade da instância de captura ao executar a consulta subjacente baseada em LSN.</span><span class="sxs-lookup"><span data-stu-id="453f8-222">Null values are passed for both the lower and upper datetime interval boundaries to signal the function to use the low end point and the high end point of the validity interval for the capture instance when performing the underlying LSN based query.</span></span> <span data-ttu-id="453f8-223">A consulta retorna uma linha para cada modificação em uma linha de origem ocorrida no intervalo válido para a instância de captura.</span><span class="sxs-lookup"><span data-stu-id="453f8-223">The query returns one row for each modification to a source row that occurred within the valid range for the capture instance.</span></span>  
  
### <a name="using-the-datetime-wrapper-functions-to-transition-between-capture-instances"></a><span data-ttu-id="453f8-224">Usando as funções de wrapper de data e hora para transição entre instâncias de captura</span><span class="sxs-lookup"><span data-stu-id="453f8-224">Using the Datetime Wrapper Functions to Transition Between Capture Instances</span></span>  
 <span data-ttu-id="453f8-225">O Change Data Capture dá suporte a até duas instâncias de captura para uma única tabela de origem rastreada.</span><span class="sxs-lookup"><span data-stu-id="453f8-225">Change data capture supports up to two capture instances for a single tracked source table.</span></span> <span data-ttu-id="453f8-226">O principal uso deste recurso é acomodar uma transição entre várias instâncias de captura quando alterações de DDL na tabela de origem expandem o conjunto de colunas disponíveis para controle.</span><span class="sxs-lookup"><span data-stu-id="453f8-226">The principal use of this capability is to accommodate a transition between multiple capture instances when data definition language (DDL) changes to the source table expand the set of available columns for tracking.</span></span> <span data-ttu-id="453f8-227">Ao transitar para uma nova instância de captura, uma forma de proteger níveis de aplicativos superiores contra alterações nos nomes de funções de consulta subjacentes é usar uma função de wrapper para incluir a chamada subjacente.</span><span class="sxs-lookup"><span data-stu-id="453f8-227">When transitioning to a new capture instance, one way to protect higher application levels from changes in the names of the underlying query functions is to use a wrapper function to wrap the underlying call.</span></span> <span data-ttu-id="453f8-228">Em seguida, atente para que o nome da função de wrapper permaneça o mesmo.</span><span class="sxs-lookup"><span data-stu-id="453f8-228">Then, ensure that the name of the wrapper function remains the same.</span></span> <span data-ttu-id="453f8-229">Quando a transição tiver de ser feita, a antiga função de wrapper poderá ser descartada, e uma nova com o mesmo nome poderá ser criada para fazer referência às novas funções de consulta.</span><span class="sxs-lookup"><span data-stu-id="453f8-229">When the switch is to occur, the old wrapper function can be dropped, and a new one with the same name created that references the new query functions.</span></span> <span data-ttu-id="453f8-230">Se primeiro você modificar o script gerado para criar uma função de wrapper de mesmo nome, poderá fazer a transição para uma nova instância de captura sem afetar as camadas de aplicativos superiores.</span><span class="sxs-lookup"><span data-stu-id="453f8-230">By first modifying the generated script to create a wrapper function of the same name, you can make the switch to a new capture instance without affecting higher application layers.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="453f8-231">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="453f8-231">See Also</span></span>  
 <span data-ttu-id="453f8-232">[Controle de alterações de dados &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="453f8-232">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="453f8-233">[Sobre a captura de dados de alterações &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="453f8-233">[About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="453f8-234">[Habilitar e desabilitar a captura de dados de alterações &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="453f8-234">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 [<span data-ttu-id="453f8-235">Administrar e monitorar a captura de dados de alteração &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="453f8-235">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
