---
title: Destino do Rastreamento de Eventos para Windows | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- event tracing for windows target
- ETW target
- targets [SQL Server extended events], event tracing for windows target
ms.assetid: ca2bb295-b7f6-49c3-91ed-0ad4c39f89d5
author: rothja
ms.author: jroth
ms.openlocfilehash: 55f247af30b5278f614b6505a94266cc07ec6c54
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570026"
---
# <a name="event-tracing-for-windows-target"></a><span data-ttu-id="6452e-102">destino do rastreamento de eventos do Windows</span><span class="sxs-lookup"><span data-stu-id="6452e-102">Event Tracing for Windows Target</span></span>
  <span data-ttu-id="6452e-103">Antes de usar o Rastreamento de Eventos do Windows (ETW) como destino, é recomendável ter um conhecimento prático do ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-103">Before you use Event Tracing for Windows (ETW) as a target, we recommend that you have a working knowledge of ETW.</span></span> <span data-ttu-id="6452e-104">O rastreamento ETW é usado junto com o recurso Eventos Estendidos ou como um consumidor de Eventos Estendidos.</span><span class="sxs-lookup"><span data-stu-id="6452e-104">ETW tracing is either used together with Extended Events or as an Extended Events event consumer.</span></span> <span data-ttu-id="6452e-105">Os links externos a seguir fornecem um ponto de partida para a obtenção de informações gerais do ETW:</span><span class="sxs-lookup"><span data-stu-id="6452e-105">The following external links provide a starting point for obtaining background information about ETW:</span></span>  
  
-   [<span data-ttu-id="6452e-106">Eventos do Windows</span><span class="sxs-lookup"><span data-stu-id="6452e-106">Windows Events</span></span>](https://go.microsoft.com/fwlink/?LinkId=92380)  
  
-   [<span data-ttu-id="6452e-107">Melhore o ajuste de depuração e desempenho com o ETW</span><span class="sxs-lookup"><span data-stu-id="6452e-107">Improve Debugging And Performance Tuning With ETW</span></span>](https://go.microsoft.com/fwlink/?LinkId=92381)  
  
 <span data-ttu-id="6452e-108">O destino de ETW é um destino singleton, embora o destino pode ser adicionado a muitas sessões.</span><span class="sxs-lookup"><span data-stu-id="6452e-108">The ETW target is a singleton target, although the target can be added to many sessions.</span></span> <span data-ttu-id="6452e-109">Se um evento for gerado em muitas sessões, esse evento somente será propagado para o destino de ETW uma vez por ocorrência de evento.</span><span class="sxs-lookup"><span data-stu-id="6452e-109">If an event is raised on many sessions, the event will only be propagated to the ETW target one time per event occurrence.</span></span> <span data-ttu-id="6452e-110">O mecanismo de Eventos Estendidos é limitado a uma única instância por processo.</span><span class="sxs-lookup"><span data-stu-id="6452e-110">The Extended Events engine is limited to a single instance per process.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6452e-111">Para que o destino ETW funcione, a conta de inicialização do serviço do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] deve ser um membro do grupo de Usuários de Log de Desempenho.</span><span class="sxs-lookup"><span data-stu-id="6452e-111">For the ETW target to work, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Service startup account must be a member of the Performance Log Users group.</span></span>  
  
 <span data-ttu-id="6452e-112">A configuração dos eventos presente em uma sessão ETW é controlada pelo processo que hospeda o mecanismo de Eventos Estendidos.</span><span class="sxs-lookup"><span data-stu-id="6452e-112">The configuration of the events present in an ETW session is controlled by the process that hosts the Extended Events engine.</span></span> <span data-ttu-id="6452e-113">O mecanismo controla os eventos a serem gerados e as condições que devem ser atendidas para que um evento ocorra.</span><span class="sxs-lookup"><span data-stu-id="6452e-113">The engine controls which events to raise and what conditions must be met for an event to occur.</span></span>  
  
 <span data-ttu-id="6452e-114">Depois de associar a uma sessão de Eventos Estendidos, que anexa o destino ETW pela primeira vez durante o tempo de vida de um processo, o destino ETW abre uma única sessão ETW no provedor [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="6452e-114">After binding to an Extended Events session, which attaches the ETW target for the first time during the lifetime of a process, the ETW target opens a single ETW session on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider.</span></span> <span data-ttu-id="6452e-115">Se uma sessão ETW já existir, o destino ETW obterá uma referência para a sessão existente.</span><span class="sxs-lookup"><span data-stu-id="6452e-115">If an ETW session already exists, the ETW target obtains a reference to the existing session.</span></span> <span data-ttu-id="6452e-116">Essa sessão ETW é compartilhada por todas as instâncias do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] em um determinado computador.</span><span class="sxs-lookup"><span data-stu-id="6452e-116">This ETW session is shared across all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instances on a given computer.</span></span> <span data-ttu-id="6452e-117">Essa sessão ETW recebe todos os eventos de sessões que têm o destino ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-117">This ETW session receives all the events from sessions that have the ETW target.</span></span>  
  
 <span data-ttu-id="6452e-118">Como o ETW precisa de provedores para ser habilitado a consumir eventos e conduzi-los ao ETW, todos os pacotes de Eventos Estendidos são habilitados na sessão.</span><span class="sxs-lookup"><span data-stu-id="6452e-118">Because ETW needs providers to be enabled to consume events and flow them down to the ETW, all Extended Events packages are enabled on the session.</span></span> <span data-ttu-id="6452e-119">Quando um evento é disparado, o destino ETW envia o evento à sessão na qual o provedor do evento está habilitado.</span><span class="sxs-lookup"><span data-stu-id="6452e-119">When an event is fired, the ETW target sends the event to the session on which the provider for the event is enabled.</span></span>  
  
 <span data-ttu-id="6452e-120">O destino ETW oferece suporte à publicação síncrona de eventos no thread que gera o evento.</span><span class="sxs-lookup"><span data-stu-id="6452e-120">The ETW target supports synchronous publishing of events on the thread that raises the event.</span></span> <span data-ttu-id="6452e-121">No entanto, o destino ETW não oferece suporte à publicação assíncrona de eventos.</span><span class="sxs-lookup"><span data-stu-id="6452e-121">However, the ETW target does not support asynchronous event publishing.</span></span>  
  
 <span data-ttu-id="6452e-122">O destino ETW não permite controle de controladores ETW externos, como Logman.exe.</span><span class="sxs-lookup"><span data-stu-id="6452e-122">The ETW target does not support control from external ETW controllers such as Logman.exe.</span></span> <span data-ttu-id="6452e-123">Para gerar rastreamentos ETW, é necessário criar uma sessão de evento com o destino ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-123">To produce ETW traces, an event session must be created with the ETW target.</span></span> <span data-ttu-id="6452e-124">Para obter mais informações, veja [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6452e-124">For more information, see [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6452e-125">A habilitação do destino de ETW cria uma sessão de ETW denominada XE_DEFAULT_ETW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="6452e-125">Enabling the ETW target creates an ETW session that is named XE_DEFAULT_ETW_SESSION.</span></span> <span data-ttu-id="6452e-126">Se uma sessão com o nome XE_DEFAULT_ETW_SESSION já existir, ele será usado sem que nenhuma propriedade da sessão existente seja modificada.</span><span class="sxs-lookup"><span data-stu-id="6452e-126">If a session with the name XE_DEFAULT_ETW_SESSION already exists, it is used without modifying any properties of the existing session.</span></span> <span data-ttu-id="6452e-127">O XE_DEFAULT_ETW_SESSION é compartilhado entre todas as instâncias do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6452e-127">The XE_DEFAULT_ETW_SESSION is shared between all instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="6452e-128">Depois de iniciar o XE_DEFAULT_ETW_SESSION, você deve pará-lo usando um controlador de ETW, como a ferramenta Logman.</span><span class="sxs-lookup"><span data-stu-id="6452e-128">After you start the XE_DEFAULT_ETW_SESSION, you must stop it by using an ETW controller, such as the Logman tool.</span></span> <span data-ttu-id="6452e-129">Por exemplo, você pode executar o seguinte comando no prompt de comando: `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span><span class="sxs-lookup"><span data-stu-id="6452e-129">For example, you can run the following command at the command prompt: `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span></span>  
  
 <span data-ttu-id="6452e-130">A tabela a seguir descreve as opções disponíveis para configuração do destino de ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-130">The following table describes the available options for configuring the ETW target.</span></span>  
  
|<span data-ttu-id="6452e-131">Opção</span><span class="sxs-lookup"><span data-stu-id="6452e-131">Option</span></span>|<span data-ttu-id="6452e-132">Valores permitidos</span><span class="sxs-lookup"><span data-stu-id="6452e-132">Allowed values</span></span>|<span data-ttu-id="6452e-133">Descrição</span><span class="sxs-lookup"><span data-stu-id="6452e-133">Description</span></span>|  
|------------|--------------------|-----------------|  
|<span data-ttu-id="6452e-134">default_xe_session_name</span><span class="sxs-lookup"><span data-stu-id="6452e-134">default_xe_session_name</span></span>|<span data-ttu-id="6452e-135">Qualquer cadeia de caracteres até 256 caracteres.</span><span class="sxs-lookup"><span data-stu-id="6452e-135">Any string up to 256 characters.</span></span> <span data-ttu-id="6452e-136">Esse valor é opcional.</span><span class="sxs-lookup"><span data-stu-id="6452e-136">This value is optional.</span></span>|<span data-ttu-id="6452e-137">O nome da sessão de Eventos Estendidos.</span><span class="sxs-lookup"><span data-stu-id="6452e-137">The Extended Events session name.</span></span> <span data-ttu-id="6452e-138">Por padrão, este é XE_DEFAULT_ETW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="6452e-138">By default, this is XE_DEFAULT_ETW_SESSION.</span></span>|  
|<span data-ttu-id="6452e-139">default_etw_session_logfile_path</span><span class="sxs-lookup"><span data-stu-id="6452e-139">default_etw_session_logfile_path</span></span>|<span data-ttu-id="6452e-140">Qualquer cadeia de caracteres até 256 caracteres.</span><span class="sxs-lookup"><span data-stu-id="6452e-140">Any string up to 256 characters.</span></span> <span data-ttu-id="6452e-141">Esse valor é opcional.</span><span class="sxs-lookup"><span data-stu-id="6452e-141">This value is optional.</span></span>|<span data-ttu-id="6452e-142">O caminho para o arquivo de log da sessão de Eventos Estendidos.</span><span class="sxs-lookup"><span data-stu-id="6452e-142">The path of the log file for the Extended Events session.</span></span> <span data-ttu-id="6452e-143">Por padrão, esse é % TEMP% \ XEEtw.etl.</span><span class="sxs-lookup"><span data-stu-id="6452e-143">By default, this is %TEMP%\ XEEtw.etl.</span></span>|  
|<span data-ttu-id="6452e-144">default_etw_session_logfile_size_mb</span><span class="sxs-lookup"><span data-stu-id="6452e-144">default_etw_session_logfile_size_mb</span></span>|<span data-ttu-id="6452e-145">Qualquer inteiro não atribuído.</span><span class="sxs-lookup"><span data-stu-id="6452e-145">Any unsigned integer.</span></span> <span data-ttu-id="6452e-146">Esse valor é opcional.</span><span class="sxs-lookup"><span data-stu-id="6452e-146">This value is optional.</span></span>|<span data-ttu-id="6452e-147">O tamanho do arquivo de log, em megabytes (MB), para a sessão de Eventos Estendidos.</span><span class="sxs-lookup"><span data-stu-id="6452e-147">The log file size, in megabytes (MB), for the Extended Events session.</span></span> <span data-ttu-id="6452e-148">O padrão é 20 MB.</span><span class="sxs-lookup"><span data-stu-id="6452e-148">The default is 20 MB.</span></span>|  
|<span data-ttu-id="6452e-149">default_etw_session_buffer_size_kb</span><span class="sxs-lookup"><span data-stu-id="6452e-149">default_etw_session_buffer_size_kb</span></span>|<span data-ttu-id="6452e-150">Qualquer inteiro não atribuído.</span><span class="sxs-lookup"><span data-stu-id="6452e-150">Any unsigned integer.</span></span> <span data-ttu-id="6452e-151">Esse valor é opcional.</span><span class="sxs-lookup"><span data-stu-id="6452e-151">This value is optional.</span></span>|<span data-ttu-id="6452e-152">O tamanho do buffer na memória, em kilobytes (KB), para a sessão de Eventos Estendidos.</span><span class="sxs-lookup"><span data-stu-id="6452e-152">The in-memory buffer size, in kilobytes (KB), for the Extended Events session.</span></span> <span data-ttu-id="6452e-153">O padrão é 128 KB.</span><span class="sxs-lookup"><span data-stu-id="6452e-153">The default is 128 KB.</span></span>|  
|<span data-ttu-id="6452e-154">retries</span><span class="sxs-lookup"><span data-stu-id="6452e-154">retries</span></span>|<span data-ttu-id="6452e-155">Qualquer inteiro não atribuído.</span><span class="sxs-lookup"><span data-stu-id="6452e-155">Any unsigned integer.</span></span>|<span data-ttu-id="6452e-156">O número de vezes para tentar publicar novamente o evento no subsistema ETW antes de descartar o evento.</span><span class="sxs-lookup"><span data-stu-id="6452e-156">The number of times to retry publishing the event to the ETW subsystem before dropping the event.</span></span> <span data-ttu-id="6452e-157">O padrão é 0.</span><span class="sxs-lookup"><span data-stu-id="6452e-157">The default is 0.</span></span>|  
  
 <span data-ttu-id="6452e-158">A configuração dessas definições precedentes é opcional.</span><span class="sxs-lookup"><span data-stu-id="6452e-158">Configuring these settings is optional.</span></span> <span data-ttu-id="6452e-159">O destino ETW usa valores padrão para essas configurações.</span><span class="sxs-lookup"><span data-stu-id="6452e-159">The ETW target uses default values for these settings.</span></span>  
  
 <span data-ttu-id="6452e-160">O destino ETW é responsável por:</span><span class="sxs-lookup"><span data-stu-id="6452e-160">The ETW target is responsible for:</span></span>  
  
-   <span data-ttu-id="6452e-161">Criar a sessão ETW padrão.</span><span class="sxs-lookup"><span data-stu-id="6452e-161">Creating the default ETW session.</span></span>  
  
-   <span data-ttu-id="6452e-162">Registrar todos os pacotes de Eventos Estendidos com o ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-162">Registering all Extended Events packages with ETW.</span></span> <span data-ttu-id="6452e-163">Isso assegura que os eventos não sejam descartados pelo ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-163">This ensures that events are not dropped by ETW.</span></span>  
  
-   <span data-ttu-id="6452e-164">Gerenciar o fluxo de eventos para o ETW.</span><span class="sxs-lookup"><span data-stu-id="6452e-164">Managing the flow of events to ETW.</span></span> <span data-ttu-id="6452e-165">O destino ETW cria um evento ETW com os dados de Eventos Estendidos e o envia para a sessão ETW apropriada.</span><span class="sxs-lookup"><span data-stu-id="6452e-165">The ETW target creates an ETW event with Extended Events data and sends it to the appropriate ETW session.</span></span> <span data-ttu-id="6452e-166">Se o evento for maior do que o tamanho do buffer, ou os dados não se encaixarem em um evento ETW, o ETW dividirá o evento em fragmentos.</span><span class="sxs-lookup"><span data-stu-id="6452e-166">If the event is larger than the buffer size, or data cannot fit in one ETW event, ETW splits the event into fragments.</span></span>  
  
-   <span data-ttu-id="6452e-167">Manter os pacotes de Eventos Estendidos habilitados o tempo todo.</span><span class="sxs-lookup"><span data-stu-id="6452e-167">Keeping Extended Events packages enabled at all times.</span></span>  
  
 <span data-ttu-id="6452e-168">Os locais de arquivo padrão seguintes são usados pelo ETW:</span><span class="sxs-lookup"><span data-stu-id="6452e-168">The following default file locations are used by ETW:</span></span>  
  
-   <span data-ttu-id="6452e-169">O arquivo de saída ETW está em %TEMP%\XEEtw.etl.</span><span class="sxs-lookup"><span data-stu-id="6452e-169">The ETW output file is in %TEMP%\XEEtw.etl.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6452e-170">O caminho do arquivo não pode ser alterado depois que a sessão for iniciada.</span><span class="sxs-lookup"><span data-stu-id="6452e-170">The file path cannot be changed after the first session starts.</span></span>  
  
-   <span data-ttu-id="6452e-171">Os arquivos MOF (Managed Object Format) estão em *\<your install path>* \Microsoft SQL Server\Shared.</span><span class="sxs-lookup"><span data-stu-id="6452e-171">Managed Object Format (MOF) files are in *\<your install path>* \Microsoft SQL Server\Shared.</span></span> <span data-ttu-id="6452e-172">Para obter mais informações, veja [Managed Object Format](https://go.microsoft.com/fwlink/?LinkId=92851) no MSDN.</span><span class="sxs-lookup"><span data-stu-id="6452e-172">For more information, see [Managed Object Format](https://go.microsoft.com/fwlink/?LinkId=92851) on MSDN.</span></span>  
  
## <a name="adding-the-target-to-a-session"></a><span data-ttu-id="6452e-173">Adicionando o destino a uma sessão</span><span class="sxs-lookup"><span data-stu-id="6452e-173">Adding the Target to a Session</span></span>  
 <span data-ttu-id="6452e-174">Para adicionar o destino de ETW a uma sessão de Eventos Estendidos, você deve incluir a instrução a seguir ao criar ou alterar uma sessão de evento:</span><span class="sxs-lookup"><span data-stu-id="6452e-174">To add the ETW target to an Extended Events session, you must include the following statement when you create or alter an event session:</span></span>  
  
```  
ADD TARGET package0.etw_classic_sync_target  
```  
  
 <span data-ttu-id="6452e-175">Para obter mais informações sobre um exemplo completo que mostra como usar o destino ETW, inclusive como exibir os dados, veja [Monitorar a atividade do sistema usando Eventos Estendidos](monitor-system-activity-using-extended-events.md).</span><span class="sxs-lookup"><span data-stu-id="6452e-175">For more information about a full example that shows how to use the ETW target, including how to view the data, see [Monitor System Activity Using Extended Events](monitor-system-activity-using-extended-events.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6452e-176">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="6452e-176">See Also</span></span>  
 <span data-ttu-id="6452e-177">[Destinos de eventos estendidos do SQL Server](../../database-engine/sql-server-extended-events-targets.md) </span><span class="sxs-lookup"><span data-stu-id="6452e-177">[SQL Server Extended Events Targets](../../database-engine/sql-server-extended-events-targets.md) </span></span>  
 <span data-ttu-id="6452e-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="6452e-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span></span>  
 <span data-ttu-id="6452e-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="6452e-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span></span>  
 [<span data-ttu-id="6452e-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="6452e-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
