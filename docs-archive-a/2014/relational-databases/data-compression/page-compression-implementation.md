---
title: Implementação da compactação de página | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- page compression [Database Engine]
- compression [SQL Server], page
ms.assetid: 78c83277-1dbb-4e07-95bd-47b14d2b5cd4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: e6edba79d1548d68e60f406d370abd5354a62fcb
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87581943"
---
# <a name="page-compression-implementation"></a><span data-ttu-id="4c2b7-102">Implementação da compactação de página</span><span class="sxs-lookup"><span data-stu-id="4c2b7-102">Page Compression Implementation</span></span>
  <span data-ttu-id="4c2b7-103">Este tópico resume como o [!INCLUDE[ssDE](../../includes/ssde-md.md)] implementa a compactação de página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-103">This topic summarizes how the [!INCLUDE[ssDE](../../includes/ssde-md.md)] implements page compression.</span></span> <span data-ttu-id="4c2b7-104">Este resumo fornece informações básicas para ajudar no planejamento do espaço de armazenamento exigido pelos dados.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-104">This summary provides basic information to help you plan the storage space that you need for your data.</span></span>  
  
 <span data-ttu-id="4c2b7-105">A compactação de página é semelhante para tabelas, partições de tabela, índices e partições de índice.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-105">Page compression is similar for tables, table partitions, indexes, and index partitions.</span></span> <span data-ttu-id="4c2b7-106">A descrição a seguir de compactação de página para uma tabela se aplica à compactação de página de todos os tipos de objeto.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-106">The following description of page compression for a table applies equally to page compression for all object types.</span></span> <span data-ttu-id="4c2b7-107">Os exemplos a seguir compactam cadeias de caracteres, mas a compactação de prefixo e dicionário segue os mesmos princípios para outros tipos de dados.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-107">The following examples compress character strings, but both prefix and dictionary compression apply the same principles to other data types.</span></span>  
  
 <span data-ttu-id="4c2b7-108">A compactação do nível folha de tabelas e índices usando a compactação de página consiste em três operações nesta ordem:</span><span class="sxs-lookup"><span data-stu-id="4c2b7-108">Compressing the leaf level of tables and indexes with page compression consists of three operations in the following order:</span></span>  
  
1.  <span data-ttu-id="4c2b7-109">Compactação de linha</span><span class="sxs-lookup"><span data-stu-id="4c2b7-109">Row compression</span></span>  
  
2.  <span data-ttu-id="4c2b7-110">Compactação de prefixo</span><span class="sxs-lookup"><span data-stu-id="4c2b7-110">Prefix compression</span></span>  
  
3.  <span data-ttu-id="4c2b7-111">Compactação de dicionário</span><span class="sxs-lookup"><span data-stu-id="4c2b7-111">Dictionary compression</span></span>  
  
 <span data-ttu-id="4c2b7-112">Quando você usa a compactação de página, as páginas do nível não folha dos índices são compactadas usando apenas a compactação de linha.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-112">When you use page compression, non-leaf-level pages of indexes are compressed by using only row compression.</span></span> <span data-ttu-id="4c2b7-113">Para obter mais informações sobre compactação de linha, veja [Implementação da compactação de linha](../data-compression/row-compression-implementation.md).</span><span class="sxs-lookup"><span data-stu-id="4c2b7-113">For more information about row compression, see [Row Compression Implementation](../data-compression/row-compression-implementation.md).</span></span>  
  
## <a name="prefix-compression"></a><span data-ttu-id="4c2b7-114">Compactação de prefixo</span><span class="sxs-lookup"><span data-stu-id="4c2b7-114">Prefix Compression</span></span>  
 <span data-ttu-id="4c2b7-115">Para cada página que está sendo compactada, a compactação de prefixo usa estas etapas:</span><span class="sxs-lookup"><span data-stu-id="4c2b7-115">For each page that is being compressed, prefix compression uses the following steps:</span></span>  
  
1.  <span data-ttu-id="4c2b7-116">Para cada coluna, é identificado um valor que pode ser usado para reduzir o espaço de armazenamento para os valores de cada coluna.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-116">For each column, a value is identified that can be used to reduce the storage space for the values in each column.</span></span>  
  
2.  <span data-ttu-id="4c2b7-117">Uma linha que representa os valores de prefixo de cada coluna é criada e armazenada em uma estrutura CI (informações de compactação) que segue imediatamente o cabeçalho da página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-117">A row that represents the prefix values for each column is created and stored in the compression information (CI) structure that immediately follows the page header.</span></span>  
  
3.  <span data-ttu-id="4c2b7-118">Os valores de prefixo repetidos da coluna são substituídos por uma referência ao prefixo correspondente.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-118">The repeated prefix values in the column are replaced by a reference to the corresponding prefix.</span></span> <span data-ttu-id="4c2b7-119">Se o valor de uma linha não corresponder exatamente ao valor do prefixo selecionado, deverá ser indicada uma correspondência parcial.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-119">If the value in a row does not exactly match the selected prefix value, a partial match can still be indicated.</span></span>  
  
 <span data-ttu-id="4c2b7-120">A ilustração a seguir mostra um exemplo de página de uma tabela antes da compactação de prefixo.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-120">The following illustration shows a sample page of a table before prefix compression.</span></span>  
  
 <span data-ttu-id="4c2b7-121">![Página antes da compactação de prefixo](../media/skt-tblcompression1c.gif "Página antes da compactação de prefixo")</span><span class="sxs-lookup"><span data-stu-id="4c2b7-121">![Page before prefix compression](../media/skt-tblcompression1c.gif "Page before prefix compression")</span></span>  
  
 <span data-ttu-id="4c2b7-122">A ilustração a seguir mostra a mesma página após a compactação de prefixo.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-122">The following illustration shows the same page after prefix compression.</span></span> <span data-ttu-id="4c2b7-123">O prefixo é movido para o cabeçalho e os valores da coluna são alterados para referências ao prefixo.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-123">The prefix is moved to the header, and the column values are changed to references to the prefix.</span></span>  
  
 <span data-ttu-id="4c2b7-124">![Página após compactação de prefixo](../media/tblcompression2.gif "Página após compactação de prefixo")</span><span class="sxs-lookup"><span data-stu-id="4c2b7-124">![Page after prefix compression](../media/tblcompression2.gif "Page after prefix compression")</span></span>  
  
 <span data-ttu-id="4c2b7-125">Na primeira coluna da primeira linha, o valor 4b indica que os primeiros quatro caracteres do prefixo (aaab) estão presentes para essa linha, além do caractere b.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-125">In the first column of the first row, the value 4b indicates that the first four characters of the prefix (aaab) are present for that row, and also the character b.</span></span> <span data-ttu-id="4c2b7-126">Isso gera o valor resultante aaabb, que é o valor original.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-126">This makes the resultant value aaabb, which is the original value.</span></span>  
  
## <a name="dictionary-compression"></a><span data-ttu-id="4c2b7-127">Compactação de dicionário</span><span class="sxs-lookup"><span data-stu-id="4c2b7-127">Dictionary Compression</span></span>  
 <span data-ttu-id="4c2b7-128">Após a conclusão da compactação de prefixo, é aplicada a compactação de dicionário.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-128">After prefix compression has been completed, dictionary compression is applied.</span></span> <span data-ttu-id="4c2b7-129">A compactação de dicionário procura valores repetidos em qualquer lugar da página e os armazena na área de informações de compactação.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-129">Dictionary compression searches for repeated values anywhere on the page, and stores them in the CI area.</span></span> <span data-ttu-id="4c2b7-130">Diferentemente da compactação de prefixo, a compactação de dicionário não é restrita a uma coluna.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-130">Unlike prefix compression, dictionary compression is not restricted to one column.</span></span> <span data-ttu-id="4c2b7-131">A compactação de dicionário pode substituir valores repetidos que ocorrem em qualquer lugar de uma página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-131">Dictionary compression can replace repeated values that occur anywhere on a page.</span></span> <span data-ttu-id="4c2b7-132">A ilustração a seguir mostra a mesma página após a compactação de dicionário.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-132">The following illustration shows the same page after dictionary compression.</span></span>  
  
 <span data-ttu-id="4c2b7-133">![Página após compactação de dicionário](../media/tblcompression3.gif "Página após compactação de dicionário")</span><span class="sxs-lookup"><span data-stu-id="4c2b7-133">![Page after dictionary compression](../media/tblcompression3.gif "Page after dictionary compression")</span></span>  
  
 <span data-ttu-id="4c2b7-134">Observe que o valor 4b foi referenciado a partir de colunas diferentes da página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-134">Note that the value 4b has been referenced from different columns of the page.</span></span>  
  
## <a name="when-page-compression-occurs"></a><span data-ttu-id="4c2b7-135">Quando ocorre a compactação de página</span><span class="sxs-lookup"><span data-stu-id="4c2b7-135">When Page Compression Occurs</span></span>  
 <span data-ttu-id="4c2b7-136">Quando uma tabela é criada e possui compactação de página, não ocorre compactação.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-136">When a new table is created that has page compression, no compression occurs.</span></span> <span data-ttu-id="4c2b7-137">No entanto, os metadados da tabela indicam que a compactação de página deve ser usada.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-137">However, the metadata for the table indicates that page compression should be used.</span></span> <span data-ttu-id="4c2b7-138">Como os dados são adicionados à primeira página de dados, os dados são compactados por linha.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-138">As data is added to the first data page, data is row-compressed.</span></span> <span data-ttu-id="4c2b7-139">Como a página não está cheia, não há benefício decorrente da compactação de página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-139">Because the page is not full, no benefit is gained from page compression.</span></span> <span data-ttu-id="4c2b7-140">Quando a página está cheia, a próxima linha a ser adicionada inicia a operação de compactação de página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-140">When the page is full, the next row to be added initiates the page compression operation.</span></span> <span data-ttu-id="4c2b7-141">A página inteira é revisada; cada coluna é avaliada para compactação de prefixo e, em seguida, todas as colunas são avaliadas para confirmar se a compactação de dicionário é necessária.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-141">The whole page is reviewed; each column is evaluated for prefix compression, and then all columns are evaluated for dictionary compression.</span></span> <span data-ttu-id="4c2b7-142">Se a compactação de página tiver criado espaço suficiente na página para uma linha adicional, a linha será adicionada e os dados serão compactados por linha e página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-142">If page compression has created enough room on the page for an additional row, the row is added, and the data is both row- and page-compressed.</span></span> <span data-ttu-id="4c2b7-143">Se o espaço obtido pela compactação de página menos o espaço exigido para a estrutura de informações de compactação não for significativo, a compactação de página não será usada nessa página.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-143">If the space gained by page compression minus the space that is required for the CI structure is not significant, page compression is not used for that page.</span></span> <span data-ttu-id="4c2b7-144">As linhas futuras serão ajustadas à nova página ou, se não couberem, uma nova página será adicionada à tabela.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-144">Future rows either fit onto the new page or, if they do not fit, a new page is added to the table.</span></span> <span data-ttu-id="4c2b7-145">Semelhante à primeira página, a nova página não estará na primeira página compactada.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-145">Similar to the first page, the new page is not at first page-compressed.</span></span>  
  
 <span data-ttu-id="4c2b7-146">Quando uma tabela existente que contém dados for convertida para compactação de página, cada página será recriada e avaliada.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-146">When an existing table that contains data is converted to page compression, each page is rebuilt and evaluated.</span></span> <span data-ttu-id="4c2b7-147">A recriação de todas as páginas causará a recriação da tabela, do índice ou da partição.</span><span class="sxs-lookup"><span data-stu-id="4c2b7-147">Rebuilding all the pages causes the rebuilding of the table, index, or partition.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4c2b7-148">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="4c2b7-148">See Also</span></span>  
 <span data-ttu-id="4c2b7-149">[Compactação de dados](data-compression.md) </span><span class="sxs-lookup"><span data-stu-id="4c2b7-149">[Data Compression](data-compression.md) </span></span>  
 [<span data-ttu-id="4c2b7-150">Implementação da compactação de linha</span><span class="sxs-lookup"><span data-stu-id="4c2b7-150">Row Compression Implementation</span></span>](row-compression-implementation.md)  
  
  
