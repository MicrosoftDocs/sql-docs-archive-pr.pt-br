---
title: Pontos de verificação de banco de dados (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 10/13/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- automatic checkpoints
- transaction logs [SQL Server], checkpoints
- logs [SQL Server], active
- pages [SQL Server], dirty
- MinLSN
- checkpoints [SQL Server]
- pages [SQL Server], flushing
- dirty pages
- transaction logs [SQL Server], active logs
- recovery interval option [SQL Server]
- buffer cache [SQL Server]
- logs [SQL Server], checkpoints
- Minimum Recovery LSN
- flushing pages
- active logs
ms.assetid: 98a80238-7409-4708-8a7d-5defd9957185
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 5776d4a23223637c50ac40098fa44342d5cd94a9
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572546"
---
# <a name="database-checkpoints-sql-server"></a><span data-ttu-id="f9291-102">Pontos de verificação de banco de dados (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="f9291-102">Database Checkpoints (SQL Server)</span></span>
  <span data-ttu-id="f9291-103">Este tópico fornece uma visão geral dos pontos de verificação de banco de dados [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f9291-103">This topic provides an overview of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database checkpoints.</span></span> <span data-ttu-id="f9291-104">Um *ponto de verificação* cria um bom ponto conhecido a partir do qual o [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] pode começar a aplicar as alterações contidas no log durante a recuperação após um desligamento ou uma falha inesperada.</span><span class="sxs-lookup"><span data-stu-id="f9291-104">A *checkpoint* creates a known good point from which the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] can start applying changes contained in the log during recovery after an unexpected shutdown or crash.</span></span>  
  
  
##  <a name="overview-of-checkpoints"></a><a name="Overview"></a><span data-ttu-id="f9291-105">Visão geral dos pontos de verificação</span><span class="sxs-lookup"><span data-stu-id="f9291-105">Overview of Checkpoints</span></span>  
 <span data-ttu-id="f9291-106">Por razões de desempenho, o [!INCLUDE[ssDE](../../includes/ssde-md.md)] executa modificações nas páginas de banco de dados, no cache do buffer e não grava essas páginas em disco após cada alteração.</span><span class="sxs-lookup"><span data-stu-id="f9291-106">For performance reasons, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] performs modifications to database pages in memory-in the buffer cache-and does not write these pages to disk after every change.</span></span> <span data-ttu-id="f9291-107">Em vez disso, o [!INCLUDE[ssDE](../../includes/ssde-md.md)] emite um ponto de verificação periodicamente em cada banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-107">Rather, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] periodically issues a checkpoint on each database.</span></span> <span data-ttu-id="f9291-108">Um *ponto de verificação* grava as páginas atuais modificadas na memória (conhecidas como *páginas sujas*) e as informações do log de transações de memória para disco e, além disso, registra informações sobre o log de transações.</span><span class="sxs-lookup"><span data-stu-id="f9291-108">A *checkpoint* writes the current in-memory modified pages (known as *dirty pages*) and transaction log information from memory to disk and, also, records information about the transaction log.</span></span>  
  
 <span data-ttu-id="f9291-109">O [!INCLUDE[ssDE](../../includes/ssde-md.md)] oferece suporte para vários tipos de pontos de verificação: automáticos, indiretos, manuais e internos.</span><span class="sxs-lookup"><span data-stu-id="f9291-109">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] supports several types of checkpoints: automatic, indirect, manual, and internal.</span></span> <span data-ttu-id="f9291-110">A tabela a seguir resume os tipos de pontos de verificação.</span><span class="sxs-lookup"><span data-stu-id="f9291-110">The following table summarizes the types of checkpoints.</span></span>  
  
|<span data-ttu-id="f9291-111">Nome</span><span class="sxs-lookup"><span data-stu-id="f9291-111">Name</span></span>|[!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="f9291-112">Interface</span><span class="sxs-lookup"><span data-stu-id="f9291-112">Interface</span></span>|<span data-ttu-id="f9291-113">Descrição</span><span class="sxs-lookup"><span data-stu-id="f9291-113">Description</span></span>|  
|----------|----------------------------------|-----------------|  
|<span data-ttu-id="f9291-114">Automático</span><span class="sxs-lookup"><span data-stu-id="f9291-114">Automatic</span></span>|<span data-ttu-id="f9291-115">EXEC sp_configure **' `recovery interval` ', ' *`seconds`* '**</span><span class="sxs-lookup"><span data-stu-id="f9291-115">EXEC sp_configure **'`recovery interval`','*`seconds`*'**</span></span>|<span data-ttu-id="f9291-116">Emitido automaticamente em segundo plano para atender ao limite de tempo superior sugerido pela `recovery interval` opção de configuração de servidor.</span><span class="sxs-lookup"><span data-stu-id="f9291-116">Issued automatically in the background to meet the upper time limit suggested by the `recovery interval` server configuration option.</span></span> <span data-ttu-id="f9291-117">Pontos de verificação automáticos executados até a conclusão.</span><span class="sxs-lookup"><span data-stu-id="f9291-117">Automatic checkpoints run to completion.</span></span>  <span data-ttu-id="f9291-118">Os pontos de verificação automáticos são acelerados com base no número de gravações pendentes e se o [!INCLUDE[ssDE](../../includes/ssde-md.md)] detecta um aumento na latência de gravação acima de 20 milissegundos.</span><span class="sxs-lookup"><span data-stu-id="f9291-118">Automatic checkpoints are throttled based on the number of outstanding writes and whether the [!INCLUDE[ssDE](../../includes/ssde-md.md)] detects an increase in write latency above 20 milliseconds.</span></span><br /><br /> <span data-ttu-id="f9291-119">Para obter mais informações, consulte [Configure the recovery interval Server Configuration Option](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="f9291-119">For more information, see [Configure the recovery interval Server Configuration Option](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md).</span></span>|  
|<span data-ttu-id="f9291-120">Indireto.</span><span class="sxs-lookup"><span data-stu-id="f9291-120">Indirect</span></span>|<span data-ttu-id="f9291-121">ALTERAR BANCO DE DADOS... DEFINIR TARGET_RECOVERY_TIME **=** _target_recovery_time_ {segundos &#124; minutos}</span><span class="sxs-lookup"><span data-stu-id="f9291-121">ALTER DATABASE ... SET TARGET_RECOVERY_TIME **=**_target_recovery_time_ { SECONDS &#124; MINUTES }</span></span>|<span data-ttu-id="f9291-122">Emitido em segundo plano para cumprir um horário de recuperação de destino especificado pelo usuário para um determinado banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-122">Issued in the background to meet a user-specified target recovery time for a given database.</span></span> <span data-ttu-id="f9291-123">A hora de recuperação de destino padrão é 0, o que faz com que a heurística de ponto de verificação automático seja usada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-123">The default target recovery time is 0, which causes automatic checkpoint heuristics to be used on the database.</span></span> <span data-ttu-id="f9291-124">Se você usou ALTER DATABASE para definir TARGET_RECOVERY_TIME a >0, esse valor será usado, em vez do intervalo de recuperação especificado para a instância do servidor.</span><span class="sxs-lookup"><span data-stu-id="f9291-124">If you have used ALTER DATABASE to set TARGET_RECOVERY_TIME to >0, this value is used, rather than the recovery interval specified for the server instance.</span></span><br /><br /> <span data-ttu-id="f9291-125">Para obter mais informações, veja [Alterar o tempo de recuperação de destino de um banco de dados &#40;SQL Server&#41;](change-the-target-recovery-time-of-a-database-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f9291-125">For more information, see [Change the Target Recovery Time of a Database &#40;SQL Server&#41;](change-the-target-recovery-time-of-a-database-sql-server.md).</span></span>|  
|<span data-ttu-id="f9291-126">Manual</span><span class="sxs-lookup"><span data-stu-id="f9291-126">Manual</span></span>|<span data-ttu-id="f9291-127">CHECKPOINT [ *checkpoint_duration* ]</span><span class="sxs-lookup"><span data-stu-id="f9291-127">CHECKPOINT [ *checkpoint_duration* ]</span></span>|<span data-ttu-id="f9291-128">Emitido quando você executa um comando [!INCLUDE[tsql](../../includes/tsql-md.md)] CHECKPOINT.</span><span class="sxs-lookup"><span data-stu-id="f9291-128">Issued when you execute a [!INCLUDE[tsql](../../includes/tsql-md.md)] CHECKPOINT command.</span></span> <span data-ttu-id="f9291-129">O ponto de verificação manual ocorre no banco de dados atual para sua conexão.</span><span class="sxs-lookup"><span data-stu-id="f9291-129">The manual checkpoint occurs in the current database for your connection.</span></span> <span data-ttu-id="f9291-130">Por padrão, pontos de verificação manuais são executados até a conclusão.</span><span class="sxs-lookup"><span data-stu-id="f9291-130">By default, manual checkpoints run to completion.</span></span> <span data-ttu-id="f9291-131">A aceleração funciona da mesma forma que para pontos de verificação automáticos.</span><span class="sxs-lookup"><span data-stu-id="f9291-131">Throttling works the same way as for automatic checkpoints.</span></span>  <span data-ttu-id="f9291-132">Opcionalmente, o parâmetro *checkpoint_duration* especifica a quantidade de tempo solicitada, em segundos, para a conclusão do ponto de verificação.</span><span class="sxs-lookup"><span data-stu-id="f9291-132">Optionally, the *checkpoint_duration* parameter specifies a requested amount of time, in seconds, for the checkpoint to complete.</span></span><br /><br /> <span data-ttu-id="f9291-133">Para obter mais informações, consulte [CHECKPOINT &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/checkpoint-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f9291-133">For more information, see [CHECKPOINT &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/checkpoint-transact-sql).</span></span>|  
|<span data-ttu-id="f9291-134">Interna</span><span class="sxs-lookup"><span data-stu-id="f9291-134">Internal</span></span>|<span data-ttu-id="f9291-135">Nenhum.</span><span class="sxs-lookup"><span data-stu-id="f9291-135">None.</span></span>|<span data-ttu-id="f9291-136">Emitido por várias operações de servidor, como backup e criação de instantâneo de banco de dados, para garantir que as imagens de disco coincidam com o estado atual do log.</span><span class="sxs-lookup"><span data-stu-id="f9291-136">Issued by various server operations such as backup and database-snapshot creation to guarantee that disk images match the current state of the log.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="f9291-137">A opção de configuração avançada `-k`[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] permite a um administrador de banco de dados acelerar o comportamento de E/S de ponto de verificação com base na taxa de transferência do subsistema de E/S de alguns tipos de pontos de verificação.</span><span class="sxs-lookup"><span data-stu-id="f9291-137">The `-k`[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] advanced setup option enables a database administrator to throttle checkpoint I/O behavior based on the throughput of the I/O subsystem for some types of checkpoints.</span></span> <span data-ttu-id="f9291-138">A `-k` opção de configuração se aplica a pontos de verificação automáticos e a qualquer outro ponto de verificação manual e interno que não seja limitado.</span><span class="sxs-lookup"><span data-stu-id="f9291-138">The `-k` setup option applies to automatic checkpoints and any otherwise unthrottled manual and internal checkpoints.</span></span>  
  
 <span data-ttu-id="f9291-139">Para pontos de verificação automáticos, manuais e internos, somente as modificações feitas após o último ponto de verificação devem passar por roll forward durante a recuperação de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-139">For automatic, manual, and internal checkpoints, only modifications made after the latest checkpoint need to be rolled forward during database recovery.</span></span> <span data-ttu-id="f9291-140">Isso reduz o tempo necessário para recuperar um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-140">This reduces the time required to recover a database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f9291-141">Transações não confirmadas de execução longa aumentam o tempo de recuperação para todos os tipos de pontos de verificação.</span><span class="sxs-lookup"><span data-stu-id="f9291-141">Long-running uncommitted transactions increase recovery time for all types of checkpoints.</span></span>  
  
  
  
###  <a name="interaction-of-the-target_recovery_time-and-recovery-interval-options"></a><a name="InteractionBwnSettings"></a> <span data-ttu-id="f9291-142">Interação de TARGET_RECOVERY_TIME e opções 'recovery interval'</span><span class="sxs-lookup"><span data-stu-id="f9291-142">Interaction of the TARGET_RECOVERY_TIME and 'recovery interval' Options</span></span>  
 <span data-ttu-id="f9291-143">A tabela a seguir resume a interação entre a configuração de \*\*sp_configure `recovery interval` \*\* de todo o servidor e o ALTER DATABASE específico do banco de dados... Configuração de TARGET_RECOVERY_TIME.</span><span class="sxs-lookup"><span data-stu-id="f9291-143">The following table summarizes the interaction between the server-wide **sp_configure'`recovery interval`'** setting and the database-specific ALTER DATABASE ... TARGET_RECOVERY_TIME setting.</span></span>  
  
|<span data-ttu-id="f9291-144">target_recovery_time</span><span class="sxs-lookup"><span data-stu-id="f9291-144">TARGET_RECOVERY_TIME</span></span>|<span data-ttu-id="f9291-145">'recovery interval'</span><span class="sxs-lookup"><span data-stu-id="f9291-145">'recovery interval'</span></span>|<span data-ttu-id="f9291-146">Tipo de ponto de verificação usado</span><span class="sxs-lookup"><span data-stu-id="f9291-146">Type of Checkpoint Used</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="f9291-147">0</span><span class="sxs-lookup"><span data-stu-id="f9291-147">0</span></span>|<span data-ttu-id="f9291-148">0</span><span class="sxs-lookup"><span data-stu-id="f9291-148">0</span></span>|<span data-ttu-id="f9291-149">pontos de verificação automáticos cujo intervalo de recuperação de destino é 1 minuto.</span><span class="sxs-lookup"><span data-stu-id="f9291-149">automatic checkpoints whose target recovery interval is 1 minute.</span></span>|  
|<span data-ttu-id="f9291-150">0</span><span class="sxs-lookup"><span data-stu-id="f9291-150">0</span></span>|<span data-ttu-id="f9291-151">>0</span><span class="sxs-lookup"><span data-stu-id="f9291-151">>0</span></span>|<span data-ttu-id="f9291-152">Pontos de verificação automáticos, cujo intervalo de recuperação de destino é especificado pela configuração definida pelo usuário na opção **sp_configurerecovery interval**.</span><span class="sxs-lookup"><span data-stu-id="f9291-152">Automatic checkpoints whose target recovery interval is specified by the user defined setting of the **sp_configurerecovery interval** option.</span></span>|  
|<span data-ttu-id="f9291-153">>0</span><span class="sxs-lookup"><span data-stu-id="f9291-153">>0</span></span>|<span data-ttu-id="f9291-154">Não aplicável.</span><span class="sxs-lookup"><span data-stu-id="f9291-154">Not applicable.</span></span>|<span data-ttu-id="f9291-155">Pontos de verificação indiretos cuja hora de recuperação de destino é determinada pela configuração de TARGET_RECOVERY_TIME, expressa em segundos.</span><span class="sxs-lookup"><span data-stu-id="f9291-155">Indirect checkpoints whose target recovery time is determined by the TARGET_RECOVERY_TIME setting, expressed in seconds.</span></span>|  
  
###  <a name="automatic-checkpoints"></a><a name="AutomaticChkpt"></a><span data-ttu-id="f9291-156">Pontos de verificação automáticos</span><span class="sxs-lookup"><span data-stu-id="f9291-156">Automatic Checkpoints</span></span>  
 <span data-ttu-id="f9291-157">Um ponto de verificação automático ocorre cada vez que o número de registros de log atinge o número que as [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimativas podem processar durante o tempo especificado na `recovery interval` opção de configuração de servidor.</span><span class="sxs-lookup"><span data-stu-id="f9291-157">An automatic checkpoint occurs each time that  the number of log records reaches the number the [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimates it can process during the time specified in the `recovery interval` server configuration option.</span></span> <span data-ttu-id="f9291-158">Em todo banco de dados sem uma hora de recuperação de destino definida pelo usuário, o [!INCLUDE[ssDE](../../includes/ssde-md.md)] gera pontos de verificação automáticos.</span><span class="sxs-lookup"><span data-stu-id="f9291-158">In every database without a user-defined target recovery time, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] generates automatic checkpoints.</span></span> <span data-ttu-id="f9291-159">A frequência dos pontos de verificação automáticos depende da `recovery interval` opção de configuração de servidor avançado, que especifica o tempo máximo que uma determinada instância de servidor deve usar para recuperar um banco de dados durante uma reinicialização do sistema.</span><span class="sxs-lookup"><span data-stu-id="f9291-159">The frequency of automatic checkpoints depends on the `recovery interval` advanced server configuration option, which specifies the maximum time that a given server instance should use to recover a database during a system restart.</span></span> <span data-ttu-id="f9291-160">O [!INCLUDE[ssDE](../../includes/ssde-md.md)] estima o número máximo de registros de log que pode processar no intervalo de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f9291-160">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimates the maximum number of log records it can process within the recovery interval.</span></span> <span data-ttu-id="f9291-161">Quando um banco de dados que está usando alcances de pontos de verificação automáticos atinge o número máximo de registros de log, o [!INCLUDE[ssDE](../../includes/ssde-md.md)] emite um ponto de verificação no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-161">When a database that is using automatic checkpoints reaches this maximum number of log records, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] issues an checkpoint on the database.</span></span> <span data-ttu-id="f9291-162">O intervalo de tempo entre pontos de verificação automáticos pode ser altamente variável.</span><span class="sxs-lookup"><span data-stu-id="f9291-162">The time interval between automatic checkpoints can be highly variable.</span></span> <span data-ttu-id="f9291-163">Um banco de dados com uma carga de trabalho de transações significativa terá mais pontos de verificação frequentes que um banco de dados usado principalmente para operações somente leitura.</span><span class="sxs-lookup"><span data-stu-id="f9291-163">A database with a substantial transaction workload will have more frequent checkpoints than a database that is used primarily for read-only operations.</span></span>  
  
 <span data-ttu-id="f9291-164">Além disso, no modelo de recuperação simples, um ponto de verificação automático também será enfileirado se o log se tornar 70% cheio.</span><span class="sxs-lookup"><span data-stu-id="f9291-164">Also, under the simple recovery model, an automatic checkpoint is also queued if the log becomes 70 percent full.</span></span>  
  
 <span data-ttu-id="f9291-165">No modelo de recuperação simples, a menos que algum fator esteja atrasando o truncamento do log, um ponto de verificação automático trunca a seção não usada do log de transações.</span><span class="sxs-lookup"><span data-stu-id="f9291-165">Under the simple recovery model, unless some factor is delaying log truncation, an automatic checkpoint truncates the unused section of the transaction log.</span></span> <span data-ttu-id="f9291-166">Em contrapartida, nos modelos de recuperação completo e bulk-logged, após o estabelecimento de uma cadeia de backup de log, os pontos de verificação automáticos não causam truncamento de log.</span><span class="sxs-lookup"><span data-stu-id="f9291-166">In contrast, under the full and bulk-logged recovery models, once a log backup chain has been established, automatic checkpoints do not cause log truncation.</span></span> <span data-ttu-id="f9291-167">Para obter mais informações, consulte [O log de transações &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f9291-167">For more information, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="f9291-168">Depois de uma falha do sistema, o tempo necessário para recuperar um determinado banco de dados depende muito da quantidade de E/S aleatória necessária para refazer páginas que estavam sujas no momento da falha.</span><span class="sxs-lookup"><span data-stu-id="f9291-168">After a system crash, the length of time required to recover a given database is largely dependent on the amount of random I/O needed to redo pages that were dirty at the time of the crash.</span></span> <span data-ttu-id="f9291-169">Isso significa que a `recovery interval` configuração não é confiável.</span><span class="sxs-lookup"><span data-stu-id="f9291-169">This means that the `recovery interval` setting is unreliable.</span></span> <span data-ttu-id="f9291-170">Não é possível determinar uma duração de recuperação precisa.</span><span class="sxs-lookup"><span data-stu-id="f9291-170">It cannot determine an accurate recovery duration.</span></span> <span data-ttu-id="f9291-171">Além disso, quando um ponto de verificação automático está em andamento, a atividade de E/S geral para os dados aumenta significativamente e de forma bastante imprevisível.</span><span class="sxs-lookup"><span data-stu-id="f9291-171">Furthermore, when an automatic checkpoint is in progress, the general I/O activity for data increases significantly and quite unpredictably.</span></span>  
  
  
####  <a name="impact-of-recovery-interval-on-recovery-performance"></a><a name="PerformanceImpact"></a><span data-ttu-id="f9291-172">Impacto do intervalo de recuperação no desempenho de recuperação</span><span class="sxs-lookup"><span data-stu-id="f9291-172">Impact of Recovery Interval on Recovery Performance</span></span>  
 <span data-ttu-id="f9291-173">Para um sistema OLTP (processamento de transações online) usando transações curtas, `recovery interval` é o fator primário que determina o tempo de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f9291-173">For an online transaction processing (OLTP) system using short transactions, `recovery interval` is the primary factor determining recovery time.</span></span> <span data-ttu-id="f9291-174">No entanto, a `recovery interval` opção não afeta o tempo necessário para desfazer uma transação de execução longa.</span><span class="sxs-lookup"><span data-stu-id="f9291-174">However, the `recovery interval` option does not affect the time required to undo a long-running transaction.</span></span> <span data-ttu-id="f9291-175">A recuperação de um banco de dados com uma transação de execução longa pode levar muito mais tempo do que o especificado na `recovery interval` opção.</span><span class="sxs-lookup"><span data-stu-id="f9291-175">Recovery of a database with a long-running transaction can take much longer than the specified in the `recovery interval` option.</span></span> <span data-ttu-id="f9291-176">Por exemplo, se uma transação de execução longa levou duas horas para executar atualizações antes que a instância do servidor fosse desabilitada, a recuperação real leva consideravelmente mais tempo do que o `recovery interval` valor para recuperar a transação longa.</span><span class="sxs-lookup"><span data-stu-id="f9291-176">For example, if a long-running transaction took two hours to perform updates before the server instance became disabled, the actual recovery takes considerably longer than the `recovery interval` value to recover the long transaction.</span></span> <span data-ttu-id="f9291-177">Para obter mais informações sobre o impacto de uma transação de longa duração em um tempo de recuperação, veja [O log de transações &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f9291-177">For more information about the impact of a long running transaction on recovery time, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="f9291-178">Normalmente, os valores padrão fornecem um ótimo desempenho de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f9291-178">Typically, the default values provides optimal recovery performance.</span></span> <span data-ttu-id="f9291-179">No entanto, a alteração do intervalo de recuperação pode melhorar o desempenho nas circunstâncias seguintes:</span><span class="sxs-lookup"><span data-stu-id="f9291-179">However, changing the recovery interval might improve performance in the following circumstances:</span></span>  
  
-   <span data-ttu-id="f9291-180">Se, em geral, a recuperação demorar significativamente mais que 1 minuto quando transações demoradas não estão sendo revertidas.</span><span class="sxs-lookup"><span data-stu-id="f9291-180">If recovery routinely takes significantly longer than 1 minute when long-running transactions are not being rolled back.</span></span>  
  
-   <span data-ttu-id="f9291-181">Se você notar que os pontos de verificação frequentes estão prejudicando o desempenho em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-181">If you notice that frequent checkpoints are impairing performance on a database.</span></span>  
  
 <span data-ttu-id="f9291-182">Se você decidir aumentar a configuração `recovery interval`, recomendamos fazer isso gradativamente em pequenos incrementos e avaliar o efeito de cada aumento incremental no desempenho de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f9291-182">If you decide to increase the `recovery interval` setting, we recommend increasing it gradually by small increments and evaluating the effect of each incremental increase on recovery performance.</span></span> <span data-ttu-id="f9291-183">Essa abordagem é importante porque, à medida que a `recovery interval` configuração aumenta, a recuperação de banco de dados leva isso muitas vezes mais tempo para ser concluída.</span><span class="sxs-lookup"><span data-stu-id="f9291-183">This approach is important because as the `recovery interval` setting increases, database recovery takes that many times longer to complete.</span></span> <span data-ttu-id="f9291-184">Por exemplo, se você alterar `recovery interval` 10, a recuperação levará aproximadamente 10 vezes mais tempo para ser concluída do que quando `recovery interval` for definido como zero.</span><span class="sxs-lookup"><span data-stu-id="f9291-184">For example, if you change `recovery interval` 10, recovery takes approximately 10 times longer to complete than when `recovery interval` is set to zero.</span></span>  
  
  
###  <a name="indirect-checkpoints"></a><a name="IndirectChkpt"></a><span data-ttu-id="f9291-185">Pontos de verificação indiretos</span><span class="sxs-lookup"><span data-stu-id="f9291-185">Indirect Checkpoints</span></span>  
 <span data-ttu-id="f9291-186">Pontos de verificação indiretos, novos no [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], fornecem um nível de banco de dados configurável alternativo para pontos de verificação automáticos.</span><span class="sxs-lookup"><span data-stu-id="f9291-186">Indirect checkpoints, new in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], provide a configurable database-level alternative to automatic checkpoints.</span></span> <span data-ttu-id="f9291-187">No caso de uma falha de sistema, pontos de verificação indiretos fornecem um tempo de recuperação mais previsível potencialmente mais rápido do que os pontos de verificação automáticos.</span><span class="sxs-lookup"><span data-stu-id="f9291-187">In the event of a system crash, indirect checkpoints provide potentially faster, more predictable recovery time than automatic checkpoints.</span></span> <span data-ttu-id="f9291-188">Os pontos de verificação indiretos oferecem as seguintes vantagens:</span><span class="sxs-lookup"><span data-stu-id="f9291-188">Indirect checkpoints offer the following advantages:</span></span>  
  
-   <span data-ttu-id="f9291-189">Uma carga de trabalho transacional online em um banco de dados configurado para pontos de verificação indiretos pode apresentar degradação no desempenho.</span><span class="sxs-lookup"><span data-stu-id="f9291-189">An online transactional workload on a database that is configured for indirect checkpoints could experience performance degradation.</span></span> <span data-ttu-id="f9291-190">Pontos de verificação indiretos garantem que o número de páginas sujas esteja abaixo de certo limite, para que a recuperação do banco de dados seja concluída dentro da meta do tempo de recuperação.</span><span class="sxs-lookup"><span data-stu-id="f9291-190">Indirect checkpoints make sure that the number of dirty pages are below a certain threshold so that the database recovery completes within the target recovery time.</span></span> <span data-ttu-id="f9291-191">A opção de configuração do intervalo de recuperação usa o número de transações para determinar o tempo de recuperação em relação aos pontos de verificação indiretos, que usam o número de páginas sujas.</span><span class="sxs-lookup"><span data-stu-id="f9291-191">The recovery interval configuration option uses the number of transactions to determine the recovery time as opposed to indirect checkpoints which makes use of number of dirty pages.</span></span> <span data-ttu-id="f9291-192">Quando pontos de verificação indiretos são habilitados em um banco de dados que recebe um grande número de operações DML, o gravador em segundo plano pode iniciar eliminação agressiva de buffers sujos no disco para garantir que o tempo necessário para executar a recuperação esteja dentro da meta do tempo de recuperação definido para o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-192">When indirect checkpoints are enabled on a database receiving a large number of DML operations, the background writer can start aggressively flushing dirty buffers to disk to ensure that the time required to perform recovery is within the target recovery time set of the database.</span></span> <span data-ttu-id="f9291-193">Isso pode causar atividade adicional de E/S em determinados sistemas, o que pode contribuir para um gargalo de desempenho, se o subsistema do disco estiver operando acima ou próximo do limite de E/S.</span><span class="sxs-lookup"><span data-stu-id="f9291-193">This can cause additional I/O activity on certain systems which can contribute to a performance bottleneck if the disk subsystem is operating above or nearing the I/O threshold.</span></span>  
  
-   <span data-ttu-id="f9291-194">Pontos de verificação indiretos permitem a você controlar o tempo de recuperação de banco de dados de modo confiável, fatorando no custo de E/S aleatória durante REDO.</span><span class="sxs-lookup"><span data-stu-id="f9291-194">Indirect checkpoints enable you to reliably control database recovery time by factoring in the cost of random I/O during REDO.</span></span> <span data-ttu-id="f9291-195">Isso permite que uma instância de servidor permaneça em um limite superior nos tempos de recuperação para um determinado banco de dados (exceto quando uma transação demorada causa tempos UNDO excessivos).</span><span class="sxs-lookup"><span data-stu-id="f9291-195">This enables a server instance to stay within an upper-bound on recovery times for a given database (except when a long-running transaction causes excessive UNDO times).</span></span>  
  
-   <span data-ttu-id="f9291-196">Pontos de verificação indiretos reduzem os picos de E/S relacionados ao ponto de verificação gravando continuamente páginas sujas em disco em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="f9291-196">Indirect checkpoints reduce checkpoint-related I/O spiking by continually writing dirty pages to disk in the background.</span></span>  
  
 <span data-ttu-id="f9291-197">No entanto, uma carga de trabalho transacional online em um banco de dados configurado para pontos de verificação indiretos podem apresentar degradação no desempenho.</span><span class="sxs-lookup"><span data-stu-id="f9291-197">However, an online transactional workload on a database that is configured for indirect checkpoints could experience performance degradation.</span></span> <span data-ttu-id="f9291-198">Isso ocorre porque o gravador em segundo plano usado pelo ponto de verificação indireto às vezes aumenta a carga de gravação total de uma instância de servidor.</span><span class="sxs-lookup"><span data-stu-id="f9291-198">This is because the background writer used by indirect checkpoint sometimes increases the total write load for a server instance.</span></span>  
  
  
###  <a name="internal-checkpoints"></a><a name="EventsCausingChkpt"></a><span data-ttu-id="f9291-199">Pontos de verificação internos</span><span class="sxs-lookup"><span data-stu-id="f9291-199">Internal Checkpoints</span></span>  
 <span data-ttu-id="f9291-200">Os pontos de verificação internos são gerados por vários componentes de servidor para garantir que as imagens de disco correspondam ao estado atual do log.</span><span class="sxs-lookup"><span data-stu-id="f9291-200">Internal Checkpoints are generated by various server components to guarantee that disk images match the current state of the log.</span></span> <span data-ttu-id="f9291-201">Pontos de verificação internos são gerados em resposta aos eventos seguintes:</span><span class="sxs-lookup"><span data-stu-id="f9291-201">Internal checkpoint are generated in response to the following events:</span></span>  
  
-   <span data-ttu-id="f9291-202">Os arquivos de banco de dados foram adicionados ou removidos usando ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="f9291-202">Database files have been added or removed by using ALTER DATABASE.</span></span>  
  
-   <span data-ttu-id="f9291-203">É realizado um backup de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-203">A database backup is taken.</span></span>  
  
-   <span data-ttu-id="f9291-204">Um instantâneo de banco de dados é criado, explicitamente ou internamente para DBCC CHECK.</span><span class="sxs-lookup"><span data-stu-id="f9291-204">A database snapshot is created, whether explicitly or internally for DBCC CHECK.</span></span>  
  
-   <span data-ttu-id="f9291-205">É executada uma atividade que requer um desligamento de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-205">An activity requiring a database shutdown is performed.</span></span> <span data-ttu-id="f9291-206">Por exemplo, AUTO_CLOSE está ON e a última conexão de usuário com o banco de dados está fechada ou é feita uma modificação de opção de banco de dados que requer o reinício do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="f9291-206">For example, AUTO_CLOSE is ON and the last user connection to the database is closed, or a database option change is made that requires a restart of the database.</span></span>  
  
-   <span data-ttu-id="f9291-207">Uma instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] é interrompida com a interrupção do serviço [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (MSSQLSERVER).</span><span class="sxs-lookup"><span data-stu-id="f9291-207">An instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is stopped by stopping the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (MSSQLSERVER) service .</span></span> <span data-ttu-id="f9291-208">Qualquer ação causa um ponto de verificação em cada banco de dados na instância de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f9291-208">Either action  causes a checkpoint in each database in the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="f9291-209">Colocando uma FCI (instância de cluster de failover) [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] offline.</span><span class="sxs-lookup"><span data-stu-id="f9291-209">Bringing a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover cluster instance (FCI) offline.</span></span>  
  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="f9291-210">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="f9291-210">Related Tasks</span></span>  
 <span data-ttu-id="f9291-211">**Para alterar o intervalo de recuperação em uma instância de servidor**</span><span class="sxs-lookup"><span data-stu-id="f9291-211">**To change the recovery interval on a server instance**</span></span>  
  
-   [<span data-ttu-id="f9291-212">Configure the recovery interval Server Configuration Option</span><span class="sxs-lookup"><span data-stu-id="f9291-212">Configure the recovery interval Server Configuration Option</span></span>](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md)  
  
 <span data-ttu-id="f9291-213">**Para configurar pontos de verificação indiretos em um banco de dados**</span><span class="sxs-lookup"><span data-stu-id="f9291-213">**To configure indirect checkpoints on a database**</span></span>  
  
-   [<span data-ttu-id="f9291-214">Alterar o tempo de recuperação de destino de um banco de dados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f9291-214">Change the Target Recovery Time of a Database &#40;SQL Server&#41;</span></span>](change-the-target-recovery-time-of-a-database-sql-server.md)  
  
 <span data-ttu-id="f9291-215">**Para emitir um ponto de verificação manual em um banco de dados**</span><span class="sxs-lookup"><span data-stu-id="f9291-215">**To issue a manual checkpoint on a database**</span></span>  
  
-   [<span data-ttu-id="f9291-216">CHECKPOINT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f9291-216">CHECKPOINT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/language-elements/checkpoint-transact-sql)  
  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="f9291-217">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="f9291-217">Related Content</span></span>  
  
-   <span data-ttu-id="f9291-218">[Arquitetura física do log de transações](https://technet.microsoft.com/library/ms179355.aspx) (nos Manuais Online do [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] )</span><span class="sxs-lookup"><span data-stu-id="f9291-218">[Transaction Log Physical Architecture](https://technet.microsoft.com/library/ms179355.aspx) (in [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] Books Oline)</span></span>  
  
  
## <a name="see-also"></a><span data-ttu-id="f9291-219">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="f9291-219">See Also</span></span>  
 [<span data-ttu-id="f9291-220">O log de transações &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f9291-220">The Transaction Log &#40;SQL Server&#41;</span></span>](the-transaction-log-sql-server.md)  
  
  
