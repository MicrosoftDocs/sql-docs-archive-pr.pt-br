---
title: Controlar a durabilidade da transação | Microsoft Docs
ms.custom: ''
ms.date: 05/19/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- delayed durability
- Lazy Commit
ms.assetid: 3ac93b28-cac7-483e-a8ab-ac44e1cc1c76
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f37bcaf8719f4a2f3b1e7fbca1cf332717bd936e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572549"
---
# <a name="control-transaction-durability"></a><span data-ttu-id="936a6-102">Controlar a durabilidade da transação</span><span class="sxs-lookup"><span data-stu-id="936a6-102">Control Transaction Durability</span></span>
  <span data-ttu-id="936a6-103">As confirmações de transações do[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] podem ser totalmente duráveis, o padrão do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , ou duráveis atrasadas (também conhecido como confirmação lenta).</span><span class="sxs-lookup"><span data-stu-id="936a6-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction commits can be either fully durable, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] default, or delayed durable (also known as lazy commit).</span></span>  
  
 <span data-ttu-id="936a6-104">As confirmações de transações totalmente duráveis são síncronas e relatam uma confirmação como bem-sucedida, devolvendo o controle ao cliente somente após a gravação dos registros de log da transação em disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-104">Fully durable transaction commits are synchronous and report a commit as successful and return control to the client only after the log records for the transaction are written to disk.</span></span> <span data-ttu-id="936a6-105">As confirmações de transações duráveis atrasadas são assíncronas e relatam uma confirmação como bem-sucedida antes que os registros de log da transação sejam gravados no disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-105">Delayed durable transaction commits are asynchronous and report a commit as successful before the log records for the transaction are written to disk.</span></span> <span data-ttu-id="936a6-106">É necessário gravar as entradas de log das transações em disco para que uma transação seja durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-106">Writing the transaction log entries to disk is required for a transaction to be durable.</span></span> <span data-ttu-id="936a6-107">As transações duráveis atrasadas tornam-se duráveis quando as entradas de log de transações são liberadas para o disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-107">Delayed durable transactions become durable when the transaction log entries are flushed to disk.</span></span>  
  
 <span data-ttu-id="936a6-108">Este tópico detalha as transações duráveis atrasadas.</span><span class="sxs-lookup"><span data-stu-id="936a6-108">This topic details delayed durable transactions.</span></span>  
  
## <a name="full-vs-delayed-transaction-durability"></a><span data-ttu-id="936a6-109">Durabilidade de transação completa versus Durabilidade de transação atrasada</span><span class="sxs-lookup"><span data-stu-id="936a6-109">Full vs. Delayed Transaction Durability</span></span>  
 <span data-ttu-id="936a6-110">A durabilidade de transações atrasadas e completas tem vantagens e desvantagens.</span><span class="sxs-lookup"><span data-stu-id="936a6-110">Both full and delayed transaction durability have their advantages and disadvantages.</span></span> <span data-ttu-id="936a6-111">Um aplicativo pode ter uma mistura de transações duráveis completas e atrasadas.</span><span class="sxs-lookup"><span data-stu-id="936a6-111">An application can have a mix of fully and delayed durable transactions.</span></span> <span data-ttu-id="936a6-112">Você deve considerar cuidadosamente as necessidades do seu negócio e como cada uma se adapta a essas necessidades.</span><span class="sxs-lookup"><span data-stu-id="936a6-112">You should carefully consider your business needs and how each fits into those needs.</span></span>  
  
### <a name="full-transaction-durability"></a><span data-ttu-id="936a6-113">Durabilidade de transação completa</span><span class="sxs-lookup"><span data-stu-id="936a6-113">Full transaction durability</span></span>  
 <span data-ttu-id="936a6-114">As transações completamente duráveis gravam o log de transações no disco antes de devolver o controle para o cliente.</span><span class="sxs-lookup"><span data-stu-id="936a6-114">Fully durable transactions write the transaction log to disk before returning control to the client.</span></span> <span data-ttu-id="936a6-115">Você deve usar transações completamente duráveis sempre que:</span><span class="sxs-lookup"><span data-stu-id="936a6-115">You should use fully durable transactions whenever:</span></span>  
  
-   <span data-ttu-id="936a6-116">O sistema não puder tolerar perda de dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-116">Your system cannot tolerate any data loss.</span></span>   
    <span data-ttu-id="936a6-117">Consulte a seção [Onde posso perder os dados?](#when-can-i-lose-data) para obter mais informações sobre quando você pode perder alguns dos seus dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-117">See the section [When can I lose data?](#when-can-i-lose-data) for information on when you can lose some of your data.</span></span>  
  
-   <span data-ttu-id="936a6-118">O gargalo não seja devido à latência de gravação do log de transações.</span><span class="sxs-lookup"><span data-stu-id="936a6-118">The bottleneck is not due to transaction log write latency.</span></span>  
  
 <span data-ttu-id="936a6-119">A durabilidade da transação atrasada reduz a latência devido à E/S do log mantendo os registros do log de transações na memória e gravando no log de transações em lotes, exigindo assim menos operações de E/S.</span><span class="sxs-lookup"><span data-stu-id="936a6-119">Delayed transaction durability reduces the latency due to log I/O by keeping the transaction log records in memory and writing to the transaction log in batches, thus requiring fewer I/O operations.</span></span> <span data-ttu-id="936a6-120">A durabilidade da transação atrasada potencialmente reduz a contenção de E/S de log, reduzindo a espera no sistema.</span><span class="sxs-lookup"><span data-stu-id="936a6-120">Delayed transaction durability potentially reduces log I/O contention, thus reducing waits in the system.</span></span>  
  
 <span data-ttu-id="936a6-121">**Garantias de durabilidade de transação completa**</span><span class="sxs-lookup"><span data-stu-id="936a6-121">**Full Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="936a6-122">Assim que a confirmação de transação tiver êxito, as alterações feitas pela transação serão visíveis para as outras transações no sistema.</span><span class="sxs-lookup"><span data-stu-id="936a6-122">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span> <span data-ttu-id="936a6-123">Consulte o tópico [níveis de isolamento da transação](../../database-engine/transaction-isolation-levels.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="936a6-123">See the topic [Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) for more information.</span></span>  
  
-   <span data-ttu-id="936a6-124">A durabilidade é garantida após a confirmação.</span><span class="sxs-lookup"><span data-stu-id="936a6-124">Durability is guaranteed on commit.</span></span> <span data-ttu-id="936a6-125">Os registros de log correspondentes são persistidos no disco antes que a confirmação de transação tenha êxito e retornam o controle para o cliente.</span><span class="sxs-lookup"><span data-stu-id="936a6-125">Corresponding log records are persisted to disk before the transaction commit succeeds and returns control to the client.</span></span>  
  
### <a name="delayed-transaction-durability"></a><span data-ttu-id="936a6-126">Durabilidade de transação atrasada</span><span class="sxs-lookup"><span data-stu-id="936a6-126">Delayed transaction durability</span></span>  
 <span data-ttu-id="936a6-127">A durabilidade da transação atrasada é obtida usando gravações assíncronas de log no disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-127">Delayed transaction durability is accomplished using asynchronous log writes to disk.</span></span> <span data-ttu-id="936a6-128">Os registros do log de transações são mantidos em um buffer e gravados no disco quando o buffer é preenchido ou um evento liberação de buffer ocorre.</span><span class="sxs-lookup"><span data-stu-id="936a6-128">Transaction log records are kept in a buffer and written to disk when the buffer fills or a buffer flushing event takes place.</span></span> <span data-ttu-id="936a6-129">A durabilidade da transação atrasada reduz a latência e a contenção dentro do sistema porque:</span><span class="sxs-lookup"><span data-stu-id="936a6-129">Delayed transaction durability reduces both latency and contention within the system because:</span></span>  
  
-   <span data-ttu-id="936a6-130">O processamento da confirmação de transação não aguarda a E/S do log ser concluída e devolver o controle para o cliente.</span><span class="sxs-lookup"><span data-stu-id="936a6-130">The transaction commit processing does not wait for log IO to finish and return control to the client.</span></span>  
  
-   <span data-ttu-id="936a6-131">As transações simultâneas são menos prováveis de conter para a E/S do log; em vez disso, o buffer de log pode ser liberado para disco em partes maiores, reduzindo a contenção e aumentando a taxa de transferência.</span><span class="sxs-lookup"><span data-stu-id="936a6-131">Concurrent transactions are less likely to contend for log IO; instead, the log buffer can be flushed to disk in larger chunks, reducing contention, and increasing throughput.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="936a6-132">Você ainda poderá ter a contenção de E/S de log se houver um nível alto de simultaneidade, especialmente se você preencher o buffer do log mais rápido do que o liberar.</span><span class="sxs-lookup"><span data-stu-id="936a6-132">You may still have log I/O contention if there is a high degree of concurrency, particularly if you fill up the log buffer faster than you flush it.</span></span>  
  
 <span data-ttu-id="936a6-133">**Quando usar a durabilidade de transação atrasada**</span><span class="sxs-lookup"><span data-stu-id="936a6-133">**When to use delayed transaction durability**</span></span>  
  
 <span data-ttu-id="936a6-134">Alguns dos casos em que você pode se beneficiar do uso da durabilidade de transação atrasada são:</span><span class="sxs-lookup"><span data-stu-id="936a6-134">Some of the cases in which you could benefit from using delayed transaction durability are:</span></span>  
  
 <span data-ttu-id="936a6-135">**Você pode tolerar alguma perda de dados.** </span><span class="sxs-lookup"><span data-stu-id="936a6-135">**You can tolerate some data loss.**</span></span>  
 <span data-ttu-id="936a6-136">Se você puder tolerar alguma perda de dados, por exemplo, nos casos em que os registros individuais não sejam críticos desde que você tenha a maioria dos dados, poderá ser válido considerar a durabilidade atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-136">If you can tolerate some data loss, for example, where individual records are not critical as long as you have most of the data, then delayed durability may be worth considering.</span></span> <span data-ttu-id="936a6-137">Se você não puder tolerar perda de dados, não use a durabilidade de transação atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-137">If you cannot tolerate any data loss, do not use delayed transaction durability.</span></span>  
  
 <span data-ttu-id="936a6-138">**Você está observando um gargalo em gravações de log de transações.** </span><span class="sxs-lookup"><span data-stu-id="936a6-138">**You are experiencing a bottleneck on transaction log writes.**</span></span>  
 <span data-ttu-id="936a6-139">Se seus problemas de desempenho forem devido à latência em gravações do log de transações, seu aplicativo provavelmente se beneficiará do uso da durabilidade de transação atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-139">If your performance issues are due to latency in transaction log writes, your application will likely benefit from using delayed transaction durability.</span></span>  
  
 <span data-ttu-id="936a6-140">**Suas cargas de trabalho têm uma taxa alta de contenção.** </span><span class="sxs-lookup"><span data-stu-id="936a6-140">**Your workloads have a high contention rate.**</span></span>  
 <span data-ttu-id="936a6-141">Se o sistema tiver cargas de trabalho com um nível alto de contenção, muito tempo será perdido aguardando que os bloqueios sejam liberados.</span><span class="sxs-lookup"><span data-stu-id="936a6-141">If your system has workloads with a high contention level much time is lost waiting for locks to be released.</span></span> <span data-ttu-id="936a6-142">A durabilidade de transação atrasada reduz o tempo de confirmação e libera os bloqueios mais rapidamente, resultando em uma taxa de transferência mais alta.</span><span class="sxs-lookup"><span data-stu-id="936a6-142">Delayed transaction durability reduces commit time and thus releases locks faster which results in higher throughput.</span></span>  
  
 <span data-ttu-id="936a6-143">**Garantias de durabilidade de transação atrasada**</span><span class="sxs-lookup"><span data-stu-id="936a6-143">**Delayed Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="936a6-144">Assim que a confirmação de transação tiver êxito, as alterações feitas pela transação serão visíveis para as outras transações no sistema.</span><span class="sxs-lookup"><span data-stu-id="936a6-144">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span>  
  
-   <span data-ttu-id="936a6-145">A durabilidade da transação é garantida apenas após uma liberação do log de transações de memória para o disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-145">Transaction durability is guaranteed only following a flush of the in-memory transaction log to disk.</span></span> <span data-ttu-id="936a6-146">O log de transações de memória é liberado para disco quando:</span><span class="sxs-lookup"><span data-stu-id="936a6-146">The in-memory transaction log is flushed to disk when:</span></span>  
  
    -   <span data-ttu-id="936a6-147">Uma transação completamente durável no mesmo banco de dados faz uma alteração no banco de dados e é confirmada com sucesso.</span><span class="sxs-lookup"><span data-stu-id="936a6-147">A fully durable transaction in the same database makes a change in the database and successfully commits.</span></span>  
  
    -   <span data-ttu-id="936a6-148">O usuário executa um procedimento armazenado do sistema `sp_flush_log` com sucesso.</span><span class="sxs-lookup"><span data-stu-id="936a6-148">The user executes the system stored procedure `sp_flush_log` successfully.</span></span>  
  
    -   <span data-ttu-id="936a6-149">O buffer de log de transações na memória é preenchido e automaticamente libera para o disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-149">The in-memory transaction log buffer fills up and automatically flushes to disk.</span></span>  
  
     <span data-ttu-id="936a6-150">Se uma transação completamente durável ou um sp_flush_log for confirmado com sucesso, todas as transações de durabilidade atrasada confirmadas anteriormente se tornarão duráveis.</span><span class="sxs-lookup"><span data-stu-id="936a6-150">If a fully durable transaction or sp_flush_log successfully commit, all previously committed delayed durability transactions have been made durable.</span></span>  
  
 <span data-ttu-id="936a6-151">O log pode ser liberado para o disco periodicamente.</span><span class="sxs-lookup"><span data-stu-id="936a6-151">The log may be flushed to disk periodically.</span></span> <span data-ttu-id="936a6-152">Contudo, o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] não fornece nenhuma garantia de durabilidade além das transações duráveis e sp_flush_log.</span><span class="sxs-lookup"><span data-stu-id="936a6-152">However, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not provide any durability guarantees other than durable transactions and sp_flush_log.</span></span>  
  
## <a name="how-to-control-transaction-durability"></a><span data-ttu-id="936a6-153">Como controlar a durabilidade da transação</span><span class="sxs-lookup"><span data-stu-id="936a6-153">How to control transaction durability</span></span>  
  
### <a name="database-level-control"></a><span data-ttu-id="936a6-154">Controle de nível de banco de dados</span><span class="sxs-lookup"><span data-stu-id="936a6-154">Database level control</span></span>  
 <span data-ttu-id="936a6-155">Você, o DBA, pode controlar se os usuários podem usar a durabilidade da transação atrasada em um banco de dados com a instrução a seguir.</span><span class="sxs-lookup"><span data-stu-id="936a6-155">You, the DBA, can control whether users can use delayed transaction durability on a database with the following statement.</span></span> <span data-ttu-id="936a6-156">Você deve definir a configuração de durabilidade atrasada com ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="936a6-156">You must set the delayed durability setting with ALTER DATABASE.</span></span>  
  
```sql  
ALTER DATABASE ... SET DELAYED_DURABILITY = { DISABLED | ALLOWED | FORCED }  
```  
  
 `DISABLED`  
 <span data-ttu-id="936a6-157">[padrão] Com essa configuração, todas as transações confirmadas no banco de dados são completamente duráveis, independentemente da configuração do nível de confirmação (DELAYED_DURABILITY=[ON | OFF]).</span><span class="sxs-lookup"><span data-stu-id="936a6-157">[default] With this setting, all transactions that commit on the database are fully durable, regardless of the commit level setting (DELAYED_DURABILITY=[ON | OFF]).</span></span> <span data-ttu-id="936a6-158">Não há nenhuma necessidade de modificação e recompilação do procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="936a6-158">There is no need for stored procedure change and recompilation.</span></span> <span data-ttu-id="936a6-159">Isso permite garantir que a durabilidade atrasada nunca coloque os dados em risco.</span><span class="sxs-lookup"><span data-stu-id="936a6-159">This allows you to ensure that no data is ever put at risk by delayed durability.</span></span>  
  
 `ALLOWED`  
 <span data-ttu-id="936a6-160">Com essa configuração, a durabilidade de cada transação é determinada no nível da transação – DELAYED_DURABILITY = { *OFF* | ON }.</span><span class="sxs-lookup"><span data-stu-id="936a6-160">With this setting, each transaction's durability is determined at the transaction level - DELAYED_DURABILITY = { *OFF* | ON }.</span></span> <span data-ttu-id="936a6-161">Consulte [controle de nível de bloco atômico-procedimentos armazenados compilados nativamente](#atomic-block-level-control---natively-compiled-stored-procedures) e [controle de nível de confirmação-Transact-SQL](#commit-level-control---t-sql) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="936a6-161">See [Atomic block level control - Natively Compiled Stored Procedures](#atomic-block-level-control---natively-compiled-stored-procedures) and [COMMIT level control - Transact-SQL](#commit-level-control---t-sql) for more information.</span></span>  
  
 `FORCED`  
 <span data-ttu-id="936a6-162">Com essa configuração, cada transação que é confirmada no banco de dados é durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-162">With this setting, every transaction that commits on the database is delayed durable.</span></span> <span data-ttu-id="936a6-163">Independentemente de a transação especificar completamente durável (DELAYED_DURABILITY = OFF) ou não fizer nenhuma especificação, a transação será durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-163">Whether the transaction specifies fully durable (DELAYED_DURABILITY = OFF) or makes no specification, the transaction is delayed durable.</span></span> <span data-ttu-id="936a6-164">Essa configuração é útil quando a durabilidade da transação atrasada é útil para um banco de dados e você não quer alterar o código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="936a6-164">This setting is useful when delayed transaction durability is useful for a database and you do not want to change any application code.</span></span>  
  
### <a name="atomic-block-level-control---natively-compiled-stored-procedures"></a><span data-ttu-id="936a6-165"> Controle no nível do bloco atômico – procedimentos armazenados e compilados nativamente</span><span class="sxs-lookup"><span data-stu-id="936a6-165">Atomic block level control - Natively Compiled Stored Procedures</span></span>  
 <span data-ttu-id="936a6-166">O código a seguir fica dentro do bloco atômico.</span><span class="sxs-lookup"><span data-stu-id="936a6-166">The following code goes inside the atomic block.</span></span>  
  
```sql  
DELAYED_DURABILITY = { OFF | ON }  
```  
  
 `OFF`  
 <span data-ttu-id="936a6-167">[padrão] A transação será completamente durável, a menos que a opção DELAYED_DURABLITY = FORCED esteja em vigor; nesse caso, a confirmação será assíncrona e, portanto, durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-167">[default] The transaction is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the commit is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="936a6-168">Consulte [Controle de nível de banco de dados](#database-level-control) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="936a6-168">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="936a6-169">A transação será durável atrasada, a menos que a opção DELAYED_DURABLITY = DISABLED esteja em vigor; nesse caso, a confirmação será síncrona e completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-169">The transaction is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the commit is synchronous and thus fully durable.</span></span>  <span data-ttu-id="936a6-170">Consulte [Controle de nível de banco de dados](#database-level-control) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="936a6-170">See [Database level control](#database-level-control) for more information.</span></span>  
  
 <span data-ttu-id="936a6-171">**Código de exemplo:**</span><span class="sxs-lookup"><span data-stu-id="936a6-171">**Example Code:**</span></span>  
  
```sql  
CREATE PROCEDURE <procedureName> ...  
WITH NATIVE_COMPILATION, SCHEMABINDING, EXECUTE AS OWNER  
AS BEGIN ATOMIC WITH   
(  
    DELAYED_DURABILITY = ON,  
    TRANSACTION ISOLATION LEVEL = SNAPSHOT,  
    LANGUAGE = N'English'  
    ...  
)  
END  
```  
  
### <a name="table-1-durability-in-atomic-blocks"></a><span data-ttu-id="936a6-172">Tabela 1: Durabilidade em blocos atômicos</span><span class="sxs-lookup"><span data-stu-id="936a6-172">Table 1: Durability in Atomic Blocks</span></span>  
  
|<span data-ttu-id="936a6-173">Opção da durabilidade do bloco atômico</span><span class="sxs-lookup"><span data-stu-id="936a6-173">Atomic block durability option</span></span>|<span data-ttu-id="936a6-174">Não há transação existente</span><span class="sxs-lookup"><span data-stu-id="936a6-174">No existing transaction</span></span>|<span data-ttu-id="936a6-175">Transação em processo (completamente durável ou atrasada)</span><span class="sxs-lookup"><span data-stu-id="936a6-175">Transaction in process (fully or delayed durable)</span></span>|  
|------------------------------------|-----------------------------|---------------------------------------------------------|  
|`DELAYED_DURABILITY = OFF`|<span data-ttu-id="936a6-176">O bloco atômico inicia uma nova transação completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-176">Atomic block starts a new fully durable transaction.</span></span>|<span data-ttu-id="936a6-177">O bloco atômico cria um ponto de salvamento na transação existente e, em seguida, inicia a nova transação.</span><span class="sxs-lookup"><span data-stu-id="936a6-177">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
|`DELAYED_DURABILITY = ON`|<span data-ttu-id="936a6-178">O bloco atômico inicia uma nova transação durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-178">Atomic block starts a new delayed durable transaction.</span></span>|<span data-ttu-id="936a6-179">O bloco atômico cria um ponto de salvamento na transação existente e, em seguida, inicia a nova transação.</span><span class="sxs-lookup"><span data-stu-id="936a6-179">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
  
### <a name="commit-level-control---t-sql"></a><span data-ttu-id="936a6-180">Controle de nível de confirmação-(T-SQL)</span><span class="sxs-lookup"><span data-stu-id="936a6-180">COMMIT level control - (T-SQL)</span></span>
 <span data-ttu-id="936a6-181">A sintaxe de COMMIT é estendida para que você possa forçar a durabilidade da transação atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-181">The COMMIT syntax is extended so you can force delayed transaction durability.</span></span> <span data-ttu-id="936a6-182">Se DELAYED_DURABILITY for DISABLED ou FORCED no nível de banco de dados (veja acima) essa opção COMMIT será ignorada.</span><span class="sxs-lookup"><span data-stu-id="936a6-182">If DELAYED_DURABILITY is DISABLED or FORCED at the database level (see above) this COMMIT option is ignored.</span></span>  
  
```sql  
COMMIT [ { TRAN | TRANSACTION } ] [ transaction_name | @tran_name_variable ] ] [ WITH ( DELAYED_DURABILITY = { OFF | ON } ) ]  
  
```  
  
 `OFF`  
 <span data-ttu-id="936a6-183">[padrão] A transação COMMIT será completamente durável, a menos que a opção de banco de dados DELAYED_DURABLITY = FORCED esteja em vigor; nesse caso, a COMMIT é assíncrona e, portanto, durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-183">[default] The transaction COMMIT is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the COMMIT is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="936a6-184">Consulte [Controle de nível de banco de dados](#database-level-control) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="936a6-184">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="936a6-185">A transação COMMIT será durável atrasada, a menos que a opção de banco de dados DELAYED_DURABLITY = DISABLED esteja em vigor; nesse caso, a COMMIT é síncrona e, portanto, completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-185">The transaction COMMIT is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the COMMIT is synchronous and thus fully durable.</span></span> <span data-ttu-id="936a6-186">Consulte [Controle de nível de banco de dados](#database-level-control) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="936a6-186">See [Database level control](#database-level-control) for more information.</span></span>  
  
### <a name="summary-of-options-and-their-interactions"></a><span data-ttu-id="936a6-187">Resumo de opções e suas interações</span><span class="sxs-lookup"><span data-stu-id="936a6-187">Summary of options and their interactions</span></span>  
 <span data-ttu-id="936a6-188">Esta tabela resume as interações entre as configurações de durabilidade atrasada de nível de banco de dados e as configurações no nível da confirmação.</span><span class="sxs-lookup"><span data-stu-id="936a6-188">This table summarizes the interactions between database level delayed durability settings and commit level settings.</span></span> <span data-ttu-id="936a6-189">As configurações no nível de banco de dados sempre têm precedência sobre configurações no nível de confirmação.</span><span class="sxs-lookup"><span data-stu-id="936a6-189">Database level settings always take precedence over commit level settings.</span></span>  
  
|<span data-ttu-id="936a6-190">Configuração de COMMIT/Configuração de banco de dados</span><span class="sxs-lookup"><span data-stu-id="936a6-190">COMMIT setting/Database setting</span></span>|<span data-ttu-id="936a6-191">DELAYED_DURABILITY = DISABLED</span><span class="sxs-lookup"><span data-stu-id="936a6-191">DELAYED_DURABILITY = DISABLED</span></span>|<span data-ttu-id="936a6-192">DELAYED_DURABILITY = ALLOWED</span><span class="sxs-lookup"><span data-stu-id="936a6-192">DELAYED_DURABILITY = ALLOWED</span></span>|<span data-ttu-id="936a6-193">DELAYED_DURABILITY = FORCED</span><span class="sxs-lookup"><span data-stu-id="936a6-193">DELAYED_DURABILITY = FORCED</span></span>|  
|--------------------------------------|-------------------------------------|------------------------------------|-----------------------------------|  
|<span data-ttu-id="936a6-194">`DELAYED_DURABILITY = OFF` Transações de nível de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-194">`DELAYED_DURABILITY = OFF` Database level transactions.</span></span>|<span data-ttu-id="936a6-195">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-195">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-196">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-196">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-197">A transação é durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-197">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="936a6-198">`DELAYED_DURABILITY = ON` Transações de nível de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-198">`DELAYED_DURABILITY = ON` Database level transactions.</span></span>|<span data-ttu-id="936a6-199">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-199">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-200">A transação é durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-200">Transaction is delayed durable.</span></span>|<span data-ttu-id="936a6-201">A transação é durável atrasada.</span><span class="sxs-lookup"><span data-stu-id="936a6-201">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="936a6-202">`DELAYED_DURABILITY = OFF` Transação entre banco de dados ou distribuída.</span><span class="sxs-lookup"><span data-stu-id="936a6-202">`DELAYED_DURABILITY = OFF` Cross database or distributed transaction.</span></span>|<span data-ttu-id="936a6-203">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-203">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-204">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-204">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-205">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-205">Transaction is fully durable.</span></span>|  
|<span data-ttu-id="936a6-206">`DELAYED_DURABILITY = ON` Transação entre banco de dados ou distribuída.</span><span class="sxs-lookup"><span data-stu-id="936a6-206">`DELAYED_DURABILITY = ON` Cross database or distributed transaction.</span></span>|<span data-ttu-id="936a6-207">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-207">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-208">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-208">Transaction is fully durable.</span></span>|<span data-ttu-id="936a6-209">A transação é completamente durável.</span><span class="sxs-lookup"><span data-stu-id="936a6-209">Transaction is fully durable.</span></span>|  
  
## <a name="how-to-force-a-transaction-log-flush"></a><span data-ttu-id="936a6-210">Como forçar uma liberação de log de transações</span><span class="sxs-lookup"><span data-stu-id="936a6-210">How to force a transaction log flush</span></span>  
 <span data-ttu-id="936a6-211">Há dois meios de forçar a liberação do log de transações para o disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-211">There are two means to force flush the transaction log to disk.</span></span>  
  
-   <span data-ttu-id="936a6-212">Executar qualquer transação completamente durável que altera o mesmo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-212">Execute any fully durable transaction that alters the same database.</span></span> <span data-ttu-id="936a6-213">Isso força uma liberação para o disco dos registros de log de todas as transações de durabilidade confirmadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="936a6-213">This forces a flush of the log records of all preceding committed delayed durability transactions to disk.</span></span>  
  
-   <span data-ttu-id="936a6-214">Executar o procedimento armazenado do sistema `sp_flush_log`.</span><span class="sxs-lookup"><span data-stu-id="936a6-214">Execute the system stored procedure `sp_flush_log`.</span></span> <span data-ttu-id="936a6-215">Esse procedimento força uma liberação para o disco dos registros de log de todas as transações duráveis confirmadas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="936a6-215">This procedure forces a flush of the log records of all preceding committed delayed durable transactions to disk.</span></span> <span data-ttu-id="936a6-216">Para obter mais informações, consulte [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="936a6-216">For more information see [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span></span>  
  
##  <a name="delayed-durability-and-other-sql-server-features"></a><span data-ttu-id="936a6-217">Durabilidade atrasada e outros recursos do SQL Server</span><span class="sxs-lookup"><span data-stu-id="936a6-217">Delayed durability and other SQL Server features</span></span>  
 <span data-ttu-id="936a6-218">**Controle de alterações e alterar captura de dados**</span><span class="sxs-lookup"><span data-stu-id="936a6-218">**Change tracking and change data capture**</span></span>  
 <span data-ttu-id="936a6-219">Todas as transações com controle de alterações são completamente duráveis.</span><span class="sxs-lookup"><span data-stu-id="936a6-219">All transactions with change tracking are fully durable.</span></span> <span data-ttu-id="936a6-220">Uma transação terá a propriedade de controle de alterações se fizer alguma operação de gravação nas tabelas que estão habilitadas para controle de alterações.</span><span class="sxs-lookup"><span data-stu-id="936a6-220">A transaction has the change tracking property if it does any write operations to tables that are enabled for change tracking.</span></span> <span data-ttu-id="936a6-221">Não há suporte para o uso de durabilidade atrasada para bancos de dados que usam o CDC (Change Data Capture).</span><span class="sxs-lookup"><span data-stu-id="936a6-221">The use of delayed durability is not supported for databases which use change data capture (CDC).</span></span>   
  
 <span data-ttu-id="936a6-222">**Recuperação de pane**</span><span class="sxs-lookup"><span data-stu-id="936a6-222">**Crash recovery**</span></span>  
 <span data-ttu-id="936a6-223">A consistência é garantida, mas algumas alterações das transações duráveis atrasadas que foram confirmadas podem ser perdidas.</span><span class="sxs-lookup"><span data-stu-id="936a6-223">Consistency is guaranteed, but some changes from delayed durable transactions that have committed may be lost.</span></span>  
  
 <span data-ttu-id="936a6-224">**Entre bancos de dados e DTC**</span><span class="sxs-lookup"><span data-stu-id="936a6-224">**Cross-database and DTC**</span></span>  
 <span data-ttu-id="936a6-225">Se uma transação for entre bancos de dados ou distribuída, ela será completamente durável, independentemente da configuração de confirmação de banco de dados ou transação.</span><span class="sxs-lookup"><span data-stu-id="936a6-225">If a transaction is cross-database or distributed, if is fully durable, regardless of any database or transaction commit setting.</span></span>  
  
 <span data-ttu-id="936a6-226">**Grupos de Disponibilidade AlwaysOn e espelhamento**</span><span class="sxs-lookup"><span data-stu-id="936a6-226">**Always On Availability Groups and Mirroring**</span></span>  
 <span data-ttu-id="936a6-227">As transações duráveis atrasadas não garantem nenhuma durabilidade no primário nem em nenhum dos secundários.</span><span class="sxs-lookup"><span data-stu-id="936a6-227">Delayed durable transactions do not guarantee any durability on either the primary or any of the secondaries.</span></span> <span data-ttu-id="936a6-228">Além disso, elas não garantem conhecimento sobre a transação no secundário.</span><span class="sxs-lookup"><span data-stu-id="936a6-228">In addition, they do not guarantee any knowledge about the transaction at the secondary.</span></span> <span data-ttu-id="936a6-229">Após a confirmação, o controle é retornado para o cliente antes de qualquer reconhecimento ser recebido de algum secundário síncrono.</span><span class="sxs-lookup"><span data-stu-id="936a6-229">After commit, control is returned to the client before any acknowledgement is received from any synchronous secondary.</span></span>  
  
 <span data-ttu-id="936a6-230">**Clustering de failover**</span><span class="sxs-lookup"><span data-stu-id="936a6-230">**Failover clustering**</span></span>  
 <span data-ttu-id="936a6-231">Algumas gravações de transações duráveis atrasadas podem ser perdidas.</span><span class="sxs-lookup"><span data-stu-id="936a6-231">Some delayed durable transaction writes might be lost.</span></span>  
  
 <span data-ttu-id="936a6-232">**Replicação de transação**</span><span class="sxs-lookup"><span data-stu-id="936a6-232">**Transaction Replication**</span></span>  
 <span data-ttu-id="936a6-233">Não há suporte para transações duráveis atrasadas com replicação transacional.</span><span class="sxs-lookup"><span data-stu-id="936a6-233">Delayed durable transactions is not supported with Transactional Replication.</span></span>  
  
 <span data-ttu-id="936a6-234">**Envio de logs**</span><span class="sxs-lookup"><span data-stu-id="936a6-234">**Log shipping**</span></span>  
 <span data-ttu-id="936a6-235">Somente as transações que se tornaram duráveis são incluídas no log enviado.</span><span class="sxs-lookup"><span data-stu-id="936a6-235">Only transactions that have been made durable are included in the log that is shipped.</span></span>  
  
 <span data-ttu-id="936a6-236">**backup de log**</span><span class="sxs-lookup"><span data-stu-id="936a6-236">**Log Backup**</span></span>  
 <span data-ttu-id="936a6-237">Somente as transações que se tornaram duráveis são incluídas no backup.</span><span class="sxs-lookup"><span data-stu-id="936a6-237">Only transactions that have been made durable are included in the backup.</span></span>  
  
## <a name="when-can-i-lose-data"></a><span data-ttu-id="936a6-238">Quando posso perder os dados?</span><span class="sxs-lookup"><span data-stu-id="936a6-238">When can I lose data?</span></span>  
 <span data-ttu-id="936a6-239">Se você implementar durabilidade atrasada em qualquer de suas tabelas, você deve compreender que certas circunstâncias podem levar à perda de dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-239">If you implement delayed durability on any of your tables, you should understand that certain circumstances can lead to data loss.</span></span> <span data-ttu-id="936a6-240">Se você não puder tolerar perda de dados, não use a durabilidade atrasada em suas tabelas.</span><span class="sxs-lookup"><span data-stu-id="936a6-240">If you cannot tolerate any data loss, you should not use delayed durability on your tables.</span></span>  
  
### <a name="catastrophic-events"></a><span data-ttu-id="936a6-241">Eventos catastróficos</span><span class="sxs-lookup"><span data-stu-id="936a6-241">Catastrophic events</span></span>  
 <span data-ttu-id="936a6-242">No caso de um evento catastrófico, como uma falha do servidor, você perderá os dados de todas as transações confirmadas que não foram salvas em disco.</span><span class="sxs-lookup"><span data-stu-id="936a6-242">In the case of a catastrophic event, like a server crash, you will lose the data for all committed transactions that have not been saved to disk.</span></span> <span data-ttu-id="936a6-243">As transações duráveis atrasadas são salvas no disco sempre que uma transação totalmente durável é executada em qualquer tabela (duráveis com otimização de memória ou baseada em disco) no banco de dados ou quando o `sp_flush_log` é chamado.</span><span class="sxs-lookup"><span data-stu-id="936a6-243">Delayed durable transactions are saved to disk whenever a fully durable transaction is executed against any table (durable memory-optimized or disk-based) in the database, or `sp_flush_log` is called.</span></span> <span data-ttu-id="936a6-244">Se estiver usando transações duráveis atrasadas, você pode querer criar uma pequena tabela no banco de dados que você pode atualizar periodicamente ou chamar periodicamente o `sp_flush_log` para salvar todas as transações confirmadas pendentes.</span><span class="sxs-lookup"><span data-stu-id="936a6-244">If you are using delayed durable transactions, you may want to create a small table in the database that you can periodically update or periodically call `sp_flush_log` to save all outstanding committed transactions.</span></span> <span data-ttu-id="936a6-245">O log de transações também é liberado sempre que fica cheio, mas é difícil de prever e impossível de controlar.</span><span class="sxs-lookup"><span data-stu-id="936a6-245">The transaction log also flushes whenever it becomes full, but that is hard to predict and impossible to control.</span></span>  
  
### <a name="sql-server-shutdown-and-restart"></a><span data-ttu-id="936a6-246">Desligamento e reinicialização de SQL Server</span><span class="sxs-lookup"><span data-stu-id="936a6-246">SQL Server shutdown and restart</span></span>  
 <span data-ttu-id="936a6-247">Para durabilidade atrasada, não há diferença entre um desligamento inesperado e um desligamento/reinício esperado do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="936a6-247">For delayed durability, there is no difference between an unexpected shutdown and an expected shutdown/restart of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="936a6-248">Como os eventos catastróficos, você também deve se planejar para a perda de dados.</span><span class="sxs-lookup"><span data-stu-id="936a6-248">Like catastrophic events, you should plan for data loss.</span></span> <span data-ttu-id="936a6-249">Em um desligamento planejado/reinício, algumas transações que não foram gravadas em disco podem primeiro ser salvas em disco, mas você não deve planejar isso.</span><span class="sxs-lookup"><span data-stu-id="936a6-249">In a planned shutdown/restart some transactions that have not been written to disk may first be saved to disk, but you should not plan on it.</span></span> <span data-ttu-id="936a6-250">Planeje mesmo se um desligamento/reinício, seja planejado ou não, perda os dados da mesma forma que um evento catastrófico.</span><span class="sxs-lookup"><span data-stu-id="936a6-250">Plan as though a shutdown/restart, whether planned or unplanned, loses the data the same as a catastrophic event.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="936a6-251">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="936a6-251">See Also</span></span>  
 <span data-ttu-id="936a6-252">[Níveis de isolamento da transação](../../database-engine/transaction-isolation-levels.md) </span><span class="sxs-lookup"><span data-stu-id="936a6-252">[Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) </span></span>  
 [<span data-ttu-id="936a6-253">Diretrizes para níveis de isolamento da transação com tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="936a6-253">Guidelines for Transaction Isolation Levels with Memory-Optimized Tables</span></span>](../in-memory-oltp/memory-optimized-tables.md)  
  
  
