---
title: Buscar linhas | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- fetching rows
- OLE DB rowsets, fetching
- rowsets [OLE DB], fetching
- IRowset interface
- SQL Server Native Client OLE DB provider, fetching
ms.assetid: 5e6dbe36-b682-464d-adfa-8e886f9bd452
author: rothja
ms.author: jroth
ms.openlocfilehash: 435e1d705091814b2544c75772f20882caddf942
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570671"
---
# <a name="fetching-rows"></a><span data-ttu-id="72355-102">Buscando linhas</span><span class="sxs-lookup"><span data-stu-id="72355-102">Fetching Rows</span></span>
  <span data-ttu-id="72355-103">A interface **IRowset** é a interface de conjunto de linhas base.</span><span class="sxs-lookup"><span data-stu-id="72355-103">The **IRowset** interface is the base rowset interface.</span></span> <span data-ttu-id="72355-104">A interface **IRowset** fornece métodos para buscar linhas em sequência, obter os dados dessas linhas e gerenciar linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-104">The **IRowset** interface provides methods for fetching rows sequentially, getting the data from those rows, and managing rows.</span></span> <span data-ttu-id="72355-105">Os consumidores usam os métodos em **IRowset** para todas as operações básicas de conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-105">Consumers use the methods in **IRowset** for all basic rowset operations.</span></span> <span data-ttu-id="72355-106">Elas incluem a busca e a liberação de linhas e a obtenção de valores de coluna.</span><span class="sxs-lookup"><span data-stu-id="72355-106">This includes fetching and releasing rows and getting column values.</span></span>  
  
 <span data-ttu-id="72355-107">Quando um consumidor obtém um ponteiro de interface em um conjunto de linhas, normalmente, a primeira etapa é determinar as funcionalidades do conjunto de linhas usando o método **IRowsetInfo::GetProperties**.</span><span class="sxs-lookup"><span data-stu-id="72355-107">When a consumer obtains an interface pointer on a rowset, the first step is ordinarily to determine the capabilities of the rowset by using the **IRowsetInfo::GetProperties** method.</span></span> <span data-ttu-id="72355-108">São retornadas informações sobre as interfaces expostas pelo conjunto de linhas, além dos recursos do conjunto de linhas que não aparecem como interfaces distintas, como o número máximo de linhas ativas e o número de linhas que podem ter atualizações pendentes simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="72355-108">This returns information about the interfaces exposed by the rowset and also capabilities of the rowset that do not show up as distinct interfaces, such as the maximum number of active rows and the number of rows that can have pending updates at the same time.</span></span>  
  
 <span data-ttu-id="72355-109">A próxima etapa para os consumidores é determinar as características, ou metadados, das colunas no conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-109">The next step for consumers is to determine the characteristics, or metadata, of the columns in the rowset.</span></span> <span data-ttu-id="72355-110">Para isso, são usados o método **IColumnsInfo** para informações de coluna simples ou o método **IColumnsRowset** para informações de coluna estendida.</span><span class="sxs-lookup"><span data-stu-id="72355-110">For this they use the **IColumnsInfo** method for simple column information or the **IColumnsRowset** method for extended column information.</span></span> <span data-ttu-id="72355-111">O método **GetColumnInfo** retorna as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="72355-111">The **GetColumnInfo** method returns the following information:</span></span>  
  
-   <span data-ttu-id="72355-112">O número de colunas no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="72355-112">The number of columns in the result set.</span></span>  
  
-   <span data-ttu-id="72355-113">Uma matriz de estruturas DBCOLUMNINFO, uma por coluna.</span><span class="sxs-lookup"><span data-stu-id="72355-113">An array of DBCOLUMNINFO structures, one per column.</span></span>  
  
     <span data-ttu-id="72355-114">A ordem das estruturas é a ordem na qual as colunas aparecem no conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-114">The order of the structures is the order in which the columns appear in the rowset.</span></span> <span data-ttu-id="72355-115">Cada estrutura DBCOLUMNINFO inclui metadados de coluna, como o nome da coluna, o ordinal da coluna, o comprimento máximo possível de um valor na coluna, o tipo de dados da coluna, a precisão e o comprimento.</span><span class="sxs-lookup"><span data-stu-id="72355-115">Each DBCOLUMNINFO structure includes column metadata, such as column name, ordinal of the column, maximum possible length of a value in the column, data type of the column, precision, and length.</span></span>  
  
-   <span data-ttu-id="72355-116">O ponteiro para um armazenamento de todos os valores da cadeia de caracteres dentro de um único bloco de alocação.</span><span class="sxs-lookup"><span data-stu-id="72355-116">The pointer to a storage for all string values within a single allocation block.</span></span>  
  
 <span data-ttu-id="72355-117">O consumidor determina quais colunas são necessárias a partir dos metadados ou com base no comando de texto que gerou o conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-117">The consumer determines which columns it needs either from the metadata or based on the text command that generated the rowset.</span></span> <span data-ttu-id="72355-118">Ele determina os ordinais das colunas necessárias com base na ordenação das informações de coluna retornadas por **IColumnsInfo** ou com base nos ordinais no conjunto de linhas de metadados de coluna retornados por **IColumnsRowset**.</span><span class="sxs-lookup"><span data-stu-id="72355-118">It determines the ordinals of the needed columns from the ordering of the column information returned by **IColumnsInfo** or from the ordinals in the column metadata rowset returned by **IColumnsRowset**.</span></span>  
  
 <span data-ttu-id="72355-119">As interfaces **IColumnsInfo** e **IColumnsRowset** são usadas para extrair informações sobre as colunas no conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-119">The **IColumnsInfo** and **IColumnsRowset** interfaces are used to extract information about the columns in the rowset.</span></span> <span data-ttu-id="72355-120">A interface **IColumnsInfo** retorna um conjunto limitado de informações, enquanto **IColumnsRowset** fornece todo os metadados.</span><span class="sxs-lookup"><span data-stu-id="72355-120">The **IColumnsInfo** interface returns a limited set of information, whereas **IColumnsRowset** provides all the metadata.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="72355-121">No [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] versão 7.0 e anterior, a coluna de metadados opcional DBCOLUMN_COMPUTEMODE retornada por **IColumnsInfo::GetColumnsInfo** retorna DBSTATUS_S_ISNULL (em vez dos valores que descrevem se a coluna foi computada), pois não é possível determinar se a coluna subjacente é computada.</span><span class="sxs-lookup"><span data-stu-id="72355-121">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] version 7.0 and earlier, the optional metadata column DBCOLUMN_COMPUTEMODE returned by **IColumnsInfo::GetColumnsInfo** returns DBSTATUS_S_ISNULL (instead of the values describing whether the column is computed) because it cannot be determined whether the underlying column is computed.</span></span>  
  
 <span data-ttu-id="72355-122">Os ordinais são usados para especificar uma associação com uma coluna.</span><span class="sxs-lookup"><span data-stu-id="72355-122">The ordinals are used to specify a binding to a column.</span></span> <span data-ttu-id="72355-123">Uma associação é uma estrutura que associa um elemento da estrutura do consumidor com uma coluna.</span><span class="sxs-lookup"><span data-stu-id="72355-123">A binding is a structure that associates an element of the consumer's structure with a column.</span></span> <span data-ttu-id="72355-124">A associação pode associar o valor de dados, o comprimento e valor de status da coluna.</span><span class="sxs-lookup"><span data-stu-id="72355-124">The binding can bind the data value, length, and status value of the column.</span></span>  
  
 <span data-ttu-id="72355-125">Um conjunto de associações é reunido em um acessador.</span><span class="sxs-lookup"><span data-stu-id="72355-125">A set of bindings is gathered together in an accessor.</span></span> <span data-ttu-id="72355-126">Ele é criado usando o método **IAccessor::CreateAccessor**.</span><span class="sxs-lookup"><span data-stu-id="72355-126">This is created by using the **IAccessor::CreateAccessor** method.</span></span> <span data-ttu-id="72355-127">Um acessador pode conter várias associações, de forma que os dados de várias colunas podem ser recuperados ou definidos em uma única chamada.</span><span class="sxs-lookup"><span data-stu-id="72355-127">An accessor can contain multiple bindings so that the data for multiple columns can be retrieved or set in a single call.</span></span> <span data-ttu-id="72355-128">O consumidor pode criar vários acessadores que correspondem a diversos padrões de uso em diferentes partes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="72355-128">The consumer can create several accessors to match different usage patterns in different parts of the application.</span></span> <span data-ttu-id="72355-129">É possível criar e liberar acessadores enquanto o conjunto de linhas continua existindo.</span><span class="sxs-lookup"><span data-stu-id="72355-129">It can create and release accessors while the rowset remains in existence.</span></span>  
  
 <span data-ttu-id="72355-130">Para buscar linhas do banco de dados, o consumidor chama um método, como **IRowset::GetNextRows** ou **IRowsetLocate::GetRowsAt**.</span><span class="sxs-lookup"><span data-stu-id="72355-130">To fetch rows from the database, the consumer calls a method, such as **IRowset::GetNextRows** or **IRowsetLocate::GetRowsAt**.</span></span> <span data-ttu-id="72355-131">Essas operações de busca colocam dados de linhas do servidor no buffer de linhas do provedor.</span><span class="sxs-lookup"><span data-stu-id="72355-131">These fetch operations put row data from the server into the row buffer of the provider.</span></span> <span data-ttu-id="72355-132">O consumidor não tem acesso direto ao buffer de linhas do provedor.</span><span class="sxs-lookup"><span data-stu-id="72355-132">The consumer does not have direct access to the row buffer of the provider.</span></span> <span data-ttu-id="72355-133">O consumidor usa **IRowset::GetData** para copiar dados do buffer do provedor para o buffer do consumidor e **IRowsetChange::SetData** para copiar alterações de dados do buffer do consumidor para o buffer do provedor.</span><span class="sxs-lookup"><span data-stu-id="72355-133">The consumer uses **IRowset::GetData** to copy data from the buffer of the provider to the consumer buffer and **IRowsetChange::SetData** to copy data changes from the consumer buffer to the provider buffer.</span></span>  
  
 <span data-ttu-id="72355-134">O consumidor chama o método **GetData** e passa o identificador para uma linha, o identificador para um acessador e um ponteiro para um buffer alocado pelo consumidor.</span><span class="sxs-lookup"><span data-stu-id="72355-134">The consumer calls the **GetData** method and passes the handle to a row, the handle to an accessor, and a pointer to a consumer-allocated buffer.</span></span> <span data-ttu-id="72355-135">**GetData** converte os dados e retorna as colunas conforme especificado nas associações usadas para criar o acessador.</span><span class="sxs-lookup"><span data-stu-id="72355-135">**GetData** converts the data and returns the columns as specified in the bindings used to create the accessor.</span></span> <span data-ttu-id="72355-136">O consumidor pode chamar **GetData** mais de uma vez para uma linha, usando acessadores e buffers diferentes; portanto, o consumidor pode obter várias cópias dos mesmos dados.</span><span class="sxs-lookup"><span data-stu-id="72355-136">The consumer can call **GetData** more than one time for a row, using different accessors and buffers and therefore the consumer can obtain multiple copies of the same data.</span></span>  
  
 <span data-ttu-id="72355-137">Os dados de colunas de comprimento variável podem ser tratados de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="72355-137">Data from variable-length columns can be treated several ways.</span></span> <span data-ttu-id="72355-138">Primeiro, essas colunas podem ser associadas com uma seção finita da estrutura do consumidor.</span><span class="sxs-lookup"><span data-stu-id="72355-138">First, such columns can be bound to a finite section of the consumer's structure.</span></span> <span data-ttu-id="72355-139">Isto gera truncamento, quando o comprimento dos dados excede o comprimento do buffer.</span><span class="sxs-lookup"><span data-stu-id="72355-139">This causes truncation when the length of the data exceeds the length of the buffer.</span></span> <span data-ttu-id="72355-140">O consumidor pode determinar se ocorreu truncamento verificando o status DBSTATUS_S_TRUNCATED.</span><span class="sxs-lookup"><span data-stu-id="72355-140">The consumer can determine that truncation has occurred by checking for the status DBSTATUS_S_TRUNCATED.</span></span> <span data-ttu-id="72355-141">O comprimento retornado sempre é o comprimento real em bytes, de forma que o consumidor também pode determinar quantos dados foram truncados.</span><span class="sxs-lookup"><span data-stu-id="72355-141">The returned length is always the true length in bytes, so that the consumer also can determine how much data was truncated.</span></span>  
  
 <span data-ttu-id="72355-142">Quando o consumidor concluir o fetch ou a atualização das linhas, ele as liberará com o método **ReleaseRows**.</span><span class="sxs-lookup"><span data-stu-id="72355-142">When the consumer has finished fetching or updating rows, it releases them with the **ReleaseRows** method.</span></span> <span data-ttu-id="72355-143">Isto libera recursos da cópia das linhas no conjunto de linhas, dando espaço a novas linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-143">This releases resources from the copy of the rows in the rowset and makes room for new rows.</span></span> <span data-ttu-id="72355-144">O consumidor pode repetir então o ciclo de busca ou criação de linhas e acessar os dados contidos nelas.</span><span class="sxs-lookup"><span data-stu-id="72355-144">The consumer can then repeat its cycle of fetching or creating rows and accessing the data in them.</span></span>  
  
 <span data-ttu-id="72355-145">Quando o consumidor conclui o conjunto de linhas, ele chama o método **IAccessor::ReleaseAccessor** para liberar qualquer acessador.</span><span class="sxs-lookup"><span data-stu-id="72355-145">When the consumer is finished with the rowset, it calls the **IAccessor::ReleaseAccessor** method to release any accessor.</span></span> <span data-ttu-id="72355-146">Ele chama o método **IUnknown::Release** em todas as interfaces expostas pelo conjunto de linhas para liberar o conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="72355-146">It calls the **IUnknown::Release** method on all interfaces exposed by the rowset to release the rowset.</span></span> <span data-ttu-id="72355-147">Quando o conjunto de linhas é liberado, é imposta a liberação de todas as linhas ou acessadores restantes que o consumidor possa deter.</span><span class="sxs-lookup"><span data-stu-id="72355-147">When the rowset is released, it forces the release of any remaining rows or accessors the consumer may hold.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="72355-148">Nesta seção</span><span class="sxs-lookup"><span data-stu-id="72355-148">In This Section</span></span>  
  
-   [<span data-ttu-id="72355-149">Próxima posição de busca</span><span class="sxs-lookup"><span data-stu-id="72355-149">Next Fetch Position</span></span>](fetching-rows-next-fetch-position.md)  
  
## <a name="see-also"></a><span data-ttu-id="72355-150">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="72355-150">See Also</span></span>  
 [<span data-ttu-id="72355-151">Conjuntos de linhas</span><span class="sxs-lookup"><span data-stu-id="72355-151">Rowsets</span></span>](rowsets.md)  
  
  
