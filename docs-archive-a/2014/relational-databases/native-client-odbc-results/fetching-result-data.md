---
title: Buscando dados de resultado | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQLFetchScroll function
- SQL Server Native Client ODBC driver, result sets
- ODBC applications, result sets
- data types [ODBC], fetching
- SQLBindCol function
- result sets [ODBC], fetching
- fetching [ODBC]
- ODBC data types, fetching
- SQLFetch function
- SQL Server Native Client ODBC driver, data types
- SQLGetData function
ms.assetid: b289c7fb-5017-4d7e-a2d3-19401e9fc4cd
author: rothja
ms.author: jroth
ms.openlocfilehash: 7eb038d431dd7f733c36e5913d72cdc6a161acad
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685632"
---
# <a name="fetching-result-data"></a><span data-ttu-id="1c91a-102">Buscando dados de resultados</span><span class="sxs-lookup"><span data-stu-id="1c91a-102">Fetching Result Data</span></span>
  <span data-ttu-id="1c91a-103">Um aplicativo ODBC tem três opções para buscar dados de resultados.</span><span class="sxs-lookup"><span data-stu-id="1c91a-103">An ODBC application has three options for fetching result data.</span></span>  
  
 <span data-ttu-id="1c91a-104">A primeira opção se baseia em [SQLBindCol](../native-client-odbc-api/sqlbindcol.md).</span><span class="sxs-lookup"><span data-stu-id="1c91a-104">The first option is based on [SQLBindCol](../native-client-odbc-api/sqlbindcol.md).</span></span> <span data-ttu-id="1c91a-105">Antes de buscar o conjunto de resultados, o aplicativo usa **SQLBindCol** para associar cada coluna no conjunto de resultados a uma variável de programa.</span><span class="sxs-lookup"><span data-stu-id="1c91a-105">Before fetching the result set, the application uses **SQLBindCol** to bind each column in the result set to a program variable.</span></span> <span data-ttu-id="1c91a-106">Depois que as colunas tiverem sido associadas, o driver transferirá os dados da linha atual para as variáveis associadas às colunas do conjunto de resultados cada vez que o aplicativo chamar **SQLFetch** ou [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span><span class="sxs-lookup"><span data-stu-id="1c91a-106">After the columns have been bound, the driver transfers the data of the current row into the variables bound to the result set columns each time the application calls **SQLFetch** or [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span></span> <span data-ttu-id="1c91a-107">O driver manipulará as conversões de dados se a coluna do conjunto de resultados e a variável de programa tiverem tipos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="1c91a-107">The driver handles data conversions if the result set column and program variable have different data types.</span></span> <span data-ttu-id="1c91a-108">Se o aplicativo tiver SQL_ATTR_ROW_ARRAY_SIZE definido como maior que 1, ele poderá associar colunas de resultado a matrizes de variáveis, que serão todas preenchidas em cada chamada para **SQLFetchScroll**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-108">If the application has SQL_ATTR_ROW_ARRAY_SIZE set greater than 1, it can bind result columns to arrays of variables, which will all be filled on each call to **SQLFetchScroll**.</span></span>  
  
 <span data-ttu-id="1c91a-109">A segunda opção se baseia em [SQLGetData](../native-client-odbc-api/sqlgetdata.md).</span><span class="sxs-lookup"><span data-stu-id="1c91a-109">The second option is based on [SQLGetData](../native-client-odbc-api/sqlgetdata.md).</span></span> <span data-ttu-id="1c91a-110">O aplicativo não usa **SQLBindCol** para associar colunas de conjunto de resultados a variáveis de programa.</span><span class="sxs-lookup"><span data-stu-id="1c91a-110">The application does not use **SQLBindCol** to bind result set columns to program variables.</span></span> <span data-ttu-id="1c91a-111">Após cada chamada para **SQLFetch**, o aplicativo chama **SQLGetData** uma vez para cada coluna no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="1c91a-111">After each call to **SQLFetch**, the application calls **SQLGetData** once for each column in the result set.</span></span> <span data-ttu-id="1c91a-112">O **SQLGetData** instrui o driver a transferir dados de uma coluna de conjunto de resultados específica para uma variável de programa específica e especifica os tipos de dados da coluna e da variável.</span><span class="sxs-lookup"><span data-stu-id="1c91a-112">**SQLGetData** instructs the driver to transfer data from a specific result set column to a specific program variable and specifies the data types of the column and variable.</span></span> <span data-ttu-id="1c91a-113">Isso permitirá que o driver converta os dados se a coluna de resultados e a variável de programa tiverem tipos de dados diferentes.</span><span class="sxs-lookup"><span data-stu-id="1c91a-113">This allows the driver to convert data if the result column and program variable have different data types.</span></span> <span data-ttu-id="1c91a-114">As colunas **Text**, **ntext**e **Image** normalmente são muito grandes para caber em uma variável de programa, mas ainda podem ser recuperadas usando **SQLGetData**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-114">**Text**, **ntext**, and **image** columns are typically too large to fit into a program variable but can still be retrieved using **SQLGetData**.</span></span> <span data-ttu-id="1c91a-115">Se os dados **Text**, **ntext**ou **Image** na coluna Result forem maiores que a variável Program, **SQLGetData** retornará SQL_SUCCESS_WITH_INFO e SQLSTATE 01004 (dados de cadeia de caracteres, truncados à direita).</span><span class="sxs-lookup"><span data-stu-id="1c91a-115">If the **text**, **ntext**, or **image** data in the result column is larger than the program variable, **SQLGetData** returns SQL_SUCCESS_WITH_INFO and SQLSTATE 01004 (string data, right truncated).</span></span> <span data-ttu-id="1c91a-116">As chamadas sucessivas para **SQLGetData** retornam partes sucessivas dos dados de **texto** ou **imagem** .</span><span class="sxs-lookup"><span data-stu-id="1c91a-116">Successive calls to **SQLGetData** return successive chunks of the **text** or **image** data.</span></span> <span data-ttu-id="1c91a-117">Quando o final dos dados é atingido, **SQLGetData** retorna SQL_SUCCESS.</span><span class="sxs-lookup"><span data-stu-id="1c91a-117">When the end of the data is reached, **SQLGetData** returns SQL_SUCCESS.</span></span> <span data-ttu-id="1c91a-118">Cada busca retornará um conjunto de linhas se SQL_ATTR_ROW_ARRAY_SIZE for maior do que 1.</span><span class="sxs-lookup"><span data-stu-id="1c91a-118">Each fetch returns a set of rows, or rowset, if SQL_ATTR_ROW_ARRAY_SIZE is greater than 1.</span></span> <span data-ttu-id="1c91a-119">Antes de usar **SQLGetData**, você deve primeiro usar **SQLSetPos** para especificar uma linha específica dentro do conjunto de linhas como a linha atual.</span><span class="sxs-lookup"><span data-stu-id="1c91a-119">Before using **SQLGetData**, you must first use **SQLSetPos** to specify a specific row within the rowset as the current row.</span></span>  
  
 <span data-ttu-id="1c91a-120">A terceira opção é usar uma combinação de **SQLBindCol** e **SQLGetData**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-120">The third option is to use a mix of **SQLBindCol** and **SQLGetData**.</span></span> <span data-ttu-id="1c91a-121">Um aplicativo poderia, por exemplo, associar as dez primeiras colunas de um conjunto de resultados e, em seguida, em cada busca, chamar **SQLGetData** três vezes para recuperar os dados de três colunas desassociadas.</span><span class="sxs-lookup"><span data-stu-id="1c91a-121">An application could, for example, bind the first ten columns of a result set and then, on each fetch, call **SQLGetData** three times to retrieve the data from three unbound columns.</span></span> <span data-ttu-id="1c91a-122">Isso normalmente seria usado quando um conjunto de resultados contiver uma ou mais colunas de **texto** ou **imagem** .</span><span class="sxs-lookup"><span data-stu-id="1c91a-122">This would typically be used when a result set contains one or more **text** or **image** columns.</span></span>  
  
 <span data-ttu-id="1c91a-123">Dependendo das opções de cursor definidas para o conjunto de resultados, um aplicativo também pode usar as opções de rolagem de **SQLFetchScroll** para rolar em volta do conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="1c91a-123">Depending on the cursor options set for the result set, an application can also use the scrolling options of **SQLFetchScroll** to scroll around the result set.</span></span>  
  
 <span data-ttu-id="1c91a-124">O uso excessivo de **SQLBindCol** para associar uma coluna de conjunto de resultados a uma variável de programa é caro porque o **SQLBindCol** faz com que um driver ODBC aloque memória.</span><span class="sxs-lookup"><span data-stu-id="1c91a-124">Excess use of **SQLBindCol** to bind a result set column to a program variable is expensive because **SQLBindCol** causes an ODBC driver to allocate memory.</span></span> <span data-ttu-id="1c91a-125">Quando você associa uma coluna de resultado a uma variável, essa associação permanece em vigor até que você chame [SQLFreeHandle](../native-client-odbc-api/sqlfreehandle.md) para liberar o identificador de instrução ou chamar [SQLFreeStmt](../native-client-odbc-api/sqlfreestmt.md) com *fOption* definido como SQL_UNBIND.</span><span class="sxs-lookup"><span data-stu-id="1c91a-125">When you bind a result column to a variable, that binding remains in effect until you either call [SQLFreeHandle](../native-client-odbc-api/sqlfreehandle.md) to free the statement handle or call [SQLFreeStmt](../native-client-odbc-api/sqlfreestmt.md) with *fOption* set to SQL_UNBIND.</span></span> <span data-ttu-id="1c91a-126">As associações não são desfeitas automaticamente quando a instrução é concluída.</span><span class="sxs-lookup"><span data-stu-id="1c91a-126">The bindings are not automatically undone when the statement completes.</span></span>  
  
 <span data-ttu-id="1c91a-127">Essa lógica permite lidar efetivamente com a execução da mesma instrução SELECT várias vezes com parâmetros diferentes.</span><span class="sxs-lookup"><span data-stu-id="1c91a-127">This logic allows you to effectively deal with executing the same SELECT statement several times with different parameters.</span></span> <span data-ttu-id="1c91a-128">Como o conjunto de resultados mantém a mesma estrutura, você pode associar o conjunto de resultados uma vez, processar todas as instruções SELECT e, em seguida, chamar **SQLFreeStmt** com *fOption* definido como SQL_UNBIND após a última execução.</span><span class="sxs-lookup"><span data-stu-id="1c91a-128">Because the result set keeps the same structure, you can bind the result set once, process all the SELECT statements, then call **SQLFreeStmt** with *fOption* set to SQL_UNBIND after the last execution.</span></span> <span data-ttu-id="1c91a-129">Você não deve chamar **SQLBindCol** para associar as colunas em um conjunto de resultados sem primeiro chamar **SQLFreeStmt** com *fOption* definido como SQL_UNBIND para liberar quaisquer associações anteriores.</span><span class="sxs-lookup"><span data-stu-id="1c91a-129">You should not call **SQLBindCol** to bind the columns in a result set without first calling **SQLFreeStmt** with *fOption* set to SQL_UNBIND to free any previous bindings.</span></span>  
  
 <span data-ttu-id="1c91a-130">Ao usar o **SQLBindCol**, você pode fazer uma associação de linha ou de coluna.</span><span class="sxs-lookup"><span data-stu-id="1c91a-130">When using **SQLBindCol**, you can either do row-wise or column-wise binding.</span></span> <span data-ttu-id="1c91a-131">A associação por linha é um pouco mais rápida do que a associação por coluna.</span><span class="sxs-lookup"><span data-stu-id="1c91a-131">Row-wise binding is somewhat faster than column-wise binding.</span></span>  
  
 <span data-ttu-id="1c91a-132">Você pode usar **SQLGetData** para recuperar dados de uma base coluna a coluna em vez de associar colunas de conjunto de resultados usando **SQLBindCol**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-132">You can use **SQLGetData** to retrieve data on a column-by-column basis instead of binding result set columns using **SQLBindCol**.</span></span> <span data-ttu-id="1c91a-133">Se um conjunto de resultados contiver apenas algumas linhas, usar **SQLGetData** em vez de **SQLBindCol** será mais rápido; caso contrário, o **SQLBindCol** fornecerá o melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="1c91a-133">If a result set contains only a few rows, using **SQLGetData** instead of **SQLBindCol** is faster; otherwise, **SQLBindCol** gives the best performance.</span></span> <span data-ttu-id="1c91a-134">Se você nem sempre colocar os dados no mesmo conjunto de variáveis, deverá usar **SQLGetData** em vez de reassociar constantemente.</span><span class="sxs-lookup"><span data-stu-id="1c91a-134">If you do not always put the data in the same set of variables, you should use **SQLGetData** instead of constantly rebinding.</span></span> <span data-ttu-id="1c91a-135">Você só pode usar **SQLGetData** em colunas que estejam na lista de seleção depois que todas as colunas estiverem associadas a **SQLBindCol**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-135">You can only use **SQLGetData** on columns that are in the select list after all columns are bound with **SQLBindCol**.</span></span> <span data-ttu-id="1c91a-136">A coluna também deve aparecer após qualquer coluna na qual você já tenha usado **SQLGetData**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-136">The column must also appear after any columns on which you have already used **SQLGetData**.</span></span>  
  
 <span data-ttu-id="1c91a-137">As funções ODBC que lidam com a movimentação de dados para dentro ou fora de variáveis de programa, como **SQLGetData**, **SQLBindCol**e [SQLBindParameter](../native-client-odbc-api/sqlbindparameter.md), dão suporte à conversão de tipo de dados implícito.</span><span class="sxs-lookup"><span data-stu-id="1c91a-137">The ODBC functions that deal with moving data into or out of program variables, such as **SQLGetData**, **SQLBindCol**, and [SQLBindParameter](../native-client-odbc-api/sqlbindparameter.md), support implicit data type conversion.</span></span> <span data-ttu-id="1c91a-138">Por exemplo, se um aplicativo associar uma coluna inteira a uma variável de programa de cadeia de caracteres, o driver converterá automaticamente os dados de inteiro em caractere antes de colocá-lo na variável de programa.</span><span class="sxs-lookup"><span data-stu-id="1c91a-138">For example, if an application binds an integer column to a character string program variable, the driver automatically converts the data from integer to character before placing it into the program variable.</span></span>  
  
 <span data-ttu-id="1c91a-139">A conversão de dados em aplicativos deve ser minimizada.</span><span class="sxs-lookup"><span data-stu-id="1c91a-139">Data conversion in applications should be minimized.</span></span> <span data-ttu-id="1c91a-140">A menos que a conversão de dados seja necessária ao processamento executado pelo aplicativo, os aplicativos devem associar colunas e parâmetros a variáveis de programa do mesmo tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="1c91a-140">Unless data conversion is required for the processing done by the application, applications should bind columns and parameters to program variables of the same data type.</span></span> <span data-ttu-id="1c91a-141">Se for necessário converter os dados entre um tipo e outro, entretanto, será mais eficiente fazer com que o driver execute a conversão do que fazê-lo no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1c91a-141">If the data must be converted from one type to another, however, it is more efficient to have the driver do the conversion than doing it in the application.</span></span> <span data-ttu-id="1c91a-142">O driver ODBC do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client normalmente só transfere dados diretamente dos buffers de rede para as variáveis do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1c91a-142">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver normally just transfers data directly from the network buffers to the variables of the application.</span></span> <span data-ttu-id="1c91a-143">A solicitação do driver para fazer a conversão dos dados obriga o driver a armazenar em buffer os dados e os ciclos de CPU de uso para convertê-los.</span><span class="sxs-lookup"><span data-stu-id="1c91a-143">Requesting the driver to do data conversion forces the driver to buffer the data and use CPU cycles to convert the data.</span></span>  
  
 <span data-ttu-id="1c91a-144">As variáveis de programa devem ser grandes o suficiente para manter os dados transferidos de uma coluna, exceto os dados de **Text**, **ntext**e **Image** .</span><span class="sxs-lookup"><span data-stu-id="1c91a-144">Program variables should be large enough to hold data transferred in from a column, except for **text**, **ntext**, and **image** data.</span></span> <span data-ttu-id="1c91a-145">Se um aplicativo tentar recuperar os dados do conjunto de resultados e colocá-los em uma variável pequena demais para retê-los, o driver gerará um aviso.</span><span class="sxs-lookup"><span data-stu-id="1c91a-145">If an application attempts to retrieve result set data and place it into a variable that is too small to hold it, the driver generates a warning.</span></span> <span data-ttu-id="1c91a-146">Isso obriga o driver a alocar memória para a mensagem, e o driver e o aplicativo têm de gastar ciclos de CPU processando a mensagem e manipulando o erro.</span><span class="sxs-lookup"><span data-stu-id="1c91a-146">This forces the driver to allocate memory for the message, and the driver and application both have to spend CPU cycles processing the message and doing error handling.</span></span> <span data-ttu-id="1c91a-147">O aplicativo deve alocar uma variável grande o suficiente para reter os dados que estão sendo recuperados ou usar a função SUBSTRING na lista de seleção para reduzir o tamanho da coluna no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="1c91a-147">The application should either allocate a variable large enough to hold the data being retrieved or use the SUBSTRING function in the select list to reduce the size of the column in the result set.</span></span>  
  
 <span data-ttu-id="1c91a-148">É necessário ter cuidado ao usar SQL_C_DEFAULT para especificar o tipo da variável C.</span><span class="sxs-lookup"><span data-stu-id="1c91a-148">Care must be taken when using SQL_C_DEFAULT to specify the type of the C variable.</span></span> <span data-ttu-id="1c91a-149">SQL_C_DEFAULT especifica que o tipo da variável C corresponde ao tipo de dados SQL da coluna ou parâmetro.</span><span class="sxs-lookup"><span data-stu-id="1c91a-149">SQL_C_DEFAULT specifies that the type of the C variable matches the SQL data type of the column or parameter.</span></span> <span data-ttu-id="1c91a-150">Se SQL_C_DEFAULT for especificado para uma coluna **ntext**, **nchar**ou **nvarchar** , os dados Unicode serão retornados para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1c91a-150">If SQL_C_DEFAULT is specified for an **ntext**, **nchar**, or **nvarchar** column, Unicode data is returned to the application.</span></span> <span data-ttu-id="1c91a-151">Isso poderá causar vários problemas se o aplicativo não foi codificado para manipular dados Unicode.</span><span class="sxs-lookup"><span data-stu-id="1c91a-151">This can cause various problems if the application has not been coded to handle Unicode data.</span></span> <span data-ttu-id="1c91a-152">Os mesmos tipos de problemas podem ocorrer com o tipo de dados **uniqueidentifier** (SQL_GUID).</span><span class="sxs-lookup"><span data-stu-id="1c91a-152">The same types of problems can occur with the **uniqueidentifier** (SQL_GUID) data type.</span></span>  
  
 <span data-ttu-id="1c91a-153">dados de **Text**, **ntext**e **Image** normalmente são muito grandes para caber em uma única variável de programa e geralmente são processados com **SQLGetData** em vez de **SQLBindCol**.</span><span class="sxs-lookup"><span data-stu-id="1c91a-153">**text**, **ntext**, and **image** data is typically too large to fit into a single program variable, and is usually processed with **SQLGetData** instead of **SQLBindCol**.</span></span> <span data-ttu-id="1c91a-154">Ao usar cursores de servidor, o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] driver ODBC do Native Client é otimizado para não transmitir os dados para colunas **Text**, **ntext**ou **Image** não associadas no momento em que a linha é buscada.</span><span class="sxs-lookup"><span data-stu-id="1c91a-154">When using server cursors, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver is optimized to not transmit the data for unbound **text**, **ntext**, or **image** columns at the time the row is fetched.</span></span> <span data-ttu-id="1c91a-155">Os dados **Text**, **ntext**ou **Image** não são realmente recuperados do servidor até que o aplicativo emita **SQLGetData** para a coluna.</span><span class="sxs-lookup"><span data-stu-id="1c91a-155">The **text**, **ntext**, or **image** data is not actually retrieved from the server until the application issues **SQLGetData** for the column.</span></span>  
  
 <span data-ttu-id="1c91a-156">Essa otimização pode ser aplicada a aplicativos para que nenhum dado de **Text**, **ntext**ou **Image** seja exibido enquanto um usuário estiver rolando para cima e abaixando um cursor.</span><span class="sxs-lookup"><span data-stu-id="1c91a-156">This optimization can be applied to applications so that no **text**, **ntext**, or **image** data is displayed while a user is scrolling up and down a cursor.</span></span> <span data-ttu-id="1c91a-157">Depois que o usuário seleciona uma linha, o aplicativo pode chamar **SQLGetData** para recuperar os dados **Text**, **ntext**ou **Image** .</span><span class="sxs-lookup"><span data-stu-id="1c91a-157">After the user selects a row, the application can call **SQLGetData** to retrieve the **text**, **ntext**, or **image** data.</span></span> <span data-ttu-id="1c91a-158">Isso salva a transmissão dos dados **Text**, **ntext**ou **Image** para qualquer uma das linhas que o usuário não seleciona e pode salvar a transmissão de grandes quantidades de dados.</span><span class="sxs-lookup"><span data-stu-id="1c91a-158">This saves transmitting the **text**, **ntext**, or **image** data for any of the rows the user does not select and can save the transmission of very large amounts of data.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1c91a-159">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="1c91a-159">See Also</span></span>  
 [<span data-ttu-id="1c91a-160">Processando resultados &#40;&#41;ODBC</span><span class="sxs-lookup"><span data-stu-id="1c91a-160">Processing Results &#40;ODBC&#41;</span></span>](processing-results-odbc.md)  
  
  
