---
title: Execução preparada | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- deferred statement preparation
- prepared execution [ODBC]
- SQLPrepare function
- ODBC applications, statements
- SQLExecute function
- statements [ODBC], prepared execution
ms.assetid: f3a9d32b-6cd7-4f0c-b38d-c8ccc4ee40c3
author: rothja
ms.author: jroth
ms.openlocfilehash: 33ab9f35cd9d3eaf04e688a89390b5eb3f00ae58
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87569410"
---
# <a name="prepared-execution"></a><span data-ttu-id="29e96-102">Execução preparada</span><span class="sxs-lookup"><span data-stu-id="29e96-102">Prepared Execution</span></span>
  <span data-ttu-id="29e96-103">A API do ODBC define a execução preparada como um modo de reduzir a sobrecarga de análise e compilação associada à execução repetida da instrução [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="29e96-103">The ODBC API defines prepared execution as a way to reduce the parsing and compiling overhead associated with repeatedly executing a [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="29e96-104">O aplicativo compila uma cadeia de caracteres que contém uma instrução SQL e então a executa em duas fases.</span><span class="sxs-lookup"><span data-stu-id="29e96-104">The application builds a character string containing an SQL statement and then executes it in two stages.</span></span> <span data-ttu-id="29e96-105">Ele chama a [função SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360) uma vez para que a instrução seja analisada e compilada em um plano de execução pelo [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="29e96-105">It calls [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360) once to have the statement parsed and compiled into an execution plan by the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="29e96-106">Em seguida, ele chama **SQLExecute** para cada execução do plano de execução preparado.</span><span class="sxs-lookup"><span data-stu-id="29e96-106">It then calls **SQLExecute** for each execution of the prepared execution plan.</span></span> <span data-ttu-id="29e96-107">Dessa forma, a sobrecarga de análise e compilação é salva em cada execução.</span><span class="sxs-lookup"><span data-stu-id="29e96-107">This saves the parsing and compiling overhead on each execution.</span></span> <span data-ttu-id="29e96-108">A execução preparada geralmente é usada através de aplicativos para executar a mesma instrução SQL com parâmetros várias vezes.</span><span class="sxs-lookup"><span data-stu-id="29e96-108">Prepared execution is commonly used by applications to repeatedly execute the same, parameterized SQL statement.</span></span>  
  
 <span data-ttu-id="29e96-109">Para a maioria dos bancos de dados, a execução preparada é mais rápida que a direta para instruções executadas mais de três ou quatro vezes primariamente, pois a instrução é compilada somente uma vez, enquanto instruções executadas diretamente são compiladas sempre que ocorrem.</span><span class="sxs-lookup"><span data-stu-id="29e96-109">For most databases, prepared execution is faster than direct execution for statements executed more than three or four times primarily because the statement is compiled only once, while statements executed directly are compiled each time they are executed.</span></span> <span data-ttu-id="29e96-110">A execução preparada também pode fornecer uma redução no tráfego de rede, pois o driver pode enviar um identificador do plano de execução e os valores de parâmetro, em vez de toda uma instrução SQL, para a fonte de dados sempre que a instrução for executada.</span><span class="sxs-lookup"><span data-stu-id="29e96-110">Prepared execution can also provide a reduction in network traffic because the driver can send an execution plan identifier and the parameter values, rather than an entire SQL statement, to the data source each time the statement is executed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="29e96-111">reduz a diferença de desempenho entre a execução direta e preparada por meio de algoritmos aprimorados para detectar e reutilizar planos de execução de **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="29e96-111">reduces the performance difference between direct and prepared execution through improved algorithms for detecting and reusing execution plans from **SQLExecDirect**.</span></span> <span data-ttu-id="29e96-112">Isso torna alguns dos benefícios de desempenho da execução preparada disponíveis para instruções executadas diretamente.</span><span class="sxs-lookup"><span data-stu-id="29e96-112">This makes some of the performance benefits of prepared execution available to statements executed directly.</span></span> <span data-ttu-id="29e96-113">Para obter mais informações, consulte [execução direta](direct-execution.md).</span><span class="sxs-lookup"><span data-stu-id="29e96-113">For more information, see [Direct Execution](direct-execution.md).</span></span>  
  
 <span data-ttu-id="29e96-114">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] também oferece suporte nativo para execução preparada.</span><span class="sxs-lookup"><span data-stu-id="29e96-114">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] also provides native support for prepared execution.</span></span> <span data-ttu-id="29e96-115">Um plano de execução é criado em **SQLPrepare** e executado posteriormente quando **SQLExecute** é chamado.</span><span class="sxs-lookup"><span data-stu-id="29e96-115">An execution plan is built on **SQLPrepare** and later executed when **SQLExecute** is called.</span></span> <span data-ttu-id="29e96-116">Como [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] o não é necessário para criar procedimentos armazenados temporários em **SQLPrepare**, não há nenhuma sobrecarga extra nas tabelas do sistema em **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="29e96-116">Because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not required to build temporary stored procedures on **SQLPrepare**, there is no extra overhead on the system tables in **tempdb**.</span></span>  
  
 <span data-ttu-id="29e96-117">Por motivos de desempenho, a preparação da instrução é adiada até que **SQLExecute** seja chamado ou uma operação de metapropriedade (como [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) ou [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) no ODBC) seja executada.</span><span class="sxs-lookup"><span data-stu-id="29e96-117">For performance reasons, the statement preparation is deferred until **SQLExecute** is called or a metaproperty operation (such as [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) or [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC) is performed.</span></span> <span data-ttu-id="29e96-118">Esse é o comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="29e96-118">This is the default behavior.</span></span> <span data-ttu-id="29e96-119">Não são conhecidos erros na instrução que está sendo preparada até que ela seja executada ou uma operação de metapropriedade seja executada.</span><span class="sxs-lookup"><span data-stu-id="29e96-119">Any errors in the statement being prepared are not known until the statement is executed or a metaproperty operation is performed.</span></span> <span data-ttu-id="29e96-120">Definir o atributo da instrução específica do driver ODBC do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client SQL_SOPT_SS_DEFER_PREPARE como SQL_DP_OFF pode desativar esse comportamento padrão.</span><span class="sxs-lookup"><span data-stu-id="29e96-120">Setting the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver-specific statement attribute SQL_SOPT_SS_DEFER_PREPARE to SQL_DP_OFF can turn off this default behavior.</span></span>  
  
 <span data-ttu-id="29e96-121">No caso da preparação adiada, chamar **SQLDescribeCol** ou **SQLDescribeParam** antes de chamar **SQLExecute** gera um ida e volta extra para o servidor.</span><span class="sxs-lookup"><span data-stu-id="29e96-121">In case of deferred prepare, calling either **SQLDescribeCol** or **SQLDescribeParam** before calling **SQLExecute** generates an extra roundtrip to the server.</span></span> <span data-ttu-id="29e96-122">No **SQLDescribeCol**, o driver remove a cláusula WHERE da consulta e a envia ao servidor com SET FMTONLY on para obter a descrição das colunas no primeiro conjunto de resultados retornado pela consulta.</span><span class="sxs-lookup"><span data-stu-id="29e96-122">On **SQLDescribeCol**, the driver removes the WHERE clause from the query and sends it to the server with SET FMTONLY ON to get the description of the columns in the first result set returned by the query.</span></span> <span data-ttu-id="29e96-123">No **SQLDescribeParam**, o driver chama o servidor para obter uma descrição das expressões ou colunas referenciadas por quaisquer marcadores de parâmetro na consulta.</span><span class="sxs-lookup"><span data-stu-id="29e96-123">On **SQLDescribeParam**, the driver calls the server to get a description of the expressions or columns referenced by any parameter markers in the query.</span></span> <span data-ttu-id="29e96-124">Esse método também tem algumas restrições, como não poder resolver parâmetros em subconsultas.</span><span class="sxs-lookup"><span data-stu-id="29e96-124">This method also has some restrictions, such as not being able to resolve parameters in subqueries.</span></span>  
  
 <span data-ttu-id="29e96-125">O uso excessivo de **SQLPrepare** com o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] driver ODBC do Native Client degrada o desempenho, especialmente quando conectado a versões anteriores do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="29e96-125">Excess use of **SQLPrepare** with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver degrades performance, especially when connected to earlier versions of SQL Server.</span></span> <span data-ttu-id="29e96-126">A execução preparada não deve ser usada para instruções executadas uma única vez.</span><span class="sxs-lookup"><span data-stu-id="29e96-126">Prepared execution should not be used for statements executed a single time.</span></span> <span data-ttu-id="29e96-127">A execução preparada é mais lenta que a direta para uma única execução de instrução, pois ela requer uma viagem de ida e volta extra do cliente ao servidor.</span><span class="sxs-lookup"><span data-stu-id="29e96-127">Prepared execution is slower than direct execution for a single execution of a statement because it requires an extra network roundtrip from the client to the server.</span></span> <span data-ttu-id="29e96-128">Em versões anteriores do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], ela também gera um procedimento armazenado temporário.</span><span class="sxs-lookup"><span data-stu-id="29e96-128">On earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] it also generates a temporary stored procedure.</span></span>  
  
 <span data-ttu-id="29e96-129">As instruções preparadas não podem ser usadas para criar objetos temporários no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="29e96-129">Prepared statements cannot be used to create temporary objects on [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="29e96-130">Alguns aplicativos ODBC iniciais usaram **SQLPrepare** sempre que [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) foi usado.</span><span class="sxs-lookup"><span data-stu-id="29e96-130">Some early ODBC applications used **SQLPrepare** any time [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) was used.</span></span> <span data-ttu-id="29e96-131">**SQLBindParameter** não requer o uso de **SQLPrepare**, ele pode ser usado com **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="29e96-131">**SQLBindParameter** does not require the use of **SQLPrepare**, it can be used with **SQLExecDirect**.</span></span> <span data-ttu-id="29e96-132">Por exemplo, use **SQLExecDirect** com **SQLBindParameter** para recuperar o código de retorno ou os parâmetros de saída de um procedimento armazenado que é executado apenas uma vez.</span><span class="sxs-lookup"><span data-stu-id="29e96-132">For example, use **SQLExecDirect** with **SQLBindParameter** to retrieve the return code or output parameters from a stored procedure that is only executed one time.</span></span> <span data-ttu-id="29e96-133">Não use o **SQLPrepare** com **SQLBindParameter** , a menos que a mesma instrução seja executada várias vezes.</span><span class="sxs-lookup"><span data-stu-id="29e96-133">Do not use **SQLPrepare** with **SQLBindParameter** unless the same statement will be executed multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="29e96-134">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="29e96-134">See Also</span></span>  
 [<span data-ttu-id="29e96-135">Executando instruções &#40;&#41;ODBC</span><span class="sxs-lookup"><span data-stu-id="29e96-135">Executing Statements &#40;ODBC&#41;</span></span>](executing-statements-odbc.md)  
  
  
