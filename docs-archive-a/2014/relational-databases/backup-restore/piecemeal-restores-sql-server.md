---
title: Restaurações por etapas (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- partial updates [SQL Server]
- staged restores [SQL Server]
- piecemeal restores [SQL Server]
- restoring [SQL Server], piecemeal restore scenario
ms.assetid: 208f55e0-0762-4cfb-85c4-d36a76ea0f5b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: ebc4ea11780908f847946a01338571211b57678a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87680491"
---
# <a name="piecemeal-restores-sql-server"></a><span data-ttu-id="536bd-102">Restaurações por etapas (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="536bd-102">Piecemeal Restores (SQL Server)</span></span>
  <span data-ttu-id="536bd-103">Este tópico é relevante apenas para os bancos de dados na edição Enterprise do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que contêm vários arquivos ou grupos de arquivos. No modelo simples, ele é relevante apenas para grupos de arquivos somente leitura.</span><span class="sxs-lookup"><span data-stu-id="536bd-103">This topic is relevant only for databases in the Enterprise edition of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that contain multiple files or filegroups; and, under the simple model, only for read-only filegroups.</span></span>  
  
 <span data-ttu-id="536bd-104">Para obter informações sobre a restauração por etapas e as tabelas com otimização de memória, consulte [Restauração por etapas de bancos de dados com tabelas com otimização de memória](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="536bd-104">For information about piecemeal restore and memory-optimized tables, see [Piecemeal Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
 <span data-ttu-id="536bd-105">A*restauração por etapas* permite que os bancos de dados que contêm vários grupos de arquivos sejam restaurados e recuperados em etapas.</span><span class="sxs-lookup"><span data-stu-id="536bd-105">*Piecemeal restore* allows databases that contain multiple filegroups to be restored and recovered in stages.</span></span> <span data-ttu-id="536bd-106">A restauração por etapas envolve uma série de sequências de restauração, iniciando com o grupo de arquivos primário e, em alguns casos, com um ou mais grupos de arquivos secundários.</span><span class="sxs-lookup"><span data-stu-id="536bd-106">Piecemeal restore involves a series of restore sequences, starting with the primary filegroup and, in some cases, one or more secondary filegroups.</span></span> <span data-ttu-id="536bd-107">A restauração por etapas mantém verificações para garantir que o banco de dados será consistente no final.</span><span class="sxs-lookup"><span data-stu-id="536bd-107">Piecemeal restore maintains checks to ensure that the database will be consistent in the end.</span></span> <span data-ttu-id="536bd-108">Depois que a sequência de restauração é concluída, os arquivos recuperados, se forem válidos e consistentes com o banco de dados, poderão ser colocados online diretamente.</span><span class="sxs-lookup"><span data-stu-id="536bd-108">After the restore sequence is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="536bd-109">A restauração por etapas trabalha com todos os modelos de recuperação, mas é mais flexível para os modelos completo e bulk-logged, do que para o modelo simples.</span><span class="sxs-lookup"><span data-stu-id="536bd-109">Piecemeal restore works with all recovery models, but is more flexible for the full and bulk-logged models than for the simple model.</span></span>  
  
 <span data-ttu-id="536bd-110">Toda restauração por etapas inicia com uma sequência inicial de restauração chamada de *sequência de restauração parcial*.</span><span class="sxs-lookup"><span data-stu-id="536bd-110">Every piecemeal restore starts with an initial restore sequence called the *partial-restore sequence*.</span></span> <span data-ttu-id="536bd-111">No mínimo, a sequência de restauração parcial restaura e recupera o grupo de arquivos primário e, no modelo simples de recuperação, todos os grupos de arquivos de leitura/gravação.</span><span class="sxs-lookup"><span data-stu-id="536bd-111">Minimally, the partial-restore sequence restores and recovers the primary filegroup and, under the simple recovery model, all read/write filegroups.</span></span> <span data-ttu-id="536bd-112">Durante a sequência de restauração por etapas, o banco de dados inteiro precisa estar offline.</span><span class="sxs-lookup"><span data-stu-id="536bd-112">During the piecemeal-restore sequence, the whole database must go offline.</span></span> <span data-ttu-id="536bd-113">Depois disso, o banco de dados ficará online e os grupos de arquivos restaurados estarão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="536bd-113">Thereafter, the database is online and restored filegroups are available.</span></span> <span data-ttu-id="536bd-114">No entanto, quaisquer grupos de arquivos não restaurados permanecerão offline e não serão acessíveis.</span><span class="sxs-lookup"><span data-stu-id="536bd-114">However, any unrestored filegroups remain offline and are not accessible.</span></span> <span data-ttu-id="536bd-115">No entanto, quaisquer grupos de arquivos offline poderão ser restaurados e colocados online mais tarde por uma restauração de arquivo.</span><span class="sxs-lookup"><span data-stu-id="536bd-115">Any offline filegroups, however, can be restored and brought online later by a file restore.</span></span>  
  
 <span data-ttu-id="536bd-116">Independentemente do modelo de recuperação usado pelo banco de dados, a sequência de restauração parcial inicia com uma instrução RESTORE DATABASE que restaura um backup completo e especifica a opção PARTIAL.</span><span class="sxs-lookup"><span data-stu-id="536bd-116">Regardless of the recovery model that is used by the database, the partial-restore sequence starts with a RESTORE DATABASE statement that restores a full backup and specifies the PARTIAL option.</span></span> <span data-ttu-id="536bd-117">A opção PARTIAL sempre inicia uma nova restauração por etapas; portanto, você deve especificar PARTIAL só uma vez na instrução inicial da sequência de restauração parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-117">The PARTIAL option always starts a new piecemeal restore; therefore, you must specify PARTIAL only one time in the initial statement of the partial-restore sequence.</span></span> <span data-ttu-id="536bd-118">Quando a sequência de restauração parcial termina e o banco de dados é colocado online, o estado dos arquivos restantes ficam em "recuperação pendente" porque a sua recuperação foi adiada.</span><span class="sxs-lookup"><span data-stu-id="536bd-118">When the partial restore sequence finishes and the database is brought online, the state of the remaining files becomes "recovery pending" because their recovery has been postponed.</span></span>  
  
 <span data-ttu-id="536bd-119">Subsequentemente, uma restauração por etapas tipicamente inclui uma ou mais sequências de restauração que são chamadas *sequências de restauração de grupos de arquivos*.</span><span class="sxs-lookup"><span data-stu-id="536bd-119">Subsequently, a piecemeal restore typically includes one or more restore sequences, which are called *filegroup-restore sequences*.</span></span> <span data-ttu-id="536bd-120">Você pode esperar para executar uma sequência de restauração de grupos de arquivos específica o quanto quiser.</span><span class="sxs-lookup"><span data-stu-id="536bd-120">You can wait to perform a specific filegroup-restore sequence for as long as you want.</span></span> <span data-ttu-id="536bd-121">Cada sequência de restauração de grupos de arquivos restaura e recupera um ou mais grupos de arquivos offline a um ponto consistente com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="536bd-121">Each filegroup-restore sequence restores and recovers one or more offline filegroups to a point consistent with the database.</span></span> <span data-ttu-id="536bd-122">O tempo e número de sequências de restauração de grupos de arquivos dependem de sua meta de recuperação, o número de grupos de arquivos offline que você quer restaurar, e quantos deles você vai restaurar por sequência de restauração de grupos de arquivos.</span><span class="sxs-lookup"><span data-stu-id="536bd-122">The timing and number of filegroup-restore sequences depends on your recovery goal, the number of offline filegroups you want to restore, and on how many of them you restore per filegroup-restore sequence.</span></span>  
  
 <span data-ttu-id="536bd-123">Os requisitos exatos para executar uma restauração por etapas dependem do modelo de recuperação do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="536bd-123">The exact requirements for performing a piecemeal restore depend on the recovery model of the database.</span></span> <span data-ttu-id="536bd-124">Para obter mais informações, veja "Restauração por etapas no modelo de recuperação simples" e "Restauração por etapas no modelo de recuperação completo", adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="536bd-124">For more information, see "Piecemeal Restore Under the Simple Recovery Model" and "Piecemeal Restore Under the Full Recovery Model," later in this topic.</span></span>  
  
## <a name="piecemeal-restore-scenarios"></a><span data-ttu-id="536bd-125">Cenários de restauração por etapas</span><span class="sxs-lookup"><span data-stu-id="536bd-125">Piecemeal Restore Scenarios</span></span>  
 <span data-ttu-id="536bd-126">Todas as edições do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] dão suporte a restauração por etapas offline.</span><span class="sxs-lookup"><span data-stu-id="536bd-126">All editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] support offline piecemeal restores.</span></span> <span data-ttu-id="536bd-127">Na edição Enterprise, uma restauração por etapas pode ser online ou offline.</span><span class="sxs-lookup"><span data-stu-id="536bd-127">In the Enterprise edition, a piecemeal restore can be either online or offline.</span></span> <span data-ttu-id="536bd-128">As implicações de restauração por etapas offline são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="536bd-128">The implications of offline and online piecemeal restores are as follows:</span></span>  
  
-   <span data-ttu-id="536bd-129">Cenário de restauração por etapas offline</span><span class="sxs-lookup"><span data-stu-id="536bd-129">Offline piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="536bd-130">Em uma restauração por etapas offline, o banco de dados ficará online após a sequência de restauração parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-130">In an offline piecemeal restore, the database is online after the partial-restore sequence.</span></span> <span data-ttu-id="536bd-131">Os grupos de arquivos que ainda não foram restaurados permanecem offline, mas eles podem ser restaurados quando você precisar deles, depois colocar o banco de dados offline.</span><span class="sxs-lookup"><span data-stu-id="536bd-131">Filegroups that have not yet been restored remain offline, but they can be restored as you need them after taking the database offline.</span></span>  
  
-   <span data-ttu-id="536bd-132">Cenário de restauração por etapas online</span><span class="sxs-lookup"><span data-stu-id="536bd-132">Online piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="536bd-133">Em uma restauração por etapas online, após a sequência de restauração parcial, o banco de dados está online e o grupo de arquivos primário e quaisquer grupos de arquivos secundários recuperados estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="536bd-133">In an online piecemeal restore, after the partial-restore sequence, the database is online, and the primary filegroup and any recovered secondary filegroups are available.</span></span> <span data-ttu-id="536bd-134">Os grupos de arquivos que ainda não foram restaurados permanecem offline, mas eles podem ser restaurados quando você precisar deles, enquanto o banco de dados permanecer online.</span><span class="sxs-lookup"><span data-stu-id="536bd-134">Filegroups that have not yet been restored remain offline, but they can be restored as needed while the database remains online.</span></span>  
  
     <span data-ttu-id="536bd-135">Restaurações por etapas online podem envolver transações adiadas.</span><span class="sxs-lookup"><span data-stu-id="536bd-135">Online piecemeal restores can involve deferred transactions.</span></span> <span data-ttu-id="536bd-136">Quando apenas um subconjunto de grupos de arquivos foi restaurado, as transações no banco de dados que dependem de grupos de arquivos online podem ser adiadas.</span><span class="sxs-lookup"><span data-stu-id="536bd-136">When only a subset of filegroups has been restored, transactions in the database that depend on online filegroups might become deferred.</span></span> <span data-ttu-id="536bd-137">Isso é normal, porque o banco de dados inteiro deve ser consistente.</span><span class="sxs-lookup"><span data-stu-id="536bd-137">This is typical, because the whole database must be consistent.</span></span> <span data-ttu-id="536bd-138">Para obter mais informações, veja [Transações adiadas &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="536bd-138">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
-   [!INCLUDE[hek_1](../../includes/hek-1-md.md)] <span data-ttu-id="536bd-139">cenários de restauração por etapas</span><span class="sxs-lookup"><span data-stu-id="536bd-139">piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="536bd-140">Para obter informações sobre Restaurações por Etapas de bancos de dados OLTPin-memory, consulte [Backup e restauração por etapas de bancos de dados com tabelas com otimização de memória](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="536bd-140">For information on Piecemeal Restores of In-Memory OLTP databases see [Piecemeal Backup and Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
## <a name="restrictions"></a><span data-ttu-id="536bd-141">Restrições</span><span class="sxs-lookup"><span data-stu-id="536bd-141">Restrictions</span></span>  
 <span data-ttu-id="536bd-142">Se uma sequência de restauração parcial excluir qualquer grupo de arquivos [FILESTREAM](../blob/filestream-sql-server.md) , não haverá suporte para a restauração pontual.</span><span class="sxs-lookup"><span data-stu-id="536bd-142">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="536bd-143">Você pode forçar a sequência de restauração a continuar.</span><span class="sxs-lookup"><span data-stu-id="536bd-143">You can force the restore sequence to continue.</span></span> <span data-ttu-id="536bd-144">Contudo, os grupos de arquivos FILESTREAM omitidos de sua instrução RESTORE nunca poderão ser restaurados.</span><span class="sxs-lookup"><span data-stu-id="536bd-144">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="536bd-145">Para forçar uma restauração pontual, especifique a opção CONTINUE_AFTER_ERROR juntamente com a opção STOPAT, STOPATMARK ou STOPBEFOREMARK, que você também deve especificar nas instruções RESTORE LOG subsequentes.</span><span class="sxs-lookup"><span data-stu-id="536bd-145">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="536bd-146">Se você especificar CONTINUE_AFTER_ERROR, a sequência de restauração parcial terá êxito e o grupo de arquivos FILESTREAM se tornará irrecuperável.</span><span class="sxs-lookup"><span data-stu-id="536bd-146">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
## <a name="piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="536bd-147">Restauração por etapas no modelo de recuperação simples</span><span class="sxs-lookup"><span data-stu-id="536bd-147">Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="536bd-148">No modelo de recuperação simples, a sequência de restauração por etapas deve iniciar com um banco de dados completo ou um backup parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-148">Under the simple recovery model, the piecemeal restore sequence must start with a full database or partial backup.</span></span> <span data-ttu-id="536bd-149">Então, se o backup restaurado for uma base diferencial, restaure o último backup diferencial a seguir.</span><span class="sxs-lookup"><span data-stu-id="536bd-149">Then, if the restored backup is a differential base, restore the latest differential backup next.</span></span>  
  
 <span data-ttu-id="536bd-150">Durante a primeira sequência de restauração parcial, se você restaurar apenas um subconjunto de grupos de arquivos de leitura/gravação, quaisquer grupos de arquivos não restaurados estarão expirados quando você recuperar o banco de dados parcialmente restaurado.</span><span class="sxs-lookup"><span data-stu-id="536bd-150">During the first partial restore sequence, if you restore only a subset of read/write filegroups, any unrestored filegroups become defunct when you recover the partially restored database.</span></span> <span data-ttu-id="536bd-151">Omitir um grupo de arquivos de leitura/gravação da sequência de restauração parcial só é apropriado nos seguintes casos:</span><span class="sxs-lookup"><span data-stu-id="536bd-151">Omitting a read/write filegroup from the partial-restore sequence is appropriate only in the following cases:</span></span>  
  
-   <span data-ttu-id="536bd-152">Você quer que os grupos de arquivos não restaurados se tornem expirados.</span><span class="sxs-lookup"><span data-stu-id="536bd-152">You intend for the unrestored filegroups to become defunct.</span></span>  
  
-   <span data-ttu-id="536bd-153">A sequência de restauração chegará a um ponto de recuperação no qual cada grupo de arquivos não restaurado tornou-se somente leitura, cancelado ou expirado (durante uma restauração anterior na sequência de restauração parcial).</span><span class="sxs-lookup"><span data-stu-id="536bd-153">The restore sequence will arrive at a recovery point at which each unrestored filegroup has become read-only, dropped, or defunct (during a previous restore in the partial-restore sequence).</span></span>  
  
-   <span data-ttu-id="536bd-154">O backup completo foi realizado enquanto o banco de dados estava usando o modelo de recuperação simples, mas o ponto de recuperação é no momento que o banco de dados estiver usando o modelo de recuperação completa.</span><span class="sxs-lookup"><span data-stu-id="536bd-154">The full backup was taken while the database was using the simple recovery model, but the recovery point is at a time when the database is using the full recovery model.</span></span> <span data-ttu-id="536bd-155">Para obter mais informações, consulte "Executando uma restauração por etapas de um banco de dados cujo modelo de recuperação foi trocado de simples para completo", adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="536bd-155">For more information, see "Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full," later in this topic.</span></span>  
  
### <a name="requirements-for-piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="536bd-156">Requisitos para uma restauração por etapas no modelo de recuperação simples</span><span class="sxs-lookup"><span data-stu-id="536bd-156">Requirements for Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="536bd-157">No modelo de recuperação simples, a fase inicial restaura e recupera o grupo de arquivos primário e todos os grupos de arquivos de leitura/gravação secundários.</span><span class="sxs-lookup"><span data-stu-id="536bd-157">Under the simple recovery model, the initial stage restores and recovers the primary filegroup and all read/write secondary filegroups.</span></span> <span data-ttu-id="536bd-158">Depois que a fase inicial é concluída, os arquivos recuperados, se forem válidos e consistentes com o banco de dados, poderão ser colocados online diretamente.</span><span class="sxs-lookup"><span data-stu-id="536bd-158">After the initial stage is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="536bd-159">Depois disso, os grupos de arquivos somente leitura podem ser restaurados em uma ou mais fases adicionais.</span><span class="sxs-lookup"><span data-stu-id="536bd-159">Thereafter, read-only filegroups can be restored in one or more additional stages.</span></span>  
  
 <span data-ttu-id="536bd-160">A restauração por etapas só estará disponível para um grupo de arquivos secundário somente leitura caso os seguinte itens sejam verdadeiros:</span><span class="sxs-lookup"><span data-stu-id="536bd-160">Piecemeal restore is available for a read-only secondary filegroup only if the following are true:</span></span>  
  
-   <span data-ttu-id="536bd-161">Era somente leitura quando o backup foi realizado.</span><span class="sxs-lookup"><span data-stu-id="536bd-161">Was read-only when backed up.</span></span>  
  
-   <span data-ttu-id="536bd-162">Permaneceu somente leitura (mantendo-o logicamente consistente com o grupo de arquivos primário).</span><span class="sxs-lookup"><span data-stu-id="536bd-162">Has remained read-only (keeping it logically consistent with the primary filegroup).</span></span>  
  
 <span data-ttu-id="536bd-163">Para executar uma restauração por etapas, estas diretrizes devem ser seguidas:</span><span class="sxs-lookup"><span data-stu-id="536bd-163">To perform a piecemeal restore, the following guidelines must be followed:</span></span>  
  
-   <span data-ttu-id="536bd-164">Um conjunto completo de backups para a restauração por etapas de um modelo de recuperação simples banco de dados deve conter o seguinte:</span><span class="sxs-lookup"><span data-stu-id="536bd-164">A complete set of backups for the piecemeal restore of a simple recovery model database must contain the following:</span></span>  
  
    -   <span data-ttu-id="536bd-165">Um backup de banco de dados parcial ou completo que contenha o grupo de arquivos primário e todos os grupos de arquivos, que eram leitura/gravação na hora do backup.</span><span class="sxs-lookup"><span data-stu-id="536bd-165">A partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span>  
  
    -   <span data-ttu-id="536bd-166">Um backup de cada arquivo somente leitura.</span><span class="sxs-lookup"><span data-stu-id="536bd-166">A backup of each read-only file.</span></span>  
  
-   <span data-ttu-id="536bd-167">Para o backup de um arquivo somente leitura ser consistente com o grupo de arquivos primário, os grupos de arquivos secundários deveriam permanecer somente leitura desde que o backup foi realizado até que o backup que contém o grupo de arquivos primário tenha sido concluído.</span><span class="sxs-lookup"><span data-stu-id="536bd-167">For the backup of a read-only file to be consistent with the primary filegroup, the secondary filegroup must have been read-only from when it was backed up until the backup that contains the primary filegroup was completed.</span></span> <span data-ttu-id="536bd-168">Você pode usar backups de arquivos diferenciais, se eles foram realizados depois que os grupos de arquivos tornaram-se somente leitura.</span><span class="sxs-lookup"><span data-stu-id="536bd-168">You can use differential file backups, if they were taken after the filegroup became read-only.</span></span>  
  
### <a name="piecemeal-restore-stages-simple-recovery-model"></a><span data-ttu-id="536bd-169">Fases da restauração por etapas (modelo de recuperação simples)</span><span class="sxs-lookup"><span data-stu-id="536bd-169">Piecemeal Restore Stages (Simple Recovery Model)</span></span>  
 <span data-ttu-id="536bd-170">O cenário da restauração por etapas envolve as seguintes fases:</span><span class="sxs-lookup"><span data-stu-id="536bd-170">The piecemeal restore scenario involves the following stages:</span></span>  
  
-   <span data-ttu-id="536bd-171">Fase inicial (restaura e recupera o grupo de arquivos primário e todos os grupos de arquivos de leitura/gravação)</span><span class="sxs-lookup"><span data-stu-id="536bd-171">Initial stage (restore and recover the primary filegroup and all read/write filegroups)</span></span>  
  
     <span data-ttu-id="536bd-172">A fase inicial executa uma restauração parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-172">The initial stage performs a partial restore.</span></span> <span data-ttu-id="536bd-173">A sequência parcial de restauração restaura o grupo de arquivos primário, todos os grupos secundários de arquivos leitura/gravação, e (opcionalmente) alguns grupos de arquivos somente leitura.</span><span class="sxs-lookup"><span data-stu-id="536bd-173">The partial restore sequence restores the primary filegroup, all read/write secondary filegroups, and (optionally) some of the read-only filegroups.</span></span> <span data-ttu-id="536bd-174">Durante a fase inicial, o banco de dados inteiro deve ir offline.</span><span class="sxs-lookup"><span data-stu-id="536bd-174">During the initial stage, the whole database must go offline.</span></span> <span data-ttu-id="536bd-175">Depois da fase inicial, o banco de dados estará online, e os grupos de arquivos restaurados estarão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="536bd-175">After the initial stage, the database is online, and restored filegroups are available.</span></span> <span data-ttu-id="536bd-176">Entretanto, quaisquer grupos de arquivos somente leitura que ainda não tiverem sido restaurados, permanecerão offline.</span><span class="sxs-lookup"><span data-stu-id="536bd-176">However, any read-only filegroups that have not yet been restored, remain offline.</span></span>  
  
     <span data-ttu-id="536bd-177">A primeira instrução RESTORE da fase inicial deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="536bd-177">The first RESTORE statement in the initial stage must do the following:</span></span>  
  
    -   <span data-ttu-id="536bd-178">Usar um backup de banco de dados parcial ou completo que contenha o grupo de arquivos primário e todos os grupos de arquivos que eram leitura/gravação na hora do backup.</span><span class="sxs-lookup"><span data-stu-id="536bd-178">Use a partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span> <span data-ttu-id="536bd-179">É comum iniciar uma sequência de restauração parcial restaurando um backup parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-179">It is common to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="536bd-180">Especifique a opção PARTIAL, que indica o início de uma restauração por etapas.</span><span class="sxs-lookup"><span data-stu-id="536bd-180">Specify the PARTIAL option, which indicates the start of a piecemeal restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="536bd-181">A opção PARTIAL executa verificações de segurança que garantem que o banco de dados resultante seja adequado para uso como um banco de dados de produção.</span><span class="sxs-lookup"><span data-stu-id="536bd-181">The PARTIAL option performs safety checks that ensure that the resulting database is suited for use as a production database.</span></span>  
  
    -   <span data-ttu-id="536bd-182">Especifique a opção READ_WRITE_FILEGROUPS se o backup for um backup de banco de dados completo.</span><span class="sxs-lookup"><span data-stu-id="536bd-182">Specify the READ_WRITE_FILEGROUPS option if the backup is a full database backup.</span></span>  
  
-   <span data-ttu-id="536bd-183">Enquanto o banco de dados estiver online, você pode usar uma ou mais restaurações de arquivo online para restaurar e recuperar arquivos offline somente leitura que eram somente leitura na hora do backup.</span><span class="sxs-lookup"><span data-stu-id="536bd-183">While the database is online, you can use one or more online file restores to restore and recover offline read-only files that were read-only at the time of backup.</span></span> <span data-ttu-id="536bd-184">A hora da restauração do arquivo online depende de quando você quer ter os dados online.</span><span class="sxs-lookup"><span data-stu-id="536bd-184">The timing of the online file restores depends on when you want to have the data online.</span></span>  
  
     <span data-ttu-id="536bd-185">Dependendo do seguinte, você precisará restaurar dados a um arquivo:</span><span class="sxs-lookup"><span data-stu-id="536bd-185">Whether you must restore data to a file depends on the following:</span></span>  
  
    -   <span data-ttu-id="536bd-186">Arquivos somente leitura válidos, que estão consistentes com o banco de dados podem ser colocados online diretamente pela recuperação, sem restaurar quaisquer dados.</span><span class="sxs-lookup"><span data-stu-id="536bd-186">Valid read-only files that are consistent with the database can be brought online directly by recovering them without restoring any data.</span></span>  
  
    -   <span data-ttu-id="536bd-187">Arquivos que estão danificados ou inconsistentes com o banco de dados devem ser restaurados antes de serem recuperados.</span><span class="sxs-lookup"><span data-stu-id="536bd-187">Files that are damaged or inconsistent with the database must be restored before they are recovered.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="536bd-188">Exemplos</span><span class="sxs-lookup"><span data-stu-id="536bd-188">Examples</span></span>  
  
-   [<span data-ttu-id="536bd-189">Exemplo: Restauração por etapas de banco de dados &#40;Modelo de recuperação simples&#41;</span><span class="sxs-lookup"><span data-stu-id="536bd-189">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="536bd-190">Exemplo: Restauração por etapas de apenas alguns grupos de arquivos &#40;Modelo de recuperação simples&#41;</span><span class="sxs-lookup"><span data-stu-id="536bd-190">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
## <a name="piecemeal-restore-under-the-full-recovery-model"></a><span data-ttu-id="536bd-191">Restauração por etapas no modelo de recuperação completa</span><span class="sxs-lookup"><span data-stu-id="536bd-191">Piecemeal Restore Under the Full Recovery Model</span></span>  
 <span data-ttu-id="536bd-192">No modelo de recuperação completa ou bulk-logged, a restauração por etapas está disponível para qualquer banco de dados que contenha vários grupos de arquivo, e você pode restaurar um banco de dados para qualquer ponto especificado.</span><span class="sxs-lookup"><span data-stu-id="536bd-192">Under the full recovery model or bulk-logged recovery model, piecemeal restore is available for any database that contains multiple filegroups and you can restore a database to any point in time.</span></span> <span data-ttu-id="536bd-193">A sequência de restauração por etapas se comporta assim:</span><span class="sxs-lookup"><span data-stu-id="536bd-193">The restore sequences of a piecemeal restore behave as follows:</span></span>  
  
-   <span data-ttu-id="536bd-194">sequência de restauração parcial</span><span class="sxs-lookup"><span data-stu-id="536bd-194">Partial-restore sequence</span></span>  
  
     <span data-ttu-id="536bd-195">A sequência de restauração parcial restaura o grupo de arquivos primário e, opcionalmente alguns dos grupos de arquivos secundários.</span><span class="sxs-lookup"><span data-stu-id="536bd-195">The partial restore sequence restores the primary filegroup and, optionally, some of the secondary filegroups.</span></span>  
  
     <span data-ttu-id="536bd-196">A primeira instrução RESTORE DATABASE na fase inicial deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="536bd-196">The first RESTORE DATABASE statement must do the following:</span></span>  
  
    -   <span data-ttu-id="536bd-197">Especificar a opção PARTIAL.</span><span class="sxs-lookup"><span data-stu-id="536bd-197">Specify the PARTIAL option.</span></span> <span data-ttu-id="536bd-198">Isso indica o início de uma restauração por etapas.</span><span class="sxs-lookup"><span data-stu-id="536bd-198">This indicates the start of a piecemeal restore.</span></span>  
  
    -   <span data-ttu-id="536bd-199">Use qualquer backup de banco de dados completo que contenha o grupo de arquivos primário.</span><span class="sxs-lookup"><span data-stu-id="536bd-199">Use any full database backup that contains the primary filegroup.</span></span> <span data-ttu-id="536bd-200">A prática comum é iniciar uma sequência de restauração parcial restaurando um backup parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-200">The common practice is to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="536bd-201">Para restaurar a um ponto específico no tempo, você deve especificar a hora na sequência de restauração parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-201">To restore to a specific point in time, you must specify the time in the partial restore sequence.</span></span> <span data-ttu-id="536bd-202">Todas as etapas seguintes da sequência de restauração devem mencionar o mesmo ponto especificado.</span><span class="sxs-lookup"><span data-stu-id="536bd-202">Every successive step of the restore sequence must specify the same point in time.</span></span>  
  
-   <span data-ttu-id="536bd-203">Sequências de restauração de grupo de arquivos trazem grupos de arquivos online adicionais para um ponto consistente com o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="536bd-203">Filegroup-restore sequences bring additional filegroups online to a point consistent with the database.</span></span>  
  
     <span data-ttu-id="536bd-204">Na edição Enterprise, qualquer grupo de arquivos secundário offline pode ser restaurado e recuperado enquanto o banco de dados permanecer online.</span><span class="sxs-lookup"><span data-stu-id="536bd-204">In the Enterprise edition, any offline secondary filegroup can be restored and recovered while the database remains online.</span></span> <span data-ttu-id="536bd-205">Se um arquivo somente leitura específico não for danificado e for consistente com o banco de dados, o arquivo não terá de ser restaurado.</span><span class="sxs-lookup"><span data-stu-id="536bd-205">If a specific read-only file is undamaged and consistent with the database, the file does not have to be restored.</span></span> <span data-ttu-id="536bd-206">Para obter mais informações, veja [Recuperar um banco de dados sem restaurar dados &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="536bd-206">For more information, see [Recover a Database Without Restoring Data &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span></span>  
  
### <a name="applying-log-backups"></a><span data-ttu-id="536bd-207">Aplicando backups de log</span><span class="sxs-lookup"><span data-stu-id="536bd-207">Applying Log Backups</span></span>  
 <span data-ttu-id="536bd-208">Se um grupo de arquivos somente leitura era somente leitura desde antes de o backup de arquivo ser criado, aplicar backups de log ao grupo de arquivos será desnecessário e é ignorado pela restauração de arquivo.</span><span class="sxs-lookup"><span data-stu-id="536bd-208">If a read-only filegroup has been read-only since before the file backup was created, applying log backups to the filegroup is unnecessary and is skipped by file restore.</span></span> <span data-ttu-id="536bd-209">Se o grupo de arquivos for leitura/gravação, uma cadeia ininterrupta de backups de log deve ser aplicada à última restauração completa ou diferencial, para trazer o grupo de arquivos para o arquivo de log atual.</span><span class="sxs-lookup"><span data-stu-id="536bd-209">If the filegroup is read/write, an unbroken chain of log backups must be applied to the last full or differential restore to bring the filegroup forward to the current log file.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="536bd-210">Exemplos</span><span class="sxs-lookup"><span data-stu-id="536bd-210">Examples</span></span>  
  
-   [<span data-ttu-id="536bd-211">Exemplo: Restauração por etapas de banco de dados &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="536bd-211">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="536bd-212">Exemplo: Restauração por etapas de apenas alguns grupos de arquivos &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="536bd-212">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
## <a name="performing-a-piecemeal-restore-of-a-database-whose-recovery-model-has-been-switched-from-simple-to-full"></a><span data-ttu-id="536bd-213">Para obter mais informações, consulte "Executando uma restauração por etapas de um banco de dados cujo modelo de recuperação foi trocado de simples para completo", adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="536bd-213">Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full</span></span>  
 <span data-ttu-id="536bd-214">Você pode executar uma restauração por etapas de um banco de dados que foi trocado do modelo de recuperação simples para o modelo de recuperação completa, a partir do backup de banco de dados completo ou parcial.</span><span class="sxs-lookup"><span data-stu-id="536bd-214">You can perform a piecemeal restore of a database that has been switched from the simple recovery model to the full recovery model since the full partial or database backup.</span></span> <span data-ttu-id="536bd-215">Por exemplo, considere um banco de dados para o qual você executa as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="536bd-215">For example, consider a database for which you take the following steps:</span></span>  
  
1.  <span data-ttu-id="536bd-216">Crie um backup parcial (backup_1) de um banco de dados modelo simples.</span><span class="sxs-lookup"><span data-stu-id="536bd-216">Create a partial backup (backup_1) of a simple-model database.</span></span>  
  
2.  <span data-ttu-id="536bd-217">Depois de algum tempo, altere o modelo de recuperação para completo.</span><span class="sxs-lookup"><span data-stu-id="536bd-217">After some time, change the recovery model to full.</span></span>  
  
3.  <span data-ttu-id="536bd-218">Crie um backup diferencial.</span><span class="sxs-lookup"><span data-stu-id="536bd-218">Create a differential backup.</span></span>  
  
4.  <span data-ttu-id="536bd-219">Comece a fazer backups de log.</span><span class="sxs-lookup"><span data-stu-id="536bd-219">Start taking log backups.</span></span>  
  
 <span data-ttu-id="536bd-220">Depois disso, a sequência seguinte é válida:</span><span class="sxs-lookup"><span data-stu-id="536bd-220">Thereafter, the following sequence is valid:</span></span>  
  
1.  <span data-ttu-id="536bd-221">Uma restauração parcial omite alguns grupos de arquivos secundários.</span><span class="sxs-lookup"><span data-stu-id="536bd-221">A partial restore that omits some secondary filegroups.</span></span>  
  
2.  <span data-ttu-id="536bd-222">Uma restauração diferencial seguida por qualquer outra restauração necessária.</span><span class="sxs-lookup"><span data-stu-id="536bd-222">A differential restore followed by any other needed restores.</span></span>  
  
3.  <span data-ttu-id="536bd-223">Depois, uma restauração de arquivo de um grupo de arquivos de leitura/gravação secundário WITH NORECOVERY do backup parcial, backup_1</span><span class="sxs-lookup"><span data-stu-id="536bd-223">Later, a file restore of a read/write secondary filegroup WITH NORECOVERY from the backup_1 partial backup</span></span>  
  
4.  <span data-ttu-id="536bd-224">O backup diferencial seguido por quaisquer outros backups que foram restaurados pela sequência de restauração por etapas original, para restaurar os dados até o ponto de recuperação original.</span><span class="sxs-lookup"><span data-stu-id="536bd-224">The differential backup followed by any other backups that were restored in the original piecemeal restore sequence to restore the data up to the original recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="536bd-225">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="536bd-225">See Also</span></span>  
 <span data-ttu-id="536bd-226">[Aplicar backups de log de transações &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="536bd-226">[Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span></span>  
 <span data-ttu-id="536bd-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="536bd-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 <span data-ttu-id="536bd-228">[Restaurar um banco de dados do SQL Server em um ponto específico &#40;Modelo de recuperação completa&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="536bd-228">[Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span></span>  
 <span data-ttu-id="536bd-229">[Visão geral de restauração e recuperação &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="536bd-229">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 [<span data-ttu-id="536bd-230">Planejar e executar sequências de restauração &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="536bd-230">Plan and Perform Restore Sequences &#40;Full Recovery Model&#41;</span></span>](plan-and-perform-restore-sequences-full-recovery-model.md)  
  
  
