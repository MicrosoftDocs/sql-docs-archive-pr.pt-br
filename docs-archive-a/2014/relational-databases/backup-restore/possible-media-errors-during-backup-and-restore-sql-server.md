---
title: Erros de mídia possíveis durante o backup e a restauração (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- media errors [SQL Server]
- CONTINUE_AFTER_ERROR option
- errors [SQL Server], backups
- backups [SQL Server], errors
- RESTORE VERIFYONLY statement
- backup media [SQL Server], error management
- page checksums [SQL Server]
- backup checksums [SQL Server]
- backing up [SQL Server], media errors
- RESTORE statement, media errors
- NO_CHECKSUM option
- checksums [SQL Server]
ms.assetid: 83a27b29-1191-4f8d-9648-6e6be73a9b7c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 15691c513aad6027be1063ef566ebdf245ebcc8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87683568"
---
# <a name="possible-media-errors-during-backup-and-restore-sql-server"></a><span data-ttu-id="89e75-102">Erros de mídia possíveis durante backup e restauração (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="89e75-102">Possible Media Errors During Backup and Restore (SQL Server)</span></span>
  [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] <span data-ttu-id="89e75-103">dá a você a opção de recuperar um banco de dados apesar dos erros detectados.</span><span class="sxs-lookup"><span data-stu-id="89e75-103">gives you the option of recovering a database despite detected errors.</span></span> <span data-ttu-id="89e75-104">Um novo mecanismo de detecção de erros importante é a criação opcional de uma soma de verificação do backup que pode ser criada por uma operação de backup e validada por uma operação de restauração.</span><span class="sxs-lookup"><span data-stu-id="89e75-104">An important new error-detection mechanism is the optional creation of a backup checksum that can be created by a backup operation and validated by a restore operation.</span></span> <span data-ttu-id="89e75-105">Você pode controlar se uma operação verifica os erros e se a operação é interrompida ou continua ao encontrar um erro.</span><span class="sxs-lookup"><span data-stu-id="89e75-105">You can control whether an operation checks for errors and whether the operation stops or continues on encountering an error.</span></span> <span data-ttu-id="89e75-106">Se um backup contiver uma soma de verificação de backup, as instruções RESTORE e RESTORE VERIFYONLY poderão verificar os erros.</span><span class="sxs-lookup"><span data-stu-id="89e75-106">If a backup contains a backup checksum, RESTORE and RESTORE VERIFYONLY statements can check for errors.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89e75-107">Backups espelhados fornecem até quatro cópias (espelhos) de um conjunto de mídia, fornecendo cópias alternativas para a recuperação de erros causados por mídias danificadas.</span><span class="sxs-lookup"><span data-stu-id="89e75-107">Mirrored backups provide up to four copies (mirrors) of a media set, providing alternative copies for recovering from errors caused by damaged media.</span></span> <span data-ttu-id="89e75-108">Para obter mais informações, veja [Conjuntos de mídias de backup espelhadas &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89e75-108">For more information, see [Mirrored Backup Media Sets &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md).</span></span>  
  
  
  
##  <a name="backup-checksums"></a><a name="BckChecksums"></a> <span data-ttu-id="89e75-109">Somas de verificação de backup</span><span class="sxs-lookup"><span data-stu-id="89e75-109">Backup Checksums</span></span>  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="89e75-110">dá suporte a três tipos de somas de verificação: uma soma de verificação nas páginas, uma soma de verificação nos blocos de log e uma soma de verificação de backup.</span><span class="sxs-lookup"><span data-stu-id="89e75-110">supports three types of checksums: a checksum on pages, a checksum in log blocks, and a backup checksum.</span></span> <span data-ttu-id="89e75-111">Ao gerar uma soma de verificação de backup, o BACKUP verifica se a leitura de dados do banco de dados é consistente com qualquer soma de verificação ou indicação da página interrompida que estejam presentes no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="89e75-111">When generating a backup checksum, BACKUP verifies that the data read from the database is consistent with any checksum or torn-page indication that is present in the database.</span></span>  
  
 <span data-ttu-id="89e75-112">A instrução BACKUP computa opcionalmente uma soma de verificação de backup no fluxo de backup; se a soma de verificação de página ou as informações da página interrompida estiverem presentes em uma determinada página, ao fazer o backup da página, o BACKUP também verifica a soma de verificação, o estado da página interrompida e a ID da página, na página.</span><span class="sxs-lookup"><span data-stu-id="89e75-112">The BACKUP statement optionally computes a backup checksum on the backup stream; if page-checksum or torn-page information is present on a given page, when backing up the page, BACKUP also verifies the checksum and torn-page status and the page ID, of the page.</span></span> <span data-ttu-id="89e75-113">Ao criar uma soma de verificação de backup, uma operação de backup não acrescenta nenhuma soma de verificação às páginas.</span><span class="sxs-lookup"><span data-stu-id="89e75-113">When creating a backup checksum, a backup operation does not add any checksums to pages.</span></span> <span data-ttu-id="89e75-114">O backup das páginas é feito enquanto as mesmas existirem no banco de dados, e as páginas não são alteradas pelo backup.</span><span class="sxs-lookup"><span data-stu-id="89e75-114">Pages are backed up as they exist in the database, and the pages are unmodified by backup.</span></span>  
  
 <span data-ttu-id="89e75-115">Devido a verificação de sobrecarga e a geração de soma de verificação de backup, usar somas de verificação de backup representa um possível impacto de desempenho.</span><span class="sxs-lookup"><span data-stu-id="89e75-115">Due to the overhead verifying and generating backup checksums, using backup checksums poses a potential performance impact.</span></span> <span data-ttu-id="89e75-116">A carga de trabalho e a taxa de transferência de backup podem ser afetadas.</span><span class="sxs-lookup"><span data-stu-id="89e75-116">Both the workload and the backup throughput may be affected.</span></span> <span data-ttu-id="89e75-117">Por isso, usar somas de verificação de backup é opcional.</span><span class="sxs-lookup"><span data-stu-id="89e75-117">Therefore, using backup checksums is optional.</span></span> <span data-ttu-id="89e75-118">Ao decidir gerar somas de verificação durante um backup, monitore cuidadosamente a sobrecarga gerada da CPU, assim como o impacto em qualquer carga de trabalho simultânea no sistema.</span><span class="sxs-lookup"><span data-stu-id="89e75-118">When deciding to generate checksums during a backup, carefully monitor the CPU overhead incurred as well as the impact on any concurrent workload on the system.</span></span>  
  
 <span data-ttu-id="89e75-119">O BACKUP nunca modifica a página de fonte em disco nem os conteúdos de uma página.</span><span class="sxs-lookup"><span data-stu-id="89e75-119">BACKUP never modifies the source page on disk nor the contents of a page.</span></span>  
  
 <span data-ttu-id="89e75-120">Quando as somas de verificação de backup estão habilitadas, uma operação de backup realiza as etapas seguintes:</span><span class="sxs-lookup"><span data-stu-id="89e75-120">When backup checksums are enabled, a backup operation performs the following steps:</span></span>  
  
1.  <span data-ttu-id="89e75-121">Antes de gravar uma página na mídia de backup, a operação de backup verifica a informação do nível de página (soma de verificação de página ou detecção de página interrompida), ou se ela existe.</span><span class="sxs-lookup"><span data-stu-id="89e75-121">Before writing a page to the backup media, the backup operation verifies the page-level information (page checksum or torn page detection), if either exists.</span></span> <span data-ttu-id="89e75-122">Se não existir, o backup não poderá verificar a página.</span><span class="sxs-lookup"><span data-stu-id="89e75-122">If neither exists, backup cannot verify the page.</span></span> <span data-ttu-id="89e75-123">As páginas não verificadas são incluídas como estão, e seu conteúdo é adicionado à soma de verificação de backup geral.</span><span class="sxs-lookup"><span data-stu-id="89e75-123">Unverified the pages are included as is, and their contents are added to the overall backup checksum.</span></span>  
  
     <span data-ttu-id="89e75-124">Se a operação de backup encontrar um erro de página durante a verificação, o backup falhará.</span><span class="sxs-lookup"><span data-stu-id="89e75-124">If the backup operation encounters a page error during verification, the backup fails.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="89e75-125">Para obter mais informações sobre somas de verificação de página e detecção de página interrompida, consulte a opção de PAGE_VERIFY da instrução ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="89e75-125">For more information about page checksums and torn page detection, see the PAGE_VERIFY option of the ALTER DATABASE statement.</span></span> <span data-ttu-id="89e75-126">Para obter mais informações, veja [Opções ALTER DATABASE SET &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span><span class="sxs-lookup"><span data-stu-id="89e75-126">For more information, see [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options).</span></span>  
  
2.  <span data-ttu-id="89e75-127">Independentemente de somas de verificação de página estarem presentes, BACKUP gera uma soma de verificação de backup separada para os fluxos de backup.</span><span class="sxs-lookup"><span data-stu-id="89e75-127">Regardless of whether page checksums are present, BACKUP generates a separate backup checksum for the backup streams.</span></span> <span data-ttu-id="89e75-128">Operações de restauração podem usar opcionalmente a soma de verificação de backup para validar se o backup não está corrompido.</span><span class="sxs-lookup"><span data-stu-id="89e75-128">Restore operations can optionally use the backup checksum to validate that the backup is not corrupted.</span></span> <span data-ttu-id="89e75-129">A soma de verificação de backup é armazenada na mídia de backup, não nas páginas do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="89e75-129">The backup checksum is stored on the backup media, not on the database pages.</span></span> <span data-ttu-id="89e75-130">A soma de verificação de backup pode ser usada opcionalmente na hora da restauração.</span><span class="sxs-lookup"><span data-stu-id="89e75-130">The backup checksum can optionally be used at restore time.</span></span>  
  
3.  <span data-ttu-id="89e75-131">O conjunto de backup é sinalizado como contendo somas de verificação de backup (na coluna **has_backup_checksums** de **msdb..backupset)** .</span><span class="sxs-lookup"><span data-stu-id="89e75-131">The backup set is flagged as containing backup checksums (in the **has_backup_checksums** column of **msdb..backupset)**.</span></span> <span data-ttu-id="89e75-132">Para obter mais informações, veja [conjunto de backup &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89e75-132">For more information, see [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span></span>  
  
 <span data-ttu-id="89e75-133">Durante a operação de restauração, se as somas de verificação de backup estiverem presentes na mídia de backup, por padrão, ambas as instruções RESTORE e RESTORE VERIFYONLY verificarão as somas de verificação de backup e somas de verificação de página.</span><span class="sxs-lookup"><span data-stu-id="89e75-133">During a restore operation, if backup checksums are present on the backup media, by default, both the RESTORE and RESTORE VERIFYONLY statements verify the backup checksums and page checksums.</span></span> <span data-ttu-id="89e75-134">Se não houver nenhuma soma de verificação de backup, cada operação de restauração prossegue sem qualquer verificação; porque sem uma soma de verificação de backup a restauração não pode verificar somas de verificação da página de modo confiável.</span><span class="sxs-lookup"><span data-stu-id="89e75-134">If there is no backup checksum, either restore operation proceeds without any verification; this is because without a backup checksum, restore cannot reliably verify page checksums.</span></span>  
  
## <a name="response-to-page-checksum-errors-during-a-backup-or-restore-operation"></a><span data-ttu-id="89e75-135">Resposta para erros de soma de verificação de página durante uma operação de backup ou restauração</span><span class="sxs-lookup"><span data-stu-id="89e75-135">Response to Page Checksum Errors During a Backup or Restore Operation</span></span>  
 <span data-ttu-id="89e75-136">Por padrão, depois de encontrar um erro de soma de verificação de página, uma operação BACKUP ou RESTORE falha e uma operação RESTORE VERIFYONLY continua.</span><span class="sxs-lookup"><span data-stu-id="89e75-136">By default, after encountering a page checksum error, a BACKUP or RESTORE operation fails and a RESTORE VERIFYONLY operation continues.</span></span> <span data-ttu-id="89e75-137">No entanto, você pode controlar se uma determinada operação não consegue encontrar um erro ou continua da melhor maneira possível.</span><span class="sxs-lookup"><span data-stu-id="89e75-137">However, you can control whether a given operation fails on encountering an error or continues as best it can.</span></span>  
  
 <span data-ttu-id="89e75-138">Se uma operação de BACKUP continuar depois de encontrar erros, ela executará as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="89e75-138">If a BACKUP operation continues after encountering errors, the operation performs the following steps:</span></span>  
  
1.  <span data-ttu-id="89e75-139">Sinaliza o conjunto de backup na mídia de backup como contendo erros e localiza a página na tabela **suspect_pages** no banco de dados **msdb** .</span><span class="sxs-lookup"><span data-stu-id="89e75-139">Flags the backup set on the backup media as containing errors and tracks the page in the **suspect_pages** table in the **msdb** database.</span></span> <span data-ttu-id="89e75-140">Para obter mais informações, veja [suspect_pages &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/suspect-pages-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89e75-140">For more information, see [suspect_pages &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/suspect-pages-transact-sql).</span></span>  
  
2.  <span data-ttu-id="89e75-141">Faz o log do erro no log de erros do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="89e75-141">Logs the error in the SQL Server error log.</span></span>  
  
3.  <span data-ttu-id="89e75-142">Marca o conjunto de backup como contendo esse tipo de erro (na coluna **is_damaged** de **msdb.backupset)** .</span><span class="sxs-lookup"><span data-stu-id="89e75-142">Marks the backup set as containing this type of error (in the **is_damaged** column of **msdb.backupset)**.</span></span> <span data-ttu-id="89e75-143">Para obter mais informações, veja [conjunto de backup &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89e75-143">For more information, see [backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql).</span></span>  
  
4.  <span data-ttu-id="89e75-144">Emite uma mensagem que o backup foi gerado com sucesso, mas contém erros de página.</span><span class="sxs-lookup"><span data-stu-id="89e75-144">Issues a message that the backup was successfully generated, but contains page errors.</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="89e75-145">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="89e75-145">Related Tasks</span></span>  
 <span data-ttu-id="89e75-146">**Para habilitar ou desabilitar as somas de verificação de backup**</span><span class="sxs-lookup"><span data-stu-id="89e75-146">**To enable or disable backup checksums**</span></span>  
  
-   [<span data-ttu-id="89e75-147">Habilitar ou desabilitar as somas de verificação de backup durante backup ou restauração &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="89e75-147">Enable or Disable Backup Checksums During Backup or Restore &#40;SQL Server&#41;</span></span>](enable-or-disable-backup-checksums-during-backup-or-restore-sql-server.md)  
  
 <span data-ttu-id="89e75-148">**Para controlar a resposta a um erro durante uma operação de backup**</span><span class="sxs-lookup"><span data-stu-id="89e75-148">**To control the response to a error during a backup operation**</span></span>  
  
-   [<span data-ttu-id="89e75-149">Especificar se uma operação de backup ou restauração continua ou é interrompida após um erro &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="89e75-149">Specify Whether a Backup or Restore Operation Continues or Stops After Encountering an Error &#40;SQL Server&#41;</span></span>](specify-if-backup-or-restore-continues-or-stops-after-error.md)  
  
## <a name="see-also"></a><span data-ttu-id="89e75-150">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="89e75-150">See Also</span></span>  
 <span data-ttu-id="89e75-151">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="89e75-151">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 <span data-ttu-id="89e75-152">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="89e75-152">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="89e75-153">[conjunto de backup &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="89e75-153">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="89e75-154">[Conjuntos de mídias de backup espelhadas &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="89e75-154">[Mirrored Backup Media Sets &#40;SQL Server&#41;](mirrored-backup-media-sets-sql-server.md) </span></span>  
 <span data-ttu-id="89e75-155">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="89e75-155">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="89e75-156">RESTORE VERIFYONLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="89e75-156">RESTORE VERIFYONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-verifyonly-transact-sql)  
  
  
