---
title: Restaurando de backups armazenados no Azure | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 6ae358b2-6f6f-46e0-a7c8-f9ac6ce79a0e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 68b270f18cb4dbc2724c5a062afae54fa711acec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87581399"
---
# <a name="restoring-from-backups-stored-in-azure"></a><span data-ttu-id="9c1fb-102">Restaurar de backups armazenados no Azure</span><span class="sxs-lookup"><span data-stu-id="9c1fb-102">Restoring From Backups Stored in Azure</span></span>
  <span data-ttu-id="9c1fb-103">Este tópico descreve o que você precisa considerar ao restaurar um banco de dados usando um backup armazenado no serviço de Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-103">This topic outlines the considerations when restoring a database using a backup stored in the Azure Blob storage service.</span></span> <span data-ttu-id="9c1fb-104">Isso se aplica aos backups criados através do Backup do SQL Server para URL ou pelo [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9c1fb-104">This applies to backups created either by using SQL Server Backup to URL backup or by [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span></span>  
  
 <span data-ttu-id="9c1fb-105">É recomendável analisar este tópico se você tiver backups armazenados no serviço de Armazenamento de Blobs do Azure que pretende restaurar e, em seguida, analisar os tópicos que descrevem as etapas de restauração de um banco de dados, que são as mesmas para backups locais e do Azure.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-105">We recommend reviewing this topic if you have backups stored in the Azure Blob storage service that you plan to restore, and then review the topics that describe the steps on how to restore a database which is the same for both on-premises and azure backups.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="9c1fb-106">Visão geral</span><span class="sxs-lookup"><span data-stu-id="9c1fb-106">Overview</span></span>  
 <span data-ttu-id="9c1fb-107">As ferramentas e os métodos que são usados para restaurar um banco de dados de um backup local se aplicam à restauração de um banco de dados de um backup na nuvem.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-107">The tools and methods that are used to restore a database from an on-premises backup apply to restoring a database from a cloud backup.</span></span>  <span data-ttu-id="9c1fb-108">As seções a seguir descrevem essas considerações e todas as diferenças que você precisa saber ao usar os backups armazenados no serviço de Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-108">The following sections describe these considerations and any differences you should know about when you use backups stored in the Azure Blob storage service.</span></span>  
  
### <a name="using-transact-sql"></a><span data-ttu-id="9c1fb-109">Usando o Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="9c1fb-109">Using Transact-SQL</span></span>  
  
-   <span data-ttu-id="9c1fb-110">Como o SQL Server precisa se conectar a uma fonte externa para recuperar os arquivos de backup, a Credenciais do SQL é usada para autenticação para a conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-110">Since SQL Server must connect to an external source to retrieve the backup files, SQL Credential is used to authenticate to the storage account.</span></span> <span data-ttu-id="9c1fb-111">Em virtude disso, a instrução RESTORE requer a opção WITH CREDENTIAL.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-111">Consequently, the RESTORE statement requires WITH CREDENTIAL option.</span></span> <span data-ttu-id="9c1fb-112">Para obter mais informações, veja [Backup e restauração do SQL Server com o Serviço de Armazenamento de Blob do Azure](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span><span class="sxs-lookup"><span data-stu-id="9c1fb-112">For more information, see [SQL Server Backup and Restore with Azure Blob Storage Service](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span></span>  
  
-   <span data-ttu-id="9c1fb-113">Se você estiver usando o [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] para gerenciar seus backups para a nuvem, poderá examinar todos os backups disponíveis no armazenamento usando a função de sistema **smart_admin.fn_available_backups** .</span><span class="sxs-lookup"><span data-stu-id="9c1fb-113">If you are using the [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] to manage your backups to the cloud, you can review all the available backups in the storage, by using the **smart_admin.fn_available_backups** system function.</span></span> <span data-ttu-id="9c1fb-114">Essa função de sistema retorna todos os backups disponíveis para um banco de dados em uma tabela.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-114">This system function returns all the available backups for a database in a table.</span></span> <span data-ttu-id="9c1fb-115">Como os resultados são retornados em uma tabela, você pode filtrá-los ou classificá-los.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-115">As the results are returned in a table, you can filter or sort the results.</span></span> <span data-ttu-id="9c1fb-116">Para obter mais informações, consulte [smart_admin. fn_available_backups &#40;&#41;do Transact-SQL ](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9c1fb-116">For more information, see [smart_admin.fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="9c1fb-117">Como usar o SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-117">Using SQL Server Management Studio</span></span>  
  
-   <span data-ttu-id="9c1fb-118">A tarefa de restauração é usada restaurar um banco de dados usando o SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-118">The restore task is used to restore a database using the SQL Server Management Studio.</span></span> <span data-ttu-id="9c1fb-119">A página da mídia de backup agora inclui a opção **URL** para mostrar os arquivos de backup armazenados no serviço de Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-119">The backup media page now includes the **URL** option to show backup files stored in the Azure Blob storage service.</span></span> <span data-ttu-id="9c1fb-120">Você também deve fornecer a Credencial do SQL usada para autenticação para a conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-120">You also must provide the SQL Credential that is used to authenticate to the storage account.</span></span> <span data-ttu-id="9c1fb-121">A grade **Conjuntos de backup a serem restaurados** é preenchida com os backups disponíveis no Armazenamento de Blobs do Azure.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-121">The **Backup sets to restore** grid is then populated with the available backups in the Azure Blob storage.</span></span> <span data-ttu-id="9c1fb-122">Para obter mais informações, confira [Restaurar por meio do Armazenamento do Microsoft Azure usando o SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span><span class="sxs-lookup"><span data-stu-id="9c1fb-122">For more information, see [Restoring from Azure storage Using SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span></span>  
  
### <a name="optimizing-restores"></a><span data-ttu-id="9c1fb-123">Otimizando restaurações</span><span class="sxs-lookup"><span data-stu-id="9c1fb-123">Optimizing Restores</span></span>  
 <span data-ttu-id="9c1fb-124">Para reduzir o tempo de gravação da restauração, adicione o direito de usuário **Executar tarefas de manutenção de volume** à conta de usuário do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-124">To reduce restore write time, Add **perform volume maintenance tasks** user right to the SQL Server user account.</span></span> <span data-ttu-id="9c1fb-125">Para obter mais informações, consulte [Inicialização de arquivos de bancos de dados](https://go.microsoft.com/fwlink/?LinkId=271622).</span><span class="sxs-lookup"><span data-stu-id="9c1fb-125">For more information, see [Database File Initialization](https://go.microsoft.com/fwlink/?LinkId=271622).</span></span> <span data-ttu-id="9c1fb-126">Se a restauração ainda estiver lenta com a inicialização instantânea de arquivo ativada, examine o tamanho do arquivo de log na instância onde foi feito o backup do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-126">If restore is still slow with instant file initialization turned on, look at the size of the log file on the instance where the database was backed up.</span></span> <span data-ttu-id="9c1fb-127">Se o log é muito grande em tamanho (vários GBs), espera-se que a restauração seja lenta.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-127">If the log is very large in size (multiple GBs), it would be expected that restore would be slow.</span></span> <span data-ttu-id="9c1fb-128">Durante a restauração, o arquivo de log deve ser zerado, o que leva uma quantidade significativa de tempo.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-128">During restore the log file must be zeroed which takes a significant amount of time.</span></span>  
  
 <span data-ttu-id="9c1fb-129">Para reduzir o tempo de restauração, recomendamos o uso de backups compactados.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-129">To reduce restore times it is recommended that you use compressed backups.</span></span>  <span data-ttu-id="9c1fb-130">Para os tamanhos de backup superiores a 25 GB, use o [utilitário AzCopy](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) para baixar à unidade local e execute a restauração.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-130">For backup sizes exceeding 25 GB, use [AzCopy utility](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) to download to the local drive and then perform the restore.</span></span> <span data-ttu-id="9c1fb-131">Para outras práticas recomendadas de backup e recomendações, consulte [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="9c1fb-131">For other backup best practices and recommendations, see [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span></span>  
  
 <span data-ttu-id="9c1fb-132">Você também pode ativar o sinalizador de rastreamento 3051 ao fazer a restauração para gerar um log detalhado.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-132">You can also turn on Trace Flag 3051 when doing the restore to generate a detailed log.</span></span> <span data-ttu-id="9c1fb-133">Este arquivo de log é colocado no diretório de log e nomeado usando o formato: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-133">This log file is placed in the log directory, and is named using the format: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span></span> <span data-ttu-id="9c1fb-134">O arquivo de log inclui informações sobre cada viagem de ida e volta para o Armazenamento do Microsoft Azure, inclusive o controle de tempo, que pode ser útil para diagnosticar o problema.</span><span class="sxs-lookup"><span data-stu-id="9c1fb-134">The log file includes information about each round trip to Azure Storage including timing that can be helpful in diagnosing the issue.</span></span>  
  
### <a name="topics-on-performing-restore-operations"></a><span data-ttu-id="9c1fb-135">Tópicos sobre a execução de operações de restauração</span><span class="sxs-lookup"><span data-stu-id="9c1fb-135">Topics on Performing Restore Operations</span></span>  
  
-   [<span data-ttu-id="9c1fb-136">Restaurações completas de banco de dados &#40;Modelo de recuperação simples#41;</span><span class="sxs-lookup"><span data-stu-id="9c1fb-136">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="9c1fb-137">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="9c1fb-137">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
-   [<span data-ttu-id="9c1fb-138">Restaurações completas de banco de dados &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="9c1fb-138">Complete Database Restores &#40;Full Recovery Model&#41;</span></span>](complete-database-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="9c1fb-139">Restaurações de arquivos &#40;Modelo de recuperação simples&#41;</span><span class="sxs-lookup"><span data-stu-id="9c1fb-139">File Restores &#40;Simple Recovery Model&#41;</span></span>](file-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="9c1fb-140">Restaurações de arquivo &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="9c1fb-140">File Restores &#40;Full Recovery Model&#41;</span></span>](file-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="9c1fb-141">Restaurações por etapas &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="9c1fb-141">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
