---
title: Restauração online (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- online restores [SQL Server]
- online restores [SQL Server], about online restores
ms.assetid: 7982a687-980a-4eb8-8e9f-6894148e7d8c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 4db4d5b5ce08c50646857099d82964bb944bc8af
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87581428"
---
# <a name="online-restore-sql-server"></a><span data-ttu-id="68d68-102">Restauração online (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="68d68-102">Online Restore (SQL Server)</span></span>
  <span data-ttu-id="68d68-103">Somente há suporte para a restauração online no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span><span class="sxs-lookup"><span data-stu-id="68d68-103">Online restore is supported only on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="68d68-104">Nessa edição, um arquivo, uma página ou uma restauração por etapas está online por padrão.</span><span class="sxs-lookup"><span data-stu-id="68d68-104">In this edition, a file, page, or piecemeal restore is online by default.</span></span> <span data-ttu-id="68d68-105">Este tópico é pertinente para bancos de dados que contêm vários arquivos ou grupos de arquivos (e, no modelo de recuperação simples, somente para grupos de arquivos somente leitura).</span><span class="sxs-lookup"><span data-stu-id="68d68-105">This topic is relevant for databases that contain multiple files or filegroups (and, under the simple recovery model, only for read-only filegroups).</span></span>  
  
 <span data-ttu-id="68d68-106">A restauração de dados enquanto o banco de dados está online é chamada *restauração online*.</span><span class="sxs-lookup"><span data-stu-id="68d68-106">Restoring data while the database is online is called an *online restore*.</span></span> <span data-ttu-id="68d68-107">O banco de dados é considerado online sempre que o grupo de arquivos primário estiver online, até mesmo se um ou mais de seus grupos de arquivos secundários estiver offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-107">A database is considered to be online whenever the primary filegroup is online, even if one or more of its secondary filegroups are offline.</span></span> <span data-ttu-id="68d68-108">Em qualquer modelo de recuperação, você poderá restaurar um arquivo que estiver offline enquanto o banco de dados estiver online.</span><span class="sxs-lookup"><span data-stu-id="68d68-108">Under any recovery model, you can restore a file that is offline while the database is online.</span></span> <span data-ttu-id="68d68-109">No modelo de recuperação completa, você também poderá restaurar páginas enquanto o banco de dados estiver online.</span><span class="sxs-lookup"><span data-stu-id="68d68-109">Under the full recovery model, you can also restore pages while the database is online.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="68d68-110">A restauração online acontece automaticamente no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise e não requer nenhuma ação do usuário.</span><span class="sxs-lookup"><span data-stu-id="68d68-110">Online restore occurs automatically on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise and requires no user action.</span></span> <span data-ttu-id="68d68-111">Se você não quiser usar a restauração online, coloque um banco de dados offline antes de iniciar uma restauração</span><span class="sxs-lookup"><span data-stu-id="68d68-111">If you do not want to use online restore, you can take a database offline before you start a restore.</span></span> <span data-ttu-id="68d68-112">Para obter mais informações, consulte [Colocando um banco de dados ou arquivo offline](#taking_db_or_file_offline), adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="68d68-112">For more information, see [Taking a Database or File Offline](#taking_db_or_file_offline), later in this topic.</span></span>  
  
 <span data-ttu-id="68d68-113">Durante uma restauração de arquivo online, qualquer arquivo que esteja sendo restaurado e seu grupo de arquivo ficarão offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-113">During an online file restore, any file being restored and its filegroup are offline.</span></span> <span data-ttu-id="68d68-114">Se quaisquer desses arquivos estiver online quando uma restauração online for iniciada, a primeira instrução de restauração colocará o grupo de arquivos do arquivo offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-114">If any of these files is online when an online restore starts, the first restore statement takes the filegroup of the file offline.</span></span> <span data-ttu-id="68d68-115">Por outro lado, durante uma restauração de página online, só a página fica offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-115">In contrast, during an online page restore, only the page is offline.</span></span>  
  
 <span data-ttu-id="68d68-116">Todo cenário de restauração online envolve as seguintes etapas básicas:</span><span class="sxs-lookup"><span data-stu-id="68d68-116">Every online restore scenario involves the following basic steps:</span></span>  
  
1.  <span data-ttu-id="68d68-117">Restaurar os dados.</span><span class="sxs-lookup"><span data-stu-id="68d68-117">Restore the data.</span></span>  
  
2.  <span data-ttu-id="68d68-118">Restaurar o log usando WITH RECOVERY da última restauração de log.</span><span class="sxs-lookup"><span data-stu-id="68d68-118">Restore the log by using WITH RECOVERY for the last log restore.</span></span> <span data-ttu-id="68d68-119">Isso coloca os dados restaurados online.</span><span class="sxs-lookup"><span data-stu-id="68d68-119">This brings the restored data online.</span></span>  
  
 <span data-ttu-id="68d68-120">Ocasionalmente, uma transação não confirmada não pode ser revertida porque os dados necessários para a reversão estão offline durante a inicialização.</span><span class="sxs-lookup"><span data-stu-id="68d68-120">Occasionally, an uncommitted transaction cannot be rolled back because the data that is required by rollback is offline during startup.</span></span> <span data-ttu-id="68d68-121">Nesse caso, a transação é adiada.</span><span class="sxs-lookup"><span data-stu-id="68d68-121">In this case, the transaction is deferred.</span></span> <span data-ttu-id="68d68-122">Para obter mais informações, veja [Transações adiadas &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="68d68-122">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="68d68-123">Se o banco de dados estiver usando o modelo de recuperação bulk-logged, recomendamos que você mude para o modelo de recuperação completa antes de iniciar uma restauração online.</span><span class="sxs-lookup"><span data-stu-id="68d68-123">If the database is currently using the bulk-logged recovery model, we recommend that you switch to the full recovery model before you start an online restore.</span></span> <span data-ttu-id="68d68-124">Para obter mais informações, veja [Exibir ou alterar o modelo de recuperação de um banco de dados &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="68d68-124">For more information, see [View or Change the Recovery Model of a Database &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="68d68-125">Se os backups foram realizados com vários dispositivos que estavam anexados ao servidor, o mesmo número de dispositivos deverá estar disponível durante uma restauração online.</span><span class="sxs-lookup"><span data-stu-id="68d68-125">If the backups were taken with multiple devices that were attached to the server, the same number of devices must be available during an online restore.</span></span>  
  
## <a name="log-backups-for-online-restore"></a><span data-ttu-id="68d68-126">Backups de log para restauração online</span><span class="sxs-lookup"><span data-stu-id="68d68-126">Log Backups for Online Restore</span></span>  
 <span data-ttu-id="68d68-127">Em uma restauração online, o ponto de recuperação é o ponto quando os dados que estão sendo restaurados foram colocados offline ou como somente leitura pela última vez.</span><span class="sxs-lookup"><span data-stu-id="68d68-127">In an online restore, the recovery point is the point when the data being restored was taken offline or made read-only for the last time.</span></span> <span data-ttu-id="68d68-128">Todos os backups de log de transações que levam a e incluem esse ponto de recuperação devem estar disponíveis</span><span class="sxs-lookup"><span data-stu-id="68d68-128">The transaction log backups leading up to and including this recovery point must all be available.</span></span> <span data-ttu-id="68d68-129">Geralmente, um backup de log é necessário depois desse ponto para cobrir o ponto de recuperação para o arquivo.</span><span class="sxs-lookup"><span data-stu-id="68d68-129">Generally, a log backup is required after that point to cover the recovery point for the file.</span></span> <span data-ttu-id="68d68-130">A única exceção é durante uma restauração online de dados somente leitura de um backup de dados realizado depois que os dados tornaram-se somente leitura.</span><span class="sxs-lookup"><span data-stu-id="68d68-130">The only exception is during an online restore of read-only data from a data backup that was taken after the data became read-only.</span></span> <span data-ttu-id="68d68-131">Nesse caso, você não precisa ter um backup de log.</span><span class="sxs-lookup"><span data-stu-id="68d68-131">In this case, you do not have to have a log backup.</span></span>  
  
 <span data-ttu-id="68d68-132">Geralmente, você pode fazer backups de log de transações enquanto o banco de dados está online, até mesmo depois do início da sequência de restauração.</span><span class="sxs-lookup"><span data-stu-id="68d68-132">Generally, you may take transaction log backups while the database is online, even after the start of the restore sequence.</span></span> <span data-ttu-id="68d68-133">O controle de tempo do último backup de log depende das propriedades do arquivo que estiver sendo restaurado:</span><span class="sxs-lookup"><span data-stu-id="68d68-133">The timing of the last log backup depends on the properties of the file being restored:</span></span>  
  
-   <span data-ttu-id="68d68-134">Para um arquivo somente leitura online, você pode fazer o último backup de log que é necessário para a recuperação, antes ou durante a primeira sequência de restauração.</span><span class="sxs-lookup"><span data-stu-id="68d68-134">For an online read-only file, you can take the last log backup that is required for recovery before or during the first restore sequence.</span></span> <span data-ttu-id="68d68-135">Um grupo de arquivos somente leitura pode não necessitar backups de log se um backup de dados ou diferencial tiver sido realizado depois que os grupos de arquivos tornaram-se somente leitura.</span><span class="sxs-lookup"><span data-stu-id="68d68-135">A read-only filegroup may not require log backups if a data or differential backup was taken after the filegroup became read-only.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="68d68-136">A informações precedentes também são aplicadas a todos os arquivos offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-136">The preceding information also applies to every offline file.</span></span>  
  
-   <span data-ttu-id="68d68-137">Existe um caso especial para um arquivo de leitura/gravação que estava online quando a primeira instrução de restauração foi emitida e automaticamente colocada offline por essa instrução de restauração.</span><span class="sxs-lookup"><span data-stu-id="68d68-137">A special case exists for a read/write file that was online when the first restore statement was issued and that was then automatically taken offline by that restore statement.</span></span> <span data-ttu-id="68d68-138">Nesse caso, faça um backup de log durante a primeira *sequência de restauração* (a sequência de uma ou mais instruções RESTORE que restauram, efetuam roll-forward e recuperam dados).</span><span class="sxs-lookup"><span data-stu-id="68d68-138">In this case, you must take a log backup during the first *restore sequence* (the sequence of one or more RESTORE statements that restore, roll forward, and recover data).</span></span> <span data-ttu-id="68d68-139">Geralmente, esse backup de log deve ocorrer depois que você restaurar todos os backups completos e antes de recuperar os dados.</span><span class="sxs-lookup"><span data-stu-id="68d68-139">Generally, this log backup must occur after you restore all the full backups and before you recover the data.</span></span> <span data-ttu-id="68d68-140">Porém, se houver vários backups de arquivo para um grupo de arquivos específico, o ponto mínimo de backup de log será depois que o grupo de arquivos estiver offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-140">However, if there are multiple file backups for a specific filegroup, the minimal point of log backup is the time after the filegroup is offline.</span></span> <span data-ttu-id="68d68-141">Esse backup de log após a restauração de dados captura o ponto em que o arquivo foi colocado offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-141">This post-data-restore log backup captures the point at which the file was taken offline.</span></span> <span data-ttu-id="68d68-142">O backup de log após a restauração de dados é necessário porque o [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] não podem usar log online para uma restauração online.</span><span class="sxs-lookup"><span data-stu-id="68d68-142">The post-data-restore log backup is necessary because the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] cannot use online log for an online restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="68d68-143">Alternativamente, você pode colocar o arquivo offline manualmente antes da sequência de restauração.</span><span class="sxs-lookup"><span data-stu-id="68d68-143">Alternatively, you can manually take the file offline before the restore sequence.</span></span> <span data-ttu-id="68d68-144">Para obter mais informações, consulte "Colocando um banco de dados ou arquivo offline", adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="68d68-144">For more information, see "Taking a Database or File Offline" later in this topic.</span></span>  
  
##  <a name="taking-a-database-or-file-offline"></a><a name="taking_db_or_file_offline"></a> <span data-ttu-id="68d68-145">Colocando um banco de dados ou arquivo offline</span><span class="sxs-lookup"><span data-stu-id="68d68-145">Taking a Database or File Offline</span></span>  
 <span data-ttu-id="68d68-146">Se você não quiser usar a restauração online, poderá colocar o banco de dados offline antes de iniciar a sequência de restauração usando um dos seguintes métodos:</span><span class="sxs-lookup"><span data-stu-id="68d68-146">If you do not want to use online restore, you can take the database offline before you start the restore sequence by using one of the following methods:</span></span>  
  
-   <span data-ttu-id="68d68-147">Em qualquer modelo de recuperação, você pode colocar o banco de dados offline usando a seguinte instrução [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) :</span><span class="sxs-lookup"><span data-stu-id="68d68-147">Under any recovery model, you can take the database offline by using the following [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) statement:</span></span>  
  
     <span data-ttu-id="68d68-148">ALTER DATABASE *database_name* SET OFFLINE</span><span class="sxs-lookup"><span data-stu-id="68d68-148">ALTER DATABASE *database_name* SET OFFLINE</span></span>  
  
-   <span data-ttu-id="68d68-149">Alternativamente, no modelo de recuperação completa, você pode forçar uma restauração de arquivo ou página a ficar offline, usando a seguinte instrução [BACKUP LOG](/sql/t-sql/statements/backup-transact-sql) , colocando o banco de dados no estado de restauração:</span><span class="sxs-lookup"><span data-stu-id="68d68-149">Alternatively, under the full recovery model, you can force a file or page restore to be offline, by using the following [BACKUP LOG](/sql/t-sql/statements/backup-transact-sql) statement put the database in to the restoring state:</span></span>  
  
     <span data-ttu-id="68d68-150">BACKUP LOG *database_name* WITH NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="68d68-150">BACKUP LOG *database_name* WITH NORECOVERY.</span></span>  
  
 <span data-ttu-id="68d68-151">Desde que um banco de dados permaneça offline, todas as restaurações serão offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-151">As long as a database remains offline, all restores are offline restores.</span></span>  
  
## <a name="examples"></a><span data-ttu-id="68d68-152">Exemplos</span><span class="sxs-lookup"><span data-stu-id="68d68-152">Examples</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="68d68-153">A sintaxe para uma sequência de restauração online é igual à de uma sequência de restauração offline.</span><span class="sxs-lookup"><span data-stu-id="68d68-153">The syntax for an online restore sequence is the same as for an offline restore sequence.</span></span>  
  
-   [<span data-ttu-id="68d68-154">Exemplo: Restauração por etapas de banco de dados &#40;Modelo de recuperação simples&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-154">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="68d68-155">Exemplo: Restauração por etapas de apenas alguns grupos de arquivos &#40;Modelo de recuperação simples&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-155">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
-   [<span data-ttu-id="68d68-156">Exemplo: restauração online de um arquivo somente leitura &#40;Modelo de recuperação simples&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-156">Example: Online Restore of a Read-Only File &#40;Simple Recovery Model&#41;</span></span>](example-online-restore-of-a-read-only-file-simple-recovery-model.md)  
  
-   [<span data-ttu-id="68d68-157">Exemplo: Restauração por etapas de banco de dados &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-157">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="68d68-158">Exemplo: Restauração por etapas de apenas alguns grupos de arquivos &#40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-158">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
-   [<span data-ttu-id="68d68-159">Exemplo: restauração online de um arquivo de leitura/gravação #40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-159">Example: Online Restore of a Read-Write File &#40;Full Recovery Model&#41;</span></span>](example-online-restore-of-a-read-write-file-full-recovery-model.md)  
  
-   [<span data-ttu-id="68d68-160">Exemplo: restauração online de um arquivo somente leitura #40;Modelo de recuperação completa&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-160">Example: Online Restore of a Read-Only File &#40;Full Recovery Model&#41;</span></span>](example-online-restore-of-a-read-only-file-full-recovery-model.md)  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="68d68-161">Tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="68d68-161">Related Tasks</span></span>  
  
-   [<span data-ttu-id="68d68-162">Restaurar arquivos e grupos de arquivos &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-162">Restore Files and Filegroups &#40;SQL Server&#41;</span></span>](restore-files-and-filegroups-sql-server.md)  
  
-   [<span data-ttu-id="68d68-163">Restaurar páginas &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-163">Restore Pages &#40;SQL Server&#41;</span></span>](restore-pages-sql-server.md)  
  
-   [<span data-ttu-id="68d68-164">Gerenciar a tabela suspect_pages &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-164">Manage the suspect_pages Table &#40;SQL Server&#41;</span></span>](manage-the-suspect-pages-table-sql-server.md)  
  
-   [<span data-ttu-id="68d68-165">Recuperar um banco de dados sem restaurar dados &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-165">Recover a Database Without Restoring Data &#40;Transact-SQL&#41;</span></span>](recover-a-database-without-restoring-data-transact-sql.md)  
  
-   [<span data-ttu-id="68d68-166">Remover grupos de arquivos expirados &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-166">Remove Defunct Filegroups &#40;SQL Server&#41;</span></span>](remove-defunct-filegroups-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="68d68-167">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="68d68-167">See Also</span></span>  
 <span data-ttu-id="68d68-168">[Restaurações de arquivo &#40;Modelo de recuperação completa&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="68d68-168">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="68d68-169">[Restaurações de arquivos &#40;Modelo de recuperação simples&#41;](file-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="68d68-169">[File Restores &#40;Simple Recovery Model&#41;](file-restores-simple-recovery-model.md) </span></span>  
 <span data-ttu-id="68d68-170">[Restaurar páginas &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="68d68-170">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 <span data-ttu-id="68d68-171">[Restaurações por etapas &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="68d68-171">[Piecemeal Restores &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span></span>  
 [<span data-ttu-id="68d68-172">Visão geral de restauração e recuperação &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="68d68-172">Restore and Recovery Overview &#40;SQL Server&#41;</span></span>](restore-and-recovery-overview-sql-server.md)  
  
  
