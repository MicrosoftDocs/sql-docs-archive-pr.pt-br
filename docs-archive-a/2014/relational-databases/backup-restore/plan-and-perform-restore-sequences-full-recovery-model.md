---
title: Planejar e executar sequências de restauração (modelo de recuperação completa) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- restore sequences [SQL Server], planning for
- full recovery model [SQL Server], planning restore sequences
ms.assetid: 9cbefaf8-d2b6-41c9-83fc-b3807a841fe2
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 85558c0a6361837b5645b9fc38ad040254265d72
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87581424"
---
# <a name="plan-and-perform-restore-sequences-full-recovery-model"></a><span data-ttu-id="08dda-102">Planejar e executar sequências de restauração (modelo de recuperação completa)</span><span class="sxs-lookup"><span data-stu-id="08dda-102">Plan and Perform Restore Sequences (Full Recovery Model)</span></span>
  <span data-ttu-id="08dda-103">Este tópico explica como planejar e executar uma sequência de restauração para bancos de dados do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que normalmente usam o modelo de recuperação completa.</span><span class="sxs-lookup"><span data-stu-id="08dda-103">This topic explains how to plan and perform a restore sequence for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that ordinarily uses the full recovery model.</span></span> <span data-ttu-id="08dda-104">Uma *sequência de restauração* é uma sequência de uma ou mais instruções [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="08dda-104">A *restore sequence* is a sequence of one or more [RESTORE](/sql/t-sql/statements/restore-statements-transact-sql) statements.</span></span> <span data-ttu-id="08dda-105">Geralmente, uma sequência de restauração inicializa os conteúdos do banco de dados, arquivos, e/ou páginas sendo restaurados (a fase de cópia de dados), efetua roll forward das transações registradas (a fase refazer) e reverte as transações não confirmadas (a fase desfazer).</span><span class="sxs-lookup"><span data-stu-id="08dda-105">Typically, a restore sequences initializes the contents of the database, files, and/or pages being restored (the data-copy phase), rolls forward logged transactions (the redo phase), and rolls back uncommitted transactions (the undo phase).</span></span>  
  
 <span data-ttu-id="08dda-106">Em casos simples, uma sequência de restauração requer apenas um backup de banco de dados completo, um backup de banco de dados diferencial e os backups de log subsequentes.</span><span class="sxs-lookup"><span data-stu-id="08dda-106">In simple cases, a restore sequence requires only a full database backup, a differential database backup, and the subsequent log backups.</span></span> <span data-ttu-id="08dda-107">Nesses casos, criar uma sequência de restauração correta é fácil.</span><span class="sxs-lookup"><span data-stu-id="08dda-107">In these cases, constructing a correct restore sequence is easy.</span></span> <span data-ttu-id="08dda-108">Por exemplo, para restaurar todo um banco de dados para o ponto de uma falha, comece fazendo backup do log de transações ativo (a *parte final* do log).</span><span class="sxs-lookup"><span data-stu-id="08dda-108">For example, to restore a whole database to the point of a failure, start by backing up the active transaction log (the *tail* of the log).</span></span> <span data-ttu-id="08dda-109">Depois, restaure o backup de banco de dados completo mais recente, o backup diferencial mais recente (se houver) e todos os backups de log subsequentes na ordem em que foram feitos.</span><span class="sxs-lookup"><span data-stu-id="08dda-109">Then, restore the most recent full database backup, the most recent differential backup (if any), and all subsequent log backups in the order in which they were taken.</span></span>  
  
 <span data-ttu-id="08dda-110">Em casos mais complexos, criar uma sequência de restauração correta pode ser um processo complexo.</span><span class="sxs-lookup"><span data-stu-id="08dda-110">In more complex cases, constructing a correct restore sequence can be a complex process.</span></span> <span data-ttu-id="08dda-111">Por exemplo, uma sequência de restauração pode exigir vários backups de arquivo ou restauração de dados a um point-in-time específico.</span><span class="sxs-lookup"><span data-stu-id="08dda-111">For example, a restore sequence might require multiple file backups or restoring data to a specific point in time.</span></span> <span data-ttu-id="08dda-112">Em casos muito complexos, você pode ter que transpor um caminho de recuperação que abrange uma ou mais bifurcações de recuperação.</span><span class="sxs-lookup"><span data-stu-id="08dda-112">In very complex cases, you might even have to traverse a forked recovery path that spans one or more recovery forks.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="08dda-113">Um *caminho de recuperação* é a sequência de backups de dados e logs que levou o banco de dados até um momento específico (conhecido como um ponto de recuperação).</span><span class="sxs-lookup"><span data-stu-id="08dda-113">A *recovery path* is the sequence of data and log backups that have brought a database to a particular point in time (known as a recovery point).</span></span> <span data-ttu-id="08dda-114">Um caminho de recuperação é um conjunto específico de transformações que levaram à evolução do banco de dados, mas mantiveram a sua consistência.</span><span class="sxs-lookup"><span data-stu-id="08dda-114">A recovery path is a specific set of transformations that have evolved the database over time, yet have maintained the consistency of the database.</span></span> <span data-ttu-id="08dda-115">Um caminho de recuperação descreve um intervalo de LSNs de um ponto inicial (LSN,GUID) até um ponto final (LSN,GUID).</span><span class="sxs-lookup"><span data-stu-id="08dda-115">A recovery path describes a range of LSNs from a start point (LSN,GUID) to an end point (LSN,GUID).</span></span> <span data-ttu-id="08dda-116">O intervalo de LSNs em um caminho de recuperação pode percorrer uma ou mais ramificações de recuperação, do início ao fim.</span><span class="sxs-lookup"><span data-stu-id="08dda-116">The range of LSNs in a recovery path can traverse one or more recovery branches from start to end.</span></span>  
  
## <a name="to-plan-a-restore-sequence"></a><span data-ttu-id="08dda-117">Para planejar uma sequência de restauração</span><span class="sxs-lookup"><span data-stu-id="08dda-117">To Plan a Restore Sequence</span></span>  
 <span data-ttu-id="08dda-118">Antes de iniciar uma sequência de restauração, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="08dda-118">Before you start a restore sequence, follow these steps:</span></span>  
  
1.  <span data-ttu-id="08dda-119">Crie um backup do final do log do banco de dados, se puder.</span><span class="sxs-lookup"><span data-stu-id="08dda-119">Create a tail-log backup of the database, if you can.</span></span> <span data-ttu-id="08dda-120">Para obter mais informações, veja [Backups da parte final do log &#40;SQL Server&#41;](tail-log-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-120">For more information, see [Tail-Log Backups &#40;SQL Server&#41;](tail-log-backups-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="08dda-121">Determine o ponto de recuperação desejado.</span><span class="sxs-lookup"><span data-stu-id="08dda-121">Determine the target recovery point.</span></span>  
  
     <span data-ttu-id="08dda-122">O ponto de recuperação desejado pode ser qualquer point-in-time ou marca em um backup de log de transações.</span><span class="sxs-lookup"><span data-stu-id="08dda-122">The target recovery point can be any point in time or mark within a transaction log backup.</span></span> <span data-ttu-id="08dda-123">Para obter mais informações, veja [Restaurar um Banco de Dados SQL Server em um ponto específico &#40;Modelo de recuperação completa&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) ou [Usar transações marcadas para recuperar bancos de dados relacionados de forma consistente &#40;Modelo de recuperação completa&#41;](use-marked-transactions-to-recover-related-databases-consistently.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-123">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) or [Use Marked Transactions to Recover Related Databases Consistently &#40;Full Recovery Model&#41;](use-marked-transactions-to-recover-related-databases-consistently.md).</span></span>  
  
3.  <span data-ttu-id="08dda-124">Determine o tipo de restauração que você deseja executar.</span><span class="sxs-lookup"><span data-stu-id="08dda-124">Determine the type of restore you want to perform.</span></span> <span data-ttu-id="08dda-125">Para obter mais informações, veja [Visão geral de restauração e recuperação &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-125">For more information, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
4.  <span data-ttu-id="08dda-126">Identifique quais backups são necessários e certifique-se de que os conjuntos de mídia e dispositivos de backup necessários estão disponíveis.</span><span class="sxs-lookup"><span data-stu-id="08dda-126">Identify which backups you require and make sure that the necessary media sets and backup devices are available.</span></span> <span data-ttu-id="08dda-127">Para obter mais informações, veja [Dispositivos de backup &#40;SQL Server&#41;](backup-devices-sql-server.md) e [Conjuntos de mídias, famílias de mídia e conjuntos de backup &#40;SQL Server&#41;](media-sets-media-families-and-backup-sets-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-127">For more information, see [Backup Devices &#40;SQL Server&#41;](backup-devices-sql-server.md) and [Media Sets, Media Families, and Backup Sets &#40;SQL Server&#41;](media-sets-media-families-and-backup-sets-sql-server.md).</span></span>  
  
## <a name="to-perform-a-restore-sequence"></a><span data-ttu-id="08dda-128">Para executar uma sequência de restauração</span><span class="sxs-lookup"><span data-stu-id="08dda-128">To Perform a Restore Sequence</span></span>  
 <span data-ttu-id="08dda-129">Para executar uma sequência de restauração, siga estes passos:</span><span class="sxs-lookup"><span data-stu-id="08dda-129">To perform a restore sequence, follow these steps:</span></span>  
  
1.  <span data-ttu-id="08dda-130">Para iniciar a sequência, restaure um ou mais backups de dados, como: um backup de banco de dados, um backup parcial, ou um ou mais backups de arquivo.</span><span class="sxs-lookup"><span data-stu-id="08dda-130">To start the sequence, restore a one or more data backups, such as: a database backup, a partial backup, one or more file backups.</span></span>  
  
2.  <span data-ttu-id="08dda-131">Opcionalmente, restaure os últimos backups diferenciais baseados nestes backups completos.</span><span class="sxs-lookup"><span data-stu-id="08dda-131">Optionally, restore the latest differential backups that are based on these full backups.</span></span>  
  
     <span data-ttu-id="08dda-132">Para cada backup completo que você planeja restaurar, determine se ele é a base de qualquer backup diferencial.</span><span class="sxs-lookup"><span data-stu-id="08dda-132">For each full backup that you plan to restore, determine whether it is the base for any differential backups.</span></span> <span data-ttu-id="08dda-133">Nesse caso, restaure o backup diferencial mais recente, se puder.</span><span class="sxs-lookup"><span data-stu-id="08dda-133">If so, restore most recent differential backup, if you can.</span></span> <span data-ttu-id="08dda-134">Para obter mais informações, veja [Backups diferenciais &#40;SQL Server&#41;](differential-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-134">For more information, see [Differential Backups &#40;SQL Server&#41;](differential-backups-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="08dda-135">Efetue roll forward do banco de dados restaurando backups de log em sequência, terminando com o backup que contém o ponto de recuperação.</span><span class="sxs-lookup"><span data-stu-id="08dda-135">Roll forward the database by restoring log backups in sequence, finishing with the backup that contains the recovery point.</span></span> <span data-ttu-id="08dda-136">A aplicação de todos os backups de log depende se o backup de log contém o ponto de recuperação desejado, como segue:</span><span class="sxs-lookup"><span data-stu-id="08dda-136">Whether you have to apply all the log backups depends on what log backup contains the target recovery point, as follows:</span></span>  
  
    -   <span data-ttu-id="08dda-137">Se o ponto de recuperação for o ponto de falha, você deve restaurar todo backup de log criado desde o último backup de dados (completo ou diferencial) restaurado.</span><span class="sxs-lookup"><span data-stu-id="08dda-137">If the recovery point is the point of a failure, you must restore every log backup that was created since the last data (full or differential) backup you restored.</span></span> <span data-ttu-id="08dda-138">Para obter mais informações, veja [Aplicar backups de log de transações &#40;SQL Server&#41;](transaction-log-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-138">For more information, see [Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md).</span></span>  
  
    -   <span data-ttu-id="08dda-139">Para a restauração point-in-time, podem não ser necessários os backups de log mais recentes.</span><span class="sxs-lookup"><span data-stu-id="08dda-139">For a point-in-time restore, you might not require the most recent log backups.</span></span> <span data-ttu-id="08dda-140">Se você usar o [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], o orientador de recuperação de banco de dados garantirá que apenas os backups necessários para restaurar até o ponto especificado sejam selecionados.</span><span class="sxs-lookup"><span data-stu-id="08dda-140">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], the Database Recovery Advisor ensures that only backups that are required to restore to your specified point in time are selected.</span></span> <span data-ttu-id="08dda-141">Esses backups compõem o plano de restauração recomendado para a sua restauração pontual.</span><span class="sxs-lookup"><span data-stu-id="08dda-141">These backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="08dda-142">Para obter mais informações, veja [Restaurar um banco de dados do SQL Server em um ponto específico &#40;Modelo de recuperação completa&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).</span><span class="sxs-lookup"><span data-stu-id="08dda-142">For more information, see [Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md).</span></span>  
  
## <a name="restarting-a-restore-sequence"></a><span data-ttu-id="08dda-143">Reinicializando uma sequência de restauração</span><span class="sxs-lookup"><span data-stu-id="08dda-143">Restarting a Restore Sequence</span></span>  
 <span data-ttu-id="08dda-144">Se você encontrar um problema com o resultado de uma sequência de restauração, pode encerrá-la e reiniciar a sequência de restauração desde o início.</span><span class="sxs-lookup"><span data-stu-id="08dda-144">If you encounter a problem with the outcome of a restore sequence, you can quit it and restart the restore sequence over from the start.</span></span> <span data-ttu-id="08dda-145">Por exemplo, se você restaurar muitos backups de log acidentalmente e exceder o ponto de recuperação pretendido, reinicialize a sequência de restauração até o backup de log que contém o ponto de recuperação desejado.</span><span class="sxs-lookup"><span data-stu-id="08dda-145">For example, if you accidentally restore too many log backups and overshoot the intended recovery point, you must restart the restore sequence up to log backup that contains the target recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="08dda-146">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="08dda-146">See Also</span></span>  
 <span data-ttu-id="08dda-147">[Visão geral do backup &#40;SQL Server&#41;](backup-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="08dda-147">[Backup Overview &#40;SQL Server&#41;](backup-overview-sql-server.md) </span></span>  
 <span data-ttu-id="08dda-148">[Visão geral de restauração e recuperação &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="08dda-148">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 <span data-ttu-id="08dda-149">[Restaurações completas de banco de dados &#40;Modelo de recuperação completa&#41;](complete-database-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="08dda-149">[Complete Database Restores &#40;Full Recovery Model&#41;](complete-database-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="08dda-150">[Restauração online &#40;SQL Server&#41;](online-restore-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="08dda-150">[Online Restore &#40;SQL Server&#41;](online-restore-sql-server.md) </span></span>  
 <span data-ttu-id="08dda-151">[Restaurações de arquivo &#40;Modelo de recuperação completa&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="08dda-151">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="08dda-152">[Restaurar páginas &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="08dda-152">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 [<span data-ttu-id="08dda-153">Restaurações por etapas &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="08dda-153">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
