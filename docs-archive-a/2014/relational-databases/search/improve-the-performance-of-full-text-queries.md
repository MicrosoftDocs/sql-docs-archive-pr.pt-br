---
title: Melhorar o desempenho de consultas de texto completo | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: search
ms.topic: conceptual
ms.assetid: 0658dc74-25eb-4486-bbd6-e85c1f92c272
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: a1437f710725df5c87d31f6a80939a5d7869b412
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87681517"
---
# <a name="improve-the-performance-of-full-text-queries"></a><span data-ttu-id="0a274-102">Melhorar o desempenho de consultas de texto completo</span><span class="sxs-lookup"><span data-stu-id="0a274-102">Improve the Performance of Full-Text Queries</span></span>
  <span data-ttu-id="0a274-103">A lista a seguir apresenta recomendações que ajudarão a melhorar o desempenho das consultas de texto completo.</span><span class="sxs-lookup"><span data-stu-id="0a274-103">The following is a list of recommendations that will help to improve the performance of full-text queries.</span></span>  
  
 <span data-ttu-id="0a274-104">O desempenho das consultas de texto completo também é influenciado por recursos de hardware, como memória, velocidade de disco, velocidade de CPU e arquitetura de computador.</span><span class="sxs-lookup"><span data-stu-id="0a274-104">The performance of full-text queries is also influenced by hardware resources, such as memory, disk speed, CPU speed, and machine architecture.</span></span>  
  
-   <span data-ttu-id="0a274-105">Desfragmente o índice da tabela base usando [ALTER INDEX REORGANIZE](/sql/t-sql/statements/alter-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0a274-105">Defragment the index of the base table by using [ALTER INDEX REORGANIZE](/sql/t-sql/statements/alter-index-transact-sql).</span></span>  
  
-   <span data-ttu-id="0a274-106">Reorganize o catálogo de texto completo usando [ALTER FULLTEXT CATALOG REORGANIZE](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0a274-106">Reorganize the full-text catalog by using [ALTER FULLTEXT CATALOG REORGANIZE](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql).</span></span> <span data-ttu-id="0a274-107">Faça isso antes de testar o desempenho, pois a execução dessa instrução provoca uma mesclagem mestra dos índices de texto completo desse catálogo.</span><span class="sxs-lookup"><span data-stu-id="0a274-107">Make sure that you do this before performance testing because running this statement causes a master merge of the full-text indexes in that catalog.</span></span>  
  
-   <span data-ttu-id="0a274-108">Restrinja suas opções de colunas de chave de texto completo a uma coluna pequena.</span><span class="sxs-lookup"><span data-stu-id="0a274-108">Restrict your choice of full-text key columns to a small column.</span></span> <span data-ttu-id="0a274-109">Embora haja suporte para uma coluna de 900 bytes, é recomendável usar uma coluna de chave menor em um índice de texto completo.</span><span class="sxs-lookup"><span data-stu-id="0a274-109">Although a 900-byte column is supported, we recommend using a smaller key column in a full-text index.</span></span> <span data-ttu-id="0a274-110">`int` e `bigint` fornecem o melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="0a274-110">`int` and `bigint` provide the best performance.</span></span>  
  
-   <span data-ttu-id="0a274-111">O uso de uma chave de texto completo de inteiro evita uma junção com a tabela de mapeamento **docid** .</span><span class="sxs-lookup"><span data-stu-id="0a274-111">Using an integer full-text key avoids a join with the **docid** mapping table.</span></span> <span data-ttu-id="0a274-112">Portanto, uma chave de texto completo de inteiro melhora o desempenho de consultas consideravelmente e aprimora o desempenho de rastreamento.</span><span class="sxs-lookup"><span data-stu-id="0a274-112">Therefore, an integer full-text key improves query performance by an order of magnitude and improves crawl performance.</span></span> <span data-ttu-id="0a274-113">Outros benefícios de desempenho poderão ser obtidos se a chave de texto completo também for a chave de índice clusterizado.</span><span class="sxs-lookup"><span data-stu-id="0a274-113">Additional performance benefits might result if the full-text key is also the clustered index key.</span></span>  
  
-   <span data-ttu-id="0a274-114">Combine vários predicados [CONTAINS](/sql/t-sql/queries/contains-transact-sql) em um único predicado CONTAINS.</span><span class="sxs-lookup"><span data-stu-id="0a274-114">Combine multiple [CONTAINS](/sql/t-sql/queries/contains-transact-sql) predicates into one CONTAINS predicate.</span></span> <span data-ttu-id="0a274-115">No [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , você pode especificar uma lista de colunas na consulta CONTAINS.</span><span class="sxs-lookup"><span data-stu-id="0a274-115">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] you can specify a list of columns in the CONTAINS query.</span></span>  
  
-   <span data-ttu-id="0a274-116">Se você só precisar de informações de classificação ou de chave de texto completo, use [CONTAINSTABLE](/sql/relational-databases/system-functions/containstable-transact-sql) ou [FREETEXTTABLE](/sql/relational-databases/system-functions/freetexttable-transact-sql) em vez de CONTAINS ou FREETEXT, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="0a274-116">If you only require full-text key or rank information, use [CONTAINSTABLE](/sql/relational-databases/system-functions/containstable-transact-sql) or [FREETEXTTABLE](/sql/relational-databases/system-functions/freetexttable-transact-sql) instead of CONTAINS or FREETEXT, respectively.</span></span>  
  
-   <span data-ttu-id="0a274-117">Para limitar os resultados e melhorar o desempenho, use o parâmetro *top_n_by_rank* das funções FREETEXTTABLE e CONTAINSTABLE.</span><span class="sxs-lookup"><span data-stu-id="0a274-117">To limit results and increase performance, use the *top_n_by_rank* parameter of the FREETEXTTABLE and CONTAINSTABLE functions.</span></span> <span data-ttu-id="0a274-118">*top_n_by_rank* permite que você recupere apenas as ocorrências mais relevantes.</span><span class="sxs-lookup"><span data-stu-id="0a274-118">*top_n_by_rank* allows you to recall only the most relevant hits.</span></span> <span data-ttu-id="0a274-119">Use este parâmetro apenas se o seu cenário comercial não exige a recuperação de todos os acertos possíveis (isto é, não exige a *recuperação total*).</span><span class="sxs-lookup"><span data-stu-id="0a274-119">Use this parameter only if your business scenario does not require recalling all possible hits (that is, it does not require *total recall*).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="0a274-120">A recuperação total geralmente só é necessária em cenários legais, mas pode ser menos importante do que o desempenho em cenários comerciais, como e-business.</span><span class="sxs-lookup"><span data-stu-id="0a274-120">Total recall is typically necessary for legal scenarios but might be less important than performance for business scenarios such as an e-business.</span></span>  
  
-   <span data-ttu-id="0a274-121">Verifique o plano de consulta de texto completo para assegurar que o plano de junção apropriado foi escolhido.</span><span class="sxs-lookup"><span data-stu-id="0a274-121">Check the full-text query plan to make sure that the appropriate join plan is chosen.</span></span> <span data-ttu-id="0a274-122">Use uma dica de junção ou de consulta se necessário.</span><span class="sxs-lookup"><span data-stu-id="0a274-122">Use a join hint or query hint if you have to.</span></span> <span data-ttu-id="0a274-123">Se um parâmetro for usado na consulta de texto completo, o valor inicial do parâmetro determinará o plano de consulta.</span><span class="sxs-lookup"><span data-stu-id="0a274-123">If a parameter is used in the full-text query, the first-time value of the parameter determines the query plan.</span></span> <span data-ttu-id="0a274-124">Você pode usar a [dica de consulta](/sql/t-sql/queries/hints-transact-sql-query) OPTIMIZE FOR para forçar a consulta a ser compilada com o valor desejado.</span><span class="sxs-lookup"><span data-stu-id="0a274-124">You can use the OPTIMIZE FOR [query hint](/sql/t-sql/queries/hints-transact-sql-query) to force the query to compile with the value you want.</span></span> <span data-ttu-id="0a274-125">Isso ajuda a conseguir um plano de consulta determinista e melhor desempenho.</span><span class="sxs-lookup"><span data-stu-id="0a274-125">This helps achieve a deterministic query plan and better performance.</span></span>  
  
-   <span data-ttu-id="0a274-126">Um número excessivo de fragmentos de índice de texto completo no índice de texto completo pode levar a uma diminuição considerável do desempenho de consulta.</span><span class="sxs-lookup"><span data-stu-id="0a274-126">Too many full-text index fragments in the full-text index, can lead to substantial degradation in query performance.</span></span> <span data-ttu-id="0a274-127">Para reduzir a quantidade de fragmentos, reorganize o catálogo de texto completo usando a opção REORGANIZE da instrução [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="0a274-127">To reduce the number of fragments, reorganize the full-text catalog by using the REORGANIZE option of the [ALTER FULLTEXT CATALOG](/sql/t-sql/statements/alter-fulltext-catalog-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="0a274-128">Essa instrução basicamente mescla todos os fragmentos em um único fragmento maior e remove todas as entradas obsoletas do índice de texto completo.</span><span class="sxs-lookup"><span data-stu-id="0a274-128">This statement essentially merges all the fragments into a single larger fragment and removes all obsolete entries from the full-text index.</span></span>  
  
-   <span data-ttu-id="0a274-129">Na pesquisa de texto completo do , os operadores lógicos especificados em CONTAINSTABLE (AND, OR) podem ser implementados como junções SQL ou nas STVF (funções com valor de tabela de fluxo) de execução de texto completo.</span><span class="sxs-lookup"><span data-stu-id="0a274-129">In  full-text search, logical operators specified in CONTAINSTABLE (AND, OR) can be implemented either as SQL joins or inside the full-text execution streaming table-valued functions (STVF).</span></span> <span data-ttu-id="0a274-130">Em geral, as consultas que têm apenas um tipo de operadores lógicos são implementadas meramente por execução de texto completo, enquanto as consultas que combinam operadores lógicos também possuem junções SQL.</span><span class="sxs-lookup"><span data-stu-id="0a274-130">Typically, queries with only one type of logical operators are implemented purely by full-text execution, whereas queries that mix logical operators also possess SQL joins.</span></span> <span data-ttu-id="0a274-131">A implementação de um operador lógico dentro da STVF de execução de texto completo usa algumas propriedades de índice especiais que a tornam bem mais rápida do que as junções SQL.</span><span class="sxs-lookup"><span data-stu-id="0a274-131">Implementation of a logical operator inside the full-text execution STVF uses some special index properties that make it much faster than SQL joins.</span></span> <span data-ttu-id="0a274-132">Por isso, é recomendável que, quando possível, você forme as consultas usando um único tipo de operador lógico.</span><span class="sxs-lookup"><span data-stu-id="0a274-132">For this reason, we recommend that, where possible, you frame queries using only a single type of logical operator.</span></span>  
  
-   <span data-ttu-id="0a274-133">Para aplicativos que contêm afirmações de relação seletiva, as consultas que usam predicados relacionais seletivos e predicados de texto completo não seletivos podem ter melhor desempenho quando escritas para usar o otimizador de consulta.</span><span class="sxs-lookup"><span data-stu-id="0a274-133">For applications that contain selective-relation predications, queries that use selective relational predicates and unselective full-text predicates might perform best when they are written to use the query optimizer.</span></span> <span data-ttu-id="0a274-134">Dessa forma, o otimizador de consulta pode decidir se poderá explorar o predicado ou a aplicação de intervalo para gerar um plano de consulta eficaz.</span><span class="sxs-lookup"><span data-stu-id="0a274-134">This allows the query optimizer to decide whether it can exploit predicate or range pushdown to produce an effective query plan.</span></span> <span data-ttu-id="0a274-135">Esta abordagem é mais simples e geralmente mais eficiente do que a indexação de dados relacionais como dados de texto completo.</span><span class="sxs-lookup"><span data-stu-id="0a274-135">This approach is simpler and often more efficient than indexing relational data as full-text data.</span></span>  
  
## <a name="related-resources"></a><span data-ttu-id="0a274-136">Recursos relacionados</span><span class="sxs-lookup"><span data-stu-id="0a274-136">Related Resources</span></span>  
 [<span data-ttu-id="0a274-137">Pesquisa de Texto Completo do SQL Server 2008: Operações internas e aprimoramentos</span><span class="sxs-lookup"><span data-stu-id="0a274-137">SQL Server 2008 Full-Text Search: Internals and Enhancements</span></span>](https://go.microsoft.com/fwlink/?LinkId=129544)  
  
## <a name="see-also"></a><span data-ttu-id="0a274-138">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="0a274-138">See Also</span></span>  
 <span data-ttu-id="0a274-139">[sys.dm_fts_memory_buffers &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-buffers-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="0a274-139">[sys.dm_fts_memory_buffers &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-buffers-transact-sql) </span></span>  
 [<span data-ttu-id="0a274-140">sys.dm_fts_memory_pools &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="0a274-140">sys.dm_fts_memory_pools &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-fts-memory-pools-transact-sql)  
  
  
