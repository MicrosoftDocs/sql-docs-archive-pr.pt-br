---
title: Estratégias para fazer backup e restaurar a replicação de mesclagem | Microsoft Docs
ms.custom: ''
ms.date: 03/09/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- recovery [SQL Server replication], merge replication
- backups [SQL Server replication], merge replication
- restoring [SQL Server replication], merge replication
- merge replication [SQL Server replication], backup and restore
ms.assetid: b8ae31c6-d76f-4dd7-8f46-17d023ca3eca
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 45e3259d93af4735569fcb6b6a9c7b9eddd52730
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87683508"
---
# <a name="strategies-for-backing-up-and-restoring-merge-replication"></a><span data-ttu-id="ac888-102">Estratégias para fazer backup e restaurar a replicação de mesclagem</span><span class="sxs-lookup"><span data-stu-id="ac888-102">Strategies for Backing Up and Restoring Merge Replication</span></span>
  <span data-ttu-id="ac888-103">Para replicação de mesclagem, faça backup dos seguintes bancos de dados regularmente:</span><span class="sxs-lookup"><span data-stu-id="ac888-103">For merge replication, back up the following databases regularly:</span></span>  
  
-   <span data-ttu-id="ac888-104">O banco de dados de publicação no Publicador.</span><span class="sxs-lookup"><span data-stu-id="ac888-104">The publication database at the Publisher</span></span>   
-   <span data-ttu-id="ac888-105">O banco de dados de distribuição no Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="ac888-105">The distribution database at the Distributor</span></span>    
-   <span data-ttu-id="ac888-106">O banco de dados de assinatura em cada Assinante.</span><span class="sxs-lookup"><span data-stu-id="ac888-106">The subscription database at each Subscriber</span></span>    
-   <span data-ttu-id="ac888-107">Os bancos de dados de sistema **mestre** e **msdb** no Publicador, Distribuidor e todos os Assinantes.</span><span class="sxs-lookup"><span data-stu-id="ac888-107">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="ac888-108">Esses bancos de dados devem ter, cada um, seus backups realizados em simultâneo com o banco de dados de replicação relevante.</span><span class="sxs-lookup"><span data-stu-id="ac888-108">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="ac888-109">Por exemplo, faça o backup dos bancos de dados **mestre** e **msdb** no Publicador ao mesmo tempo em que executa o backup do banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-109">For example, back up the **master** and **msdb** databases at the Publisher at the same time you back up the publication database.</span></span> <span data-ttu-id="ac888-110">Se o banco de dados de publicação for restaurado, assegure-se de que os bancos de dados **mestre** e **msdb** são consistentes com o banco de dados de publicação, em termos de configuração de replicação e ajustes.</span><span class="sxs-lookup"><span data-stu-id="ac888-110">If the publication database is restored, ensure that the **master** and **msdb** database are consistent with the publication database in terms of replication configuration and settings.</span></span>  
  
 <span data-ttu-id="ac888-111">Se você executar backups de log regulares, qualquer alteração relacionada à replicação deverá ser capturada nos backups de log.</span><span class="sxs-lookup"><span data-stu-id="ac888-111">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="ac888-112">Se você não executar backups de log, um backup deverá ser executado sempre que uma configuração relevante à replicação for alterada.</span><span class="sxs-lookup"><span data-stu-id="ac888-112">If you don't perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="ac888-113">Para obter mais informações, consulte [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-113">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
 <span data-ttu-id="ac888-114">Escolha uma das abordagens descritas abaixo, para fazer o backup e a restauração do banco de dados de publicação, e, então, siga as recomendações relacionadas abaixo, para o banco de dados de publicação e para os bancos de dados de assinaturas.</span><span class="sxs-lookup"><span data-stu-id="ac888-114">Choose one of the approaches detailed below for backing up and restoring the publication database, and then follow the recommendations listed for the distribution database and subscription databases.</span></span>  
  
## <a name="backing-up-and-restoring-the-publication-database"></a><span data-ttu-id="ac888-115">Fazendo backup e restaurando o banco de dados de publicação</span><span class="sxs-lookup"><span data-stu-id="ac888-115">Backing Up and Restoring the Publication Database</span></span>  
 <span data-ttu-id="ac888-116">Há duas abordagens para restaurar um banco de dados de publicação de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="ac888-116">There are two approaches to restoring a merge publication database.</span></span> <span data-ttu-id="ac888-117">Depois de restaurar o banco de dados de publicação de um backup, você deverá:</span><span class="sxs-lookup"><span data-stu-id="ac888-117">After restoring the publication database from a backup, you should either:</span></span>  
  
-   <span data-ttu-id="ac888-118">Sincronizar o banco de dados de publicação com um banco de dados de assinatura.</span><span class="sxs-lookup"><span data-stu-id="ac888-118">Synchronize the publication database with a subscription database.</span></span>  
  
-   <span data-ttu-id="ac888-119">Reinicializar todas as assinaturas para publicações no banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-119">Reinitialize all subscriptions to the publications in the publication database.</span></span>  
  
 <span data-ttu-id="ac888-120">Usar qualquer um desses métodos garante que, depois que uma restauração é executada, o Publicador e todos os Assinantes serão sincronizados.</span><span class="sxs-lookup"><span data-stu-id="ac888-120">Using either of these methods ensures that after a restore is performed, the Publisher and all Subscribers are synchronized.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ac888-121">Se qualquer tabela contiver colunas de identidade, você deve certificar-se que os intervalos corretos de identidade estão atribuídos, depois de uma restauração.</span><span class="sxs-lookup"><span data-stu-id="ac888-121">If any tables contain identity columns, you must ensure the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="ac888-122">Para obter mais informações, consulte [Replicar colunas de identidade](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-122">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
### <a name="synchronizing-the-publication-database"></a><span data-ttu-id="ac888-123">Sincronizando o banco de dados de publicação</span><span class="sxs-lookup"><span data-stu-id="ac888-123">Synchronizing the Publication Database</span></span>  
 <span data-ttu-id="ac888-124">Sincronizar um banco de dados de publicação com um banco de dados de assinatura permitirá a você carregar a partir de um ou mais bancos de dados de assinatura, as mudanças que foram feitas anteriormente no banco de dados de publicação, mas que não foram representadas no backup restaurado.</span><span class="sxs-lookup"><span data-stu-id="ac888-124">Synchronizing a publication database with a subscription database allows you to upload from one or more subscription databases those changes made previously in the publication database, but not represented in the restored backup.</span></span> <span data-ttu-id="ac888-125">Os dados que podem ser carregados dependem do modo como uma publicação é filtrada:</span><span class="sxs-lookup"><span data-stu-id="ac888-125">The data that can be uploaded depends on the way in which a publication is filtered:</span></span>  
  
-   <span data-ttu-id="ac888-126">Se a publicação não for filtrada, você deverá conseguir atualizar o banco de dados de publicação com uma sincronização com o Assinante mais atualizado.</span><span class="sxs-lookup"><span data-stu-id="ac888-126">If the publication is not filtered, you should be able to bring the publication database up-to-date by synchronizing with the most up-to-date Subscriber.</span></span>  
  
-   <span data-ttu-id="ac888-127">Se a publicação for filtrada, talvez você possa atualizar o banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-127">If the publication is filtered, you might not be able to bring the publication database up-to-date.</span></span> <span data-ttu-id="ac888-128">Considere uma tabela particionada, de modo que cada assinatura receba os dados do cliente somente de uma região: Norte, Leste, Sul e Oeste.</span><span class="sxs-lookup"><span data-stu-id="ac888-128">Consider a table that is partitioned such that each subscription receives customer data only for a single region: North, East, South, and West.</span></span> <span data-ttu-id="ac888-129">Se existir pelo menos um Assinante para cada partição de dados, a sincronização com um Assinante para cada partição deverá atualizar o banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-129">If there is at least one Subscriber for each partition of data, synchronizing with a Subscriber for each partition should bring the publication database up-to-date.</span></span> <span data-ttu-id="ac888-130">Entretanto, se por exemplo, os dados da partição oeste, não foram replicados para nenhum Assinante, então esses dados no Publicador não poderão ser atualizados.</span><span class="sxs-lookup"><span data-stu-id="ac888-130">However, if data in the West partition, for example, was not replicated to any Subscribers, this data at the Publisher cannot be brought up-to-date.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ac888-131">Sincronizar um banco de dados de publicação com um banco de dados de assinatura pode resultar em tabelas publicadas restauradas a um point-in-time, que é mais recente que o point-in-time de outras tabelas não publicadas, que foram restaurados a partir do backup.</span><span class="sxs-lookup"><span data-stu-id="ac888-131">Synchronizing a publication database with a subscription database can result in published tables being restored to a point in time that is more recent than the point in time of other non-published tables restored from the backup.</span></span>  
  
 <span data-ttu-id="ac888-132">Se você sincronizar com um Assinante que está executando uma versão do [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] anterior à [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], a assinatura não poderá ser anônima; ela deverá ser a assinatura de um cliente ou de um servidor (referenciadas como assinaturas locais e assinaturas globais nas versões anteriores).</span><span class="sxs-lookup"><span data-stu-id="ac888-132">If you synchronize with a Subscriber that is running a version of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the subscription cannot be anonymous; it must be a client subscription or server subscription (referred to as local subscriptions and global subscriptions in previous releases).</span></span>  
  
 <span data-ttu-id="ac888-133">Para sincronizar uma assinatura, consulte [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) e [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-133">To synchronize a subscription, see [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span></span>  
  
### <a name="reinitializing-all-subscriptions"></a><span data-ttu-id="ac888-134">Reinicializando todas as assinaturas</span><span class="sxs-lookup"><span data-stu-id="ac888-134">Reinitializing all Subscriptions</span></span>  
 <span data-ttu-id="ac888-135">Reinicializar todas as assinatura assegura que todos os Assinantes estarão em um estado consistente com o banco de dados de publicação restaurado.</span><span class="sxs-lookup"><span data-stu-id="ac888-135">Reinitializing all subscriptions ensures all Subscribers are in a state consistent with the restored publication database.</span></span> <span data-ttu-id="ac888-136">Essa abordagem deverá ser usada se desejar retornar uma topologia inteira ao estado anterior, representado por um determinado backup de banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-136">This approach should be used if you want to return an entire topology to the previous state represented by a given publication database backup.</span></span> <span data-ttu-id="ac888-137">Por exemplo, é possível reinicializar todas as assinaturas, se estiver restaurando um banco de dados de publicação a partir de um point-in-time especifico, como um mecanismo de recuperação para uma operação em lote executada erroneamente.</span><span class="sxs-lookup"><span data-stu-id="ac888-137">For example, you might want to reinitialize all subscriptions if you are restoring a publication database to an earlier point in time as a mechanism to recover from an erroneously performed batch operation.</span></span>  
  
 <span data-ttu-id="ac888-138">Se você escolher essa opção, gere um instantâneo novo para entregar aos Assinantes reinicializados, imediatamente depois de restaurar seu banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-138">If you choose this option, generate a new snapshot for delivery to reinitialized Subscribers immediately after restoring your publication database.</span></span>  
  
 <span data-ttu-id="ac888-139">Para reinicializar uma assinatura, consulte [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-139">To reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
 <span data-ttu-id="ac888-140">Para criar e aplicar um instantâneo, consulte [Create e Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md) e [Create a Snapshot for a Merge Publication with Parameterized Filters](../create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-140">To create and apply a snapshot, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md) and [Create a Snapshot for a Merge Publication with Parameterized Filters](../create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span></span>  
  
## <a name="backing-up-and-restoring-the-distribution-database"></a><span data-ttu-id="ac888-141">Fazendo backup e restaurando o banco de dados de distribuição</span><span class="sxs-lookup"><span data-stu-id="ac888-141">Backing Up and Restoring the Distribution Database</span></span>  
 <span data-ttu-id="ac888-142">Com a replicação de mesclagem, deve ser realizado regularmente o backup do banco de dados de distribuição, e, pode ser restaurado sem nenhuma consideração especial, contanto que o backup usado não seja anterior ao menor período de retenção de todas as publicações que usam o Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="ac888-142">With merge replication, the distribution database should be backed up regularly, and can be restored without any special considerations as long as the backup used is no older than the shortest retention period of all publications that use the Distributor.</span></span> <span data-ttu-id="ac888-143">Por exemplo, se houver três publicações com períodos de retenção de 10, 20, e 30 dias, respectivamente, o backup usado para restaurar o banco de dados não deve ter mais de 10 dias.</span><span class="sxs-lookup"><span data-stu-id="ac888-143">For example, if there are three publications with retention periods of 10, 20, and 30 days, respectively, the backup used to restore the database should not be more than 10 days old.</span></span> <span data-ttu-id="ac888-144">O banco de dados de distribuição tem uma função limitada na replicação de mesclagem: não armazena nenhum dos dados usados no controle de alterações e não fornece o armazenamento temporário das mudanças de replicação de mesclagem a serem encaminhadas aos bancos de dados de assinatura (como faz na replicação transacional).</span><span class="sxs-lookup"><span data-stu-id="ac888-144">The distribution database has a limited role in merge replication: it does not store any data used in change tracking and it does not provide temporary storage of merge replication changes to be forwarded to subscription databases (as it does in transactional replication).</span></span>  
  
## <a name="backing-up-and-restoring-a-subscription-database"></a><span data-ttu-id="ac888-145">Fazendo backup e restaurando um banco de dados de assinatura</span><span class="sxs-lookup"><span data-stu-id="ac888-145">Backing Up and Restoring a Subscription Database</span></span>  
 <span data-ttu-id="ac888-146">Para garantir a recuperação bem sucedida de um banco de dados de assinantes, os assinantes devem sincronizar com o Publicador, antes que tenha sido realizado o backup do banco de dados de assinatura; devem também sincronizar depois que o banco de dados de assinatura é restaurado:</span><span class="sxs-lookup"><span data-stu-id="ac888-146">To ensure successful recovery of a subscription database, Subscribers should synchronize with the Publisher before the subscription database is backed up; they should also synchronize after the subscription database is restored:</span></span>  
  
-   <span data-ttu-id="ac888-147">Sincronizar com o Publicador, antes que tenha sido realizado o backup do banco de dados de assinatura ajuda a garantir que, se um Assinante é restaurado a partir do backup, a assinatura ainda estará dentro do período de retenção da publicação:</span><span class="sxs-lookup"><span data-stu-id="ac888-147">Synchronizing with the Publisher before a subscription database backup helps ensure that if a Subscriber is restored from backup, the subscription is still within the publication retention period.</span></span> <span data-ttu-id="ac888-148">Por exemplo, imagine uma publicação com um período de retenção de 10 dias.</span><span class="sxs-lookup"><span data-stu-id="ac888-148">For example, assume a publication with a retention period of 10 days.</span></span> <span data-ttu-id="ac888-149">A última sincronização foi há 8 dias e o backup é realizado agora.</span><span class="sxs-lookup"><span data-stu-id="ac888-149">The last synchronization was 8 days ago, and now the backup is performed.</span></span> <span data-ttu-id="ac888-150">Se o backup for realizado 4 dias depois, a última sincronização terá ocorrido há 12 dias, antes do período de retenção.</span><span class="sxs-lookup"><span data-stu-id="ac888-150">If the backup is restored 4 days later, the last synchronization will have occurred 12 days ago, which is past the retention period.</span></span> <span data-ttu-id="ac888-151">Nesse caso, você teria de reinicializar o Assinante.</span><span class="sxs-lookup"><span data-stu-id="ac888-151">In this case, you would have to reinitialize the Subscriber.</span></span> <span data-ttu-id="ac888-152">Se o Assinante tivesse sincronizado antes do backup, o banco de dados de assinatura estaria dentro do período de retenção.</span><span class="sxs-lookup"><span data-stu-id="ac888-152">If the Subscriber had synchronized before the backup, the subscription database would be within the retention period.</span></span>  
  
     <span data-ttu-id="ac888-153">O backup não deve ser anterior ao menor período de retenção de todas as publicações assinadas pelo Assinante.</span><span class="sxs-lookup"><span data-stu-id="ac888-153">The backup should be no older than the shortest retention period of all publications to which the Subscriber subscribes.</span></span> <span data-ttu-id="ac888-154">Por exemplo, se o Assinante assinar três publicações com períodos de retenção de 10, 20, e 30 dias, respectivamente, o backup usado para restaurar o banco de dados não deve ter mais de 10 dias.</span><span class="sxs-lookup"><span data-stu-id="ac888-154">For example, if a Subscriber subscribes to three publications with retention periods of 10, 20, and 30 days, respectively, the backup used to restore the database should not be more than 10 days old.</span></span>  
  
-   <span data-ttu-id="ac888-155">Sincronizar o banco de dados de assinatura com cada uma de suas publicações, depois de uma restauração, garante que o Assinante está atualizado com todas as alterações do Publicador.</span><span class="sxs-lookup"><span data-stu-id="ac888-155">Synchronizing the subscription database with each of its publications following a restore ensures that the Subscriber is up to date with all changes at the Publisher.</span></span>  
  
 <span data-ttu-id="ac888-156">Para definir o período de retenção da publicação, consulte [Definir o período de expiração para assinaturas](../publish/set-the-expiration-period-for-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-156">To set the publication retention period, see [Set the Expiration Period for Subscriptions](../publish/set-the-expiration-period-for-subscriptions.md).</span></span>  
  
 <span data-ttu-id="ac888-157">Para sincronizar uma assinatura, consulte [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) e [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="ac888-157">To synchronize a subscription, see [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span></span>  
  
## <a name="backing-up-and-restoring-a-republishing-database"></a><span data-ttu-id="ac888-158">Fazendo backup e restaurando um banco de dados de republicação</span><span class="sxs-lookup"><span data-stu-id="ac888-158">Backing Up and Restoring a Republishing Database</span></span>  
 <span data-ttu-id="ac888-159">Quando um banco de dados assina os dados de um Publicador e, por sua vez, publica os mesmos dados em outros bancos de dados de assinatura, isso é chamado de banco de dados de republicação.</span><span class="sxs-lookup"><span data-stu-id="ac888-159">When a database subscribes to data from a Publisher and in turn publishes that same data to other subscription databases, it is referred to as a republishing database.</span></span> <span data-ttu-id="ac888-160">Ao restaurar um banco de dados de republicação, siga as diretrizes descritas em "Fazendo backup e restaurando um banco de dados de publicação" e "Fazendo backup e restaurando um banco de dados de assinatura" neste tópico.</span><span class="sxs-lookup"><span data-stu-id="ac888-160">When restoring a republishing database, follow the guidelines described in "Backing Up and Restoring a Publication Database" and "Backing Up and Restoring a Subscription Database" in this topic.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ac888-161">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="ac888-161">See Also</span></span>  
 <span data-ttu-id="ac888-162">[Fazer backup e restaurar bancos de dados do SQL Server](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="ac888-162">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 [<span data-ttu-id="ac888-163">Fazer backup e restaurar bancos de dados replicados</span><span class="sxs-lookup"><span data-stu-id="ac888-163">Back Up and Restore Replicated Databases</span></span>](back-up-and-restore-replicated-databases.md)  
  
  
