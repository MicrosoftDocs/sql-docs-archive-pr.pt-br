---
title: Aprimorar o desempenho da replicação transacional | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- performance [SQL Server replication], transactional replication
- designing databases [SQL Server], replication performance
- performance [SQL Server replication], snapshot replication
- snapshot replication [SQL Server], performance
- subscriptions [SQL Server replication], performance considerations
- agents [SQL Server replication], performance
- Distribution Agent, performance
- transactional replication, performance
- Log Reader Agent, performance
ms.assetid: 67084a67-43ff-4065-987a-3b16d1841565
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: fe802796b129ff9bdb50e5dea13e1fe98beee269
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685582"
---
# <a name="enhance-transactional-replication-performance"></a><span data-ttu-id="25fc9-102">Aprimorar o desempenho da replicação transacional</span><span class="sxs-lookup"><span data-stu-id="25fc9-102">Enhance Transactional Replication Performance</span></span>
  <span data-ttu-id="25fc9-103">Após considerar as dicas para o de desempenho geral descritas em [Aprimorando o Desempenho Geral da Replicação](enhance-general-replication-performance.md), considere essas áreas adicionais específicas da replicação transacional.</span><span class="sxs-lookup"><span data-stu-id="25fc9-103">After considering the general performance tips described in [Enhancing General Replication Performance](enhance-general-replication-performance.md), consider these additional areas specific to transactional replication.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="25fc9-104">Design de banco de dados</span><span class="sxs-lookup"><span data-stu-id="25fc9-104">Database Design</span></span>  
  
-   <span data-ttu-id="25fc9-105">Minimize o tamanho de transação em seu design de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="25fc9-105">Minimize transaction size in your application design.</span></span>  
  
     <span data-ttu-id="25fc9-106">Por padrão, a replicação transacional propaga as alterações de acordo com limites da transação.</span><span class="sxs-lookup"><span data-stu-id="25fc9-106">By default, transactional replication propagates changes according to transaction boundaries.</span></span> <span data-ttu-id="25fc9-107">Em transações menores, é menos provável que o Distribution Agent tenha que reenviar a transação devido a problemas de rede.</span><span class="sxs-lookup"><span data-stu-id="25fc9-107">If transactions are smaller, it is less likely that the Distribution Agent will have to resend a transaction due to network issues.</span></span> <span data-ttu-id="25fc9-108">Se for necessário que o agente reenvie uma transação, a quantidade de dados enviada será menor.</span><span class="sxs-lookup"><span data-stu-id="25fc9-108">If the agent is required to resend a transaction, the amount of data sent is smaller.</span></span>  
  
## <a name="distributor-configuration"></a><span data-ttu-id="25fc9-109">Configuração do Distribuidor</span><span class="sxs-lookup"><span data-stu-id="25fc9-109">Distributor Configuration</span></span>  
  
-   <span data-ttu-id="25fc9-110">Configure o Distribuidor em um servidor dedicado.</span><span class="sxs-lookup"><span data-stu-id="25fc9-110">Configure the Distributor on a dedicated server.</span></span>  
  
     <span data-ttu-id="25fc9-111">Você pode reduzir a sobrecarga de processamento no Publicador configurando um Distribuidor remoto.</span><span class="sxs-lookup"><span data-stu-id="25fc9-111">You can reduce processing overhead on the Publisher by configuring a remote Distributor.</span></span> <span data-ttu-id="25fc9-112">Para obter mais informações, consulte [Configure Distribution](../configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="25fc9-112">For more information, see [Configure Distribution](../configure-distribution.md).</span></span>  
  
-   <span data-ttu-id="25fc9-113">Dimensione adequadamente o banco de dados de distribuição.</span><span class="sxs-lookup"><span data-stu-id="25fc9-113">Size the distribution database appropriately.</span></span>  
  
     <span data-ttu-id="25fc9-114">Teste a replicação com uma carga típica para seu sistema para determinar a quantidade de espaço necessária para armazenar comandos.</span><span class="sxs-lookup"><span data-stu-id="25fc9-114">Test replication with a typical load for your system to determine how much space is required to store commands.</span></span> <span data-ttu-id="25fc9-115">Certifique-se de que o banco de dados seja amplo o suficiente para armazenar comandos, sem ter que aumentá-lo frequentemente.</span><span class="sxs-lookup"><span data-stu-id="25fc9-115">Ensure the database is large enough to store commands without having to auto-grow frequently.</span></span> <span data-ttu-id="25fc9-116">Para obter mais informações sobre como alterar o tamanho de um banco de dados, consulte [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="25fc9-116">For more information about changing the size of a database, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="25fc9-117">Design de publicação</span><span class="sxs-lookup"><span data-stu-id="25fc9-117">Publication Design</span></span>  
  
-   <span data-ttu-id="25fc9-118">Replique a execução de procedimento armazenado ao fazer atualizações em lote em tabelas publicadas.</span><span class="sxs-lookup"><span data-stu-id="25fc9-118">Replicate stored procedure execution when making batch updates to published tables.</span></span>  
  
     <span data-ttu-id="25fc9-119">Se tiver atualizações em lote que afetem ocasionalmente um grande número de linhas no Assinante, você deve considerar a atualização da tabela publicada usando um procedimento armazenado, e publicar a execução desse procedimento.</span><span class="sxs-lookup"><span data-stu-id="25fc9-119">If you have batch updates that occasionally affect a large number of rows at the Subscriber, you should consider updating the published table using a stored procedure and publish the execution of the stored procedure.</span></span> <span data-ttu-id="25fc9-120">Ao invés de enviar uma atualização ou excluir cada linha afetada, o Distribution Agent executa o mesmo procedimento no Assinante, com os mesmos valores de parâmetros.</span><span class="sxs-lookup"><span data-stu-id="25fc9-120">Instead of sending an update or delete for every row affected, the Distribution Agent executes the same procedure at the Subscriber with the same parameter values.</span></span> <span data-ttu-id="25fc9-121">Para obter mais informações, consulte [Publicando execução de procedimento armazenado em replicação transacional](../transactional/publishing-stored-procedure-execution-in-transactional-replication.md).</span><span class="sxs-lookup"><span data-stu-id="25fc9-121">For more information, see [Publishing Stored Procedure Execution in Transactional Replication](../transactional/publishing-stored-procedure-execution-in-transactional-replication.md).</span></span>  
  
-   <span data-ttu-id="25fc9-122">Espalhe os artigos por várias publicações.</span><span class="sxs-lookup"><span data-stu-id="25fc9-122">Spread articles across multiple publications.</span></span>  
  
     <span data-ttu-id="25fc9-123">Se não puder usar o parâmetro **- SubscriptionStreams** (descrito mais adiante neste tópico), considere a criação de várias publicações.</span><span class="sxs-lookup"><span data-stu-id="25fc9-123">If you cannot use the **-SubscriptionStreams** parameter (described later in this topic), consider creating multiple publications.</span></span> <span data-ttu-id="25fc9-124">Espalhar os artigos por essas publicações permite à replicação aplicar alterações em paralelo aos Assinantes.</span><span class="sxs-lookup"><span data-stu-id="25fc9-124">Spreading articles across these publications allows replication to apply changes in parallel to Subscribers.</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="25fc9-125">Considerações sobre assinatura</span><span class="sxs-lookup"><span data-stu-id="25fc9-125">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="25fc9-126">Use agentes independentes ao invés de agentes compartilhados se tiver várias publicações no mesmo Publicador (esse é o padrão para o Assistente para Nova Publicação).</span><span class="sxs-lookup"><span data-stu-id="25fc9-126">Use independent agents rather than shared agents if you have multiple publications on the same Publisher (this is the default for the New Publication Wizard).</span></span>  
  
-   <span data-ttu-id="25fc9-127">Execute os agentes continuamente em vez de em horários muito frequentes.</span><span class="sxs-lookup"><span data-stu-id="25fc9-127">Run agents continuously instead of on very frequent schedules.</span></span>  
  
     <span data-ttu-id="25fc9-128">Definir que os agentes executem continuamente, em vez de criar agendamentos frequentes (como a cada minuto), melhora o desempenho da replicação, eliminando as interrupções do agente.</span><span class="sxs-lookup"><span data-stu-id="25fc9-128">Setting the agents to run continuously rather than creating frequent schedules (such as every minute) improves replication performance, because the agent does not have to start and stop.</span></span> <span data-ttu-id="25fc9-129">Quando você define que o Distribution Agent execute continuamente, as alterações são propagadas com uma baixa latência para os demais servidores conectados na topologia.</span><span class="sxs-lookup"><span data-stu-id="25fc9-129">When you set the Distribution Agent to run continuously, changes are propagated with low latency to the other servers that are connected in the topology.</span></span> <span data-ttu-id="25fc9-130">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="25fc9-130">For more information, see:</span></span>  
  
    -   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="25fc9-131">: [Especificar agendas de sincronização](../specify-synchronization-schedules.md)</span><span class="sxs-lookup"><span data-stu-id="25fc9-131">: [Specify Synchronization Schedules](../specify-synchronization-schedules.md)</span></span>  
  
## <a name="distribution-agent-and-log-reader-agent-parameters"></a><span data-ttu-id="25fc9-132">Parâmetros do Distribution Agent e do Log Reader Agent</span><span class="sxs-lookup"><span data-stu-id="25fc9-132">Distribution Agent and Log Reader Agent Parameters</span></span>  
  
-   <span data-ttu-id="25fc9-133">Para resolver afunilamentos acidentais e de uso único, use o parâmetro **-MaxCmdsInTran** para o agente de leitor de log.</span><span class="sxs-lookup"><span data-stu-id="25fc9-133">To resolve accidental, one-time bottlenecks use the **-MaxCmdsInTran** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="25fc9-134">O parâmetro **-MaxCmdsInTran** especifica o número máximo de instruções agrupadas em uma transação, uma vez que o leitor de log grava comandos no banco de dados de distribuição.</span><span class="sxs-lookup"><span data-stu-id="25fc9-134">The **-MaxCmdsInTran** parameter specifies the maximum number of statements grouped into a transaction as the Log Reader writes commands to the distribution database.</span></span> <span data-ttu-id="25fc9-135">O uso desse parâmetro permite que o Log Reader Agent e o Distribution Agent dividam transações volumosas (consistindo em muitos comandos) no Publicador em várias transações menores, ao aplicar os comandos no Assinante.</span><span class="sxs-lookup"><span data-stu-id="25fc9-135">Using this parameter allows the Log Reader Agent and Distribution Agent to divide large transactions (consisting of many commands) at the Publisher into several smaller transactions when applying commands at the Subscriber.</span></span> <span data-ttu-id="25fc9-136">A especificação desse parâmetro pode reduzir a contenção no Distribuidor e pode reduzir a latência entre o Publicador e o Assinante.</span><span class="sxs-lookup"><span data-stu-id="25fc9-136">Specifying this parameter can reduce contention at the Distributor and reduce latency between the Publisher and Subscriber.</span></span> <span data-ttu-id="25fc9-137">Como a transação original é aplicada em unidades menores, o Assinante pode acessar linhas de uma transação lógica de Publicador antes do fim da transação original,</span><span class="sxs-lookup"><span data-stu-id="25fc9-137">Because the original transaction is applied in smaller units, the Subscriber can access rows of a large logical Publisher transaction prior to the end of the original transaction, breaking strict transactional atomicity.</span></span> <span data-ttu-id="25fc9-138">O padrão é **0**, que preserva os limites de transação do Publicador.</span><span class="sxs-lookup"><span data-stu-id="25fc9-138">The default is **0**, which preserves the transaction boundaries of the Publisher.</span></span> <span data-ttu-id="25fc9-139">Esse parâmetro não se aplica aos Editores Oracle.</span><span class="sxs-lookup"><span data-stu-id="25fc9-139">This parameter does not apply to Oracle Publishers.</span></span>  
  
    > [!WARNING]  
    >  <span data-ttu-id="25fc9-140">O `MaxCmdsInTran` não foi criado para estar sempre ativado.</span><span class="sxs-lookup"><span data-stu-id="25fc9-140">`MaxCmdsInTran` was not designed to be always turned on.</span></span> <span data-ttu-id="25fc9-141">Ele existe para solucionar casos em que alguém acidentalmente realizou um número grande de operações DML em uma única transação (causando atraso na distribuição de comandos até que a transação inteira esteja no banco de dados de distribuição, os bloqueios sejam mantidos etc.).</span><span class="sxs-lookup"><span data-stu-id="25fc9-141">It exists to work around cases where someone accidentally performed a large number of DML operations in a single transaction (causing delay in distribution of commands until the entire transaction is in distribution database, locks being held, etc.).</span></span> <span data-ttu-id="25fc9-142">Se você rotineiramente enfrentar essa situação, deverá revisar seus aplicativos e descobrir maneiras de reduzir o tamanho da transação.</span><span class="sxs-lookup"><span data-stu-id="25fc9-142">If you routinely fall into this situation, you should review your applications and find ways to reduce the transaction size.</span></span>  
  
-   <span data-ttu-id="25fc9-143">Use o parâmetro **-SubscriptionStreams** para o agente de distribuição.</span><span class="sxs-lookup"><span data-stu-id="25fc9-143">Use the **-SubscriptionStreams** parameter for the Distribution Agent.</span></span>  
  
     <span data-ttu-id="25fc9-144">O parâmetro **-SubscriptionStreams** pode melhorar muito a taxa de transferência de replicação agregada.</span><span class="sxs-lookup"><span data-stu-id="25fc9-144">The **-SubscriptionStreams** parameter can greatly improve aggregate replication throughput.</span></span> <span data-ttu-id="25fc9-145">Ele permite várias conexões a um Assinante para aplicar lotes de alterações em paralelo, mantendo presentes, ao mesmo tempo, várias características transacionais, quando for usar um thread único.</span><span class="sxs-lookup"><span data-stu-id="25fc9-145">It allows multiple connections to a Subscriber to apply batches of changes in parallel, while maintaining many of the transactional characteristics present when using a single thread.</span></span> <span data-ttu-id="25fc9-146">Se uma das conexões falhar na execução ou na confirmação, todas as conexões abortarão o lote atual, e o agente usará um fluxo único para repetir os lotes com falha.</span><span class="sxs-lookup"><span data-stu-id="25fc9-146">If one of the connections fails to execute or commit, all connections will abort the current batch, and the agent will use a single stream to retry the failed batches.</span></span> <span data-ttu-id="25fc9-147">Antes de concluir a fase de repetição pode haver inconsistências transacionais temporárias no Assinante.</span><span class="sxs-lookup"><span data-stu-id="25fc9-147">Before this retry phase completes, there can be temporary transactional inconsistencies at the Subscriber.</span></span> <span data-ttu-id="25fc9-148">Depois que os lotes com falha são confirmados com êxito, o Assinante é levado de volta a um estado de consistência transacional.</span><span class="sxs-lookup"><span data-stu-id="25fc9-148">After the failed batches are successfully committed, the Subscriber is brought back to a state of transactional consistency.</span></span>  
  
     <span data-ttu-id="25fc9-149">Um valor para esse parâmetro de agente pode ser especificado usando o \*\* \@ subscriptionstreams\*\* de [sp_addsubscription &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="25fc9-149">A value for this agent parameter can be specified using the **\@subscriptionstreams** of [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span>  
  
-   <span data-ttu-id="25fc9-150">Aumente o valor do parâmetro **-ReadBatchSize** para o Agente de Leitor de Log.</span><span class="sxs-lookup"><span data-stu-id="25fc9-150">Increase the value of the **-ReadBatchSize** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="25fc9-151">O Log Reader Agent e o Distribution Agent dão suporte ao tamanho dos lotes para as operações de leitura e confirmação de transações.</span><span class="sxs-lookup"><span data-stu-id="25fc9-151">The Log Reader Agent and Distribution Agent support batch sizes for transaction read and commit operations.</span></span> <span data-ttu-id="25fc9-152">O tamanho padrão dos lotes é de 500 transações.</span><span class="sxs-lookup"><span data-stu-id="25fc9-152">Batch sizes default to 500 transactions.</span></span> <span data-ttu-id="25fc9-153">O Log Reader Agent lê o número específico de transações do log, mesmo essas estando marcadas ou não, para a replicação.</span><span class="sxs-lookup"><span data-stu-id="25fc9-153">The Log Reader Agent reads the specific number of transactions from the log, whether or not they are marked for replication.</span></span> <span data-ttu-id="25fc9-154">Quando um grande número de transações é gravado em um banco de dados de publicação, mas somente um pequeno subconjunto for marcado para replicação, você deverá usar o parâmetro **-ReadBatchSize** para aumentar o tamanho do lote de leitura do Agente de Leitor de Log.</span><span class="sxs-lookup"><span data-stu-id="25fc9-154">When a large number of transactions is written to a publication database, but only a small subset of those are marked for replication, you should use the **-ReadBatchSize** parameter to increase the read batch size of the Log Reader Agent.</span></span> <span data-ttu-id="25fc9-155">Esse parâmetro não se aplica aos Editores Oracle.</span><span class="sxs-lookup"><span data-stu-id="25fc9-155">This parameter does not apply to Oracle Publishers.</span></span>  
  
-   <span data-ttu-id="25fc9-156">Aumente o valor do parâmetro **-CommitBatchSize** para o Agente de Leitor de Log.</span><span class="sxs-lookup"><span data-stu-id="25fc9-156">Increase the value of the **-CommitBatchSize** parameter for the Distribution Agent.</span></span>  
  
     <span data-ttu-id="25fc9-157">A confirmação de um conjunto de transações tem uma sobrecarga fixa. Ao confirmar um número maior de transações com menor frequência, a sobrecarga será espalhada em um volume de dados maior.</span><span class="sxs-lookup"><span data-stu-id="25fc9-157">Committing a set of transactions has a fixed overhead; by committing a larger number of transactions less frequently, the overhead is spread across a larger volume of data.</span></span> <span data-ttu-id="25fc9-158">Porém, o benefício em aumentar esse parâmetro é anulado, pois, o custo para aplicar alterações é retido por outros fatores, como o E/S máximo do disco que contém o log.</span><span class="sxs-lookup"><span data-stu-id="25fc9-158">However, the benefit of increasing this parameter drops off as the cost of applying changes is gated by other factors, such as the maximum I/O of the disk that contains the log.</span></span> <span data-ttu-id="25fc9-159">Além disso, existe uma compensação a ser considerada: qualquer falha que faz com que o Distribution Agent se reinicie deverá ser revertida e reaplicar um grande número de transações.</span><span class="sxs-lookup"><span data-stu-id="25fc9-159">Additionally, there is a trade off to be considered: any failure that causes the Distribution Agent to start over must rollback and reapply a larger number of transactions.</span></span> <span data-ttu-id="25fc9-160">Para as redes não confiáveis, um valor inferior pode resultar em menos falhas e em um número menor de transações a serem revertidas e reaplicadas em caso de falha.</span><span class="sxs-lookup"><span data-stu-id="25fc9-160">For unreliable networks, a lower value can result in less failures and a smaller number of transactions to rollback and reapply if a failure occurs.</span></span>  
  
-   <span data-ttu-id="25fc9-161">Reduza o valor do parâmetro **-PollingInterval** para o Agente de Leitor de Log.</span><span class="sxs-lookup"><span data-stu-id="25fc9-161">Decrease the value of the **-PollingInterval** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="25fc9-162">O parâmetro **-PollingInterval** especifica com que frequência o log de transações de um banco de dados publicado é consultado sobre transações a serem replicadas.</span><span class="sxs-lookup"><span data-stu-id="25fc9-162">The **-PollingInterval** parameter specifies how often the transaction log of a published database is queried for transactions to replicate.</span></span> <span data-ttu-id="25fc9-163">O padrão é 5 segundos.</span><span class="sxs-lookup"><span data-stu-id="25fc9-163">The default is 5 seconds.</span></span> <span data-ttu-id="25fc9-164">Se reduzir esse valor, o log é sondado com mais frequentemente, o que pode resultar em uma menor latência na entrega de transações de um banco de dados de publicação, para o banco de dados de distribuição.</span><span class="sxs-lookup"><span data-stu-id="25fc9-164">If you decrease this value, the log is polled more frequently, which can result in lower latency for the delivery of transactions from the publication database to the distribution database.</span></span> <span data-ttu-id="25fc9-165">Porém, você deve equilibrar a necessidade por uma latência menor com uma carga maior no servidor, devido a uma sondagem mais frequente.</span><span class="sxs-lookup"><span data-stu-id="25fc9-165">However, you should balance the need for lower latency against the increased load on the server from polling more frequently.</span></span>  
  
 <span data-ttu-id="25fc9-166">Os parâmetros de agente podem ser especificados em perfis de agente e na linha de comando.</span><span class="sxs-lookup"><span data-stu-id="25fc9-166">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="25fc9-167">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="25fc9-167">For more information, see:</span></span>  
  
-   [<span data-ttu-id="25fc9-168">Trabalhar com perfis do Agente de Replicação</span><span class="sxs-lookup"><span data-stu-id="25fc9-168">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
-   [<span data-ttu-id="25fc9-169">Exibir e modificar parâmetros do prompt de comando de agentes de replicação &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="25fc9-169">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
-   [<span data-ttu-id="25fc9-170">Conceitos dos executáveis do Replication Agent</span><span class="sxs-lookup"><span data-stu-id="25fc9-170">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
  
