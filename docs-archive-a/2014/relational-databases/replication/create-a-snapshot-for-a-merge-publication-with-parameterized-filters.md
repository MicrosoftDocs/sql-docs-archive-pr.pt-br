---
title: Criar um instantâneo para uma publicação de mesclagem com filtros parametrizados | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87679879"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="b8cc9-102">Criar um instantâneo para uma publicação de mesclagem com filtros com parâmetros</span><span class="sxs-lookup"><span data-stu-id="b8cc9-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="b8cc9-103">Este tópico descreve como criar um instantâneo para uma publicação de mesclagem com filtros parametrizados no [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] usando [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]ou RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="b8cc9-104">Antes de começar</span><span class="sxs-lookup"><span data-stu-id="b8cc9-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="b8cc9-105">Recomendações</span><span class="sxs-lookup"><span data-stu-id="b8cc9-105">Recommendations</span></span>  
  
-   <span data-ttu-id="b8cc9-106">Ao gerar um instantâneo para uma publicação de mesclagem usando filtros com parâmetros, você deve, primeiro, gerar um instantâneo padrão (esquema), que contenha todos os dados publicados e os metadados do Assinante para a assinatura.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="b8cc9-107">Para obter mais informações, consulte [Criar e aplicar o instantâneo inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="b8cc9-108">Após ter criado um instantâneo de esquema, você poderá gerar o instantâneo que contém a partição Assinante específica dos dados publicados.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="b8cc9-109">Se a filtragem para um ou mais artigos da publicação gerar partições não sobrepostas, exclusivas de cada assinatura, os metadados serão limpos sempre que o Agente de Mesclagem for executado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="b8cc9-110">Isso significa que o instantâneo particionado irá expirar mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="b8cc9-111">Ao usar essa opção, considere permitir que os Assinantes possam iniciar a geração e a entrega do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="b8cc9-112">Para obter mais informações sobre opções de filtragem, consulte a seção Setting "Setting 'partition options'" (Definindo opções de partição) de [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) (Instantâneos para publicações de mesclagem com filtros parametrizados).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="b8cc9-113">Usando o SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="b8cc9-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="b8cc9-114">Gerar instantâneos para partições na página **Partições de Dados** da caixa de diálogo **Propriedades da Publicação – \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="b8cc9-115">Para obter mais informações sobre como acessar essa caixa de diálogo, consulte [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="b8cc9-116">É possível permitir que os Assinantes iniciem a geração de instantâneo e entreguem e/ou gerem instantâneos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="b8cc9-117">Antes de gerar instantâneos para uma ou mais partições, é preciso:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="b8cc9-118">Criar uma publicação de mesclagem com o Assistente para Nova Publicação, e especificar um ou mais filtros de linha com parâmetros na página **Adicionar Filtro** do assistente.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="b8cc9-119">Para obter mais informações, consulte [Definir e modificar um filtro de linha com parâmetros para um artigo de mesclagem](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="b8cc9-120">Gerar um instantâneo de esquema para a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="b8cc9-121">Por padrão, o instantâneo de esquema é gerado quando o Assistente para Nova Publicação é encerrado. Nesse momento é igualmente possível gerar um instantâneo de esquema no [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b8cc9-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="b8cc9-122">Para gerar um instantâneo de esquema</span><span class="sxs-lookup"><span data-stu-id="b8cc9-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="b8cc9-123">Conecte-se ao Publicador no [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)]e expanda o nó de servidor.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="b8cc9-124">Expanda a pasta **Replicação** e, em seguida, a pasta **Publicações** .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="b8cc9-125">Clique com o botão direito do mouse na publicação para a qual você quer criar um instantâneo e, então, clique em **Exibir Status do Snapshot Agent**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="b8cc9-126">Na caixa de diálogo **Exibir Status do Agente de Instantâneo – \<Publication>** , clique em **Iniciar**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="b8cc9-127">Quando Snapshot Agent terminar de gerar o instantâneo, uma mensagem será exibida, tal como "[100%] Um instantâneo de 17 artigo(s) foi gerado."</span><span class="sxs-lookup"><span data-stu-id="b8cc9-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="b8cc9-128">Para permitir que os Assinantes iniciem a geração e entrega de instantâneo</span><span class="sxs-lookup"><span data-stu-id="b8cc9-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="b8cc9-129">Na página **Partições de Dados** da caixa de diálogo **Propriedades da Publicação – \<Publication>** , selecione **Definir automaticamente uma partição e gerar um instantâneo, se necessário, quando um novo Assinante tentar sincronizar**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="b8cc9-130">Para gerar e atualizar instantâneos</span><span class="sxs-lookup"><span data-stu-id="b8cc9-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="b8cc9-131">Na página **Partições de Dados** da caixa de diálogo **Propriedades da Publicação – \<Publication>** , clique em **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="b8cc9-132">Digite um valor para **HOST_NAME()** e/ou um valor para **SUSER_SNAME()** , associado à partição para a qual será criado um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="b8cc9-133">Especifique, opcionalmente, um cronograma para atualizar instantâneos:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="b8cc9-134">Selecione **Agendar o Snapshot Agent para que esta partição seja executada no(s) seguinte(s) horário(s):**</span><span class="sxs-lookup"><span data-stu-id="b8cc9-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="b8cc9-135">Aceite o cronograma padrão para atualizar instantâneos ou clique em **Alterar** para especificar um cronograma diferente.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="b8cc9-136">Clique em **OK**, que retorna à caixa de diálogo **Propriedades da Publicação – \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="b8cc9-137">Selecione a partição na grade de propriedades e, depois, clique em **Gerar os instantâneos selecionados agora**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="b8cc9-138">Usando o Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="b8cc9-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="b8cc9-139">Ao usar os procedimentos armazenados e o Agente de Instantâneo, será possível realizar o seguinte:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="b8cc9-140">Permita que os Assinantes solicitem geração e aplicação de instantâneos na primeira vez que eles sincronizarem.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="b8cc9-141">Gere previamente instantâneos para cada partição.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="b8cc9-142">Gerar manualmente um instantâneo para cada Assinante.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b8cc9-143">Quando possível, solicite que os usuários insiram as credenciais de segurança em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="b8cc9-144">Se for necessário armazenar credenciais em um arquivo de script, você deverá proteger o arquivo para impedir acesso não autorizado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="b8cc9-145">Para criar uma publicação que permita que os Assinantes inicializem geração e entrega de instantâneo</span><span class="sxs-lookup"><span data-stu-id="b8cc9-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="b8cc9-146">No Publicador do banco de dados de publicação, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="b8cc9-147">Especifique os seguintes parâmetros:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="b8cc9-148">O nome da publicação em **\@publication**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="b8cc9-149">Um valor de `true` para \*\* \@ allow_subscriber_initiated_snapshot\*\*, que permite que os assinantes iniciem o processo de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="b8cc9-150">(Opcional) O número de processos de instantâneo dinâmico que podem ser executados simultaneamente em **\@max_concurrent_dynamic_snapshots**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="b8cc9-151">Se o número máximo de processos estiver em execução e o Assinante tentar gerar um instantâneo, o processo será colocado em uma fila.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="b8cc9-152">Por padrão não há nenhum limite para o número de processos simultâneos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="b8cc9-153">No Publicador, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="b8cc9-154">Especifique o nome da publicação usado na etapa 1 para \*\* \@ publicação\*\* e as [!INCLUDE[msCoName](../../includes/msconame-md.md)] credenciais do Windows sob as quais a [replicação agente de instantâneo](agents/replication-snapshot-agent.md) autenticação ao se conectar ao Publicador, você também deve especificar um valor **0** para \*\* \@ publisher_security_mode\*\* e as [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] informações de logon para \*\* \@ publisher_login\*\* e \*\* \@ publisher_password\*\*.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="b8cc9-155">Isso cria um trabalho do Agente de Instantâneo para a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="b8cc9-156">Para obter mais informações sobre como gerar um instantâneo inicial e definir uma agenda personalizada para o Snapshot Agent, consulte [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b8cc9-157">Quando um Publicador é configurado com um Distribuidor remoto, os valores fornecidos para todos os parâmetros, inclusive *job_login* e *job_password*, são enviados ao Distribuidor como texto sem-formatação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="b8cc9-158">Você deve criptografar a conexão entre o Publicador e seu Distribuidor remoto antes de executar esse procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="b8cc9-159">Para obter mais informações, veja [Habilitar conexões criptografadas no Mecanismo de Banco de Dados &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="b8cc9-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) para adicionar artigos à publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="b8cc9-161">Esse procedimento armazenado deve ser executado uma vez para cada artigo na publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="b8cc9-162">Ao usar filtros com parâmetros, você precisa especificar um filtro de linha com parâmetros para um ou mais artigos usando o parâmetro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="b8cc9-163">Para obter mais informações, consulte [Definir e modificar um filtro de linha com parâmetros para um artigo de mesclagem](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="b8cc9-164">Se outros artigos serão filtrados com base no filtro de linha parametrizado, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) para definir as relações de junção ou de registro lógico entre artigos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="b8cc9-165">Esse procedimento armazenado deve ser executado uma vez para cada artigo sendo definido.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="b8cc9-166">Para obter mais informações, consulte [Definir e modificar um filtro de junção entre artigos de mesclagem](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="b8cc9-167">Quando o Merge Agent solicita que o instantâneo inicialize o Assinante, o instantâneo para a solicitação de partição de assinatura é gerado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="b8cc9-168">Para criar uma publicação e pré-gerar ou atualizar automaticamente instantâneos</span><span class="sxs-lookup"><span data-stu-id="b8cc9-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="b8cc9-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) para criar a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="b8cc9-170">Para obter mais informações, consulte [Criar uma assinatura](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="b8cc9-171">No Publicador, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="b8cc9-172">Especifique o nome da publicação usado na etapa 1 em **\@publication** e as credenciais do Windows com as quais o Agente de Instantâneo é executado em **\@job_login** e **\@password**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="b8cc9-173">Se o agente pretender usar a Autenticação do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ao se conectar ao Publicador, você também precisará especificar um valor igual a **0** em **\@publisher_security_mode** e as informações de logon do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] em **\@publisher_login** e **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="b8cc9-174">Isso cria um trabalho do Agente de Instantâneo para a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="b8cc9-175">Para obter mais informações sobre como gerar um instantâneo inicial e definir uma agenda personalizada para o Snapshot Agent, consulte [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b8cc9-176">Quando um Publicador é configurado com um Distribuidor remoto, os valores fornecidos para todos os parâmetros, inclusive *job_login* e *job_password*, são enviados ao Distribuidor como texto sem-formatação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="b8cc9-177">Você deve criptografar a conexão entre o Publicador e seu Distribuidor remoto antes de executar esse procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="b8cc9-178">Para obter mais informações, veja [Habilitar conexões criptografadas no Mecanismo de Banco de Dados &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="b8cc9-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) para adicionar artigos à publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="b8cc9-180">Esse procedimento armazenado deve ser executado uma vez para cada artigo na publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="b8cc9-181">Ao usar filtros com parâmetros, você precisa especificar um filtro de linha com parâmetros para um artigo usando o parâmetro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="b8cc9-182">Para obter mais informações, consulte [Definir e modificar um filtro de linha com parâmetros para um artigo de mesclagem](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="b8cc9-183">Se outros artigos serão filtrados com base no filtro de linha parametrizado, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) para definir as relações de junção ou de registro lógico entre artigos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="b8cc9-184">Esse procedimento armazenado deve ser executado uma vez para cada artigo sendo definido.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="b8cc9-185">Para obter mais informações, consulte [Definir e modificar um filtro de junção entre artigos de mesclagem](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="b8cc9-186">No Publicador do banco de dados de publicação, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql) especificando o valor de **\@publication** da etapa 1.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="b8cc9-187">Observe o valor **snapshot_jobid** no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="b8cc9-188">Converta o valor do **snapshot_jobid** obtido na etapa 5 para **uniqueidentifier**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="b8cc9-189">No Publicador do banco de dados **msdb**, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) especificando o valor convertido obtido na etapa 6 em **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="b8cc9-190">No Publicador do banco de dados de publicação, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="b8cc9-191">Especifique o nome da publicação da etapa 1 em **\@publication** e o valor usado para definir a partição em **\@suser_sname** se [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) for usado na cláusula de filtro ou em **\@host_name** se [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) for usado na cláusula de filtro.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="b8cc9-192">No publicador do banco de dados de publicação, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="b8cc9-193">Especifique o nome da publicação da etapa 1 em **\@publication**, o valor de **\@suser_sname** ou **\@host_name** da etapa 8 e uma agenda para o trabalho.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="b8cc9-194">Isso irá criar o trabalho que gera o instantâneo com parâmetros para a partição especificada.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="b8cc9-195">Para obter mais informações, consulte [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b8cc9-196">Esse trabalho executa, usando a mesma conta Windows do trabalho de instantâneo inicial definido na etapa 2.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="b8cc9-197">Para remover o trabalho de instantâneo parametrizado e sua partição de dados relacionada, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="b8cc9-198">No Publicador do banco de dados de publicação, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql) especificando o valor de **\@publication** da etapa 1 e o valor de **\@suser_sname** ou **\@host_name** da etapa 8.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="b8cc9-199">Observe o valor **dynamic_snapshot_jobid** no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="b8cc9-200">No Distribuidor do banco de dados **msdb**, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql) especificando o valor obtido na etapa 9 em **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="b8cc9-201">Isso inicia o trabalho de instantâneo com parâmetros para a partição.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="b8cc9-202">Repita as etapas de 8 a11 para gerar um instantâneo particionado para cada assinatura.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="b8cc9-203">Para criar uma publicação e criar manualmente instantâneos para cada partição</span><span class="sxs-lookup"><span data-stu-id="b8cc9-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="b8cc9-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) para criar a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="b8cc9-205">Para obter mais informações, consulte [Criar uma assinatura](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="b8cc9-206">No Publicador, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="b8cc9-207">Especifique o nome da publicação usado na etapa 1 em **\@publication** e as credenciais do Windows com as quais o Agente de Instantâneo é executado em **\@job_login** e **\@password**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="b8cc9-208">Se o agente pretender usar a Autenticação do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ao se conectar ao Publicador, você também precisará especificar um valor igual a **0** em **\@publisher_security_mode** e as informações de logon do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] em **\@publisher_login** e **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="b8cc9-209">Isso cria um trabalho do Agente de Instantâneo para a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="b8cc9-210">Para obter mais informações sobre como gerar um instantâneo inicial e definir uma agenda personalizada para o Snapshot Agent, consulte [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b8cc9-211">Quando um Publicador é configurado com um Distribuidor remoto, os valores fornecidos para todos os parâmetros, inclusive *job_login* e *job_password*, são enviados ao Distribuidor como texto sem-formatação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="b8cc9-212">Você deve criptografar a conexão entre o Publicador e seu Distribuidor remoto antes de executar esse procedimento armazenado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="b8cc9-213">Para obter mais informações, veja [Habilitar conexões criptografadas no Mecanismo de Banco de Dados &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="b8cc9-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) para adicionar artigos à publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="b8cc9-215">Esse procedimento armazenado deve ser executado uma vez para cada artigo na publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="b8cc9-216">Ao usar filtros com parâmetros, você precisa especificar um filtro de linha com parâmetros para, pelo menos, um artigo usando o parâmetro **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="b8cc9-217">Para obter mais informações, consulte [Definir e modificar um filtro de linha com parâmetros para um artigo de mesclagem](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="b8cc9-218">Se outros artigos serão filtrados com base no filtro de linha parametrizado, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) para definir as relações de junção ou de registro lógico entre artigos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="b8cc9-219">Esse procedimento armazenado deve ser executado uma vez para cada artigo sendo definido.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="b8cc9-220">Para obter mais informações, consulte [Definir e modificar um filtro de junção entre artigos de mesclagem](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="b8cc9-221">Inicie o trabalho de instantâneo ou execute o Replication Snapshot Agent no prompt de comando para gerar o esquema de instantâneo padrão e outros arquivos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="b8cc9-222">Para obter mais informações, consulte [Criar e aplicar o instantâneo inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="b8cc9-223">Execute o Replication Snapshot Agent novamente no prompt de comando para gerar arquivos (.bcp) para cópia em massa, especificando o local do instantâneo particionado para **-DynamicSnapshotLocation** e uma ou ambas as seguintes propriedades que definam a partição:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="b8cc9-224">**-DynamicFilterHostName** – o valor se [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) for usado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="b8cc9-225">**-DynamicFilterLogin** – o valor se [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) for usado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="b8cc9-226">Repita a etapa 6 para gerar um instantâneo particionado para cada assinatura.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="b8cc9-227">Execute o Merge Agent para cada assinatura para aplicar o instantâneo inicial particionado nos Assinantes, especificando as propriedades a seguir:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="b8cc9-228">**-Hostname** - o valor usado para definir a partição, se o valor atual de HOST_NAME estiver sendo substituído.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="b8cc9-229">**- DynamicSnapshotLocation** - o local do instantâneo dinâmico para esta partição.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b8cc9-230">Para obter mais informações sobre como programar agentes de replicação, consulte [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md) (Conceitos dos executáveis do agente de replicação).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="b8cc9-231">Exemplos (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="b8cc9-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="b8cc9-232">Esse exemplo cria uma publicação de mesclagem com filtros com parâmetros onde Assinantes inicia o processo de geração de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="b8cc9-233">Os valores em **\@job_login** e **\@job_password** são passados com o uso de variáveis de script.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="b8cc9-234">Esse exemplo cria uma publicação usando um filtro com parâmetros, onde cada Assinante tem sua partição definida ao executar [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) e o trabalho de instantâneo filtrado criado pela execução [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passando as informações de particionamento.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="b8cc9-235">Os valores em **\@job_login** e **\@job_password** são passados com o uso de variáveis de script.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="b8cc9-236">Esse exemplo cria uma publicação usando um filtro com parâmetros, onde cada Assinante deve ter sua própria partição de dados e trabalho de instantâneo criado pelo fornecimento das informações de particionamento.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="b8cc9-237">Um Assinante fornece informações de particionamento, usando parâmetros de linha de comando ao executar, manualmente, os agentes de replicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="b8cc9-238">Esse exemplo assume que também foi criada uma assinatura para a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="b8cc9-239">Usando o RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="b8cc9-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="b8cc9-240">Você pode usar RMO (Replication Management Objects) para gerar instantâneos particionados programaticamente dos seguintes modos:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="b8cc9-241">Permita que os Assinantes solicitem geração e aplicação de instantâneos na primeira vez que eles sincronizarem.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="b8cc9-242">Gere previamente instantâneos para cada partição.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="b8cc9-243">Gere manualmente um instantâneo para cada Assinante executando o Snapshot Agent.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b8cc9-244">Quando a filtragem de um artigo gerar partições não sobrepostas, exclusivas de cada assinatura (especificando um valor de <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> para <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> ao criar um artigo de mesclagem), metadados são limpos sempre que o Merge Agent for executado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="b8cc9-245">Isso significa que o instantâneo particionado irá expirar mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="b8cc9-246">Ao usar essa opção, considere permitir que os Assinantes solicitem geração do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="b8cc9-247">Para obter mais informações, consulte a seção "Usando as opções de filtragem” apropriadas no tópico [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b8cc9-248">Quando possível, solicite que os usuários insiram as credenciais de segurança em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="b8cc9-249">Se for preciso armazenar credenciais, use os serviços [criptográficos](https://go.microsoft.com/fwlink/?LinkId=34733) fornecidos pelo [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework do Windows.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="b8cc9-250">Para criar uma publicação que permita que os Assinantes inicializem geração e entrega de instantâneo</span><span class="sxs-lookup"><span data-stu-id="b8cc9-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="b8cc9-251">Crie uma conexão com o Publicador usando a classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="b8cc9-252">Crie uma instância da classe <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> para o banco de dados de publicação; defina a propriedade <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> para a instância de <xref:Microsoft.SqlServer.Management.Common.ServerConnection> da etapa 1 e chame o método <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="b8cc9-253">Se <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> retornar `false`, confirme a existência do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="b8cc9-254">Se a propriedade <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> for `false`, defina-a como `true` e chame <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="b8cc9-255">Crie uma instância da classe <xref:Microsoft.SqlServer.Replication.MergePublication> e defina as propriedades a seguir para esse objeto:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="b8cc9-256">O <xref:Microsoft.SqlServer.Management.Common.ServerConnection> da Etapa 1 para <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="b8cc9-257">Nome do banco de dados publicado para <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="b8cc9-258">Um nome para a publicação para <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="b8cc9-259">O número máximo de trabalhos de instantâneo dinâmicos a serem executados para <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="b8cc9-260">Uma vez que solicitações de instantâneo iniciado pelo Assinante podem ocorrer a qualquer momento, essa propriedade limita o número de trabalhos do Snapshot Agent que podem ser executados simultaneamente quando vários Assinantes solicitam seu instantâneo particionado ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="b8cc9-261">Quando o número máximo de trabalhos estiver sendo executado, solicitações de instantâneos particionados adicionais são enfileiradas até que um dos trabalhos que está sendo executado seja concluído.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="b8cc9-262">Use o operador lógico bit a bit OR (`|` em Visual C# e `Or` em Visual Basic) para adicionar o valor <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> a <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="b8cc9-263">Os campos <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> e <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> para fornecer as credenciais para a conta do Windows [!INCLUDE[msCoName](../../includes/msconame-md.md)] em que o Snapshot Agent é executado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="b8cc9-264">Recomenda-se definir <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> quando a publicação é criada por um membro da função de servidor fixa `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="b8cc9-265">Para obter mais informações, consulte [Replication Agent Security Model](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="b8cc9-266">Chame o método <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> para criar a publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="b8cc9-267">Quando um Publicador é configurado com um Distribuidor remoto, os valores fornecidos para todas as propriedades, inclusive <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, são enviados ao Distribuidor como texto sem-formatação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="b8cc9-268">É necessário criptografar a conexão entre o Publicador e o respectivo Distribuidor remoto antes de chamar o método <xref:Microsoft.SqlServer.Replication.Publication.Create%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="b8cc9-269">Para obter mais informações, veja [Habilitar conexões criptografadas no Mecanismo de Banco de Dados &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="b8cc9-270">Use a propriedade <xref:Microsoft.SqlServer.Replication.MergeArticle> para adicionar artigos à publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="b8cc9-271">Especifique a propriedade <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> para pelo menos um artigo que defina o filtro com parâmetros.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="b8cc9-272">(Opcional) Crie objetos <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> que definam filtros de junção entre artigos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="b8cc9-273">Para obter mais informações, consulte [Define an Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="b8cc9-274">Se o valor de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> for `false`, chame <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> para criar o trabalho inicial do Snapshot Agent para essa publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="b8cc9-275">Chame o método <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> do objeto <xref:Microsoft.SqlServer.Replication.MergePublication> criado na etapa 4.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="b8cc9-276">Isso inicia o trabalho do agente que gera o instantâneo inicial.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="b8cc9-277">Para obter mais informações sobre como gerar um instantâneo inicial e definir uma agenda personalizada para o Snapshot Agent, consulte [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="b8cc9-278">(Opcional) Procure um valor de `true` para a propriedade <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> a fim de determinar quando o instantâneo inicial está pronto para ser usado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="b8cc9-279">Quando o Merge Agent para um Assinante for conectado pela primeira vez, um instantâneo particionado é gerado automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="b8cc9-280">Para criar uma publicação e gerar previamente ou atualizar automaticamente instantâneos</span><span class="sxs-lookup"><span data-stu-id="b8cc9-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="b8cc9-281">Use uma instância da classe <xref:Microsoft.SqlServer.Replication.MergePublication> para definir uma publicação de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="b8cc9-282">Para obter mais informações, consulte [Criar uma assinatura](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="b8cc9-283">Use a propriedade <xref:Microsoft.SqlServer.Replication.MergeArticle> para adicionar artigos à publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="b8cc9-284">Especifique a propriedade <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> para pelo menos um artigo que defina o filtro com parâmetros e crie quaisquer objetos <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> que definam filtros de junção entre artigos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="b8cc9-285">Para obter mais informações, consulte [Define an Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="b8cc9-286">Se o valor de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> for `false`, chame <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> para criar o trabalho do Snapshot Agent para essa publicação.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="b8cc9-287">Chame o método <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> do objeto <xref:Microsoft.SqlServer.Replication.MergePublication> criado na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="b8cc9-288">Esse método inicia o trabalho do agente que gera o instantâneo inicial.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="b8cc9-289">Para obter mais informações sobre como gerar um instantâneo inicial e definir uma agenda personalizada para o Snapshot Agent, consulte [Criar e aplicar o instantâneo inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="b8cc9-290">Verifique se há um valor de `true` para a <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> propriedade para determinar quando o instantâneo inicial está pronto para uso.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="b8cc9-291">Crie uma instância da classe <xref:Microsoft.SqlServer.Replication.MergePartition> e defina os critérios de filtragem com parâmetros para o Assinante, usando uma ou mais das seguintes propriedades:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="b8cc9-292">Se a partição do Assinante for definida pelo resultado de [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="b8cc9-293">Se a partição do Assinante for definida pelo resultado de [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) ou uma sobrecarga dessa função, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="b8cc9-294">Crie uma instância da classe <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> e defina a mesma propriedade que a da etapa 6.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="b8cc9-295">Use a classe <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> para definir uma agenda para gerar o instantâneo filtrado para a partição de Assinante.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="b8cc9-296">Usando a instância de <xref:Microsoft.SqlServer.Replication.MergePublication> da etapa 1, chame <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="b8cc9-297">Passe o objeto <xref:Microsoft.SqlServer.Replication.MergePartition> da etapa 6.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="b8cc9-298">Usando a instância de <xref:Microsoft.SqlServer.Replication.MergePublication> da etapa 1, chame o método <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="b8cc9-299">Passe o objeto <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> da etapa 7 e o objeto <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> da etapa 8.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="b8cc9-300">Chame <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>e localize o objeto <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> para o trabalho de instantâneo particionado recém-adicionado à matriz retornada.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="b8cc9-301">Adquira a propriedade <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> para o trabalho.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="b8cc9-302">Crie uma conexão com o Distribuidor usando a classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="b8cc9-303">Crie uma instância da classe <xref:Microsoft.SqlServer.Management.Smo.Server> do SQL Server Management Objetcs (SMO), passando o objeto <xref:Microsoft.SqlServer.Management.Common.ServerConnection> da etapa 13.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="b8cc9-304">Crie uma instância da classe <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> passando a propriedade <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> do objeto <xref:Microsoft.SqlServer.Management.Smo.Server> da etapa 14 e o nome do trabalho da etapa 12.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="b8cc9-305">Chame o método <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> para iniciar o trabalho de instantâneo particionado.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="b8cc9-306">Repita as etapas 6-16 para cada Assinante.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="b8cc9-307">Para criar uma publicação e criar manualmente instantâneos para cada partição</span><span class="sxs-lookup"><span data-stu-id="b8cc9-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="b8cc9-308">Use uma instância da classe <xref:Microsoft.SqlServer.Replication.MergePublication> para definir uma publicação de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="b8cc9-309">Para obter mais informações, consulte [Criar uma assinatura](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="b8cc9-310">Use a propriedade <xref:Microsoft.SqlServer.Replication.MergeArticle> para adicionar artigos para a publicação. Especifique a propriedade <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> para pelo menos um artigo que defina o filtro com parâmetros e crie quaisquer objetos <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> que definam filtros de junção entre artigos.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="b8cc9-311">Para obter mais informações, consulte [Define an Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="b8cc9-312">Gere o instantâneo inicial.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-312">Generate the initial snapshot.</span></span> <span data-ttu-id="b8cc9-313">Para obter mais informações, consulte [Criar e aplicar o instantâneo inicial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="b8cc9-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="b8cc9-314">Crie uma instância da classe <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> e defina as seguintes propriedades necessárias:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="b8cc9-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - nome do Publicador</span><span class="sxs-lookup"><span data-stu-id="b8cc9-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="b8cc9-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - nome do banco de dados de publicação</span><span class="sxs-lookup"><span data-stu-id="b8cc9-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="b8cc9-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - nome da publicação</span><span class="sxs-lookup"><span data-stu-id="b8cc9-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="b8cc9-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - nome do Distribuidor</span><span class="sxs-lookup"><span data-stu-id="b8cc9-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="b8cc9-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - um valor de <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> para Autenticação integrada do Windows usada ou um valor de <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> para usar o Autenticação do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="b8cc9-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - um valor de <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> para Autenticação integrada do Windows usada ou um valor de <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> para usar o Autenticação do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="b8cc9-321">Defina um valor de <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> para <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="b8cc9-322">Defina uma ou mais das seguintes propriedades a fim de definir os parâmetros de particionamento:</span><span class="sxs-lookup"><span data-stu-id="b8cc9-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="b8cc9-323">Se a partição do Assinante for definida pelo resultado de [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="b8cc9-324">Se a partição do Assinante for definida pelo resultado de [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) ou uma sobrecarga dessa função, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="b8cc9-325">Chame o método <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="b8cc9-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="b8cc9-326">Repita as etapas 4-7 para cada Assinante.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="b8cc9-327">Exemplos (RMO)</span><span class="sxs-lookup"><span data-stu-id="b8cc9-327">Examples (RMO)</span></span>  
 <span data-ttu-id="b8cc9-328">Esse exemplo cria uma publicação de mesclagem que permite aos Assinantes solicitar geração de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="b8cc9-329">Esse exemplo cria a partição de Assinante e o instantâneo filtrado manualmente para uma publicação de mesclagem com filtros de linha com parâmetros.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="b8cc9-330">Esse exemplo inicia manualmente o Agente de Instantâneo para gerar o instantâneo de dados filtrado para um Assinante para uma publicação de mesclagem com filtros de linha com parâmetros.</span><span class="sxs-lookup"><span data-stu-id="b8cc9-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="b8cc9-331">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="b8cc9-331">See Also</span></span>  
 <span data-ttu-id="b8cc9-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="b8cc9-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="b8cc9-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="b8cc9-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="b8cc9-334">[Instantâneos para publicações de mesclagem com filtros com parâmetros](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="b8cc9-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="b8cc9-335">Replication Security Best Practices</span><span class="sxs-lookup"><span data-stu-id="b8cc9-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
