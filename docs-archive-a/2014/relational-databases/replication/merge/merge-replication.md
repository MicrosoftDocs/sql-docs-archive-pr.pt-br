---
title: Replicação de mesclagem | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication [SQL Server replication], about merge replication
- merge replication [SQL Server replication]
ms.assetid: ff87c368-4c00-4e48-809d-ea752839551e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 7feef9e4debc228d1685c664c072139d60b56c22
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87568491"
---
# <a name="merge-replication"></a><span data-ttu-id="3c261-102">Replicação de mesclagem</span><span class="sxs-lookup"><span data-stu-id="3c261-102">Merge Replication</span></span>
  <span data-ttu-id="3c261-103">A replicação de mesclagem, como a replicação transacional, normalmente inicia com um instantâneo dos objetos e dos dados do banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="3c261-103">Merge replication, like transactional replication, typically starts with a snapshot of the publication database objects and data.</span></span> <span data-ttu-id="3c261-104">As alterações dos dados subsequentes e as modificações de esquema feitas no Publicador e nos Assinantes são rastreadas com gatilhos.</span><span class="sxs-lookup"><span data-stu-id="3c261-104">Subsequent data changes and schema modifications made at the Publisher and Subscribers are tracked with triggers.</span></span> <span data-ttu-id="3c261-105">O Assinante sincroniza com o Publicador quando está conectado à rede e permuta todas as linhas que foram alteradas entre o Publicador e o Assinante desde a última vez que a sincronização ocorreu.</span><span class="sxs-lookup"><span data-stu-id="3c261-105">The Subscriber synchronizes with the Publisher when connected to the network and exchanges all rows that have changed between the Publisher and Subscriber since the last time synchronization occurred.</span></span>

 <span data-ttu-id="3c261-106">Normalmente, a replicação de mesclagem é usada normalmente em ambientes do tipo servidor para clientes.</span><span class="sxs-lookup"><span data-stu-id="3c261-106">Merge replication is typically used in server-to-client environments.</span></span> <span data-ttu-id="3c261-107">A replicação de mesclagem é apropriada em quaisquer das seguintes situações:</span><span class="sxs-lookup"><span data-stu-id="3c261-107">Merge replication is appropriate in any of the following situations:</span></span>

-   <span data-ttu-id="3c261-108">Diversos Assinantes podem atualizar os mesmos dados diversas vezes e propagar essas alterações para o Publicador e outros Assinantes.</span><span class="sxs-lookup"><span data-stu-id="3c261-108">Multiple Subscribers might update the same data at various times and propagate those changes to the Publisher and to other Subscribers.</span></span>

-   <span data-ttu-id="3c261-109">Os Assinantes precisam receber dados, fazer alterações offline e sincronizar posteriormente as alterações com o Publicador e outros Assinantes.</span><span class="sxs-lookup"><span data-stu-id="3c261-109">Subscribers need to receive data, make changes offline, and later synchronize changes with the Publisher and other Subscribers.</span></span>

-   <span data-ttu-id="3c261-110">Cada Assinante requer uma partição diferente de dados.</span><span class="sxs-lookup"><span data-stu-id="3c261-110">Each Subscriber requires a different partition of data.</span></span>

-   <span data-ttu-id="3c261-111">Conflitos podem ocorrer e, quando isto acontecer, você precisará do recurso para detectá-los e encontrar a solução.</span><span class="sxs-lookup"><span data-stu-id="3c261-111">Conflicts might occur and, when they do, you need the ability to detect and resolve them.</span></span>

-   <span data-ttu-id="3c261-112">O aplicativo requer a alteração nos dados da rede no lugar do acesso aos estados de dados intermediários.</span><span class="sxs-lookup"><span data-stu-id="3c261-112">The application requires net data change rather than access to intermediate data states.</span></span> <span data-ttu-id="3c261-113">Por exemplo, se uma linha for alterada cinco vezes em um Assinante antes de ele sincronizar com um Publicador, a linha será alterada somente uma vez no Publicador pra refletir a alteração dos dados na rede (ou seja, o quinto valor).</span><span class="sxs-lookup"><span data-stu-id="3c261-113">For example, if a row changes five times at a Subscriber before it synchronizes with a Publisher, the row will change only once at the Publisher to reflect the net data change (that is, the fifth value).</span></span>

 <span data-ttu-id="3c261-114">A replicação de mesclagem permite que diversos sites operem de forma autônoma e que as atualizações posteriores de mesclagem obtenham um único resultado uniforme.</span><span class="sxs-lookup"><span data-stu-id="3c261-114">Merge replication allows various sites to work autonomously and later merge updates into a single, uniform result.</span></span> <span data-ttu-id="3c261-115">Como as atualizações são feitas em mais de um nó, os mesmos dados podem ter sido atualizados pelo Publicador e por mais de um Assinante.</span><span class="sxs-lookup"><span data-stu-id="3c261-115">Because updates are made at more than one node, the same data may have been updated by the Publisher and by more than one Subscriber.</span></span> <span data-ttu-id="3c261-116">Portanto, os conflitos podem ocorrer quando as atualizações forem mescladas e a replicação de mesclagem fornecer várias maneiras para controlar os conflitos.</span><span class="sxs-lookup"><span data-stu-id="3c261-116">Therefore, conflicts can occur when updates are merged and merge replication provides a number of ways to handle conflicts.</span></span>

 <span data-ttu-id="3c261-117">A replicação de mesclagem é implementada pelo [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Agente de Instantâneo e Agente de Mesclagem.</span><span class="sxs-lookup"><span data-stu-id="3c261-117">Merge replication is implemented by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Snapshot Agent and Merge Agent.</span></span> <span data-ttu-id="3c261-118">Se a publicação não for filtrada ou usar filtros estáticos, o Agente de Instantâneo criará um único instantâneo.</span><span class="sxs-lookup"><span data-stu-id="3c261-118">If the publication is unfiltered or uses static filters, the Snapshot Agent creates a single snapshot.</span></span> <span data-ttu-id="3c261-119">Se a publicação usar filtros com parâmetros, o Agente de Instantâneo criará um instantâneo para cada partição de dados.</span><span class="sxs-lookup"><span data-stu-id="3c261-119">If the publication uses parameterized filters, the Snapshot Agent creates a snapshot for each partition of data.</span></span> <span data-ttu-id="3c261-120">O Agente de Mesclagem aplica os instantâneos iniciais aos Assinantes.</span><span class="sxs-lookup"><span data-stu-id="3c261-120">The Merge Agent applies the initial snapshots to the Subscribers.</span></span> <span data-ttu-id="3c261-121">Ele também mescla as alterações incrementais de dados que ocorreram no Publicador ou nos Assinantes após a criação do instantâneo inicial, e detecta e soluciona qualquer conflito de acordo com as regras que você configura.</span><span class="sxs-lookup"><span data-stu-id="3c261-121">It also merges incremental data changes that occurred at the Publisher or Subscribers after the initial snapshot was created, and detects and resolves any conflicts according to rules you configure.</span></span>

 <span data-ttu-id="3c261-122">Para rastrear as alterações, a replicação de mesclagem (e a replicação transacional, com assinaturas de atualização em fila) deve poder identificar exclusivamente cada linha em cada tabela publicada.</span><span class="sxs-lookup"><span data-stu-id="3c261-122">To track changes, merge replication (and transactional replication with queued updating subscriptions) must be able to uniquely identify every row in every published table.</span></span> <span data-ttu-id="3c261-123">Para fazer isso, a replicação de mesclagem adiciona a coluna `rowguid` a cada tabela, a menos que a tabela já tenha uma coluna do tipo de dados `uniqueidentifier` com a propriedade `ROWGUIDCOL` definida (neste caso, esta coluna será usada).</span><span class="sxs-lookup"><span data-stu-id="3c261-123">To accomplish this merge replication adds the column `rowguid` to every table, unless the table already has a column of data type `uniqueidentifier` with the `ROWGUIDCOL` property set (in which case this column is used).</span></span> <span data-ttu-id="3c261-124">Se a tabela for descartada da publicação, a coluna `rowguid` será removida; mas, se uma coluna existente foi usada para o rastreamento, ela não será removida.</span><span class="sxs-lookup"><span data-stu-id="3c261-124">If the table is dropped from the publication, the `rowguid` column is removed; if an existing column was used for tracking, the column is not removed.</span></span> <span data-ttu-id="3c261-125">Um filtro não deve incluir o `rowguidcol` usado por replicação para identificar linhas.</span><span class="sxs-lookup"><span data-stu-id="3c261-125">A filter must not include the `rowguidcol` used by replication to identify rows.</span></span> <span data-ttu-id="3c261-126">A função `newid()` é fornecida como um padrão para a coluna `rowguid`, mas os clientes podem fornecer um guid para cada linha, se necessário.</span><span class="sxs-lookup"><span data-stu-id="3c261-126">The `newid()` function is provided as a default for the `rowguid` column, however customers can provide a guid for each row if needed.</span></span> <span data-ttu-id="3c261-127">Entretanto, não forneça o valor 00000000-0000-0000-0000-000000000000.</span><span class="sxs-lookup"><span data-stu-id="3c261-127">However, do not provide value 00000000-0000-0000-0000-000000000000.</span></span>

 <span data-ttu-id="3c261-128">O diagrama a seguir mostra os componentes usados em replicação de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="3c261-128">The following diagram shows the components used in merge replication.</span></span>

 <span data-ttu-id="3c261-129">![Fluxo de dados e componentes da replicação de mesclagem](../media/merge.gif "Fluxo de dados e componentes da replicação de mesclagem")</span><span class="sxs-lookup"><span data-stu-id="3c261-129">![Merge replication components and data flow](../media/merge.gif "Merge replication components and data flow")</span></span>


