---
title: Otimizar o desempenho de filtro com parâmetros com partições pré-computadas | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication], about precomputed partitions
ms.assetid: 85654bf4-e25f-4f04-8e34-bbbd738d60fa
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4ad0a33f0a5951256ff94bc78e7f09a88c05f227
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685065"
---
# <a name="optimize-parameterized-filter-performance-with-precomputed-partitions"></a><span data-ttu-id="cdb14-102">Otimizar o desempenho de filtro parametrizado com partições pré-computadas</span><span class="sxs-lookup"><span data-stu-id="cdb14-102">Optimize Parameterized Filter Performance with Precomputed Partitions</span></span>
  <span data-ttu-id="cdb14-103">Partições pré-computadas são uma otimização de desempenho que pode ser usada com publicações de mesclagem filtradas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-103">Precomputed partitions is a performance optimization that can be used with filtered merge publications.</span></span> <span data-ttu-id="cdb14-104">Partições pré-computadas também são um requisito para usar registros lógicos em publicações filtradas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-104">Precomputed partitions is also a requirement for using logical records on filtered publications.</span></span> <span data-ttu-id="cdb14-105">Para obter mais informações sobre registros lógicos, consulte [Agrupar alterações em linhas relacionadas com registros lógicos](group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="cdb14-105">For more information about logical records, see [Group Changes to Related Rows with Logical Records](group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
 <span data-ttu-id="cdb14-106">Quando um Assinante faz a sincronização com um Publicador, este deve avaliar os filtros do Assinante para determinar quais linhas pertencem àquele Assinante ou conjunto de dados.</span><span class="sxs-lookup"><span data-stu-id="cdb14-106">When a Subscriber synchronizes with a Publisher, the Publisher must evaluate the Subscriber's filters to determine which rows belong to that Subscriber's partition, or data set.</span></span> <span data-ttu-id="cdb14-107">Esse processo de determinação de associação de partição de alterações no Publicador para cada Assinante recebendo um conjunto de dados filtrado é referido como *avaliação de partição*.</span><span class="sxs-lookup"><span data-stu-id="cdb14-107">This process of determining partition membership of changes at the Publisher for each Subscriber receiving a filtered dataset is referred to as *partition evaluation*.</span></span> <span data-ttu-id="cdb14-108">Sem partições pré-computadas, a avaliação de partição deve ser executada para cada alteração feita em uma coluna filtrada no Publicador desde a última vez que o Agente de Mesclagem foi executado em um Assinante específico e esse processo tem de ser repetido para cada Assinante que sincroniza com o Publicador.</span><span class="sxs-lookup"><span data-stu-id="cdb14-108">Without precomputed partitions, partition evaluation must be performed for each change made to a filtered column at the Publisher since the last time the Merge Agent ran for a specific Subscriber, and this process has to be repeated for every Subscriber that synchronizes with the Publisher.</span></span>  
  
 <span data-ttu-id="cdb14-109">No entanto, se o Publicador e o assinante estiverem em execução no [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou em uma versão posterior e você usar partições preputadas, a associação de partição para todas as alterações no Publicador será executada e persistirá no momento em que as alterações forem feitas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-109">However, if the Publisher and Subscriber are running on [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version and you use precomputed partitions, partition membership for all changes at the Publisher is precomputed and persisted at the time that the changes are made.</span></span> <span data-ttu-id="cdb14-110">Como resultado, quando um Assinante sincroniza com o Publicador, ele pode começar imediatamente a baixar as alterações relevantes à sua partição sem ter de passar pelo processo de avaliação de partição.</span><span class="sxs-lookup"><span data-stu-id="cdb14-110">As a result, when a Subscriber synchronizes with the Publisher, it can immediately start to download changes relevant to its partition without having to go through the partition evaluation process.</span></span> <span data-ttu-id="cdb14-111">Isso pode levar a um ganho significativo de desempenho quando a publicação tem um grande número de alterações, Assinantes ou artigos na publicação.</span><span class="sxs-lookup"><span data-stu-id="cdb14-111">This can lead to significant performance gains when a publication has a large number of changes, Subscribers, or articles in the publication.</span></span>  
  
 <span data-ttu-id="cdb14-112">Além de usar partições pré-computadas, instantâneos pré-gerados e/ou permitir que os Assinantes solicitem geração e aplicação de instantâneos na primeira vez que eles sincronizarem.</span><span class="sxs-lookup"><span data-stu-id="cdb14-112">In addition to using precomputed partitions, pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span> <span data-ttu-id="cdb14-113">Use uma, ou ambas as opções, para fornecer instantâneos para publicações que usam filtros com parâmetros.</span><span class="sxs-lookup"><span data-stu-id="cdb14-113">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="cdb14-114">Se você não especificar uma dessas opções, as assinaturas serão inicializadas usando uma série de instruções SELECT e INSERT, ao invés de usar o utilitário **bcp** , esse processo é muito mais lento.</span><span class="sxs-lookup"><span data-stu-id="cdb14-114">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="cdb14-115">Para obter mais informações, consulte [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="cdb14-115">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="cdb14-116">**Para usar partições pré-computadas**</span><span class="sxs-lookup"><span data-stu-id="cdb14-116">**To use precomputed partitions**</span></span>  
  
 <span data-ttu-id="cdb14-117">Partições de pré-computadas estão habilitadas, por padrão, em todas as publicações novas e existentes que aderem às diretrizes descritas acima.</span><span class="sxs-lookup"><span data-stu-id="cdb14-117">Precomputed partitions are enabled by default on all new and existing publications that adhere to the guidelines described above.</span></span> <span data-ttu-id="cdb14-118">A configuração pode ser alterada pelo [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] ou programaticamente.</span><span class="sxs-lookup"><span data-stu-id="cdb14-118">The setting can be changed through [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or programmatically.</span></span> <span data-ttu-id="cdb14-119">Para obter mais informações, consulte [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="cdb14-119">For more information, see [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span></span>  
  
## <a name="requirements-for-using-precomputed-partitions"></a><span data-ttu-id="cdb14-120">Requisitos para usar partições pré-computadas</span><span class="sxs-lookup"><span data-stu-id="cdb14-120">Requirements for Using Precomputed Partitions</span></span>  
 <span data-ttu-id="cdb14-121">Se os seguintes requisitos forem satisfeitos, novas publicações de mesclagem serão, por padrão, criadas com as partições pré-computadas habilitadas, e as publicações existentes serão automaticamente atualizadas para usar a característica.</span><span class="sxs-lookup"><span data-stu-id="cdb14-121">If the following requirements are met, new merge publications are, by default, created with precomputed partitions enabled, and existing publications are automatically upgraded to use the feature.</span></span> <span data-ttu-id="cdb14-122">Se uma publicação não satisfizer os requisitos, ela poderá ser alterada e, então, as partições pré-computadas poderão ser habilitadas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-122">If a publication does not meet the requirements, it can be changed, and then precomputed partitions can be enabled.</span></span> <span data-ttu-id="cdb14-123">Se alguns artigos satisfizerem os requisitos e outros não, considere criar duas publicações, sendo uma delas habilitada para partições pré-computadas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-123">If some articles meet these requirements and some do not, consider creating two publications, with one enabled for precomputed partitions.</span></span>  
  
### <a name="requirements-for-filter-clauses"></a><span data-ttu-id="cdb14-124">Requisitos para cláusulas de filtro</span><span class="sxs-lookup"><span data-stu-id="cdb14-124">Requirements for Filter Clauses</span></span>  
  
-   <span data-ttu-id="cdb14-125">Quaisquer funções usadas em filtros de linha com parâmetros, como HOST_NAME() e SUSER_SNAME(), deveriam aparecer diretamente na cláusula de filtro com parâmetros e não ser aninhada dentro de uma exibição ou função dinâmica.</span><span class="sxs-lookup"><span data-stu-id="cdb14-125">Any functions used in parameterized row filters, such as HOST_NAME() and SUSER_SNAME(), should appear directly in the parameterized filter clause and not be nested inside of a view or dynamic function.</span></span> <span data-ttu-id="cdb14-126">Para obter mais informações sobre essas funções, consulte [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) e [Filtros de linha com parâmetros](parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="cdb14-126">For more information about these functions, see [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), and [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="cdb14-127">Os valores retornados para cada Assinante não deveriam alterar depois que a partição seja criada.</span><span class="sxs-lookup"><span data-stu-id="cdb14-127">The values returned for each Subscriber should not change after the partition is created.</span></span> <span data-ttu-id="cdb14-128">Por exemplo, se você usar HOST_NAME() em um filtro (e não substituir o valor de HOST_NAME()) não altere o nome do computador no Assinante.</span><span class="sxs-lookup"><span data-stu-id="cdb14-128">For example, if you use HOST_NAME() in a filter (and do not override the HOST_NAME() value) do not change the computer name at the Subscriber.</span></span>  
  
-   <span data-ttu-id="cdb14-129">Filtros de junção não deveriam conter funções dinâmicas (funções como HOST_NAME() e SUSER_SNAME() que avaliam para um valor diferente dependendo do Assinante que está sincronizando).</span><span class="sxs-lookup"><span data-stu-id="cdb14-129">Join filters should not contain dynamic functions (functions such as HOST_NAME() and SUSER_SNAME() that evaluate to a different value depending upon the Subscriber that is synchronizing).</span></span> <span data-ttu-id="cdb14-130">Somente filtros de linha com parâmetros deveriam conter funções dinâmicas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-130">Only parameterized row filters should contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="cdb14-131">Não podem ser usadas funções não determinísticas em uma cláusula de filtro.</span><span class="sxs-lookup"><span data-stu-id="cdb14-131">Nondeterministic functions cannot be used in a filter clause.</span></span> <span data-ttu-id="cdb14-132">Para obter mais informações sobre funções não determinísticas, consulte [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span><span class="sxs-lookup"><span data-stu-id="cdb14-132">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="cdb14-133">Exibições referenciadas em cláusulas de filtro de junção ou cláusulas de filtro com parâmetros não deveriam conter funções dinâmicas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-133">Views referenced in join filter clauses or parameterized filter clauses should not contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="cdb14-134">Não deveria haver nenhuma relação de filtro de junção circular na publicação.</span><span class="sxs-lookup"><span data-stu-id="cdb14-134">There should be no circular join filter relationships in the publication.</span></span>  
  
### <a name="database-collation"></a><span data-ttu-id="cdb14-135">Ordenação de banco de dados</span><span class="sxs-lookup"><span data-stu-id="cdb14-135">Database Collation</span></span>  
  
-   <span data-ttu-id="cdb14-136">Quando partições pré-computadas são usadas, a ordenação do banco de dados é sempre usada ao fazer comparações, ao invés de ordenação de tabela ou coluna.</span><span class="sxs-lookup"><span data-stu-id="cdb14-136">When precomputed partitions are used, the collation of the database is always used when making comparisons, rather than the collation of the table or column.</span></span> <span data-ttu-id="cdb14-137">Considere o cenário a seguir.</span><span class="sxs-lookup"><span data-stu-id="cdb14-137">Consider the following scenario:</span></span>  
  
    -   <span data-ttu-id="cdb14-138">Um banco de dados com uma ordenação com diferenciação de maiúsculas e minúsculas contém uma tabela com uma ordenação de diferenciação de maiúsculas e minúsculas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-138">A database with a case-sensitive collation contains a table with a case-insensitive collation.</span></span>  
  
    -   <span data-ttu-id="cdb14-139">A tabela contém uma coluna **ComputerName**, que é comparada ao nome do host do Assinante em um filtro com parâmetros.</span><span class="sxs-lookup"><span data-stu-id="cdb14-139">The table contains a column **ComputerName**, which is compared against the host name of the Subscriber in a parameterized filter.</span></span>  
  
    -   <span data-ttu-id="cdb14-140">A tabela contém uma linha com o valor "MYCOMPUTER" e uma linha com o valor "mycomputer" nesta coluna.</span><span class="sxs-lookup"><span data-stu-id="cdb14-140">The table contains one row with the value "MYCOMPUTER" and one row with the value "mycomputer" in this column.</span></span>  
  
     <span data-ttu-id="cdb14-141">Se o Assinante sincronizar com o nome de host “mycomputer”, o Assinante receberá apenas uma linha, porque a comparação é com diferenciação de maiúsculas e minúsculas (a ordenação do banco de dados).</span><span class="sxs-lookup"><span data-stu-id="cdb14-141">If the Subscriber synchronizes with a host name of "mycomputer", the Subscriber receives only one row because the comparison is case-sensitive (the collation of the database).</span></span> <span data-ttu-id="cdb14-142">Se partições de pré-computadas não forem usadas, o Assinante receberá ambas as linhas, porque a tabela tem uma ordenação sem diferenciação de maiúsculas e minúsculas.</span><span class="sxs-lookup"><span data-stu-id="cdb14-142">If precomputed partitions are not used, the Subscriber receives both rows, because the table has a case-insensitive collation.</span></span>  
  
## <a name="performance-of-precomputed-partitions"></a><span data-ttu-id="cdb14-143">Desempenho de partições pré-computadas</span><span class="sxs-lookup"><span data-stu-id="cdb14-143">Performance of Precomputed Partitions</span></span>  
 <span data-ttu-id="cdb14-144">Há um pequeno custo de desempenho com partições pré-computadas quando as alterações são carregadas do Assinante para o Publicador, mas o tempo de processamento em massa de mesclagem é gasto avaliando as partições e baixando as alterações do Publicador para o Assinante, portanto, o ganho da rede ainda pode ser significativo.</span><span class="sxs-lookup"><span data-stu-id="cdb14-144">There is a small performance cost with precomputed partitions when changes are uploaded from the Subscriber to the Publisher, but the bulk of merge processing time is spent evaluating partitions and downloading changes from the Publisher to the Subscriber, so the net gain can still be significant.</span></span> <span data-ttu-id="cdb14-145">O benefício de desempenho irá variar, dependendo do número de Assinantes, sincronizando simultaneamente e o número de atualizações por sincronização que move linhas de uma partição a outra.</span><span class="sxs-lookup"><span data-stu-id="cdb14-145">The performance benefit will vary, depending on the number of Subscribers synchronizing concurrently and the number of updates per synchronization that move rows from one partition to another.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cdb14-146">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="cdb14-146">See Also</span></span>  
 [<span data-ttu-id="cdb14-147">Parameterized Row Filters</span><span class="sxs-lookup"><span data-stu-id="cdb14-147">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
