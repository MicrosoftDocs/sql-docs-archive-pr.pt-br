---
title: Replicação de instantâneo | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshot replication [SQL Server], about snapshot replication
- snapshot replication [SQL Server]
ms.assetid: 5d745f22-9c6b-4e11-8c62-bc50e9a8bf38
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6192c196e31c4c5772099074c79b3c6c4ca7aeed
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87686258"
---
# <a name="snapshot-replication"></a><span data-ttu-id="86dd1-102">Replicação de instantâneo</span><span class="sxs-lookup"><span data-stu-id="86dd1-102">Snapshot Replication</span></span>
  <span data-ttu-id="86dd1-103">A replicação de instantâneo distribui os dados exatamente como eles aparecem em um momento específico e não monitora as atualizações dos dados.</span><span class="sxs-lookup"><span data-stu-id="86dd1-103">Snapshot replication distributes data exactly as it appears at a specific moment in time and does not monitor for updates to the data.</span></span> <span data-ttu-id="86dd1-104">Quando a sincronização ocorre, todo o instantâneo é gerado e enviado aos Assinantes.</span><span class="sxs-lookup"><span data-stu-id="86dd1-104">When synchronization occurs, the entire snapshot is generated and sent to Subscribers.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="86dd1-105">A replicação de instantâneo pode ser usada por si só, mas o processo de instantâneo (o que cria uma cópia de todos os objetos e dados especificados por uma publicação) também é usado regularmente para fornecer o conjunto inicial dos dados e dos objetos do banco de dados para publicações de mesclagem e transacionais.</span><span class="sxs-lookup"><span data-stu-id="86dd1-105">Snapshot replication can be used by itself, but the snapshot process (which creates a copy of all of the objects and data specified by a publication) is also commonly used to provide the initial set of data and database objects for transactional and merge publications.</span></span>  
  
 <span data-ttu-id="86dd1-106">O uso da replicação de instantâneo por si só é mais apropriado quando um ou mais dos itens a seguir for real:</span><span class="sxs-lookup"><span data-stu-id="86dd1-106">Using snapshot replication by itself is most appropriate when one or more of the following is true:</span></span>  
  
-   <span data-ttu-id="86dd1-107">As alterações de dados ocorrerem raramente.</span><span class="sxs-lookup"><span data-stu-id="86dd1-107">Data changes infrequently.</span></span>  
  
-   <span data-ttu-id="86dd1-108">É aceitável ter cópias de dados desatualizadas em relação ao Publicador por um período de tempo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-108">It is acceptable to have copies of data that are out of date with respect to the Publisher for a period of time.</span></span>  
  
-   <span data-ttu-id="86dd1-109">Replicação de pequenos volumes de dados.</span><span class="sxs-lookup"><span data-stu-id="86dd1-109">Replicating small volumes of data.</span></span>  
  
-   <span data-ttu-id="86dd1-110">Um volume grande de alterações ocorre por um curto período de tempo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-110">A large volume of changes occurs over a short period of time.</span></span>  
  
 <span data-ttu-id="86dd1-111">A replicação de instantâneo é mais apropriada quando as alterações de dados forem significativas, mas pouco frequentes.</span><span class="sxs-lookup"><span data-stu-id="86dd1-111">Snapshot replication is most appropriate when data changes are substantial but infrequent.</span></span> <span data-ttu-id="86dd1-112">Por exemplo, se uma empresa de vendas mantiver uma lista de preços de produtos e os preços forem todos atualizados ao mesmo tempo uma ou duas vezes por ano, é recomendada a replicação de todo o instantâneo de dados após ele ter sido alterado.</span><span class="sxs-lookup"><span data-stu-id="86dd1-112">For example, if a sales organization maintains a product price list and the prices are all updated at the same time once or twice each year, replicating the entire snapshot of data after it has changed is recommended.</span></span> <span data-ttu-id="86dd1-113">Ao ter certos tipos de dados determinados, os instantâneos mais frequentes também podem ser apropriados.</span><span class="sxs-lookup"><span data-stu-id="86dd1-113">Given certain types of data, more frequent snapshots may also be appropriate.</span></span> <span data-ttu-id="86dd1-114">Por exemplo, se uma tabela relativamente pequena for atualizada no Publicador durante o dia, mas alguma latência for aceitável, as alterações podem ser distribuídas pela noite como um instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-114">For example, if a relatively small table is updated at the Publisher during the day, but some latency is acceptable, changes can be delivered nightly as a snapshot.</span></span>  
  
 <span data-ttu-id="86dd1-115">A replicação de instantâneo tem uma sobrecarga contínua no Publicador inferior à replicação transacional, porque as alterações incrementais não são rastreadas.</span><span class="sxs-lookup"><span data-stu-id="86dd1-115">Snapshot replication has a lower continuous overhead on the Publisher than transactional replication, because incremental changes are not tracked.</span></span> <span data-ttu-id="86dd1-116">No entanto, se o ajuste do conjunto de dados que estiver sendo replicado for muito grande, ele exigirá recursos substanciais para gerar e aplicar o instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-116">However, if the dataset set being replicated is very large, it will require substantial resources to generate and apply the snapshot.</span></span> <span data-ttu-id="86dd1-117">Considere a dimensão de todo o conjunto de dados e a frequência de alterações nos dados ao avaliar a possibilidade de utilizar a replicação de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-117">Consider the size of the entire data set and the frequency of changes to the data when evaluating whether to utilize snapshot replication.</span></span>  
  
 <span data-ttu-id="86dd1-118">**Neste tópico**</span><span class="sxs-lookup"><span data-stu-id="86dd1-118">**In this topic**</span></span>  
  
 [<span data-ttu-id="86dd1-119">Como a replicação de instantâneo funciona</span><span class="sxs-lookup"><span data-stu-id="86dd1-119">How Snapshot Replication Works</span></span>](#HowWorks)  
  
 [<span data-ttu-id="86dd1-120">Snapshot Agent</span><span class="sxs-lookup"><span data-stu-id="86dd1-120">Snapshot Agent</span></span>](#SnapshotAgent)  
  
 [<span data-ttu-id="86dd1-121">Agentes de Distribuição e Mesclagem</span><span class="sxs-lookup"><span data-stu-id="86dd1-121">Distribution and Merge Agents</span></span>](#DistAgent)  
  
##  <a name="how-snapshot-replication-works"></a><a name="HowWorks"></a> <span data-ttu-id="86dd1-122">Como a replicação de instantâneo funciona</span><span class="sxs-lookup"><span data-stu-id="86dd1-122">How Snapshot Replication Works</span></span>  
 <span data-ttu-id="86dd1-123">Por padrão, todos os três tipos de replicação usam um instantâneo para inicializar os Assinantes.</span><span class="sxs-lookup"><span data-stu-id="86dd1-123">By default, all three types of replication use a snapshot to initialize Subscribers.</span></span> <span data-ttu-id="86dd1-124">O Snapshot Agent do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sempre gera os arquivos de instantâneo, mas o agente que distribui os arquivos pode diferir dependendo do tipo de replicação que estiver sendo usada.</span><span class="sxs-lookup"><span data-stu-id="86dd1-124">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Snapshot Agent always generates the snapshot files, but the agent that delivers the files differs depending on the type of replication being used.</span></span> <span data-ttu-id="86dd1-125">A replicação transacional e a de instantâneo usam o Distribution Agent para distribuir os arquivos, ao passo que a replicação de mesclagem usa o Merge Agent do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="86dd1-125">Snapshot replication and transactional replication use the Distribution Agent to deliver the files, whereas merge replication uses the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Agent.</span></span> <span data-ttu-id="86dd1-126">O Agente de Instantâneo executa no Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="86dd1-126">The Snapshot Agent runs at the Distributor.</span></span> <span data-ttu-id="86dd1-127">O Agente de Distribuição e o Agente de Mesclagem são executados no Distribuidor para as assinaturas push ou no Assinante para assinaturas pull.</span><span class="sxs-lookup"><span data-stu-id="86dd1-127">The Distribution Agent and Merge Agent run at the Distributor for push subscriptions, or at Subscribers for pull subscriptions.</span></span>  
  
 <span data-ttu-id="86dd1-128">Os instantâneos podem ser gerados e aplicados imediatamente após a assinatura ser criada ou de acordo com uma programação definida no momento que a publicação for criada.</span><span class="sxs-lookup"><span data-stu-id="86dd1-128">Snapshots can be generated and applied either immediately after the subscription is created or according to a schedule set at the time the publication is created.</span></span> <span data-ttu-id="86dd1-129">O Snapshot Agent prepara os arquivos de instantâneo que contêm o esquema e os dados das tabelas publicadas e os objetos do banco de dados, armazena os arquivos na pasta do instantâneo para o Publicador e registra o rastreamento de informações do banco de dados de distribuição no Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="86dd1-129">The Snapshot Agent prepares snapshot files containing the schema and data of published tables and database objects, stores the files in the snapshot folder for the Publisher, and records tracking information in the distribution database on the Distributor.</span></span> <span data-ttu-id="86dd1-130">Você especifica uma pasta padrão de instantâneo quando configura um Distribuidor, mas você pode especificar um local alternativo para uma publicação além do padrão.</span><span class="sxs-lookup"><span data-stu-id="86dd1-130">You specify a default snapshot folder when you configure a Distributor, but you can specify an alternate location for a publication instead of or in addition to the default.</span></span>  
  
 <span data-ttu-id="86dd1-131">Além do processo de instantâneo padrão descrito neste tópico, um processo de instantâneo em duas partes é usado para publicação de mesclagem com filtros com parâmetros.</span><span class="sxs-lookup"><span data-stu-id="86dd1-131">In addition to the standard snapshot process described in this topic, a two-part snapshot process is used for merge publications with parameterized filters.</span></span>  
  
 <span data-ttu-id="86dd1-132">A ilustração a seguir mostra os principais componentes de replicação de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-132">The following illustration shows the principal components of snapshot replication.</span></span>  
  
 <span data-ttu-id="86dd1-133">![Componentes e fluxo de dados de replicação de instantâneo](media/snapshot.gif "Componentes e fluxo de dados de replicação de instantâneo")</span><span class="sxs-lookup"><span data-stu-id="86dd1-133">![Snapshot replication components and data flow](media/snapshot.gif "Snapshot replication components and data flow")</span></span>  
  
##  <a name="snapshot-agent"></a><a name="SnapshotAgent"></a> <span data-ttu-id="86dd1-134">Snapshot Agent</span><span class="sxs-lookup"><span data-stu-id="86dd1-134">Snapshot Agent</span></span>  
 <span data-ttu-id="86dd1-135">Para replicação de mesclagem, é gerado um instantâneo toda vez que o Agente de Instantâneo é executado.</span><span class="sxs-lookup"><span data-stu-id="86dd1-135">For merge replication, a snapshot is generated every time the Snapshot Agent runs.</span></span> <span data-ttu-id="86dd1-136">Para replicação transacional, a geração de instantâneo depende da configuração da propriedade de publicação de **immediate_sync**.</span><span class="sxs-lookup"><span data-stu-id="86dd1-136">For transactional replication, snapshot generation depends on the setting of the publication property **immediate_sync**.</span></span> <span data-ttu-id="86dd1-137">Se a propriedade estiver definida como TRUE (padrão ao usar o Assistente para Nova Publicação), um instantâneo é gerado toda vez que o Agente de Instantâneo for executado e pode ser aplicado ao Assinante a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="86dd1-137">If the property is set to TRUE (the default when using the New Publication Wizard), a snapshot is generated every time the Snapshot Agent runs, and it can be applied to a Subscriber at any time.</span></span> <span data-ttu-id="86dd1-138">Se a propriedade estiver definida como FALSE (padrão ao usar **sp_addpublication**), o instantâneo só é gerado se uma assinatura nova for adicionada desde a última execução do Agente de Instantâneo; Assinantes devem esperar que o Agente de Instantâneo termine antes de poder sincronizar-se.</span><span class="sxs-lookup"><span data-stu-id="86dd1-138">If the property is set to FALSE (the default when using **sp_addpublication**), the snapshot is generated only if a new subscription has been added since the last Snapshot Agent run; Subscribers must wait for the Snapshot Agent to complete before they can synchronize.</span></span>  
  
 <span data-ttu-id="86dd1-139">O Snapshot Agent executa as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="86dd1-139">The Snapshot Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="86dd1-140">Estabelece uma conexão do Distribuidor para o Publicador e, em seguida, leva os bloqueios em tabelas publicadas, se necessário:</span><span class="sxs-lookup"><span data-stu-id="86dd1-140">Establishes a connection from the Distributor to the Publisher, and then takes locks on published tables if necessary:</span></span>  
  
    -   <span data-ttu-id="86dd1-141">Para as publicações de mesclagem, o Snapshot Agent não requer nenhum bloqueio.</span><span class="sxs-lookup"><span data-stu-id="86dd1-141">For merge publications, the Snapshot Agent does not take any locks.</span></span>  
  
    -   <span data-ttu-id="86dd1-142">Para publicações transacionais, por padrão o Snapshot Agent leva bloqueios somente durante a fase inicial de geração de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-142">For transactional publications, by default the Snapshot Agent take locks only during the initial phase of snapshot generation.</span></span>  
  
    -   <span data-ttu-id="86dd1-143">Para publicações de instantâneo, bloqueios são retidos durante todo o processo de geração de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-143">For snapshot publications, locks are held during the entire snapshot generation process.</span></span>  
  
2.  <span data-ttu-id="86dd1-144">Grava uma cópia do esquema de tabela para cada artigo em um arquivo .sch.</span><span class="sxs-lookup"><span data-stu-id="86dd1-144">Writes a copy of the table schema for each article to a .sch file.</span></span> <span data-ttu-id="86dd1-145">Se outros objetos de banco de dados forem publicados, como índices, exibições, tipos de dados, procedimentos armazenados, exibições, funções definidas pelo usuário, e assim por diante, arquivos de script adicionais serão gerados.</span><span class="sxs-lookup"><span data-stu-id="86dd1-145">If other database objects are published, such as indexes, constraints, stored procedures, views, user-defined functions, and so on, additional script files are generated.</span></span>  
  
3.  <span data-ttu-id="86dd1-146">Copia os dados da tabela publicada no Publicador e grava os dados na pasta de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-146">Copies the data from the published table at the Publisher and writes the data to the snapshot folder.</span></span> <span data-ttu-id="86dd1-147">O instantâneo é gerado como um conjunto de arquivos de programa de cópia em massa (BCP).</span><span class="sxs-lookup"><span data-stu-id="86dd1-147">The snapshot is generated as a set of bulk copy program (BCP) files.</span></span>  
  
4.  <span data-ttu-id="86dd1-148">Para as publicações transacionais e de instantâneo, o Snapshot Agent acrescenta linhas nas tabelas **MSrepl_commands** e **MSrepl_transactions** no banco de dados de distribuição.</span><span class="sxs-lookup"><span data-stu-id="86dd1-148">For snapshot and transactional publications, the Snapshot Agent appends rows to the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database.</span></span> <span data-ttu-id="86dd1-149">As entradas na tabela **MSrepl_commands** são comandos indicando o local dos arquivos .sch e .bcp, qualquer outro arquivo de instantâneo e as referências a qualquer script pré ou pós-instantâneo.</span><span class="sxs-lookup"><span data-stu-id="86dd1-149">The entries in the **MSrepl_commands** table are commands indicating the location of .sch and .bcp files, any other snapshot files, and references to any pre- or post-snapshot scripts.</span></span> <span data-ttu-id="86dd1-150">As entradas na tabela **MSrepl_transactions** são comandos importantes para sincronizar o Assinante.</span><span class="sxs-lookup"><span data-stu-id="86dd1-150">The entries in the **MSrepl_transactions** table are commands relevant to synchronizing the Subscriber.</span></span>  
  
     <span data-ttu-id="86dd1-151">Para publicações de mesclagem, o Agente de Instantâneo executa etapas adicionais.</span><span class="sxs-lookup"><span data-stu-id="86dd1-151">For merge publications, the Snapshot Agent performs additional steps.</span></span>  
  
5.  <span data-ttu-id="86dd1-152">Libera qualquer bloqueio em tabelas publicadas.</span><span class="sxs-lookup"><span data-stu-id="86dd1-152">Releases any locks on published tables.</span></span>  
  
 <span data-ttu-id="86dd1-153">Durante a geração de instantâneo, você não pode fazer alterações de esquema em tabelas publicadas.</span><span class="sxs-lookup"><span data-stu-id="86dd1-153">During snapshot generation, you cannot make schema changes on published tables.</span></span> <span data-ttu-id="86dd1-154">Depois que os arquivos de instantâneo forem gerados, você pode exibi-los na pasta de instantâneo usando o Windows Explorer.</span><span class="sxs-lookup"><span data-stu-id="86dd1-154">After the snapshot files are generated, you can view them in the snapshot folder using Windows Explorer.</span></span>  
  
##  <a name="distribution-agent-and-merge-agent"></a><a name="DistAgent"></a> <span data-ttu-id="86dd1-155">Agente de Distribuição e Agente de Mesclagem</span><span class="sxs-lookup"><span data-stu-id="86dd1-155">Distribution Agent and Merge Agent</span></span>  
 <span data-ttu-id="86dd1-156">Para publicações de instantâneo, sempre que o Agente de Distribuição for executado para a publicação, ele moverá um novo instantâneo para cada Assinante que ainda não tiver sido sincronizado, que não tenha sido marcado para reinicialização, ou incluirá novos artigos.</span><span class="sxs-lookup"><span data-stu-id="86dd1-156">For snapshot publications, each time the Distribution Agent runs for the publication, it moves a new snapshot to each Subscriber that has not yet been synchronized, has been marked for reinitialization, or includes new articles.</span></span>  
  
 <span data-ttu-id="86dd1-157">Para replicação de instantâneo e transacional, o Distribution Agent executará as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="86dd1-157">For snapshot and transactional replication, the Distribution Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="86dd1-158">Estabelece uma conexão com o Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="86dd1-158">Establishes a connection to the Distributor.</span></span>  
  
2.  <span data-ttu-id="86dd1-159">Examina as tabelas **do MSrepl_commands** e **MSrepl_transactions** no banco de dados de distribuição do Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="86dd1-159">Examines the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database on the Distributor.</span></span> <span data-ttu-id="86dd1-160">O agente lê o local dos arquivos de instantâneo da primeira tabela e os comandos de sincronização do Assinante de ambas as tabelas.</span><span class="sxs-lookup"><span data-stu-id="86dd1-160">The agent reads the location of the snapshot files from the first table and Subscriber synchronization commands from both tables.</span></span>  
  
3.  <span data-ttu-id="86dd1-161">Aplica o esquema e os comandos ao banco de dados de assinatura.</span><span class="sxs-lookup"><span data-stu-id="86dd1-161">Applies the schema and commands to the subscription database.</span></span>  
  
 <span data-ttu-id="86dd1-162">Para uma publicação de replicação de mesclagem não filtrada, o Merge Agent executa as seguintes etapas:</span><span class="sxs-lookup"><span data-stu-id="86dd1-162">For an unfiltered merge replication publication, the Merge Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="86dd1-163">Estabelece uma conexão com o Publicador.</span><span class="sxs-lookup"><span data-stu-id="86dd1-163">Establishes a connection to the Publisher.</span></span>  
  
2.  <span data-ttu-id="86dd1-164">Examina a tabela **sysmergeschemachange** no Publicador e determina se existe um novo instantâneo que deve ser aplicado no Assinante.</span><span class="sxs-lookup"><span data-stu-id="86dd1-164">Examines the **sysmergeschemachange** table on the Publisher and determines whether there is a new snapshot that should be applied at the Subscriber.</span></span>  
  
3.  <span data-ttu-id="86dd1-165">Se um novo instantâneo estiver disponível, o Agente de Mesclagem aplicará ao banco de dados de assinatura os arquivos de instantâneo do local especificado em **sysmergeschemachange**.</span><span class="sxs-lookup"><span data-stu-id="86dd1-165">If a new snapshot is available, the Merge Agent applies to the subscription database the snapshot files from the location specified in **sysmergeschemachange**.</span></span>  
  
  
