---
title: Medir a latência e validar as conexões para a replicação transacional | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Replication Monitor, performance
- tracer tokens [SQL Server replication]
- latency [SQL Server replication]
- transactional replication, tracer tokens
- monitoring performance [SQL Server replication], tracer tokens
ms.assetid: 4addd426-7523-4067-8d7d-ca6bae4c9e34
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 3ba1e5eddfdcffa5fbefdea323f110ba9d15ca8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87571943"
---
# <a name="measure-latency-and-validate-connections-for-transactional-replication"></a><span data-ttu-id="6714f-102">Medir a latência e validar as conexões para a replicação transacional</span><span class="sxs-lookup"><span data-stu-id="6714f-102">Measure Latency and Validate Connections for Transactional Replication</span></span>
  <span data-ttu-id="6714f-103">Este tópico descreve como medir a latência e validar conexões para replicação transacional no [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] usando o Replication Monitor, [!INCLUDE[tsql](../../../includes/tsql-md.md)]ou RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="6714f-103">This topic describes how to measure latency and validate connections for transactional replication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using Replication Monitor, [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="6714f-104">A replicação transacional fornece o recurso do token de rastreamento, que proporciona um meio adequado para medir a latência em topologias de replicação transacional e validar as conexões entre o Publicador, o Distribuidor e os Assinantes.</span><span class="sxs-lookup"><span data-stu-id="6714f-104">Transactional replication provides the tracer token feature, which provides a convenient way to measure latency in transactional replication topologies and to validate the connections between the Publisher, Distributor and Subscribers.</span></span> <span data-ttu-id="6714f-105">Um token (uma quantidade pequena de dados) é gravado no log de transações do banco de dados de publicação, marcado como se fosse uma transação replicada comum e enviado pelo sistema, permitindo um cálculo de:</span><span class="sxs-lookup"><span data-stu-id="6714f-105">A token (a small amount of data) is written to the transaction log of the publication database, marked as though it were a typical replicated transaction, and sent through the system, allowing a calculation of:</span></span>  
  
-   <span data-ttu-id="6714f-106">O tempo decorrido entre a confirmação de uma transação no Publicador e o comando correspondente inserido no banco de dados de distribuição no Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="6714f-106">How much time elapses between a transaction being committed at the Publisher and the corresponding command being inserted in the distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="6714f-107">O tempo decorrido entre um comando inserido no banco de dados de distribuição e a transação correspondente confirmada no Assinante.</span><span class="sxs-lookup"><span data-stu-id="6714f-107">How much time elapses between a command being inserted in the distribution database and the corresponding transaction being committed at a Subscriber.</span></span>  
  
 <span data-ttu-id="6714f-108">Desses cálculos, você pode responder várias perguntas, enquanto incluindo:</span><span class="sxs-lookup"><span data-stu-id="6714f-108">From these calculations, you can answer a number of questions, including:</span></span>  
  
-   <span data-ttu-id="6714f-109">Quais Assinantes levam mais tempo para receber uma alteração do Publicador?</span><span class="sxs-lookup"><span data-stu-id="6714f-109">Which Subscribers take the longest to receive a change from the Publisher?</span></span>  
  
-   <span data-ttu-id="6714f-110">Dos Assinantes esperados para receber o token de rastreamento quais, se houver, ainda não receberam?</span><span class="sxs-lookup"><span data-stu-id="6714f-110">Of the Subscribers expected to receive the tracer token, which, if any, have not received it?</span></span>  
  
 <span data-ttu-id="6714f-111">**Neste tópico**</span><span class="sxs-lookup"><span data-stu-id="6714f-111">**In This Topic**</span></span>  
  
-   <span data-ttu-id="6714f-112">**Antes de começar:**</span><span class="sxs-lookup"><span data-stu-id="6714f-112">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="6714f-113">Limitações e restrições</span><span class="sxs-lookup"><span data-stu-id="6714f-113">Limitations and Restrictions</span></span>](#Restrictions)  
  
-   <span data-ttu-id="6714f-114">**Para medir a latência e validar as conexões, usando:**</span><span class="sxs-lookup"><span data-stu-id="6714f-114">**To measure latency and validate connections, using:**</span></span>  
  
     [<span data-ttu-id="6714f-115">SQL Server Replication Monitor</span><span class="sxs-lookup"><span data-stu-id="6714f-115">SQL Server Replication Monitor</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="6714f-116">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="6714f-116">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="6714f-117">Replication Management Objects</span><span class="sxs-lookup"><span data-stu-id="6714f-117">Replication Management Objects</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="6714f-118">Antes de começar</span><span class="sxs-lookup"><span data-stu-id="6714f-118">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="6714f-119">Limitações e restrições</span><span class="sxs-lookup"><span data-stu-id="6714f-119">Limitations and Restrictions</span></span>  
 <span data-ttu-id="6714f-120">Os tokens de rastreamento também são úteis para confirmar um sistema, o que implica em parar todas as atividades e verificar que todos os nós tenham recebido todas as alterações pendentes.</span><span class="sxs-lookup"><span data-stu-id="6714f-120">Tracer tokens can also be useful when quiescing a system, which involves stopping all activity and verifying that all nodes have received all outstanding changes.</span></span> <span data-ttu-id="6714f-121">Para obter mais informações, consulte [Como confirmar uma topologia de replicação &#40;Programação Transact-SQL de replicação&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span><span class="sxs-lookup"><span data-stu-id="6714f-121">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
 <span data-ttu-id="6714f-122">Para usar tokens de rastreamento, você deve usar determinadas versões do [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="6714f-122">To use tracer tokens, you must use certain versions of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="6714f-123">O distribuidor deve ser [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou posterior.</span><span class="sxs-lookup"><span data-stu-id="6714f-123">The Distributor must be [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>  
  
-   <span data-ttu-id="6714f-124">O Publicador deve ser [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou posterior, ou ser um Editor Oracle.</span><span class="sxs-lookup"><span data-stu-id="6714f-124">The Publisher must be [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later or be an Oracle Publisher.</span></span>  
  
-   <span data-ttu-id="6714f-125">Para assinaturas push, as estatísticas de token de rastreamento são coletadas do Publicador, distribuidor e assinantes se o assinante for [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="6714f-125">For push subscriptions, tracer token statistics are gathered from the Publisher, Distributor, and Subscribers if the Subscriber is [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or later.</span></span>  
  
-   <span data-ttu-id="6714f-126">Para as assinaturas pull, as estatísticas dos tokens de rastreamento são coletadas dos Assinantes somente se o Assinante for [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou posterior.</span><span class="sxs-lookup"><span data-stu-id="6714f-126">For pull subscriptions, tracer token statistics are gathered from Subscribers only if the Subscriber is [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span> <span data-ttu-id="6714f-127">Se o assinante for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 ou [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)] , as estatísticas serão coletadas somente do Publicador e do distribuidor.</span><span class="sxs-lookup"><span data-stu-id="6714f-127">If the Subscriber is [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)], statistics are gathered only from the Publisher and Distributor.</span></span>  
  
 <span data-ttu-id="6714f-128">Há vários outros itens e restrições que devem ser considerados:</span><span class="sxs-lookup"><span data-stu-id="6714f-128">There are also a number of other issues and restrictions to be aware of:</span></span>  
  
-   <span data-ttu-id="6714f-129">Para receber um token de rastreamento, as assinaturas devem estar ativas.</span><span class="sxs-lookup"><span data-stu-id="6714f-129">Subscriptions must be active to receive a tracer token.</span></span> <span data-ttu-id="6714f-130">Uma assinatura estará ativa se ela foi inicializada.</span><span class="sxs-lookup"><span data-stu-id="6714f-130">A subscription is active if it has been initialized.</span></span>  
  
-   <span data-ttu-id="6714f-131">A reinicialização remove todos os tokens de rastreamento pendentes para as assinaturas relevantes.</span><span class="sxs-lookup"><span data-stu-id="6714f-131">Reinitialization removes any pending tracer tokens for the relevant subscriptions.</span></span>  
  
-   <span data-ttu-id="6714f-132">Os Assinantes recebem os tokens de rastreamento que foram criados somente após a sua sincronização inicial.</span><span class="sxs-lookup"><span data-stu-id="6714f-132">Subscribers only receive tracer tokens that were created after their initial synchronization.</span></span>  
  
-   <span data-ttu-id="6714f-133">Os tokens de rastreamento não são encaminhados pelos Assinantes de republicação.</span><span class="sxs-lookup"><span data-stu-id="6714f-133">Tracer tokens are not forwarded by republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="6714f-134">Depois do failover para um secundário, o Replication Monitor não pode ajustar o nome da instância de publicação do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e continuará exibindo informações de replicação sob o nome da instância primária original do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6714f-134">After failover to a secondary, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="6714f-135">Depois do failover, um token de rastreamento não pode ser inserido usando o Replication Monitor; porém um token de rastreamento inserido no novo publicador usando [!INCLUDE[tsql](../../../includes/tsql-md.md)]é visível no Replication Monitor.</span><span class="sxs-lookup"><span data-stu-id="6714f-135">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
##  <a name="using-sql-server-replication-monitor"></a><a name="SSMSProcedure"></a><span data-ttu-id="6714f-136">Usando Replicação do SQL Server monitor</span><span class="sxs-lookup"><span data-stu-id="6714f-136">Using SQL Server Replication Monitor</span></span>  
 <span data-ttu-id="6714f-137">Para obter informações sobre como iniciar o Replication Monitor, consulte [Start the Replication Monitor](start-the-replication-monitor.md) (Iniciar o Replication Monitor).</span><span class="sxs-lookup"><span data-stu-id="6714f-137">For information about starting Replication Monitor, see [Start the Replication Monitor](start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-insert-a-tracer-token-and-view-information-on-the-token"></a><span data-ttu-id="6714f-138">Para inserir um token de rastreamento e exibir informações sobre o token</span><span class="sxs-lookup"><span data-stu-id="6714f-138">To insert a tracer token and view information on the token</span></span>  
  
1.  <span data-ttu-id="6714f-139">Expanda um Grupo do publicador no painel esquerdo, expanda um Publicador e clique em uma publicação.</span><span class="sxs-lookup"><span data-stu-id="6714f-139">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="6714f-140">Clique na guia **Tokens de Rastreamento** .</span><span class="sxs-lookup"><span data-stu-id="6714f-140">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="6714f-141">Clique em **Inserir Rastreador**.</span><span class="sxs-lookup"><span data-stu-id="6714f-141">Click **Insert Tracer**.</span></span>  
  
4.  <span data-ttu-id="6714f-142">Exiba o tempo decorrido para o token de rastreamento nas seguintes colunas: **Publicador para Distribuidor**, **Distribuidor para Assinante**, **Latência Total**.</span><span class="sxs-lookup"><span data-stu-id="6714f-142">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="6714f-143">Um valor **pendente** indica que o token não atingiu um determinado ponto.</span><span class="sxs-lookup"><span data-stu-id="6714f-143">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
#### <a name="to-view-information-on-a-tracer-token-inserted-previously"></a><span data-ttu-id="6714f-144">Para exibir informações sobre um token de rastreamento previamente inserido</span><span class="sxs-lookup"><span data-stu-id="6714f-144">To view information on a tracer token inserted previously</span></span>  
  
1.  <span data-ttu-id="6714f-145">Expanda um Grupo do publicador no painel esquerdo, expanda um Publicador e clique em uma publicação.</span><span class="sxs-lookup"><span data-stu-id="6714f-145">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="6714f-146">Clique na guia **Tokens de Rastreamento** .</span><span class="sxs-lookup"><span data-stu-id="6714f-146">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="6714f-147">Selecione uma opção de tempo na lista suspensa **Tempo inserido** .</span><span class="sxs-lookup"><span data-stu-id="6714f-147">Select a time from the **Time inserted** drop-down list.</span></span>  
  
4.  <span data-ttu-id="6714f-148">Exiba o tempo decorrido para o token de rastreamento nas seguintes colunas: **Publicador para Distribuidor**, **Distribuidor para Assinante**, **Latência Total**.</span><span class="sxs-lookup"><span data-stu-id="6714f-148">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="6714f-149">Um valor **pendente** indica que o token não atingiu um determinado ponto.</span><span class="sxs-lookup"><span data-stu-id="6714f-149">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="6714f-150">Informações de token de rastreamento são retidas para o mesmo período de tempo que outros dados históricos, os quais são governados pelo período de retenção de histórico do banco de dados de distribuição.</span><span class="sxs-lookup"><span data-stu-id="6714f-150">Tracer token information is retained for the same time period as other historical data, which is governed by the history retention period of the distribution database.</span></span> <span data-ttu-id="6714f-151">Para obter informações sobre como alterar as propriedades do banco de dados de distribuição, consulte [Exibir e modificar as propriedades do Distribuidor e do Publicador](../view-and-modify-distributor-and-publisher-properties.md).</span><span class="sxs-lookup"><span data-stu-id="6714f-151">For information about changing distribution database properties, see [View and Modify Distributor and Publisher Properties](../view-and-modify-distributor-and-publisher-properties.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="6714f-152">Usando o Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="6714f-152">Using Transact-SQL</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="6714f-153">Para publicar um token de rastreamento em uma publicação transacional</span><span class="sxs-lookup"><span data-stu-id="6714f-153">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="6714f-154">(Opcional) No Publicador do banco de dados de publicação, execute [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6714f-154">(Optional) At the Publisher on the publication database, execute [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span> <span data-ttu-id="6714f-155">Verifique se a publicação existe e se o status é ativo.</span><span class="sxs-lookup"><span data-stu-id="6714f-155">Verify that the publication exists and that the status is active.</span></span>  
  
2.  <span data-ttu-id="6714f-156">(Opcional) No Publicador do banco de dados de publicação, execute [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6714f-156">(Optional) At the Publisher on the publication database, execute [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span></span> <span data-ttu-id="6714f-157">Verifique se a assinatura existe e se o status é ativo.</span><span class="sxs-lookup"><span data-stu-id="6714f-157">Verify that the subscription exists and that the status is active.</span></span>  
  
3.  <span data-ttu-id="6714f-158">No Publicador do banco de dados de publicação, execute [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), especificando **@publication**.</span><span class="sxs-lookup"><span data-stu-id="6714f-158">At the Publisher on the publication database, execute [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="6714f-159">Observe o valor do **@tracer_token_id** parâmetro de saída.</span><span class="sxs-lookup"><span data-stu-id="6714f-159">Note the value of the **@tracer_token_id** output parameter.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="6714f-160">Para determinar a latência e validar as conexões para uma publicação transacional</span><span class="sxs-lookup"><span data-stu-id="6714f-160">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="6714f-161">Publique um token de rastreamento na publicação usando o procedimento anterior.</span><span class="sxs-lookup"><span data-stu-id="6714f-161">Post a tracer token to the publication using the previous procedure.</span></span>  
  
2.  <span data-ttu-id="6714f-162">No Publicador do banco de dados de publicação, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), especificando **@publication**.</span><span class="sxs-lookup"><span data-stu-id="6714f-162">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="6714f-163">Isso retorna uma lista de todos os tokens de rastreamento publicados na publicação.</span><span class="sxs-lookup"><span data-stu-id="6714f-163">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="6714f-164">Observe o **tracer_id** desejado no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="6714f-164">Note the desired **tracer_id** in the result set.</span></span>  
  
3.  <span data-ttu-id="6714f-165">No Publicador do banco de dados de publicação, execute [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), especificando **@publication** e a ID do token de rastreamento da etapa 2 para **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="6714f-165">At the Publisher on the publication database, execute [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), specifying **@publication** and the tracer token ID from step 2 for **@tracer_id**.</span></span> <span data-ttu-id="6714f-166">Isso retorna informações de latência para o token de rastreamento selecionado.</span><span class="sxs-lookup"><span data-stu-id="6714f-166">This returns latency information for the selected tracer token.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="6714f-167">Para remover tokens de rastreamento</span><span class="sxs-lookup"><span data-stu-id="6714f-167">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="6714f-168">No Publicador do banco de dados de publicação, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), especificando **@publication**.</span><span class="sxs-lookup"><span data-stu-id="6714f-168">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="6714f-169">Isso retorna uma lista de todos os tokens de rastreamento publicados na publicação.</span><span class="sxs-lookup"><span data-stu-id="6714f-169">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="6714f-170">Observe o **tracer_id** a ser excluído pelo token de rastreamento no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="6714f-170">Note the **tracer_id** for the tracer token to delete in the result set.</span></span>  
  
2.  <span data-ttu-id="6714f-171">No Publicador do banco de dados de publicação, execute [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), especificando **@publication** e a ID de rastreamento a ser excluída da etapa 2 para **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="6714f-171">At the Publisher on the publication database, execute [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), specifying **@publication** and the ID of the tracer to delete from step 2 for **@tracer_id**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="6714f-172">Exemplo (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="6714f-172">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="6714f-173">Esse exemplo publica um registro dos tokens de rastreamento, e usa o ID retornado do token de rastreamento publicado, para exibir as informações da latência.</span><span class="sxs-lookup"><span data-stu-id="6714f-173">This example posts a tracer token record and uses the returned ID of the posted tracer token to view latency information.</span></span>  
  
 [!code-sql[HowTo#sp_tracertokens](../../../snippets/tsql/SQL15/replication/howto/tsql/createtracertokens.sql#sp_tracertokens)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="6714f-174">Usando o RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="6714f-174">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="6714f-175">Para publicar um token de rastreamento em uma publicação transacional</span><span class="sxs-lookup"><span data-stu-id="6714f-175">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="6714f-176">Crie uma conexão com o Publicador usando a classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="6714f-176">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="6714f-177">Criar uma instância da classe <xref:Microsoft.SqlServer.Replication.TransPublication>.</span><span class="sxs-lookup"><span data-stu-id="6714f-177">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span>  
  
3.  <span data-ttu-id="6714f-178">Defina as propriedades <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> e <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> para a publicação, e a propriedade <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> para a conexão criada na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="6714f-178">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="6714f-179">Chame o método <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> para obter as propriedades do objeto.</span><span class="sxs-lookup"><span data-stu-id="6714f-179">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="6714f-180">Se esse método retornar `false`, as propriedades de publicação na etapa 3 foram definidas incorretamente ou a publicação não existe.</span><span class="sxs-lookup"><span data-stu-id="6714f-180">If this method returns `false`, either the publication properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="6714f-181">Chame o método <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> .</span><span class="sxs-lookup"><span data-stu-id="6714f-181">Call the <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> method.</span></span> <span data-ttu-id="6714f-182">Esse método insere um token de rastreamento no log de transações da publicação.</span><span class="sxs-lookup"><span data-stu-id="6714f-182">This method inserts a tracer token into the publication's transaction log.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="6714f-183">Para determinar a latência e validar as conexões para uma publicação transacional</span><span class="sxs-lookup"><span data-stu-id="6714f-183">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="6714f-184">Crie uma conexão com o Distribuidor usando a classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="6714f-184">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="6714f-185">Criar uma instância da classe <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="6714f-185">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="6714f-186">Defina as propriedades <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>e <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> ; e, defina a propriedade <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> para a conexão criada na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="6714f-186">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="6714f-187">Chame o método <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> para obter as propriedades do objeto.</span><span class="sxs-lookup"><span data-stu-id="6714f-187">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="6714f-188">Se esse método retornar `false`, as propriedades do monitor da publicação na etapa 3 foram definidas incorretamente ou a publicação não existe.</span><span class="sxs-lookup"><span data-stu-id="6714f-188">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="6714f-189">Chame o método <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="6714f-189">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="6714f-190">Converta o objeto <xref:System.Collections.ArrayList> retornado em uma matriz de objetos <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="6714f-190">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="6714f-191">Chame o método <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="6714f-191">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="6714f-192">Passe um valor de <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> para um token de rastreamento da etapa 5.</span><span class="sxs-lookup"><span data-stu-id="6714f-192">Pass a value of <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="6714f-193">Isso retorna as informações da latência para o token de rastreamento selecionado como um objeto <xref:System.Data.DataSet> .</span><span class="sxs-lookup"><span data-stu-id="6714f-193">This returns latency information for the selected tracer token as a <xref:System.Data.DataSet> object.</span></span> <span data-ttu-id="6714f-194">Se todas as informações do token de rastreamento forem retornadas, a conexão entre o Publicador e o Distribuidor e a conexão entre o Distribuidor e o Assinante serão efetivas e a topologia de replicação estará funcionando.</span><span class="sxs-lookup"><span data-stu-id="6714f-194">If all tracer token information is returned, the connection between the Publisher and Distributor and the connection between the Distributor and the Subscriber both exist and the replication topology is functioning.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="6714f-195">Para remover tokens de rastreamento</span><span class="sxs-lookup"><span data-stu-id="6714f-195">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="6714f-196">Crie uma conexão com o Distribuidor usando a classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="6714f-196">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="6714f-197">Criar uma instância da classe <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="6714f-197">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="6714f-198">Defina as propriedades <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>e <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> ; e, defina a propriedade <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> para a conexão criada na etapa 1.</span><span class="sxs-lookup"><span data-stu-id="6714f-198">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="6714f-199">Chame o método <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> para obter as propriedades do objeto.</span><span class="sxs-lookup"><span data-stu-id="6714f-199">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="6714f-200">Se esse método retornar `false`, as propriedades do monitor da publicação na etapa 3 foram definidas incorretamente ou a publicação não existe.</span><span class="sxs-lookup"><span data-stu-id="6714f-200">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="6714f-201">Chame o método <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="6714f-201">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="6714f-202">Converta o objeto <xref:System.Collections.ArrayList> retornado em uma matriz de objetos <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="6714f-202">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="6714f-203">Chame o método <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="6714f-203">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="6714f-204">Passe um dos seguintes valores:</span><span class="sxs-lookup"><span data-stu-id="6714f-204">Pass one of the following values:</span></span>  
  
    -   <span data-ttu-id="6714f-205">O <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> para um token de rastreamento da etapa 5.</span><span class="sxs-lookup"><span data-stu-id="6714f-205">The <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="6714f-206">Isso exclui as informações para um token selecionado.</span><span class="sxs-lookup"><span data-stu-id="6714f-206">This deletes information for a selected token.</span></span>  
  
    -   <span data-ttu-id="6714f-207">Um objeto <xref:System.DateTime>.</span><span class="sxs-lookup"><span data-stu-id="6714f-207">A <xref:System.DateTime> object.</span></span> <span data-ttu-id="6714f-208">Isso exclui as informações de todos os tokens anteriores à data e hora especificadas.</span><span class="sxs-lookup"><span data-stu-id="6714f-208">This deletes information for all tokens older than the specified date and time.</span></span>  
  
###  <a name="PShellExample"></a>  
