---
title: Replicar colunas de identidade | Microsoft Docs
ms.custom: ''
ms.date: 10/04/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- identities [SQL Server replication]
- identity values [SQL Server replication]
- merge replication [SQL Server replication], identity range management
- publishing [SQL Server replication], identity columns
- transactional replication, identity range management
- identity columns [SQL Server], replication
ms.assetid: eb2f23a8-7ec2-48af-9361-0e3cb87ebaf7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c899d902e403e9f7cdbdfd1a83cde110e627ab11
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570603"
---
# <a name="replicate-identity-columns"></a><span data-ttu-id="a4131-102">Replicar colunas de identidade</span><span class="sxs-lookup"><span data-stu-id="a4131-102">Replicate Identity Columns</span></span>
  <span data-ttu-id="a4131-103">Quando se atribui uma propriedade IDENTITY a uma coluna, o [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] gera automaticamente números sequenciais para novas linhas inseridas na tabela que contém a coluna de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-103">When you assign an IDENTITY property to a column, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] automatically generates sequential numbers for new rows inserted in the table containing the identity column.</span></span> <span data-ttu-id="a4131-104">Para obter mais informações, consulte [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span><span class="sxs-lookup"><span data-stu-id="a4131-104">For more information, see [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span></span> <span data-ttu-id="a4131-105">Como as colunas de identidade podem ser incluídas como parte da chave primária, é importante evitar valores duplicados nas colunas de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-105">Because identity columns might be included as a part of the primary key, it is important to avoid duplicate values in the identity columns.</span></span> <span data-ttu-id="a4131-106">Para que colunas de identidade sejam usadas em uma topologia de replicação que tenha atualizações em mais de um nó, cada nó da topologia de replicação precisará usar um intervalo diferente de valores de identidade, de modo que não ocorram duplicatas.</span><span class="sxs-lookup"><span data-stu-id="a4131-106">To use identity columns in a replication topology that has updates at more than one node, each node in the replication topology must use a different range of identity values, so that duplicates do not occur.</span></span>  
  
 <span data-ttu-id="a4131-107">Por exemplo, o intervalo de 1 a 100 poderia ser atribuído ao Publicador; o intervalo de 101 a 200 ao Assinante A e o intervalo de 201 a 300 ao Assinante B.</span><span class="sxs-lookup"><span data-stu-id="a4131-107">For example, the Publisher could be assigned the range 1-100, Subscriber A the range 101-200, and Subscriber B the range 201-300.</span></span> <span data-ttu-id="a4131-108">Se uma linha for inserida no Publicador e o valor de identidade for, por exemplo, 65, esse valor será replicado para cada Assinante.</span><span class="sxs-lookup"><span data-stu-id="a4131-108">If a row is inserted at the Publisher and the identity value is, for example, 65, that value is replicated to each Subscriber.</span></span> <span data-ttu-id="a4131-109">Quando a replicação insere dados em cada Assinante, isso não incrementa o valor da coluna de identidade na tabela Assinante. Em vez disso, o valor literal 65 é inserido.</span><span class="sxs-lookup"><span data-stu-id="a4131-109">When replication inserts data at each Subscriber, it does not increment the identity column value in the Subscriber table; instead, the literal value 65 is inserted.</span></span> <span data-ttu-id="a4131-110">Somente as inserções do usuário, não as inserções do agente de replicação, causam o incremento da coluna de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-110">Only user inserts, but not replication agent inserts cause the identity column value to be incremented.</span></span>  
  
 <span data-ttu-id="a4131-111">A replicação trata colunas de identidade em todos os tipos de publicação e assinatura, o que permite gerenciar as colunas manualmente ou fazer com que a replicação as gerencie de forma automática.</span><span class="sxs-lookup"><span data-stu-id="a4131-111">Replication handles identity columns across all publication and subscription types, allowing you to manage the columns manually or have replication manage them automatically.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a4131-112">Não há suporte para adicionar uma coluna de identidade a uma tabela publicada, pois isso pode resultar em não convergência quando a coluna é replicada no Assinante.</span><span class="sxs-lookup"><span data-stu-id="a4131-112">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="a4131-113">Os valores na coluna de identidade no Publicador dependerão da ordem em que as linhas para a tabela afetada forem armazenadas fisicamente.</span><span class="sxs-lookup"><span data-stu-id="a4131-113">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="a4131-114">As linhas podem ser armazenadas de forma diversa no Assinante; assim, o valor da coluna de identidade pode ser diferente para as mesmas linhas.</span><span class="sxs-lookup"><span data-stu-id="a4131-114">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
## <a name="specifying-an-identity-range-management-option"></a><span data-ttu-id="a4131-115">Especificando uma opção de gerenciamento de intervalo de identidade</span><span class="sxs-lookup"><span data-stu-id="a4131-115">Specifying an Identity Range Management Option</span></span>  
 <span data-ttu-id="a4131-116">A replicação oferece três opções de gerenciamento de intervalo de identidade:</span><span class="sxs-lookup"><span data-stu-id="a4131-116">Replication offers three identity range management options:</span></span>  
  
-   <span data-ttu-id="a4131-117">Automático.</span><span class="sxs-lookup"><span data-stu-id="a4131-117">Automatic.</span></span> <span data-ttu-id="a4131-118">Usado para replicação de mesclagem e replicação transacional com atualizações do Assinante.</span><span class="sxs-lookup"><span data-stu-id="a4131-118">Used for merge replication and transactional replication with updates at the Subscriber.</span></span> <span data-ttu-id="a4131-119">Especifique os intervalos de tamanho para o Publicador e para os Assinantes, e a replicação gerenciará automaticamente a atribuição de novos intervalos.</span><span class="sxs-lookup"><span data-stu-id="a4131-119">Specify size ranges for the Publisher and Subscribers, and replication automatically manages the assignment of new ranges.</span></span> <span data-ttu-id="a4131-120">A replicação define a opção NOT FOR REPLICATION na coluna de identidade do Assinante, de modo que somente as inserções do usuário geram o valor a ser incrementado no Assinante.</span><span class="sxs-lookup"><span data-stu-id="a4131-120">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber, so that only user inserts cause the value to be incremented at the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a4131-121">Para que novos intervalos sejam recebidos é preciso que haja sincronização entre os Assinantes e o Publicador.</span><span class="sxs-lookup"><span data-stu-id="a4131-121">Subscribers must synchronize with the Publisher to receive new ranges.</span></span> <span data-ttu-id="a4131-122">Como os intervalos de identidade são atribuídos automaticamente aos Assinantes, é possível que qualquer Assinante esgote todo o fornecimento de intervalos de identidade quando novos intervalos são solicitados repetidamente.</span><span class="sxs-lookup"><span data-stu-id="a4131-122">Because Subscribers are assigned identity ranges automatically, it is possible for any Subscriber to exhaust the entire supply of identity ranges if it repeatedly requests new ranges.</span></span>  
  
-   <span data-ttu-id="a4131-123">Manual.</span><span class="sxs-lookup"><span data-stu-id="a4131-123">Manual.</span></span> <span data-ttu-id="a4131-124">Usado para replicação de instantâneo e transacional sem atualizações no Assinante, replicação transacional ponto a ponto ou quando é necessário que o aplicativo controle de forma programática os intervalos de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-124">Used for snapshot and transactional replication without updates at the Subscriber, peer-to-peer transactional replication, or if your application must control identity ranges programmatically.</span></span> <span data-ttu-id="a4131-125">Se o gerenciamento manual for especificado, será preciso assegurar que intervalos sejam atribuídos ao Publicador e a cada Assinante e que novos intervalos sejam atribuídos, caso os intervalos iniciais sejam utilizados.</span><span class="sxs-lookup"><span data-stu-id="a4131-125">If you specify manual management, you must ensure that ranges are assigned to the Publisher and each Subscriber and that new ranges are assigned if the initial ranges are used.</span></span> <span data-ttu-id="a4131-126">A replicação define a opção NOT FOR REPLICATION na coluna de identidade do Assinante.</span><span class="sxs-lookup"><span data-stu-id="a4131-126">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber.</span></span>  
  
-   <span data-ttu-id="a4131-127">Nenhum.</span><span class="sxs-lookup"><span data-stu-id="a4131-127">None.</span></span> <span data-ttu-id="a4131-128">Essa opção é recomendada apenas para compatibilidade com versões anteriores do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , sendo disponibilizada apenas na interface do procedimento armazenado para as publicações transacionais.</span><span class="sxs-lookup"><span data-stu-id="a4131-128">This option is recommended only for backwards compatibility with earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and is available only from the stored procedure interface for transactional publications.</span></span>  
  
 <span data-ttu-id="a4131-129">Para especificar uma opção de gerenciamento de intervalos de identidade, consulte [Gerenciar colunas de identidade](manage-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="a4131-129">To specify an identity range management option, see [Manage Identity Columns](manage-identity-columns.md).</span></span>  
  
## <a name="assigning-identity-ranges"></a><span data-ttu-id="a4131-130">Atribuindo intervalos de identidade</span><span class="sxs-lookup"><span data-stu-id="a4131-130">Assigning Identity Ranges</span></span>  
 <span data-ttu-id="a4131-131">A replicação de mesclagem e a replicação transacional usam diferentes métodos para a atribuição de intervalos. Esses métodos são descritos nesta seção.</span><span class="sxs-lookup"><span data-stu-id="a4131-131">Merge replication and transactional replication use different methods for assigning ranges; these methods are described in this section.</span></span>  
  
 <span data-ttu-id="a4131-132">Há dois tipos de intervalos a serem considerados quando se replicam colunas de identidade: os intervalos atribuídos ao Publicador e Assinantes, e o intervalo do tipo de dados na coluna.</span><span class="sxs-lookup"><span data-stu-id="a4131-132">There are two types of ranges to take into account when replicating identity columns: the ranges assigned to the Publisher and Subscribers, and the range of the data type in the column.</span></span> <span data-ttu-id="a4131-133">A tabela a seguir mostra os intervalos disponíveis para os tipos de dados usados normalmente em colunas de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-133">The following table shows the ranges available for the data types typically used in identity columns.</span></span> <span data-ttu-id="a4131-134">O intervalo é usado em todos os nós de uma topologia.</span><span class="sxs-lookup"><span data-stu-id="a4131-134">The range is used across all nodes in a topology.</span></span> <span data-ttu-id="a4131-135">Por exemplo, se você usar `smallint` a partir de 1 com um incremento de 1, o número máximo de inserções será 32.767 para o Publicador e todos os assinantes.</span><span class="sxs-lookup"><span data-stu-id="a4131-135">For example, if you use `smallint` starting at 1 with an increment of 1, the maximum number of inserts is 32,767 for the Publisher and all Subscribers.</span></span> <span data-ttu-id="a4131-136">O número real de inserções depende da existência de lacunas nos valores usados e da utilização de um valor limite.</span><span class="sxs-lookup"><span data-stu-id="a4131-136">The actual number of inserts depends on whether there are gaps in the values used and whether a threshold value is used.</span></span> <span data-ttu-id="a4131-137">Para obter mais informações sobre limites, consulte as seções a seguir, "Replicação de mesclagem" e "Replicação transacional com assinaturas de atualização enfileirada".</span><span class="sxs-lookup"><span data-stu-id="a4131-137">For more information about thresholds, see the following sections "Merge Replication" and "Transactional Replication with Queued Updating Subscriptions".</span></span>  
  
 <span data-ttu-id="a4131-138">Se o Publicador esgotar seu intervalo de identidade após uma inserção, ele poderá atribuir um novo intervalo se a inserção tiver sido realizada por um membro de uma função de banco de dados fixa **db_owner** .</span><span class="sxs-lookup"><span data-stu-id="a4131-138">If the Publisher exhausts its identity range after an insert, it can automatically assign a new range if the insert was performed by a member of the **db_owner** fixed database role.</span></span> <span data-ttu-id="a4131-139">Se a inserção tiver sido realizada por um usuário que não estava nessa função, o Agente de Leitor de Log, o Agente de Mesclagem ou um usuário que é membro da função **db_owner** deverá executar [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a4131-139">If the insert was performed by a user not in that role, the Log Reader Agent, Merge Agent, or a user who is a member of the **db_owner** role must run [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span></span> <span data-ttu-id="a4131-140">Para publicações transacionais, o Agente de Leitor de Log deverá estar em execução para alocar automaticamente um novo intervalo (o padrão é que o agente seja executado continuamente).</span><span class="sxs-lookup"><span data-stu-id="a4131-140">For transactional publications, the Log Reader Agent must be running to automatically allocate a new range (the default is for the agent to run continuously).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="a4131-141">Durante uma inserção de lote grande, o gatilho de replicação é disparado apenas uma vez, e não para cada linha da inserção.</span><span class="sxs-lookup"><span data-stu-id="a4131-141">During a large batch insert the replication trigger is fired only once, not for each row of the insert.</span></span> <span data-ttu-id="a4131-142">Isso pode resultar em falha na instrução de inserção se um intervalo de identidade for esgotado durante uma inserção grande, como a instrução `INSERT INTO`.</span><span class="sxs-lookup"><span data-stu-id="a4131-142">This can lead to a failure of the insert statement if an identity range is exhausted during an large insert, such as an `INSERT INTO` statement.</span></span>  
  
|<span data-ttu-id="a4131-143">Tipo de dados</span><span class="sxs-lookup"><span data-stu-id="a4131-143">Data type</span></span>|<span data-ttu-id="a4131-144">Intervalo</span><span class="sxs-lookup"><span data-stu-id="a4131-144">Range</span></span>|  
|---------------|-----------|  
|`tinyint`|<span data-ttu-id="a4131-145">Não tem suporte para gerenciamento automático</span><span class="sxs-lookup"><span data-stu-id="a4131-145">Not supported for automatic management</span></span>|  
|`smallint`|<span data-ttu-id="a4131-146">-2^15 (-32.768) a 2^15-1 (32.767)</span><span class="sxs-lookup"><span data-stu-id="a4131-146">-2^15 (-32,768) to 2^15-1 (32,767)</span></span>|  
|`int`|<span data-ttu-id="a4131-147">-2^31 (-2.147.483.648) a 2^31-1 (2.147.483.647)</span><span class="sxs-lookup"><span data-stu-id="a4131-147">-2^31 (-2,147,483,648) to 2^31-1 (2,147,483,647)</span></span>|  
|`bigint`|<span data-ttu-id="a4131-148">-2^63 (-9.223.372.036.854.775.808) a 2^63-1 (9.223.372.036.854.775.807)</span><span class="sxs-lookup"><span data-stu-id="a4131-148">-2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)</span></span>|  
|<span data-ttu-id="a4131-149">`decimal` e `numeric`</span><span class="sxs-lookup"><span data-stu-id="a4131-149">`decimal` and `numeric`</span></span>|<span data-ttu-id="a4131-150">-10^38+1 até 10^38-1</span><span class="sxs-lookup"><span data-stu-id="a4131-150">-10^38+1 through 10^38-1</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="a4131-151">Para criar um número incrementado automaticamente, que possa ser usado em várias tabelas ou ser chamado de aplicativos, sem referenciar tabelas, consulte [Números de Sequência](../../sequence-numbers/sequence-numbers.md).</span><span class="sxs-lookup"><span data-stu-id="a4131-151">To create an automatically incrementing number that can be used in multiple tables or that can be called from applications without referencing any table, see [Sequence Numbers](../../sequence-numbers/sequence-numbers.md).</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="a4131-152">Replicação de mesclagem</span><span class="sxs-lookup"><span data-stu-id="a4131-152">Merge Replication</span></span>  
 <span data-ttu-id="a4131-153">Os intervalos de identidade são gerenciados pelo Publicador e propagados para os Assinantes pelo Merge Agent (em uma hierarquia de republicação, os intervalos são gerenciados pelo Publicador raiz e pelos republicadores).</span><span class="sxs-lookup"><span data-stu-id="a4131-153">Identity ranges are managed by the Publisher and propagated to Subscribers by the Merge Agent (in a republishing hierarchy, ranges are managed by the root Publisher and the republishers).</span></span> <span data-ttu-id="a4131-154">Os valores de identidade são atribuídos em um pool do Publicador.</span><span class="sxs-lookup"><span data-stu-id="a4131-154">The identity values are assigned from a pool at the Publisher.</span></span> <span data-ttu-id="a4131-155">Ao adicionar um artigo com uma coluna de identidade a uma publicação no Assistente para Nova Publicação ou ao usar [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), especifique valores para:</span><span class="sxs-lookup"><span data-stu-id="a4131-155">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="a4131-156">O parâmetro \*\* \@ identity_range\*\* , que controla o tamanho do intervalo de identidade inicialmente alocado para o Publicador e para assinantes com assinaturas de cliente.</span><span class="sxs-lookup"><span data-stu-id="a4131-156">The **\@identity_range** parameter, which controls the identity range size initially allocated both to the Publisher and to Subscribers with client subscriptions.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a4131-157">Para assinantes que executam versões anteriores do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , esse parâmetro (em vez do parâmetro \*\* \@ pub_identity_range\*\* ) também controla o tamanho do intervalo de identidade em assinantes de republicação.</span><span class="sxs-lookup"><span data-stu-id="a4131-157">For Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], this parameter (rather than the **\@pub_identity_range** parameter) also controls the identity range size at republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="a4131-158">O parâmetro \*\* \@ pub_identity_range\*\* , que controla o tamanho do intervalo de identidade para republicação alocada para assinantes com assinaturas de servidor (necessárias para republicação de dados).</span><span class="sxs-lookup"><span data-stu-id="a4131-158">The **\@pub_identity_range** parameter, which controls the identity range size for republishing allocated to Subscribers with server subscriptions (required for republishing data).</span></span> <span data-ttu-id="a4131-159">Todos os Assinantes com assinaturas de servidor recebem um intervalo para republicar, mesmo se eles de fato não republiquem dados.</span><span class="sxs-lookup"><span data-stu-id="a4131-159">All Subscribers with server subscriptions receive a range for republishing, even if they don't actually republish data.</span></span>  
  
-   <span data-ttu-id="a4131-160">O parâmetro \*\* \@ Threshold\*\* , que é usado para determinar quando um novo intervalo de identidades é necessário para uma assinatura [!INCLUDE[ssEW](../../../includes/ssew-md.md)] do ou para uma versão anterior do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="a4131-160">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription to [!INCLUDE[ssEW](../../../includes/ssew-md.md)] or a previous version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="a4131-161">Por exemplo, você pode especificar 10000 para \*\* \@ identity_range\*\* e 500000 para \*\* \@ pub_identity_range\*\*.</span><span class="sxs-lookup"><span data-stu-id="a4131-161">For example, you could specify 10000 for **\@identity_range** and 500000 for **\@pub_identity_range**.</span></span> <span data-ttu-id="a4131-162">Um intervalo primário de 10.000 é atribuído ao Publicador e a todos os Assinantes que executam o [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou uma versão posterior, inclusive ao Assinante com a assinatura do servidor.</span><span class="sxs-lookup"><span data-stu-id="a4131-162">The Publisher and all Subscribers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version, including the Subscriber with the server subscription, are assigned a primary range of 10000.</span></span> <span data-ttu-id="a4131-163">O Assinante com a assinatura do servidor também é atribuído a um intervalo primário de 500000, que pode ser usado por assinantes que sincronizam com o Assinante de republicação (você também deve especificar \*\* \@ identity_range**, \*\* \@ pub_identity_range**e \*\* \@ limite\*\* para os artigos na publicação no Assinante de republicação).</span><span class="sxs-lookup"><span data-stu-id="a4131-163">The Subscriber with the server subscription is also assigned a primary range of 500000, which can be used by Subscribers that synchronize with the republishing Subscriber (you must also specify **\@identity_range**, **\@pub_identity_range**, and **\@threshold** for the articles in the publication at the republishing Subscriber).</span></span>  
  
 <span data-ttu-id="a4131-164">Todo Assinante que executa o [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou uma versão posterior também recebe um intervalo de identidade secundário.</span><span class="sxs-lookup"><span data-stu-id="a4131-164">Each Subscriber running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version also receives a secondary identity range.</span></span> <span data-ttu-id="a4131-165">O intervalo secundário é igual em tamanho ao intervalo primário. Quando o intervalo primário se esgota, o intervalo secundário é usado, e o Merge Agent atribui um novo intervalo ao Assinante.</span><span class="sxs-lookup"><span data-stu-id="a4131-165">The secondary range is equal in size to the primary range; when the primary range is exhausted, the secondary range is used, and the Merge Agent assigns a new range to the Subscriber.</span></span> <span data-ttu-id="a4131-166">O novo intervalo passa a ser o intervalo secundário, e o processo continua à medida que o Assinante utiliza valores de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-166">The new range becomes the secondary range, and the process continues as the Subscriber uses identity values.</span></span>  
  
  
### <a name="transactional-replication-with-queued-updating-subscriptions"></a><span data-ttu-id="a4131-167">Replicação transacional com assinaturas de atualização enfileirada</span><span class="sxs-lookup"><span data-stu-id="a4131-167">Transactional Replication with Queued Updating Subscriptions</span></span>  
 <span data-ttu-id="a4131-168">Os intervalos de identidade são gerenciados pelo Distribuidor e propagados para os Assinantes pelo Distribution Agent.</span><span class="sxs-lookup"><span data-stu-id="a4131-168">Identity ranges are managed by the Distributor and propagated to Subscribers by the Distribution Agent.</span></span> <span data-ttu-id="a4131-169">Os valores de identidade são atribuídos em um pool do Distribuidor.</span><span class="sxs-lookup"><span data-stu-id="a4131-169">The identity values are assigned from a pool at the Distributor.</span></span> <span data-ttu-id="a4131-170">O tamanho do pool baseia-se no tamanho dos tipos de dados e no incremento usado para a coluna de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-170">The pool size is based on the size of the data type and the increment used for the identity column.</span></span> <span data-ttu-id="a4131-171">Ao adicionar um artigo com uma coluna de identidade a uma publicação no Assistente para Nova Publicação ou ao usar [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), especifique valores para:</span><span class="sxs-lookup"><span data-stu-id="a4131-171">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="a4131-172">O parâmetro \*\* \@ identity_range\*\* , que controla o tamanho do intervalo de identidade inicialmente alocado para todos os assinantes.</span><span class="sxs-lookup"><span data-stu-id="a4131-172">The **\@identity_range** parameter, which controls the identity range size initially allocated to all Subscribers.</span></span>  
  
-   <span data-ttu-id="a4131-173">O parâmetro \*\* \@ pub_identity_range\*\* , que controla o tamanho do intervalo de identidade alocado para o Publicador.</span><span class="sxs-lookup"><span data-stu-id="a4131-173">The **\@pub_identity_range** parameter, which controls the identity range size allocated to the Publisher.</span></span>  
  
-   <span data-ttu-id="a4131-174">O parâmetro \*\* \@ Threshold\*\* , que é usado para determinar quando um novo intervalo de identidades é necessário para uma assinatura.</span><span class="sxs-lookup"><span data-stu-id="a4131-174">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription.</span></span>  
  
 <span data-ttu-id="a4131-175">Por exemplo, você pode especificar 10000 para \*\* \@ pub_identity_range**, 1000 para \*\* \@ identity_range** (supondo menos atualizações no Assinante) e 80% para o \*\* \@ limite\*\*.</span><span class="sxs-lookup"><span data-stu-id="a4131-175">For example, you could specify 10000 for **\@pub_identity_range**, 1000 for **\@identity_range** (assuming fewer updates at the Subscriber), and 80 percent for **\@threshold**.</span></span> <span data-ttu-id="a4131-176">Após 800 inserções em um Assinante (80 por cento de 1.000), um Assinante é atribuído a um novo intervalo.</span><span class="sxs-lookup"><span data-stu-id="a4131-176">After 800 inserts at a Subscriber (80 percent of 1000), a Subscriber is assigned a new range.</span></span> <span data-ttu-id="a4131-177">Depois de 8.000 inserções em um Publicador, um novo intervalo é atribuído ao Publicador.</span><span class="sxs-lookup"><span data-stu-id="a4131-177">After 8000 inserts at the Publisher, the Publisher is assigned a new range.</span></span> <span data-ttu-id="a4131-178">Quando o novo intervalo é atribuído, há uma lacuna nos valores de intervalo de identidade da tabela.</span><span class="sxs-lookup"><span data-stu-id="a4131-178">When a new range is assigned, there will be a gap in the identity range values in the table.</span></span> <span data-ttu-id="a4131-179">Especificar um limite superior resulta em lacunas menores, mas o sistema torna-se menos tolerante a falhas. Se o Merge Agent não puder ser executado por algum motivo, um Assinante poderá ficar mais facilmente sem identidades.</span><span class="sxs-lookup"><span data-stu-id="a4131-179">Specifying a higher threshold results in smaller gaps, but the system is less fault-tolerant: if the Distribution Agent cannot run for some reason, a Subscriber could more easily run out of identities.</span></span>  
  
## <a name="assigning-ranges-for-manual-identity-range-management"></a><span data-ttu-id="a4131-180">Atribuindo intervalos para o gerenciamento manual de intervalo de identidade</span><span class="sxs-lookup"><span data-stu-id="a4131-180">Assigning ranges for manual identity range management</span></span>  
 <span data-ttu-id="a4131-181">Caso o gerenciamento manual de identidade seja especificado, será preciso assegurar que o Publicador e cada um dos Assinantes usem intervalos de identidade diferentes.</span><span class="sxs-lookup"><span data-stu-id="a4131-181">If you specify manual identity range management, you must ensure that the Publisher and each Subscriber use different identity ranges.</span></span> <span data-ttu-id="a4131-182">Por exemplo, considere uma tabela do Publicador com coluna de identidade definida como `IDENTITY(1,1)`: a coluna de identidade começa com 1 e é incrementada em 1 toda vez que uma linha é inserida.</span><span class="sxs-lookup"><span data-stu-id="a4131-182">For example, consider a table at the Publisher with an identity column defined as `IDENTITY(1,1)`: the identity column starts at 1 and is incremented by 1 each time a row is inserted.</span></span> <span data-ttu-id="a4131-183">Se a tabela do Publicador tiver 5.000 linhas, e houver expectativa de algum aumento da tabela durante a vida útil do aplicativo, o Publicador poderá usar o intervalo de 1 a 10.000.</span><span class="sxs-lookup"><span data-stu-id="a4131-183">If the table at the Publisher has 5,000 rows, and you expect some growth in the table over the life of the application, the Publisher could use the range 1-10,000.</span></span> <span data-ttu-id="a4131-184">Considerando-se dois Assinantes, o Assinante A poderá usar de 10.001 a 20.000 e o Assinante B poderá usar de 20.001 a 30.000.</span><span class="sxs-lookup"><span data-stu-id="a4131-184">Given two Subscribers, Subscriber A could use 10,001-20,000, and Subscriber B could use 20,001-30,000.</span></span>  
  
 <span data-ttu-id="a4131-185">Após o Assinante ser iniciado com um instantâneo ou por outros meios, execute DBCC CHECKIDENT para atribuir ao Assinante um ponto inicial para o seu intervalo de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-185">After a Subscriber is initialized with a snapshot or through another means, execute DBCC CHECKIDENT to assign the Subscriber a starting point for its identity range.</span></span> <span data-ttu-id="a4131-186">Por exemplo, no Assinante A, `DBCC CHECKIDENT('<TableName>','reseed',10001)`seria executado.</span><span class="sxs-lookup"><span data-stu-id="a4131-186">For example, at Subscriber A, you would execute `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span></span> <span data-ttu-id="a4131-187">No Assinante B, `CHECKIDENT('<TableName>','reseed',20001)`seria executado.</span><span class="sxs-lookup"><span data-stu-id="a4131-187">At Subscriber B, you would execute `CHECKIDENT('<TableName>','reseed',20001)`.</span></span>  
  
 <span data-ttu-id="a4131-188">Para atribuir novos intervalos ao Publicador ou aos Assinantes, execute DBCC CHECKIDENT e especifique um novo valor para semear novamente a tabela.</span><span class="sxs-lookup"><span data-stu-id="a4131-188">To assign new ranges to the Publisher or Subscribers, execute DBCC CHECKIDENT and specify a new value to reseed the table.</span></span> <span data-ttu-id="a4131-189">Deve haver algum modo de determinar quando um novo intervalo precisa ser atribuído.</span><span class="sxs-lookup"><span data-stu-id="a4131-189">You should have some way to determine when a new range must be assigned.</span></span> <span data-ttu-id="a4131-190">Por exemplo, o aplicativo pode ter um mecanismo que detecte quando um nó está prestes a esgotar seu intervalo e a atribuir um novo intervalo usando DBCC CHECKIDENT.</span><span class="sxs-lookup"><span data-stu-id="a4131-190">For example, your application could have a mechanism that detects when a node is about to use up its range and assign a new range using DBCC CHECKIDENT.</span></span> <span data-ttu-id="a4131-191">Você também pode adicionar uma restrição de verificação para assegurar que não seja possível adicionar uma linha caso ela possa causar o uso de um valor de identidade fora do intervalo.</span><span class="sxs-lookup"><span data-stu-id="a4131-191">You can also add a check constraint to ensure that a row cannot be added if it would cause an out of range identity value to be used.</span></span>  
  
## <a name="handling-identity-ranges-after-a-database-restore"></a><span data-ttu-id="a4131-192">Tratando intervalos de identidade após uma restauração de banco de dados</span><span class="sxs-lookup"><span data-stu-id="a4131-192">Handling Identity Ranges after a Database Restore</span></span>  
 <span data-ttu-id="a4131-193">Caso o gerenciamento de identidade automático seja utilizado, quando um Assinante for restaurado de um backup, ele solicitará automaticamente um novo intervalo de valores de identidade.</span><span class="sxs-lookup"><span data-stu-id="a4131-193">If you are using automatic identity range management, when a Subscriber is restored from a backup, it automatically requests a new range of identity values.</span></span> <span data-ttu-id="a4131-194">Se um Publicador for restaurado de um backup, assegure que um intervalo adequado seja atribuído ao Publicador.</span><span class="sxs-lookup"><span data-stu-id="a4131-194">If a Publisher is restored from a backup, you must ensure that the Publisher is assigned an appropriate range.</span></span> <span data-ttu-id="a4131-195">Para a replicação de mesclagem, atribua um novo intervalo usando [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a4131-195">For merge replication, assign a new range using [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span></span> <span data-ttu-id="a4131-196">Para a replicação transacional, determine o valor mais alto que foi utilizado; em seguida, defina o ponto inicial para os novos intervalos.</span><span class="sxs-lookup"><span data-stu-id="a4131-196">For transactional replication, determine the highest value that has been used and then set the starting point for new ranges.</span></span> <span data-ttu-id="a4131-197">Use o procedimento a seguir depois que o banco de dados de publicação tiver sido restaurado:</span><span class="sxs-lookup"><span data-stu-id="a4131-197">Use the following procedure after the publication database has been restored:</span></span>  
  
1.  <span data-ttu-id="a4131-198">Pare toda a atividade em todos os Assinantes.</span><span class="sxs-lookup"><span data-stu-id="a4131-198">Stop all activity on all Subscribers.</span></span>  
  
2.  <span data-ttu-id="a4131-199">Para cada tabela publicada que inclua uma coluna de identidade:</span><span class="sxs-lookup"><span data-stu-id="a4131-199">For each published table that includes an identity column:</span></span>  
  
    1.  <span data-ttu-id="a4131-200">No banco de dados de assinatura de cada Assinante, execute `IDENT_CURRENT('<TableName>')`.</span><span class="sxs-lookup"><span data-stu-id="a4131-200">In the subscription database at each Subscriber, execute `IDENT_CURRENT('<TableName>')`.</span></span>  
  
    2.  <span data-ttu-id="a4131-201">Registre o valor mais alto encontrado em todos os Assinantes.</span><span class="sxs-lookup"><span data-stu-id="a4131-201">Record the highest value found across all Subscribers.</span></span>  
  
    3.  <span data-ttu-id="a4131-202">No banco de dados de publicação do Publicador, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span><span class="sxs-lookup"><span data-stu-id="a4131-202">In the publication database at the Publisher, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span></span>  
  
    4.  <span data-ttu-id="a4131-203">No banco de dados de publicação do Publicador, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span><span class="sxs-lookup"><span data-stu-id="a4131-203">In the publication database at the Publisher, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a4131-204">Se o valor da coluna identidade estiver definido para redução em vez de incremento, registre o valor mais baixo encontrado, depois semeie novamente esse valor.</span><span class="sxs-lookup"><span data-stu-id="a4131-204">If the value in the identity column is set to decrement rather than increment, record the lowest value found, and then reseed with that value.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a4131-205">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="a4131-205">See Also</span></span>  
 <span data-ttu-id="a4131-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a4131-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="a4131-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a4131-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span></span>  
 <span data-ttu-id="a4131-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="a4131-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span></span>  
 <span data-ttu-id="a4131-209">[IDENTITY &#40;Propriedade&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span><span class="sxs-lookup"><span data-stu-id="a4131-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span></span>  
 [<span data-ttu-id="a4131-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="a4131-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)  
  
  
