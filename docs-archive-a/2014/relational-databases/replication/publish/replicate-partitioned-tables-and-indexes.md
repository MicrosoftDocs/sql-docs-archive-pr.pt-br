---
title: Replicar tabelas e índices particionados | Microsoft Docs
ms.custom: ''
ms.date: 09/10/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- partitioned indexes [SQL Server], replicating
- partitioned tables [SQL Server], replicating
- replication [SQL Server], partitioned tables
- publishing [SQL Server replication], partitioned tables
- transactional replication, partitioned tables
ms.assetid: c9fa81b1-6c81-4c11-927b-fab16301a8f5
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 616707bfb11b48b170fc8f0e8872076d2cd09d1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570602"
---
# <a name="replicate-partitioned-tables-and-indexes"></a><span data-ttu-id="07058-102">Replicar tabelas e índices particionados</span><span class="sxs-lookup"><span data-stu-id="07058-102">Replicate Partitioned Tables and Indexes</span></span>
  <span data-ttu-id="07058-103">O particionamento facilita o gerenciamento de grandes tabelas ou índices, permitindo o acesso e o gerenciamento de subconjuntos de dados de forma rápida e eficaz, ao mesmo tempo em que mantém a integridade geral da coleção de dados.</span><span class="sxs-lookup"><span data-stu-id="07058-103">Partitioning makes large tables or indexes more manageable because partitioning enables you to manage and access subsets of data quickly and efficiently, and maintain the integrity of a data collection at the same time.</span></span> <span data-ttu-id="07058-104">Para saber mais, confira [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="07058-104">For more information, see [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span></span> <span data-ttu-id="07058-105">A replicação dá suporte ao particionamento fornecendo um conjunto de propriedades que especificam como tabelas e índices particionados devem ser tratados.</span><span class="sxs-lookup"><span data-stu-id="07058-105">Replication supports partitioning by providing a set of properties that specify how partitioned tables and indexes should be treated.</span></span>  
  
## <a name="article-properties-for-transactional-and-merge-replication"></a><span data-ttu-id="07058-106">Propriedades de artigo para replicação transacional e de mesclagem</span><span class="sxs-lookup"><span data-stu-id="07058-106">Article Properties for Transactional and Merge Replication</span></span>  
 <span data-ttu-id="07058-107">A tabela a seguir lista os objetos que são usados para particionar dados.</span><span class="sxs-lookup"><span data-stu-id="07058-107">The following table lists the objects that are used to partition data.</span></span>  
  
|<span data-ttu-id="07058-108">Objeto</span><span class="sxs-lookup"><span data-stu-id="07058-108">Object</span></span>|<span data-ttu-id="07058-109">Criado com</span><span class="sxs-lookup"><span data-stu-id="07058-109">Created by using</span></span>|  
|------------|----------------------|  
|<span data-ttu-id="07058-110">Tabela ou índice particionado</span><span class="sxs-lookup"><span data-stu-id="07058-110">Partitioned table or index</span></span>|<span data-ttu-id="07058-111">CREATE TABLE ou CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="07058-111">CREATE TABLE or CREATE INDEX</span></span>|  
|<span data-ttu-id="07058-112">Função de partição</span><span class="sxs-lookup"><span data-stu-id="07058-112">Partition function</span></span>|<span data-ttu-id="07058-113">CREATE PARTITION FUNCTION</span><span class="sxs-lookup"><span data-stu-id="07058-113">CREATE PARTITION FUNCTION</span></span>|  
|<span data-ttu-id="07058-114">Esquema de partição</span><span class="sxs-lookup"><span data-stu-id="07058-114">Partition scheme</span></span>|<span data-ttu-id="07058-115">CREATE PARTITION SCHEME</span><span class="sxs-lookup"><span data-stu-id="07058-115">CREATE PARTITION SCHEME</span></span>|  
  
 <span data-ttu-id="07058-116">O primeiro conjunto de propriedades relacionadas ao particionamento são as opções de esquema de artigo que determinam se os objetos de particionamento devem ser copiados para o Assinante.</span><span class="sxs-lookup"><span data-stu-id="07058-116">The first set of properties related to partitioning are the article schema options that determine whether partitioning objects should be copied to the Subscriber.</span></span> <span data-ttu-id="07058-117">Essas opções de esquema podem ser definidas das seguintes formas:</span><span class="sxs-lookup"><span data-stu-id="07058-117">These schema options can be set in the following ways:</span></span>  
  
-   <span data-ttu-id="07058-118">Na página **Propriedades do Artigo** do Assistente para Nova Publicação ou na caixa de Propriedades de Publicação.</span><span class="sxs-lookup"><span data-stu-id="07058-118">In the **Article Properties** page of the New Publication Wizard or the Publication Properties dialog box.</span></span> <span data-ttu-id="07058-119">Para copiar os objetos listados na tabela anterior, especifique um valor de `true` para as propriedades **copiar esquemas de particionamento de tabela** e **copiar esquemas de particionamento de índice**.</span><span class="sxs-lookup"><span data-stu-id="07058-119">To copy the objects listed in the previous table, specify a value of `true` for the properties **Copy table partitioning schemes** and **Copy index partitioning schemes**.</span></span> <span data-ttu-id="07058-120">Para obter informações sobre como acessar a página **Propriedades do artigo**, consulte [Exibir e modificar as propriedades da publicação](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="07058-120">For information about how to access the **Article Properties** page, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
-   <span data-ttu-id="07058-121">Usando o parâmetro *schema_option* de um dos procedimentos armazenados a seguir:</span><span class="sxs-lookup"><span data-stu-id="07058-121">By using the *schema_option* parameter of one of the following stored procedures:</span></span>  
  
    -   <span data-ttu-id="07058-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) ou [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) para replicação transacional</span><span class="sxs-lookup"><span data-stu-id="07058-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) or [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) for transactional replication</span></span>  
  
    -   <span data-ttu-id="07058-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) ou [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) para replicação de mesclagem</span><span class="sxs-lookup"><span data-stu-id="07058-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) or [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) for merge replication</span></span>  
  
     <span data-ttu-id="07058-124">Para copiar os objetos listados na tabela anterior, especifique os valores de opção de esquema apropriados.</span><span class="sxs-lookup"><span data-stu-id="07058-124">To copy the objects listed in the previous table, specify the appropriate schema option values.</span></span> <span data-ttu-id="07058-125">Para obter informações sobre como especificar opções de esquema, consulte [Specify Schema Options](specify-schema-options.md).</span><span class="sxs-lookup"><span data-stu-id="07058-125">For information about how to specify schema options, see [Specify Schema Options](specify-schema-options.md).</span></span>  
  
 <span data-ttu-id="07058-126">A replicação copia objetos para o Assinante durante a sincronização inicial.</span><span class="sxs-lookup"><span data-stu-id="07058-126">Replication copies objects to the Subscriber during the initial synchronization.</span></span> <span data-ttu-id="07058-127">Se o esquema de partição usar grupos de arquivo diferentes do grupo de arquivo PRIMARY, esses grupos deverão existir no Assinante antes da sincronização inicial.</span><span class="sxs-lookup"><span data-stu-id="07058-127">If the partition scheme uses filegroups other than the PRIMARY filegroup, those filegroups must exist on the Subscriber before the initial synchronization.</span></span>  
  
 <span data-ttu-id="07058-128">Depois que o Assinante é inicializado, as alterações de dados são propagadas para o Assinante e aplicadas nas partições apropriadas.</span><span class="sxs-lookup"><span data-stu-id="07058-128">After the Subscriber is initialized, data changes are propagated to the Subscriber and applied to the appropriate partitions.</span></span> <span data-ttu-id="07058-129">Porém, as alterações no esquema de partição não são suportadas.</span><span class="sxs-lookup"><span data-stu-id="07058-129">However, changes to the partition scheme are not supported.</span></span> <span data-ttu-id="07058-130">A replicação transacional e de mesclagem não dá suporte à replicação dos seguintes comandos: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, ou a instrução REBUILD WITH PARTITION de ALTER INDEX.</span><span class="sxs-lookup"><span data-stu-id="07058-130">Transactional and merge replication do not support replicating the following commands: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, or the REBUILD WITH PARTITION statement of ALTER INDEX.</span></span>  <span data-ttu-id="07058-131">As alterações associadas a eles não serão replicadas automaticamente para o Assinante.</span><span class="sxs-lookup"><span data-stu-id="07058-131">The changes associated with them will not be automatically replicated to the Subscriber.</span></span> <span data-ttu-id="07058-132">É responsabilidade do usuário fazer alterações semelhantes manualmente no Assinante.</span><span class="sxs-lookup"><span data-stu-id="07058-132">It is the responsibility of the user to make similar changes manually at the Subscriber.</span></span>  
  
## <a name="replication-support-for-partition-switching"></a><span data-ttu-id="07058-133">Suporte de replicação para alternância de partição</span><span class="sxs-lookup"><span data-stu-id="07058-133">Replication Support for Partition Switching</span></span>  
 <span data-ttu-id="07058-134">Um dos principais benefícios do particionamento de tabela é a possibilidade de mover subconjuntos de dados entre partições com rapidez e eficiência.</span><span class="sxs-lookup"><span data-stu-id="07058-134">One of the key benefits of table partitioning is the ability to quickly and efficiently move subsets of data between partitions.</span></span> <span data-ttu-id="07058-135">Os dados são movidos com o comando SWITCH PARTITION.</span><span class="sxs-lookup"><span data-stu-id="07058-135">Data is moved by using the SWITCH PARTITION command.</span></span> <span data-ttu-id="07058-136">Por padrão, quando uma tabela é habilitada para replicação, as operações SWITCH PARTITION são bloqueadas pelos seguintes motivos:</span><span class="sxs-lookup"><span data-stu-id="07058-136">By default, when a table is enabled for replication, SWITCH PARTITION operations are blocked for the following reasons:</span></span>  
  
-   <span data-ttu-id="07058-137">Se os dados forem movidos para ou de uma tabela que existe no Publicador, mas não existe no Assinante, ambos ficarão inconsistentes entre si.</span><span class="sxs-lookup"><span data-stu-id="07058-137">If data is moved into or out of a table that exists at the Publisher but does not exist at the Subscriber, the Publisher and Subscriber could become inconsistent with one another.</span></span> <span data-ttu-id="07058-138">Esse problema ocorre normalmente quando os dados são movidos para ou de uma tabela de preparação.</span><span class="sxs-lookup"><span data-stu-id="07058-138">This problem typically occurs when data is moved into or out of a staging table.</span></span>  
  
-   <span data-ttu-id="07058-139">Se o Assinante tiver uma definição diferente para a tabela particionada da definição do Publicador, o Agente de Distribuição falhará ao tentar aplicar as alterações no Assinante.</span><span class="sxs-lookup"><span data-stu-id="07058-139">If the Subscriber has a different definition for the partitioned table than the Publisher, the Distribution Agent will fail when it tries to apply changes at the Subscriber.</span></span>  
  
 <span data-ttu-id="07058-140">Apesar destes possíveis problemas, a alternância de partição pode ser habilitada para replicação transacional.</span><span class="sxs-lookup"><span data-stu-id="07058-140">Despite these potential issues, partition switching can be enabled for transactional replication.</span></span> <span data-ttu-id="07058-141">Antes de habilitá-la, verifique se todas as tabelas que estão envolvidas na alternância de partição existem no Publicador e no Assinante e verifique se as definições de tabela e de partição são iguais.</span><span class="sxs-lookup"><span data-stu-id="07058-141">Before you enable partition switching, make sure that all tables that are involved in partition switching exist at the Publisher and Subscriber, and make sure that the table and partition definitions are the same.</span></span>  
  
 <span data-ttu-id="07058-142">Quando as partições têm o esquema de partição exato nos publicadores e assinantes, você pode ativar o *allow_partition_switch* junto com *replication_partition_switch* , que somente replicará a instrução switch da partição para o assinante.</span><span class="sxs-lookup"><span data-stu-id="07058-142">When partitions have the exact same partition scheme at the publishers and subscribers you can turn on *allow_partition_switch* along with *replication_partition_switch* which will only replicate the partition switch statement to the subscriber.</span></span> <span data-ttu-id="07058-143">Você também pode ativar o *allow_partition_switch* sem replicar o DDL.</span><span class="sxs-lookup"><span data-stu-id="07058-143">You can also turn on *allow_partition_switch* without replicating the DDL.</span></span> <span data-ttu-id="07058-144">Isto é útil no caso em que você deseja reverter meses antigos da partição, mas persistir a partição replicada no local durante outro ano para fins de backup no assinante.</span><span class="sxs-lookup"><span data-stu-id="07058-144">This is useful in the case where you want to roll old months out of the partition but keep the replicated partition in place for another year for backup purposes at the subscriber.</span></span>  
  
 <span data-ttu-id="07058-145">Se você habilitar a alternância de partição no SQL Server 2008 R2 até a versão atual, talvez também seja necessário realizar operações de divisão e mesclagem em um futuro próximo.</span><span class="sxs-lookup"><span data-stu-id="07058-145">If you enable partition switching on SQL Server 2008 R2 through the current version, you might also need split and merge operations in near future.</span></span> <span data-ttu-id="07058-146">Antes de executar uma operação de divisão ou mesclagem em uma tabela replicada, certifique-se de que a partição em questão não tenha nenhum comando replicado pendente.</span><span class="sxs-lookup"><span data-stu-id="07058-146">Before executing a split or merge operation on a replicated table ensure that the partition in question does not have any pending replicated commands.</span></span> <span data-ttu-id="07058-147">Você também deve garantir que nenhuma operação DML seja executada na partição durante as operações de divisão e mesclagem.</span><span class="sxs-lookup"><span data-stu-id="07058-147">You should also ensure that no DML operations are executed on the partition during the split and merge operations.</span></span> <span data-ttu-id="07058-148">Se houver transações não processadas pelo leitor de log, ou se as operações DML forem executadas em uma partição de uma tabela replicada enquanto uma operação de divisão ou mesclagem é executada (envolvendo a mesma partição), isso pode levar a um erro de processamento com o agente de leitor de log.</span><span class="sxs-lookup"><span data-stu-id="07058-148">If there are transactions which the log reader has not processed, or if DML operations are performed on a partition of a replicated table while a split or merge operation is executed (involving the same partition), it could lead to a processing error with log reader agent.</span></span> <span data-ttu-id="07058-149">Para corrigir o erro, talvez isso exija uma reinicialização da assinatura.</span><span class="sxs-lookup"><span data-stu-id="07058-149">In order to correct the error, it might require a re-initialization of the subscription.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="07058-150">Você não deveria habilitar o switch de partição para publicações ponto a ponto, devido à coluna oculta que é usada para detectar e resolver conflitos.</span><span class="sxs-lookup"><span data-stu-id="07058-150">You should not enable partition switching for Peer-to-Peer publications, due to the hidden column which is used to detect and resolve conflict.</span></span>  
  
### <a name="enabling-partition-switching"></a><span data-ttu-id="07058-151">Habilitando a alternância de partição</span><span class="sxs-lookup"><span data-stu-id="07058-151">Enabling Partition Switching</span></span>  
 <span data-ttu-id="07058-152">As propriedades a seguir para publicações transacionais permitem que os usuários controlem o comportamento da alternância de partição em um ambiente replicado:</span><span class="sxs-lookup"><span data-stu-id="07058-152">The following properties for transactional publications enable users to control the behavior of partition switching in a replicated environment:</span></span>  
  
-   <span data-ttu-id="07058-153">\*\* \@ allow_partition_switch\*\*, quando definido como `true` , o switch Partition pode ser executado no banco de dados de publicação.</span><span class="sxs-lookup"><span data-stu-id="07058-153">**\@allow_partition_switch**, when set to `true`, SWITCH PARTITION can be executed against the publication database.</span></span>  
  
-   <span data-ttu-id="07058-154">\*\* \@ replicate_partition_switch\*\* determina se a instrução switch Partition DDL deve ser replicada para os assinantes.</span><span class="sxs-lookup"><span data-stu-id="07058-154">**\@replicate_partition_switch** determines whether the SWITCH PARTITION DDL statement should be replicated to Subscribers.</span></span> <span data-ttu-id="07058-155">Essa opção é válida somente quando \*\* \@ allow_partition_switch\*\* é definido como `true` .</span><span class="sxs-lookup"><span data-stu-id="07058-155">This option is valid only when **\@allow_partition_switch** is set to `true`.</span></span>  
  
 <span data-ttu-id="07058-156">Você pode definir essas propriedades usando [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) quando a publicação é criada ou usando [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) depois da criação da publicação.</span><span class="sxs-lookup"><span data-stu-id="07058-156">You can set these properties by using [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) when the publication is created, or by using [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) after the publication is created.</span></span> <span data-ttu-id="07058-157">Como observado anteriormente, a replicação de mesclagem não dá suporte à alternância de partição.</span><span class="sxs-lookup"><span data-stu-id="07058-157">As noted earlier, merge replication does not support partition switching.</span></span> <span data-ttu-id="07058-158">Para executar SWITCH PARTITION em uma tabela que é habilitada para replicação de mesclagem, remova a tabela da publicação.</span><span class="sxs-lookup"><span data-stu-id="07058-158">To execute SWITCH PARTITION on a table that is enabled for merge replication, remove the table from the publication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="07058-159">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="07058-159">See Also</span></span>  
 [<span data-ttu-id="07058-160">Publicar dados e objetos de banco de dados</span><span class="sxs-lookup"><span data-stu-id="07058-160">Publish Data and Database Objects</span></span>](publish-data-and-database-objects.md)  
  
  
