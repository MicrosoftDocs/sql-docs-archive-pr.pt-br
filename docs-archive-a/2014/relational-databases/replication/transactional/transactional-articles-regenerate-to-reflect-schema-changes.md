---
title: Regenerar os procedimentos transacionais personalizados para refletir alterações de esquema | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- custom procedures [SQL Server replication]
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
ms.assetid: ccf68a13-e748-4455-8168-90e6d2868098
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 7b41b5309816e037ce3619e880b796e0653c7506
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87684150"
---
# <a name="regenerate-custom-transactional-procedures-to-reflect-schema-changes"></a><span data-ttu-id="1c995-102">Regenerar os procedimentos transacionais personalizados para refletir alterações de esquema</span><span class="sxs-lookup"><span data-stu-id="1c995-102">Regenerate Custom Transactional Procedures to Reflect Schema Changes</span></span>
  <span data-ttu-id="1c995-103">Por padrão, a replicação transacional faz todas as alterações de dados nos Assinantes por meio de um conjunto de procedimentos armazenados gerados por procedimentos internos para cada artigo de tabela na publicação.</span><span class="sxs-lookup"><span data-stu-id="1c995-103">By default transactional replication makes all data changes at Subscribers through stored procedures that are generated by internal procedures for each table article in the publication.</span></span> <span data-ttu-id="1c995-104">Os três procedimentos (um de cada para inserir, atualizar e excluir) são copiados para o Assinante e executados quando uma inserção, atualização ou exclusão for replicada para o Assinante.</span><span class="sxs-lookup"><span data-stu-id="1c995-104">The three procedures (one each for inserts, updates, and deletes) are copied to the Subscriber and execute when an insert, update, or delete is replicated to the Subscriber.</span></span> <span data-ttu-id="1c995-105">Quando uma alteração de esquema é feita em uma tabela do Publicador [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , a replicação regenera esses procedimentos automaticamente, chamando o mesmo conjunto de procedimentos de script interno, de modo que os novos procedimentos correspondam ao novo esquema (a replicação de alterações de esquema não tem suporte para Publicadores Oracle).</span><span class="sxs-lookup"><span data-stu-id="1c995-105">When a schema change is made to a table on a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, replication regenerates these procedures automatically by calling the same set of internal scripting procedures so that the new procedures match the new schema (replication of schema changes is not supported for Oracle Publishers).</span></span>  
  
 <span data-ttu-id="1c995-106">Também é possível especificar procedimentos personalizados para substituir um ou mais procedimentos padrão.</span><span class="sxs-lookup"><span data-stu-id="1c995-106">It is also possible to specify custom procedures to replace one or more of the default procedures.</span></span> <span data-ttu-id="1c995-107">Os procedimentos personalizados devem ser alterados se a alteração do esquema afetar o procedimento.</span><span class="sxs-lookup"><span data-stu-id="1c995-107">The custom procedures should be changed if the schema change will affect the procedure.</span></span> <span data-ttu-id="1c995-108">Por exemplo, se um procedimento fizer referência a uma coluna descartada em uma alteração de esquema, as referências à coluna deverão ser removidas do procedimento.</span><span class="sxs-lookup"><span data-stu-id="1c995-108">For example, if a procedure references a column that is dropped in a schema change, references to the column should be removed from the procedure.</span></span> <span data-ttu-id="1c995-109">Há dois modos para que a replicação propague um novo procedimento personalizado aos Assinantes:</span><span class="sxs-lookup"><span data-stu-id="1c995-109">There are two ways for replication to propagate a new custom procedure to Subscribers:</span></span>  
  
-   <span data-ttu-id="1c995-110">A primeira opção é usar um procedimento de script personalizado para substituir os padrões usados pela replicação:</span><span class="sxs-lookup"><span data-stu-id="1c995-110">The first option is to use a custom scripting procedure to replace the defaults used by replication:</span></span>  
  
    1.  <span data-ttu-id="1c995-111">Ao executar [sp_addarticle &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), verifique se o **@schema_option** bit 0x02 é **verdadeiro**.</span><span class="sxs-lookup"><span data-stu-id="1c995-111">When executing [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), ensure the **@schema_option** 0x02 bit is to **true**.</span></span>  
  
    2.  <span data-ttu-id="1c995-112">Execute [sp_register_custom_scripting &#40;&#41;Transact-SQL](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql) e especifique um valor de ' Insert ', ' Update ' ou ' Delete ' para o parâmetro **@type** e o nome do procedimento de script personalizado para o parâmetro **@value** .</span><span class="sxs-lookup"><span data-stu-id="1c995-112">Execute [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql) and specify a value of 'insert', 'update', or 'delete' for the parameter **@type** and the name of the custom scripting procedure for the parameter **@value**.</span></span>  
  
     <span data-ttu-id="1c995-113">Na próxima alteração de esquema, a replicação chamará esse procedimento armazenado para substituir a definição pelo novo procedimento armazenado personalizado definido pelo usuário e depois propagará o procedimento para cada Assinante.</span><span class="sxs-lookup"><span data-stu-id="1c995-113">The next time a schema change is made, replication calls this stored procedure to script out the definition for the new user defined custom stored procedure, and then propagates the procedure to each Subscriber.</span></span>  
  
-   <span data-ttu-id="1c995-114">A segunda opção é usar um script que contenha uma nova definição de procedimento personalizada:</span><span class="sxs-lookup"><span data-stu-id="1c995-114">The second option is to use a script that contains a new custom procedure definition:</span></span>  
  
    1.  <span data-ttu-id="1c995-115">Ao executar [sp_addarticle &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), defina o **@schema_option** bit 0x02 como **false** para que a replicação não gere automaticamente procedimentos personalizados no Assinante.</span><span class="sxs-lookup"><span data-stu-id="1c995-115">When executing [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), set the **@schema_option** 0x02 bit to **false** so replication does not automatically generate custom procedures at the Subscriber.</span></span>  
  
    2.  <span data-ttu-id="1c995-116">Antes de cada alteração de esquema, crie um novo arquivo de script e registre o script com replicação executando [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1c995-116">Before each schema change, create a new script file and register the script with replication by executing [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql).</span></span> <span data-ttu-id="1c995-117">Especifique um valor de ' custom_script ' para o parâmetro **@type** e o caminho para o script no Publicador para o parâmetro **@value** .</span><span class="sxs-lookup"><span data-stu-id="1c995-117">Specify a value of 'custom_script' for the parameter **@type** and the path to the script on the Publisher for the parameter **@value**.</span></span>  
  
     <span data-ttu-id="1c995-118">Na próxima vez em que for feita uma alteração de esquema relevante, esse script será executado em cada Assinante dentro da mesma transação como o comando DDL.</span><span class="sxs-lookup"><span data-stu-id="1c995-118">The next time a relevant schema change is made, this script executes on each Subscriber within the same transaction as the DDL command.</span></span> <span data-ttu-id="1c995-119">Após concluir a alteração de esquema, o registro do script será removido.</span><span class="sxs-lookup"><span data-stu-id="1c995-119">After the schema change is made, the script is unregistered.</span></span> <span data-ttu-id="1c995-120">Você deve registrar de novo o script para que ele seja executado depois de uma alteração de esquema subsequente.</span><span class="sxs-lookup"><span data-stu-id="1c995-120">You must re-register the script to have it executed after a subsequent schema change.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1c995-121">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="1c995-121">See Also</span></span>  
 <span data-ttu-id="1c995-122">[Especificar como as alterações são propagadas para artigos transacionais](transactional-articles-specify-how-changes-are-propagated.md) </span><span class="sxs-lookup"><span data-stu-id="1c995-122">[Specify How Changes Are Propagated for Transactional Articles](transactional-articles-specify-how-changes-are-propagated.md) </span></span>  
 [<span data-ttu-id="1c995-123">Fazer alterações de esquema em bancos de dados de publicação</span><span class="sxs-lookup"><span data-stu-id="1c995-123">Make Schema Changes on Publication Databases</span></span>](../publish/make-schema-changes-on-publication-databases.md)  
  
  
