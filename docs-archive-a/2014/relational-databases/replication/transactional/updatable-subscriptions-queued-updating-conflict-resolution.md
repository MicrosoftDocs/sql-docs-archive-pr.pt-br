---
title: Resolução e detecção de conflitos de atualização na fila | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- conflict resolution [SQL Server replication], queued updating subscriptions
- viewing queued updating conflicts
- conflict resolution [SQL Server replication]
- queued updating subscriptions [SQL Server replication]
- articles [SQL Server replication], conflict resolution
ms.assetid: 084ac587-25e7-4bd0-a385-556bbe07d02f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8c4608347ab119e25caa45b0ee4a592a953e34a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87583481"
---
# <a name="queued-updating-conflict-detection-and-resolution"></a><span data-ttu-id="f39ac-102">Queued Updating Conflict Detection and Resolution</span><span class="sxs-lookup"><span data-stu-id="f39ac-102">Queued Updating Conflict Detection and Resolution</span></span>
  <span data-ttu-id="f39ac-103">Como as assinaturas de atualização em fila permitem modificações nos mesmos dados em vários locais, pode haver conflitos quando os dados forem sincronizados no Publicador.</span><span class="sxs-lookup"><span data-stu-id="f39ac-103">Because queued updating subscriptions allow modifications to the same data at multiple locations, there may be conflicts when data is synchronized at the Publisher.</span></span> <span data-ttu-id="f39ac-104">A replicação detecta todos os conflitos quando alterações são sincronizadas com o Publicador, resolvendo-os por meio da política de resolução selecionada durante a criação da publicação.</span><span class="sxs-lookup"><span data-stu-id="f39ac-104">Replication detects any conflicts when changes are synchronized with the Publisher and resolves those conflicts using the resolution policy you selected when creating the publication.</span></span> <span data-ttu-id="f39ac-105">Podem ocorrer os seguintes conflitos:</span><span class="sxs-lookup"><span data-stu-id="f39ac-105">The following conflicts can occur:</span></span>  
  
-   <span data-ttu-id="f39ac-106">Conflitos de atualização e inserção.</span><span class="sxs-lookup"><span data-stu-id="f39ac-106">Update and insert conflicts.</span></span> <span data-ttu-id="f39ac-107">Esse conflito acontece quando os mesmos dados são alterados em dois locais.</span><span class="sxs-lookup"><span data-stu-id="f39ac-107">This conflict happens when the same data is changed at two locations.</span></span> <span data-ttu-id="f39ac-108">Uma alteração vence e a outra perde.</span><span class="sxs-lookup"><span data-stu-id="f39ac-108">One change wins, and the other one loses.</span></span>  
  
-   <span data-ttu-id="f39ac-109">Conflitos de exclusão.</span><span class="sxs-lookup"><span data-stu-id="f39ac-109">Delete conflicts.</span></span> <span data-ttu-id="f39ac-110">Esses conflitos ocorrem quando a mesma linha é excluída em um local e alterada em outro.</span><span class="sxs-lookup"><span data-stu-id="f39ac-110">This conflict occurs when the same row is deleted at one location and changed at the other.</span></span>  
  
 <span data-ttu-id="f39ac-111">A detecção e resolução de conflitos pode ser um processo demorado e que utiliza muitos recursos. No entanto, é o que há de melhor para reduzir os conflitos no aplicativo, por criar partições de dados, de modo que os vários Assinantes modifiquem diferentes subconjuntos de dados.</span><span class="sxs-lookup"><span data-stu-id="f39ac-111">Conflict detection and resolution can be a time-consuming and resource-intensive process; therefore, it is best to minimize conflicts in the application by creating data partitions so that different Subscribers modify different subsets of data.</span></span>  
  
## <a name="detecting-conflicts"></a><span data-ttu-id="f39ac-112">Conflitos de detecção</span><span class="sxs-lookup"><span data-stu-id="f39ac-112">Detecting Conflicts</span></span>  
 <span data-ttu-id="f39ac-113">Ao criar uma publicação e ativar atualizações em fila, a replicação adiciona uma coluna **uniqueidentifier** (**msrepl_tran_version**) com o padrão de **newid()** à tabela subjacente.</span><span class="sxs-lookup"><span data-stu-id="f39ac-113">When creating a publication and enabling queued updating, replication adds a **uniqueidentifier** column (**msrepl_tran_version**) with the default of **newid()** to the underlying table.</span></span> <span data-ttu-id="f39ac-114">Quando os dados publicados são alterados tanto no Publicador quando no Assinante, a linha recebe um GUID (Globally Unique Identifier) para indicar que existe uma nova versão de linha.</span><span class="sxs-lookup"><span data-stu-id="f39ac-114">When published data is changed at either the Publisher or the Subscriber, the row receives a new globally unique identifier (GUID) to indicate that a new row version exists.</span></span> <span data-ttu-id="f39ac-115">O Queue Reader Agent usa essa coluna durante a sincronização para determinar se há um conflito.</span><span class="sxs-lookup"><span data-stu-id="f39ac-115">The Queue Reader Agent uses this column during synchronization to determine if a conflict exists.</span></span>  
  
 <span data-ttu-id="f39ac-116">Uma transação em uma fila mantém os valores de versão de linha antigos e novos.</span><span class="sxs-lookup"><span data-stu-id="f39ac-116">A transaction in a queue maintains the old and new row version values.</span></span> <span data-ttu-id="f39ac-117">Quando a transação é aplicada ao Publicador, os GUIDs da transação e o GUID da publicação são comparados.</span><span class="sxs-lookup"><span data-stu-id="f39ac-117">When the transaction is applied at the Publisher, the GUIDs from the transaction and the GUID in the publication are compared.</span></span> <span data-ttu-id="f39ac-118">Se um GUID antigo, armazenado na transação, corresponder ao GUID da publicação,a publicação é atualizada e a linha é atribuída ao novo GUID que foi gerado pelo Assinante.</span><span class="sxs-lookup"><span data-stu-id="f39ac-118">If the old GUID stored in the transaction matches the GUID in the publication, the publication is updated and the row is assigned the new GUID that was generated by the Subscriber.</span></span> <span data-ttu-id="f39ac-119">Pela atualização da publicação com o GUID da transação, obtêm-se versões de linha correspondentes na publicação e na transação.</span><span class="sxs-lookup"><span data-stu-id="f39ac-119">By updating the publication with the GUID from the transaction, you have matching row versions in the publication and in the transaction.</span></span>  
  
 <span data-ttu-id="f39ac-120">Se um GUID antigo, armazenado na transação, não corresponder ao GUID da publicação, será detectado um conflito.</span><span class="sxs-lookup"><span data-stu-id="f39ac-120">If the old GUID stored in the transaction does not match the GUID in the publication, a conflict is detected.</span></span> <span data-ttu-id="f39ac-121">O novo GUID da publicação indica que há duas versões de linhas diferentes: uma na transação sendo submetida ao Assinante e uma mais nova que existe no Assinante.</span><span class="sxs-lookup"><span data-stu-id="f39ac-121">The new GUID in the publication indicates that two different row versions exist: one in the transaction being submitted by the Subscriber and a newer one that exists on the Publisher.</span></span> <span data-ttu-id="f39ac-122">Nesse caso, outro Assinante ou o Publicador atualizou a mesma linha da publicação antes de a transação de Assinante ser sincronizada.</span><span class="sxs-lookup"><span data-stu-id="f39ac-122">In this case, another Subscriber or the Publisher updated the same row in the publication before this Subscriber transaction was synchronized.</span></span>  
  
 <span data-ttu-id="f39ac-123">Diferentemente da replicação de mesclagem, o uso da coluna GUID não é destinado à identificação a própria linha, mas para verificar se a linha foi alterada.</span><span class="sxs-lookup"><span data-stu-id="f39ac-123">Unlike merge replication, the use of a GUID column is not used to identify the row itself, but is used to check if the row has changed.</span></span>  
  
## <a name="resolving-conflicts"></a><span data-ttu-id="f39ac-124">Conflitos de resolução</span><span class="sxs-lookup"><span data-stu-id="f39ac-124">Resolving Conflicts</span></span>  
 <span data-ttu-id="f39ac-125">Quando uma publicação é criada usando-se a atualização em fila, um resolvedor de conflitos é utilizado caso algum conflito seja detectado.</span><span class="sxs-lookup"><span data-stu-id="f39ac-125">When you create a publication using queued updating, you select a conflict resolver to be used if any conflicts are detected.</span></span> <span data-ttu-id="f39ac-126">O resolvedor de conflitos governa o modo pelo qual o Queue Reader Agent controla as diferentes versões da mesma linha, encontradas durante a sincronização.</span><span class="sxs-lookup"><span data-stu-id="f39ac-126">The conflict resolver governs how the Queue Reader Agent handles different versions of the same row encountered during synchronization.</span></span> <span data-ttu-id="f39ac-127">É possível alterar a política de resolução de conflitos após a criação da publicação, desde que não haja assinaturas para a publicação.</span><span class="sxs-lookup"><span data-stu-id="f39ac-127">You can change the conflict resolution policy after the publication is created as long as there are no subscriptions to the publication.</span></span> <span data-ttu-id="f39ac-128">As opções do resolvedor de conflitos são as seguintes:</span><span class="sxs-lookup"><span data-stu-id="f39ac-128">The conflict resolver choices are the following:</span></span>  
  
-   <span data-ttu-id="f39ac-129">Publicador vence (padrão)</span><span class="sxs-lookup"><span data-stu-id="f39ac-129">Publisher wins (the default)</span></span>  
  
-   <span data-ttu-id="f39ac-130">O Publicador vence e a assinatura é reinicializada</span><span class="sxs-lookup"><span data-stu-id="f39ac-130">Publisher wins and the subscription is reinitialized</span></span>  
  
-   <span data-ttu-id="f39ac-131">Assinante vence</span><span class="sxs-lookup"><span data-stu-id="f39ac-131">Subscriber wins</span></span>  
  
 <span data-ttu-id="f39ac-132">Os conflitos são registrados e exibidos com o Visualizador de Conflitos.</span><span class="sxs-lookup"><span data-stu-id="f39ac-132">Conflicts are recorded and can be viewed using the Conflict Viewer.</span></span>  
  
 <span data-ttu-id="f39ac-133">**Para definir a política de resolução de conflitos de atualização em fila**</span><span class="sxs-lookup"><span data-stu-id="f39ac-133">**To set the queued updating conflict resolution policy**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="f39ac-134">: [Definir opções de resolução de conflitos de atualização na fila &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="f39ac-134">: [Set Queued Updating Conflict Resolution Options &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
-   <span data-ttu-id="f39ac-135">Programação Transact-SQL de replicação: [Habilitar atualização de assinaturas para publicações transacionais](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="f39ac-135">Replication Transact-SQL programming: [Enable Updating Subscriptions for Transactional Publications](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span></span>  
  
 <span data-ttu-id="f39ac-136">**Para exibir conflitos de dados**</span><span class="sxs-lookup"><span data-stu-id="f39ac-136">**To view data conflicts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="f39ac-137">: [Exibir conflitos de dados em publicações transacionais &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="f39ac-137">: [View Data Conflicts for Transactional Publications &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span></span>  
  
### <a name="publisher-wins"></a><span data-ttu-id="f39ac-138">Publicador vence</span><span class="sxs-lookup"><span data-stu-id="f39ac-138">Publisher Wins</span></span>  
 <span data-ttu-id="f39ac-139">Quando a resolução de conflito é definida como Publicador vence, a consistência transacional é mantida, com base nos dados do Publicador.</span><span class="sxs-lookup"><span data-stu-id="f39ac-139">When the conflict resolution is set to the Publisher wins, transactional consistency is maintained based on the data at the Publisher.</span></span> <span data-ttu-id="f39ac-140">A transação conflitante é revertida para o Assinante que a iniciou.</span><span class="sxs-lookup"><span data-stu-id="f39ac-140">The conflicting transaction is rolled back at the Subscriber that initiated it.</span></span>  
  
 <span data-ttu-id="f39ac-141">O Queue Reader Agent detecta um conflito e comandos de compensação são gerados e propagados para o Assinante por meio de postagem no banco de dados da distribuição.</span><span class="sxs-lookup"><span data-stu-id="f39ac-141">The Queue Reader Agent detects a conflict and compensating commands are generated and propagated to the Subscriber by posting them in the distribution database.</span></span> <span data-ttu-id="f39ac-142">O Distribution Agent, em seguida, aplica os comandos de compensação para o Assinante que originou a transação conflitante.</span><span class="sxs-lookup"><span data-stu-id="f39ac-142">The Distribution Agent then applies the compensating commands to the Subscriber that originated the conflicting transaction.</span></span> <span data-ttu-id="f39ac-143">As ações de compensação atualizam as linhas no Assinante para que correspondam às do Publicador.</span><span class="sxs-lookup"><span data-stu-id="f39ac-143">The compensating actions update the rows on the Subscriber to match the rows on the Publisher.</span></span>  
  
 <span data-ttu-id="f39ac-144">Até que os comandos de compensação sejam aplicados, é possível ler os resultados de uma transação que será, em algum momento futuro, revertida para o Assinante.</span><span class="sxs-lookup"><span data-stu-id="f39ac-144">Until the compensating commands are applied, it is possible to read the results of a transaction that will eventually be rolled back at the Subscriber.</span></span> <span data-ttu-id="f39ac-145">Isto equivale a uma leitura suja (nível de isolamento de leitura não confirmada).</span><span class="sxs-lookup"><span data-stu-id="f39ac-145">This is equivalent to a dirty read (read uncommitted isolation level).</span></span> <span data-ttu-id="f39ac-146">Não há compensações para as transações dependentes subsequentes que venham a ocorrer.</span><span class="sxs-lookup"><span data-stu-id="f39ac-146">There is no compensation for the subsequent dependent transactions that can occur.</span></span> <span data-ttu-id="f39ac-147">Contudo, os limites da transação são mantidos e todas as ações dentro da transação são igualmente confirmadas, ou, em caso de conflito, revertidas.</span><span class="sxs-lookup"><span data-stu-id="f39ac-147">However, transaction boundaries are honored and all the actions within a transaction are either committed, or in the case of a conflict, rolled back.</span></span>  
  
### <a name="publisher-wins-and-the-subscription-is-reinitialized"></a><span data-ttu-id="f39ac-148">O Publicador vence e a assinatura é reinicializada</span><span class="sxs-lookup"><span data-stu-id="f39ac-148">Publisher Wins and the Subscription Is Reinitialized</span></span>  
 <span data-ttu-id="f39ac-149">Reinicializar o Assinante para resolver conflitos mantém uma consistência transacional explícita no Assinante, mas pode despender muito tempo caso a publicação contenha grandes quantidades de dados.</span><span class="sxs-lookup"><span data-stu-id="f39ac-149">Reinitializing the Subscriber to resolve conflicts maintains strict transactional consistency at the Subscriber, but it can be time consuming if the publication contains large amounts of data.</span></span>  
  
 <span data-ttu-id="f39ac-150">Quando o Queue Reader Agent detecta um conflito, todas as transações restantes na fila (inclusive a transação em conflito) são rejeitadas e o Assinante é marcado para reinicialização.</span><span class="sxs-lookup"><span data-stu-id="f39ac-150">When the Queue Reader Agent detects a conflict, all remaining transactions in the queue (including the transaction in conflict) are rejected, and the Subscriber is marked for reinitialization.</span></span> <span data-ttu-id="f39ac-151">O próximo instantâneo gerado para a publicação é aplicado pelo Distribution Agent para o Assinante.</span><span class="sxs-lookup"><span data-stu-id="f39ac-151">The next snapshot generated for the publication is applied by the Distribution Agent to the Subscriber.</span></span>  
  
### <a name="subscriber-wins"></a><span data-ttu-id="f39ac-152">Assinante vence</span><span class="sxs-lookup"><span data-stu-id="f39ac-152">Subscriber Wins</span></span>  
 <span data-ttu-id="f39ac-153">A detecção de conflitos segundo a política Assinante vence significa que a última transação de Assinante que atualizar o Publicador vence.</span><span class="sxs-lookup"><span data-stu-id="f39ac-153">Conflict detection under the Subscriber wins policy means the last Subscriber transaction to update the Publisher wins.</span></span> <span data-ttu-id="f39ac-154">Nesse caso, quando um conflito é detectado, a transação enviada pelo Assinante ainda é usada, e o Publicador é atualizado.</span><span class="sxs-lookup"><span data-stu-id="f39ac-154">In this case, when a conflict is detected, the transaction sent by the Subscriber is still used and the Publisher is updated.</span></span> <span data-ttu-id="f39ac-155">Essa política é adequada para aplicativos em que essas alterações não comprometem a integridade de dados.</span><span class="sxs-lookup"><span data-stu-id="f39ac-155">This policy is suitable for applications where such changes do not compromise data integrity.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f39ac-156">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="f39ac-156">See Also</span></span>  
 [<span data-ttu-id="f39ac-157">Updatable Subscriptions for Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="f39ac-157">Updatable Subscriptions for Transactional Replication</span></span>](updatable-subscriptions-for-transactional-replication.md)  
  
  
