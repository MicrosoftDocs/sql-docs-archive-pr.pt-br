---
title: Colunas e tipos de dados XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
ms.assetid: 00db8f21-7d4b-4347-ae43-3a7c314d2fa1
author: rothja
ms.author: jroth
ms.openlocfilehash: 575f8b8fc640ea5ff671a6b0cef4208e7447898f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685470"
---
# <a name="xml-data-type-and-columns-sql-server"></a><span data-ttu-id="13f68-102">Tipos e colunas de dados XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="13f68-102">XML Data Type and Columns (SQL Server)</span></span>
  <span data-ttu-id="13f68-103">Este tópico discute as vantagens e as limitações do tipo de `xml` dados no e [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ajuda a escolher como armazenar dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-103">This topic discusses the advantages and the limitations of the `xml` data type in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and helps you to choose how to store XML data.</span></span>  
  
## <a name="relational-or-xml-data-model"></a><span data-ttu-id="13f68-104">Modelo de dados relacional ou XML</span><span class="sxs-lookup"><span data-stu-id="13f68-104">Relational or XML Data Model</span></span>  
 <span data-ttu-id="13f68-105">Se os dados estiverem altamente estruturados com esquema conhecido, o modelo relacional provavelmente funcionará melhor para armazenamento de dados.</span><span class="sxs-lookup"><span data-stu-id="13f68-105">If your data is highly structured with known schema, the relational model is likely to work best for data storage.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="13f68-106">fornece a funcionalidade exigida e ferramentas que podem ser necessárias.</span><span class="sxs-lookup"><span data-stu-id="13f68-106">provides the required functionality and tools you may need.</span></span> <span data-ttu-id="13f68-107">Por outro lado, se a estrutura estiver semiestruturada, desestruturada ou desconhecida, será necessário considerar a modelagem desses dados.</span><span class="sxs-lookup"><span data-stu-id="13f68-107">On the other hand, if the structure is semi-structured or unstructured, or unknown, you have to give consideration to modeling such data.</span></span>  
  
 <span data-ttu-id="13f68-108">O XML é uma boa opção se você desejar um modelo independente de plataforma para garantir a portabilidade dos dados usando marcação estrutural e semântica.</span><span class="sxs-lookup"><span data-stu-id="13f68-108">XML is a good choice if you want a platform-independent model in order to ensure portability of the data by using structural and semantic markup.</span></span> <span data-ttu-id="13f68-109">Além disso, ele será uma opção apropriada se algumas das seguintes propriedades forem atendidas:</span><span class="sxs-lookup"><span data-stu-id="13f68-109">Additionally, it is an appropriate option if some of the following properties are satisfied:</span></span>  
  
-   <span data-ttu-id="13f68-110">Os dados são esparsos ou você não conhece a estrutura dos dados ou a estrutura dos dados pode ser alterada significativamente no futuro.</span><span class="sxs-lookup"><span data-stu-id="13f68-110">Your data is sparse or you do not know the structure of the data, or the structure of your data may change significantly in the future.</span></span>  
  
-   <span data-ttu-id="13f68-111">Seus dados representam hierarquia de confinamento, em vez de referências entre entidades, e podem ser recursivos.</span><span class="sxs-lookup"><span data-stu-id="13f68-111">Your data represents containment hierarchy, instead of references among entities, and may be recursive.</span></span>  
  
-   <span data-ttu-id="13f68-112">A ordem é inerente em seus dados.</span><span class="sxs-lookup"><span data-stu-id="13f68-112">Order is inherent in your data.</span></span>  
  
-   <span data-ttu-id="13f68-113">Você deseja consultar os dados ou atualizar partes dos dados com base em sua estrutura.</span><span class="sxs-lookup"><span data-stu-id="13f68-113">You want to query into the data or update parts of it, based on its structure.</span></span>  
  
 <span data-ttu-id="13f68-114">Se nenhuma dessas condições for atendida, você deverá usar o modelo de dados relacional.</span><span class="sxs-lookup"><span data-stu-id="13f68-114">If none of these conditions is met, you should use the relational data model.</span></span> <span data-ttu-id="13f68-115">Por exemplo, se os dados estiverem em formato XML, mas seu aplicativo usar o banco de dados apenas para armazenar e recuperar dados, uma coluna `[n]varchar(max)` é tudo o que você precisa.</span><span class="sxs-lookup"><span data-stu-id="13f68-115">For example, if your data is in XML format but your application just uses the database to store and retrieve the data, an `[n]varchar(max)` column is all you require.</span></span> <span data-ttu-id="13f68-116">O armazenamento de dados em uma coluna XML traz benefícios adicionais.</span><span class="sxs-lookup"><span data-stu-id="13f68-116">Storing the data in an XML column has additional benefits.</span></span> <span data-ttu-id="13f68-117">Isso inclui fazer com que o mecanismo determine se os dados estão bem formados ou válidos e, também, inclui suporte para atualizações e consultas refinadas nos dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-117">This includes having the engine determine that the data is well formed or valid, and also includes support for fine-grained query and updates into the XML data.</span></span>  
  
## <a name="reasons-for-storing-xml-data-in-sql-server"></a><span data-ttu-id="13f68-118">Razões para o armazenamento de dados XML no SQL Server</span><span class="sxs-lookup"><span data-stu-id="13f68-118">Reasons for Storing XML Data in SQL Server</span></span>  
 <span data-ttu-id="13f68-119">A seguir estão algumas das razões para usar recursos do XML nativo no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] em vez do gerenciamento de dados XML no sistema de arquivos:</span><span class="sxs-lookup"><span data-stu-id="13f68-119">Following are some of the reasons to use native XML features in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instead of managing your XML data in the file system:</span></span>  
  
-   <span data-ttu-id="13f68-120">Você deseja compartilhar, consultar e modificar dados XML de uma maneira eficiente e transacionada.</span><span class="sxs-lookup"><span data-stu-id="13f68-120">You want to share, query, and modify your XML data in an efficient and transacted way.</span></span> <span data-ttu-id="13f68-121">O acesso a dados refinados é importante para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="13f68-121">Fine-grained data access is important to your application.</span></span> <span data-ttu-id="13f68-122">Por exemplo, você pode desejar extrair algumas das seções dentro de um documento XML ou inserir uma nova seção sem substituir todo o documento.</span><span class="sxs-lookup"><span data-stu-id="13f68-122">For example, you may want to extract some of the sections within an XML document, or you may want to insert a new section without replacing your whole document.</span></span>  
  
-   <span data-ttu-id="13f68-123">Você tem dados relacionais e dados XML e deseja ter interoperabilidade entre os dados relacionais e XML dentro de seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="13f68-123">You have relational data and XML data and you want interoperability between both relational and XML data within your application.</span></span>  
  
-   <span data-ttu-id="13f68-124">Você precisa de suporte a idioma para consulta e modificação de dados para aplicativos entre domínios.</span><span class="sxs-lookup"><span data-stu-id="13f68-124">You need language support for query and data modification for cross-domain applications.</span></span>  
  
-   <span data-ttu-id="13f68-125">Você deseja que o servidor garanta que os dados estejam bem formados além de, opcionalmente, validar os dados de acordo com esquemas XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-125">You want the server to guarantee that the data is well formed and also optionally validate your data according to XML schemas.</span></span>  
  
-   <span data-ttu-id="13f68-126">Você deseja indexação de dados XML para processamento eficiente de consultas e boa escalabilidade e o uso de um otimizador de consulta de primeira classe.</span><span class="sxs-lookup"><span data-stu-id="13f68-126">You want indexing of XML data for efficient query processing and good scalability, and the use of a first-rate query optimizer.</span></span>  
  
-   <span data-ttu-id="13f68-127">Você deseja acesso de OLE DB, SOAP e ADO.NET a dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-127">You want SOAP, ADO.NET, and OLE DB access to XML data.</span></span>  
  
-   <span data-ttu-id="13f68-128">Você deseja usar a funcionalidade administrativa do servidor de banco de dados para gerenciar dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-128">You want to use administrative functionality of the database server for managing your XML data.</span></span> <span data-ttu-id="13f68-129">Por exemplo, backup, recuperação e replicação.</span><span class="sxs-lookup"><span data-stu-id="13f68-129">For example, this would be backup, recovery, and replication.</span></span>  
  
 <span data-ttu-id="13f68-130">Se nenhuma dessas condições for atendida, talvez seja melhor armazenar os dados como não XML, tipo de objeto grande, como `[n]varchar(max)` ou `varbinary(max)`.</span><span class="sxs-lookup"><span data-stu-id="13f68-130">If none of these conditions is satisfied, it may be better to store your data as a non-XML, large object type, such as `[n]varchar(max)` or `varbinary(max)`.</span></span>  
  
## <a name="xml-storage-options"></a><span data-ttu-id="13f68-131">Opções de armazenamento XML</span><span class="sxs-lookup"><span data-stu-id="13f68-131">XML Storage Options</span></span>  
 <span data-ttu-id="13f68-132">As opções de armazenamento de XML no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] incluem o seguinte:</span><span class="sxs-lookup"><span data-stu-id="13f68-132">The storage options for XML in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] include the following:</span></span>  
  
-   <span data-ttu-id="13f68-133">Armazenamento nativo como tipo de dados `xml`</span><span class="sxs-lookup"><span data-stu-id="13f68-133">Native storage as `xml` data type</span></span>  
  
     <span data-ttu-id="13f68-134">Os dados são armazenados em uma representação interna que preserva o conteúdo XML dos dados.</span><span class="sxs-lookup"><span data-stu-id="13f68-134">The data is stored in an internal representation that preserves the XML content of the data.</span></span> <span data-ttu-id="13f68-135">Essa representação interna inclui informações sobre a hierarquia de confinamento, a ordem dos documentos e os valores do elemento e do atributo.</span><span class="sxs-lookup"><span data-stu-id="13f68-135">This internal representation includes information about the containment hierarchy, document order, and element and attribute values.</span></span> <span data-ttu-id="13f68-136">Especificamente, o conteúdo de InfoSet dos dados XML é preservado.</span><span class="sxs-lookup"><span data-stu-id="13f68-136">Specifically, the InfoSet content of the XML data is preserved.</span></span> <span data-ttu-id="13f68-137">Para obter mais informações sobre InfoSet, visite [http://www.w3.org/TR/xml-infoset](https://go.microsoft.com/fwlink/?LinkId=48843).</span><span class="sxs-lookup"><span data-stu-id="13f68-137">For more information about InfoSet, visit [http://www.w3.org/TR/xml-infoset](https://go.microsoft.com/fwlink/?LinkId=48843).</span></span> <span data-ttu-id="13f68-138">O conteúdo de InfoSet não pode ser uma cópia idêntica do XML de texto porque as seguintes informações não são mantidas: espaços em branco insuficientes, ordem dos atributos, prefixos de namespace e declaração XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-138">The InfoSet content may not be an identical copy of the text XML, because the following information is not retained: insignificant white spaces, order of attributes, namespace prefixes, and XML declaration.</span></span>  
  
     <span data-ttu-id="13f68-139">Para tipo de dados tipado `xml` , um `xml` tipo de dados vinculado a esquemas XML, o PSVI (Post-Schema Validation infoset) adiciona informações de tipo ao infoset e é codificado na representação interna.</span><span class="sxs-lookup"><span data-stu-id="13f68-139">For typed `xml` data type, an `xml` data type bound to XML schemas, the post-schema validation InfoSet (PSVI) adds type information to the InfoSet and is encoded in the internal representation.</span></span> <span data-ttu-id="13f68-140">Isto melhora a velocidade da análise significativamente.</span><span class="sxs-lookup"><span data-stu-id="13f68-140">This improves parsing speed significantly.</span></span> <span data-ttu-id="13f68-141">Para obter mais informações, consulte as especificações de Esquema XML do W3C em [http://www.w3.org/TR/xmlschema-1](https://go.microsoft.com/fwlink/?LinkId=48881) e [http://www.w3.org/TR/xmlschema-2](https://go.microsoft.com/fwlink/?LinkId=4871).</span><span class="sxs-lookup"><span data-stu-id="13f68-141">For more information, see the W3C XML Schema specifications at [http://www.w3.org/TR/xmlschema-1](https://go.microsoft.com/fwlink/?LinkId=48881) and [http://www.w3.org/TR/xmlschema-2](https://go.microsoft.com/fwlink/?LinkId=4871).</span></span>  
  
-   <span data-ttu-id="13f68-142">Mapeando entre XML e armazenamento relacional</span><span class="sxs-lookup"><span data-stu-id="13f68-142">Mapping between XML and relational storage</span></span>  
  
     <span data-ttu-id="13f68-143">Usando um AXSD (annotated schema), o XML é decomposto em colunas em uma ou mais tabelas.</span><span class="sxs-lookup"><span data-stu-id="13f68-143">By using an annotated schema (AXSD), the XML is decomposed into columns in one or more tables.</span></span> <span data-ttu-id="13f68-144">Isso preserva a fidelidade dos dados no nível relacional.</span><span class="sxs-lookup"><span data-stu-id="13f68-144">This preserves fidelity of the data at the relational level.</span></span> <span data-ttu-id="13f68-145">Como resultado, a estrutura hierárquica é preservada, embora a ordem entre os elementos seja ignorada.</span><span class="sxs-lookup"><span data-stu-id="13f68-145">As a result, the hierarchical structure is preserved although order among elements is ignored.</span></span> <span data-ttu-id="13f68-146">O esquema não pode ser recursivo.</span><span class="sxs-lookup"><span data-stu-id="13f68-146">The schema cannot be recursive.</span></span>  
  
-   <span data-ttu-id="13f68-147">Armazenamento de objeto grande, `[n]varchar(max)` e `varbinary(max)`</span><span class="sxs-lookup"><span data-stu-id="13f68-147">Large object storage, `[n]varchar(max)` and `varbinary(max)`</span></span>  
  
     <span data-ttu-id="13f68-148">Uma cópia idêntica dos dados é armazenada.</span><span class="sxs-lookup"><span data-stu-id="13f68-148">An identical copy of the data is stored.</span></span> <span data-ttu-id="13f68-149">Isso é útil para aplicativos com finalidades especiais, como documentos legais.</span><span class="sxs-lookup"><span data-stu-id="13f68-149">This is useful for special-purpose applications such as legal documents.</span></span> <span data-ttu-id="13f68-150">A maioria dos aplicativos não exige uma cópia exata e ficam satisfeitos com o conteúdo XML (fidelidade de InfoSet).</span><span class="sxs-lookup"><span data-stu-id="13f68-150">Most applications do not require an exact copy and are satisfied with the XML content (InfoSet fidelity).</span></span>  
  
 <span data-ttu-id="13f68-151">Geralmente, você pode precisar usar uma combinação dessas abordagens.</span><span class="sxs-lookup"><span data-stu-id="13f68-151">Generally, you may have to use a combination of these approaches.</span></span> <span data-ttu-id="13f68-152">Por exemplo, você pode desejar armazenar dados XML em uma coluna de tipo de dados `xml` e promover propriedades dela em colunas relacionais.</span><span class="sxs-lookup"><span data-stu-id="13f68-152">For example, you may want to store your XML data in an `xml` data type column and promote properties from it into relational columns.</span></span> <span data-ttu-id="13f68-153">Ou, talvez você queira usar a tecnologia de mapeamento para armazenar partes nonrecursive em colunas não XML e apenas as partes recursivas em `xml` colunas de tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="13f68-153">Or, you may want to use mapping technology to store nonrecursive parts in non-XML columns and only the recursive parts in `xml` data type columns.</span></span>  
  
### <a name="choice-of-xml-technology"></a><span data-ttu-id="13f68-154">Opção de tecnologia XML</span><span class="sxs-lookup"><span data-stu-id="13f68-154">Choice of XML Technology</span></span>  
 <span data-ttu-id="13f68-155">A opção de tecnologia XML, XML nativo versus exibição de XML, geralmente depende dos seguintes fatores:</span><span class="sxs-lookup"><span data-stu-id="13f68-155">The choice of XML technology, native XML versus XML view, generally depends upon the following factors:</span></span>  
  
-   <span data-ttu-id="13f68-156">Opções de armazenamento</span><span class="sxs-lookup"><span data-stu-id="13f68-156">Storage options</span></span>  
  
     <span data-ttu-id="13f68-157">Os dados XML podem ser mais apropriados para armazenamento de objetos grandes (por exemplo, um manual do produto) ou mais compatível para armazenamento em colunas relacionais (por exemplo, um item de linha convertido em XML).</span><span class="sxs-lookup"><span data-stu-id="13f68-157">Your XML data may be more appropriate for large object storage (for example, a product manual), or more amenable to storage in relational columns (for example, a line item converted to XML).</span></span> <span data-ttu-id="13f68-158">Cada opção de armazenamento preserva a fidelidade do documento a uma extensão diferente.</span><span class="sxs-lookup"><span data-stu-id="13f68-158">Each storage option preserves document fidelity to a different extent.</span></span>  
  
-   <span data-ttu-id="13f68-159">Capacidades de consulta</span><span class="sxs-lookup"><span data-stu-id="13f68-159">Query capabilities</span></span>  
  
     <span data-ttu-id="13f68-160">Uma opção de armazenamento pode ser mais apropriada do que outra com base na natureza de suas consultas e na extensão na qual os dados XML são consultados.</span><span class="sxs-lookup"><span data-stu-id="13f68-160">You may find one storage option more appropriate than another, based on the nature of your queries and on the extent to which you query your XML data.</span></span> <span data-ttu-id="13f68-161">Nas duas opções de armazenamento, há suporte em vários níveis para consulta refinada de seus dados XML, por exemplo, para avaliação de predicado em nós XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-161">Fine-grained query of your XML data, for example, predicate evaluation on XML nodes, is supported to varying degrees in the two storage options.</span></span>  
  
-   <span data-ttu-id="13f68-162">Indexando dados XML</span><span class="sxs-lookup"><span data-stu-id="13f68-162">Indexing XML data</span></span>  
  
     <span data-ttu-id="13f68-163">Talvez você deseje indexar os dados XML para acelerar o desempenho de consultas XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-163">You may want to index the XML data to speed up XML query performance.</span></span> <span data-ttu-id="13f68-164">As opções de indexação variam de acordo com as opções de armazenamento. É necessário fazer a escolha apropriada para otimizar sua carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="13f68-164">Indexing options vary with the storage options; you have to make the appropriate choice to optimize your workload.</span></span>  
  
-   <span data-ttu-id="13f68-165">Capacidades de modificação de dados</span><span class="sxs-lookup"><span data-stu-id="13f68-165">Data modification capabilities</span></span>  
  
     <span data-ttu-id="13f68-166">Algumas cargas de trabalho envolvem modificação refinada de dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-166">Some workloads involve fine-grained modification of XML data.</span></span> <span data-ttu-id="13f68-167">Por exemplo, isso pode incluir a adição de uma nova seção dentro de um documento, enquanto outras cargas de trabalho, como conteúdo da Web, não incluem.</span><span class="sxs-lookup"><span data-stu-id="13f68-167">For example, this can include adding a new section within a document, while other workloads, such as Web content, do not.</span></span> <span data-ttu-id="13f68-168">O suporte à linguagem de modificação de dados pode ser importante para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="13f68-168">Data modification language support may be important for your application.</span></span>  
  
-   <span data-ttu-id="13f68-169">Suporte de esquema</span><span class="sxs-lookup"><span data-stu-id="13f68-169">Schema support</span></span>  
  
     <span data-ttu-id="13f68-170">Os dados XML podem ser descritos por um esquema que pode ou não ser um documento de esquema XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-170">Your XML data may be described by a schema that may or may not be an XML schema document.</span></span> <span data-ttu-id="13f68-171">O suporte para XML associado a esquema depende da tecnologia XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-171">The support for schema-bound XML depends upon the XML technology.</span></span>  
  
 <span data-ttu-id="13f68-172">Opções diferentes também têm características diferentes de desempenho.</span><span class="sxs-lookup"><span data-stu-id="13f68-172">Different choices also have different performance characteristics.</span></span>  
  
### <a name="native-xml-storage"></a><span data-ttu-id="13f68-173">Armazenamento XML nativo</span><span class="sxs-lookup"><span data-stu-id="13f68-173">Native XML Storage</span></span>  
 <span data-ttu-id="13f68-174">É possível armazenar dados XML em uma coluna de tipo de dados `xml` no servidor.</span><span class="sxs-lookup"><span data-stu-id="13f68-174">You can store your XML data in an `xml` data type column at the server.</span></span> <span data-ttu-id="13f68-175">Essa escolha será apropriada se as seguintes condições forem aplicadas:</span><span class="sxs-lookup"><span data-stu-id="13f68-175">This is an appropriate choice if the following applies:</span></span>  
  
-   <span data-ttu-id="13f68-176">Você deseja uma maneira direta de armazenar dados XML no servidor e, ao mesmo tempo, preservar a ordem e a estrutura do documento.</span><span class="sxs-lookup"><span data-stu-id="13f68-176">You want a straightforward way to store your XML data at the server and, at the same time, preserve document order and document structure.</span></span>  
  
-   <span data-ttu-id="13f68-177">Você pode ou não ter um esquema para seus dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-177">You may or may not have a schema for your XML data.</span></span>  
  
-   <span data-ttu-id="13f68-178">Você deseja consultar e modificar os dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-178">You want to query and modify your XML data.</span></span>  
  
-   <span data-ttu-id="13f68-179">Você deseja indexar os dados XML para acelerar o processamento de consultas.</span><span class="sxs-lookup"><span data-stu-id="13f68-179">You want to index the XML data for faster query processing.</span></span>  
  
-   <span data-ttu-id="13f68-180">Seu aplicativo precisa de exibições do catálogo do sistema para administrar seus dados e esquemas XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-180">Your application needs system catalog views to administer your XML data and XML schemas.</span></span>  
  
 <span data-ttu-id="13f68-181">O armazenamento XML nativo é útil quando você tem documentos XML que têm um intervalo de estruturas ou documentos XML que estão de acordo com esquemas diferentes ou complexos muito difíceis de mapear para estruturas relacionais.</span><span class="sxs-lookup"><span data-stu-id="13f68-181">Native XML storage is useful when you have XML documents that have a range of structures, or you have XML documents that conform to different or complex schemas that are too hard to map to relational structures.</span></span>  
  
#### <a name="example-modeling-xml-data-using-the-xml-data-type"></a><span data-ttu-id="13f68-182">Exemplo: Modelando dados XML com o tipo de dados xml</span><span class="sxs-lookup"><span data-stu-id="13f68-182">Example: Modeling XML Data Using the xml Data Type</span></span>  
 <span data-ttu-id="13f68-183">Considere o manual de um produto em formato XML composto por um capítulo separado para cada tópico e com várias seções dentro de cada capítulo.</span><span class="sxs-lookup"><span data-stu-id="13f68-183">Consider a product manual in XML format that is made up of a separate chapter for each topic and that has multiple sections within each chapter.</span></span> <span data-ttu-id="13f68-184">Uma seção pode conter subseções.</span><span class="sxs-lookup"><span data-stu-id="13f68-184">A section can contain subsections.</span></span> <span data-ttu-id="13f68-185">Como resultado, \<section> é um elemento recursivo.</span><span class="sxs-lookup"><span data-stu-id="13f68-185">As a result, \<section> is a recursive element.</span></span> <span data-ttu-id="13f68-186">Os manuais de produtos contêm uma grande quantidade de conteúdo misto, diagramas e material técnico. Os dados são semiestruturados.</span><span class="sxs-lookup"><span data-stu-id="13f68-186">Product manuals contain a large amount of mixed content, diagrams, and technical material; the data is semi-structured.</span></span> <span data-ttu-id="13f68-187">Os usuários podem desejar executar uma pesquisa contextual para obter tópicos de interesse, como pesquisar a seção sobre "índice clusterizado" dentro do capítulo sobre "indexação" e consultar as quantidades técnicas.</span><span class="sxs-lookup"><span data-stu-id="13f68-187">Users may want to perform a contextual search for topics of interest such as searching for the section on "clustered index" within the chapter on "indexing", and query technical quantities.</span></span>  
  
 <span data-ttu-id="13f68-188">Um modelo de armazenamento apropriado para seus documentos XML é uma coluna de tipo de dados `xml`.</span><span class="sxs-lookup"><span data-stu-id="13f68-188">An appropriate storage model for your XML documents is an `xml` data type column.</span></span> <span data-ttu-id="13f68-189">Isso preserva o conteúdo de InfoSet de seus dados XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-189">This preserves the InfoSet content of your XML data.</span></span> <span data-ttu-id="13f68-190">A indexação de colunas XML beneficia o desempenho de consultas.</span><span class="sxs-lookup"><span data-stu-id="13f68-190">Indexing the XML column benefits query performance.</span></span>  
  
#### <a name="example-retaining-exact-copies-of-xml-data"></a><span data-ttu-id="13f68-191">Exemplo: Mantendo cópias exatas de dados XML</span><span class="sxs-lookup"><span data-stu-id="13f68-191">Example: Retaining Exact Copies of XML Data</span></span>  
 <span data-ttu-id="13f68-192">Para ilustrar, assuma que os regulamentos governamentais exigem que você mantenha cópias textuais exatas de seus documentos XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-192">For illustration, assume that government regulations require you to retain exact textual copies of your XML documents.</span></span> <span data-ttu-id="13f68-193">Por exemplo, isso pode incluir documentos assinados, documentos legais ou pedidos de transação de estoque.</span><span class="sxs-lookup"><span data-stu-id="13f68-193">For example, these could include signed documents, legal documents, or stock transaction orders.</span></span> <span data-ttu-id="13f68-194">Você pode desejar armazenar seus documentos em uma coluna `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="13f68-194">You may want to store your documents in a `[n]varchar(max)` column.</span></span>  
  
 <span data-ttu-id="13f68-195">Para consultar, converta os dados em tipo de dados `xml` em tempo de execução e execute Xquery sobre eles.</span><span class="sxs-lookup"><span data-stu-id="13f68-195">For querying, convert the data to `xml` data type at run time and execute Xquery on it.</span></span> <span data-ttu-id="13f68-196">A conversão em tempo de execução pode ser dispendiosa, principalmente quando o documento é grande.</span><span class="sxs-lookup"><span data-stu-id="13f68-196">The run-time conversion may be costly, especially when the document is large.</span></span> <span data-ttu-id="13f68-197">Se a consulta for feita com frequência, você poderá armazenar os documentos de maneira redundante em uma coluna de tipo de dados `xml` e indexá-los enquanto retorna cópias exatas dos documentos da coluna `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="13f68-197">If you query frequently, you can redundantly store the documents in an `xml` data type column and index it while you return exact document copies from the `[n]varchar(max)` column.</span></span>  
  
 <span data-ttu-id="13f68-198">A coluna XML pode ser uma coluna computada, baseada na coluna `[n]varchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="13f68-198">The XML column may be a computed column, based on the `[n]varchar(max)` column.</span></span> <span data-ttu-id="13f68-199">No entanto, você não pode criar um índice XML em uma coluna XML computada, nem um índice XML pode ser criado em `[n]varchar(max)` `varbinary(max)` colunas ou.</span><span class="sxs-lookup"><span data-stu-id="13f68-199">However, you cannot create an XML index on a computed, XML column, nor can an XML index be built on `[n]varchar(max)` or `varbinary(max)` columns.</span></span>  
  
### <a name="xml-view-technology"></a><span data-ttu-id="13f68-200">Tecnologia de exibição XML</span><span class="sxs-lookup"><span data-stu-id="13f68-200">XML View Technology</span></span>  
 <span data-ttu-id="13f68-201">Ao definir um mapeamento entre seus esquemas XML e as tabelas em um banco de dados, você cria uma "exibição XML" dos dados persistentes.</span><span class="sxs-lookup"><span data-stu-id="13f68-201">By defining a mapping between your XML schemas and the tables in a database, you create an "XML view" of your persistent data.</span></span> <span data-ttu-id="13f68-202">O carregamento de XML em massa pode ser usado para popular as tabelas subjacentes usando a exibição XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-202">XML bulk load can be used to populate the underlying tables by using the XML view.</span></span> <span data-ttu-id="13f68-203">É possível consultar a exibição XML usando XPath versão 1.0. A consulta é convertida em consultas SQL nas tabelas.</span><span class="sxs-lookup"><span data-stu-id="13f68-203">You can query the XML view by using XPath version 1.0; the query is translated to SQL queries on the tables.</span></span> <span data-ttu-id="13f68-204">De maneira semelhante, as atualizações também são propagadas para essas tabelas.</span><span class="sxs-lookup"><span data-stu-id="13f68-204">Similarly, updates are also propagated to those tables.</span></span>  
  
 <span data-ttu-id="13f68-205">Essa tecnologia é útil nas seguintes situações:</span><span class="sxs-lookup"><span data-stu-id="13f68-205">This technology is useful in the following situations:</span></span>  
  
-   <span data-ttu-id="13f68-206">Você deseja ter um modelo de programação centrado em XML usando exibições XML sobre seus dados relacionais existentes.</span><span class="sxs-lookup"><span data-stu-id="13f68-206">You want to have an XML-centric programming model using XML views over your existing relational data.</span></span>  
  
-   <span data-ttu-id="13f68-207">Você tem um esquema (XSD, XDR) para seus dados XML que um parceiro externo pode ter fornecido.</span><span class="sxs-lookup"><span data-stu-id="13f68-207">You have a schema (XSD, XDR) for your XML data that an external partner may have provided.</span></span>  
  
-   <span data-ttu-id="13f68-208">A ordem não é importante nos dados, os dados da tabela de consulta não são recursivos ou a profundidade máxima da recursão é conhecida antecipadamente.</span><span class="sxs-lookup"><span data-stu-id="13f68-208">Order is not important in your data, or your query table data is not recursive, or the maximal recursion depth is known in advance.</span></span>  
  
-   <span data-ttu-id="13f68-209">Você deseja consultar e modificar os dados pela exibição XML usando XPath versão 1.0.</span><span class="sxs-lookup"><span data-stu-id="13f68-209">You want to query and modify the data through the XML view by using XPath version 1.0.</span></span>  
  
-   <span data-ttu-id="13f68-210">Você deseja carregar dados XML em massa e decompô-los nas tabelas subjacentes usando a exibição XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-210">You want to bulk load XML data and decompose them into the underlying tables by using the XML view.</span></span>  
  
 <span data-ttu-id="13f68-211">Os exemplos incluem dados relacionais expostos como XML para troca de dados e serviços da Web e dados XML com esquema fixo.</span><span class="sxs-lookup"><span data-stu-id="13f68-211">Examples include relational data exposed as XML for data exchange and Web services, and XML data with fixed schema.</span></span> <span data-ttu-id="13f68-212">Para obter mais informações, consulte [MSDN Online Library](https://go.microsoft.com/fwlink/?linkid=31174).</span><span class="sxs-lookup"><span data-stu-id="13f68-212">For more information, see the [MSDN Online Library](https://go.microsoft.com/fwlink/?linkid=31174).</span></span>  
  
#### <a name="example-modeling-data-using-an-annotated-xml-schema-axsd"></a><span data-ttu-id="13f68-213">Exemplo: Modelando dados usando um AXSD (Esquema XML Anotado)</span><span class="sxs-lookup"><span data-stu-id="13f68-213">Example: Modeling Data Using an Annotated XML Schema (AXSD)</span></span>  
 <span data-ttu-id="13f68-214">Para ilustrar, assuma que você tem dados relacionais existentes, como clientes, pedidos e itens de linha que deseja tratar como XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-214">For illustration, assume that you have existing relational data, such as customers, orders, and line items, that you want to handle as XML.</span></span> <span data-ttu-id="13f68-215">Defina uma exibição XML usando AXSD sobre dados relacionais.</span><span class="sxs-lookup"><span data-stu-id="13f68-215">Define an XML view by using AXSD over the relational data.</span></span> <span data-ttu-id="13f68-216">A exibição XML permite carregar dados XML em massa em suas tabelas e consultar e atualizar os dados relacionais usando a exibição XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-216">The XML view allows you to bulk load XML data into your tables and query and update the relational data by using the XML view.</span></span> <span data-ttu-id="13f68-217">Esse modelo é útil se você precisar trocar dados que contêm marcação XML com outros aplicativos enquanto seus aplicativos SQL funcionam sem interrupção.</span><span class="sxs-lookup"><span data-stu-id="13f68-217">This model is useful if you have to exchange data that contains XML markup with other applications while your SQL applications work uninterrupted.</span></span>  
  
### <a name="hybrid-model"></a><span data-ttu-id="13f68-218">Modelo híbrido</span><span class="sxs-lookup"><span data-stu-id="13f68-218">Hybrid Model</span></span>  
 <span data-ttu-id="13f68-219">Frequentemente, uma combinação de colunas de tipo relacional e de `xml` dados é apropriada para a modelagem de dados.</span><span class="sxs-lookup"><span data-stu-id="13f68-219">Frequently, a combination of relational and `xml` data type columns is appropriate for data modeling.</span></span> <span data-ttu-id="13f68-220">Alguns dos valores de seus dados XML podem ser armazenados em colunas relacionais e o restante, ou todo o valor XML, armazenado em uma coluna XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-220">Some of the values from your XML data can be stored in relational columns, and the rest, or the whole XML value stored in an XML column.</span></span> <span data-ttu-id="13f68-221">Isso pode resultar em um melhor desempenho no qual você terá mais controle sobre os índices criados nas colunas relacionais e características de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="13f68-221">This may yield better performance in that you have more control over the indexes created on the relational columns and locking characteristics.</span></span>  
  
 <span data-ttu-id="13f68-222">Os valores a serem armazenados em colunas relacionais dependem de sua carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="13f68-222">The values to store in relational columns depend on your workload.</span></span> <span data-ttu-id="13f68-223">Por exemplo, você pode conseguir um desempenho mais rápido da consulta se recuperar todos os valores XML com base na expressão de caminho, /Customer/@CustId, promovendo o valor do atributo **CustId** em uma coluna relacional e indexando-o.</span><span class="sxs-lookup"><span data-stu-id="13f68-223">For example, if you retrieve all the XML values based on the path expression, /Customer/@CustId, promoting the value of the **CustId** attribute into a relational column and indexing it may yield faster query performance.</span></span> <span data-ttu-id="13f68-224">Por outro lado, se os dados XML forem decompostos de maneira extensiva e não redundante em colunas relacionais, o custo de remontagem poderá ser significativo.</span><span class="sxs-lookup"><span data-stu-id="13f68-224">On the other hand, if your XML data is extensively and nonredundantly decomposed into relational columns, the re-assembly cost may be significant.</span></span>  
  
 <span data-ttu-id="13f68-225">Para dados XML altamente estruturados, por exemplo, o conteúdo de uma tabela foi convertido em XML, você pode mapear todos os valores para colunas relacionais e provavelmente usar tecnologia de exibição XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-225">For highly structured XML data, for example, the content of a table has been converted into XML; you can map all values to relational columns, and possibly use XML view technology.</span></span>  
  
## <a name="granularity-of-xml-data"></a><span data-ttu-id="13f68-226">Granularidade de dados XML</span><span class="sxs-lookup"><span data-stu-id="13f68-226">Granularity of XML Data</span></span>  
 <span data-ttu-id="13f68-227">A granularidade dos dados XML armazenados em uma coluna XML é muito importante para bloqueio e, em um nível menor, também é importante para atualizações.</span><span class="sxs-lookup"><span data-stu-id="13f68-227">The granularity of the XML data stored in an XML column is very important for locking and, to a lesser degree, it is also important for updates.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="13f68-228">usa o mesmo mecanismo de bloqueio para dados XML e não XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-228">uses the same locking mechanism for both XML and non-XML data.</span></span> <span data-ttu-id="13f68-229">Portanto, o bloqueio em nível de linha faz com que todas as instâncias XML na linha sejam bloqueadas.</span><span class="sxs-lookup"><span data-stu-id="13f68-229">Therefore, row-level locking causes all XML instances in the row to be locked.</span></span> <span data-ttu-id="13f68-230">Quando a granularidade é grande, o bloqueio de grandes instâncias XML para atualizações faz com que a taxa de transferência decline em um cenário multiusuário.</span><span class="sxs-lookup"><span data-stu-id="13f68-230">When the granularity is large, locking large XML instances for updates causes throughput to decline in a multiuser scenario.</span></span> <span data-ttu-id="13f68-231">Por outro lado, a decomposição grave perde o encapsulamento de objetos e aumenta o custo de reassembly.</span><span class="sxs-lookup"><span data-stu-id="13f68-231">On the other hand, severe decomposition loses object encapsulation and increases reassembly cost.</span></span>  
  
 <span data-ttu-id="13f68-232">Um equilíbrio entre requisitos de modelagem de dados e características de atualização e bloqueio é importante para um bom design.</span><span class="sxs-lookup"><span data-stu-id="13f68-232">A balance between data modeling requirements and locking and update characteristics is important for good design.</span></span> <span data-ttu-id="13f68-233">No entanto, no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], o tamanho de instâncias XML armazenadas reais não é crítico.</span><span class="sxs-lookup"><span data-stu-id="13f68-233">However, in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the size of actual stored XML instances is not as critical.</span></span>  
  
 <span data-ttu-id="13f68-234">Por exemplo, as atualizações em uma instância XML são executadas usando novo suporte para atualizações de BLOB (objetos binários grandes) parciais e de índices parciais nas quais a instância XML armazenada existente é comparada com sua versão atualizada.</span><span class="sxs-lookup"><span data-stu-id="13f68-234">For example, updates to an XML instance are performed by using new support for partial binary large object (BLOB) and partial index updates in which the existing stored XML instance is compared to its updated version.</span></span> <span data-ttu-id="13f68-235">A atualização de BLOB (objetos binários grandes) parcial executa uma comparação diferencial entre as duas instâncias XML e atualiza apenas as diferenças.</span><span class="sxs-lookup"><span data-stu-id="13f68-235">Partial binary large object (BLOB) update performs a differential comparison between the two XML instances and updates only the differences.</span></span> <span data-ttu-id="13f68-236">As atualizações parciais de índice modificam apenas as linhas que devem ser alteradas no índice XML.</span><span class="sxs-lookup"><span data-stu-id="13f68-236">Partial index updates modify only those rows that must be changed in the XML index.</span></span>  
  
## <a name="limitations-of-the-xml-data-type"></a><span data-ttu-id="13f68-237">Limitações do tipo de dados xml</span><span class="sxs-lookup"><span data-stu-id="13f68-237">Limitations of the xml Data Type</span></span>  
 <span data-ttu-id="13f68-238">Observe as seguintes limitações gerais que se aplicam ao tipo de dados `xml`:</span><span class="sxs-lookup"><span data-stu-id="13f68-238">Note the following general limitations that apply to the `xml` data type:</span></span>  
  
-   <span data-ttu-id="13f68-239">A representação armazenada de instâncias de tipo de dados `xml` não pode exceder 2 GB.</span><span class="sxs-lookup"><span data-stu-id="13f68-239">The stored representation of `xml` data type instances cannot exceed 2 GB.</span></span>  
  
-   <span data-ttu-id="13f68-240">Ele não pode ser usado como um subtipo de uma instância **sql_variant** .</span><span class="sxs-lookup"><span data-stu-id="13f68-240">It cannot be used as a subtype of a **sql_variant** instance.</span></span>  
  
-   <span data-ttu-id="13f68-241">Ele não oferece suporte à conversão de `text` ou `ntext`.</span><span class="sxs-lookup"><span data-stu-id="13f68-241">It does not support casting or converting to either `text` or `ntext`.</span></span> <span data-ttu-id="13f68-242">Em vez disso, use `varchar(max)` ou `nvarchar(max)`.</span><span class="sxs-lookup"><span data-stu-id="13f68-242">Use `varchar(max)` or `nvarchar(max)` instead.</span></span>  
  
-   <span data-ttu-id="13f68-243">Ele não pode ser comparado ou classificado.</span><span class="sxs-lookup"><span data-stu-id="13f68-243">It cannot be compared or sorted.</span></span> <span data-ttu-id="13f68-244">Isto significa que um tipo de dados `xml` não pode ser usado em uma instrução GROUP BY.</span><span class="sxs-lookup"><span data-stu-id="13f68-244">This means an `xml` data type cannot be used in a GROUP BY statement.</span></span>  
  
-   <span data-ttu-id="13f68-245">Ele não pode ser usado como um parâmetro para nenhuma função escalar interna além de ISNULL, COALESCE e DATALENGTH.</span><span class="sxs-lookup"><span data-stu-id="13f68-245">It cannot be used as a parameter to any scalar, built-in functions other than ISNULL, COALESCE, and DATALENGTH.</span></span>  
  
-   <span data-ttu-id="13f68-246">Ele não pode ser usado como uma coluna de chaves em um índice.</span><span class="sxs-lookup"><span data-stu-id="13f68-246">It cannot be used as a key column in an index.</span></span> <span data-ttu-id="13f68-247">No entanto ele pode ser incluído como dados em um índice clusterizado ou adicionado explicitamente em um índice não clusterizado usando a palavra-chave INCLUDE quando o índice não clusterizado é criado.</span><span class="sxs-lookup"><span data-stu-id="13f68-247">However, it can be included as data in a clustered index or explicitly added to a nonclustered index by using the INCLUDE keyword when the nonclustered index is created.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="13f68-248">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="13f68-248">See Also</span></span>  
 [<span data-ttu-id="13f68-249">Exemplos de importação e exportação em massa de documentos XML &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="13f68-249">Examples of Bulk Import and Export of XML Documents &#40;SQL Server&#41;</span></span>](../import-export/examples-of-bulk-import-and-export-of-xml-documents-sql-server.md)  
  
  
