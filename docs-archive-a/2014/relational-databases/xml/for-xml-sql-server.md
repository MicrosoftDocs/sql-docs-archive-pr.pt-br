---
title: FOR XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, about FOR XML clause
- PATH FOR XML mode, construction
- EXPLICIT FOR XML mode
- RAW FOR XML mode
- retrieving XML data
- XML [SQL Server], FOR XML clause
- AUTO FOR XML mode
- XML [SQL Server], construction
ms.assetid: 2b6b5c61-c5bd-49d2-8c0c-b7cf15857906
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe55186e89020f57ae1eb078625d1cdce262864
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87686195"
---
# <a name="for-xml-sql-server"></a><span data-ttu-id="47dcf-102">FOR XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="47dcf-102">FOR XML (SQL Server)</span></span>
  <span data-ttu-id="47dcf-103">Uma consulta SELECT retorna resultados como um conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="47dcf-103">A SELECT query returns results as a rowset.</span></span> <span data-ttu-id="47dcf-104">Opcionalmente, é possível recuperar resultados formais de uma consulta SQL como XML com a especificação da cláusula FOR XML na consulta.</span><span class="sxs-lookup"><span data-stu-id="47dcf-104">You can optionally retrieve formal results of a SQL query as XML by specifying the FOR XML clause in the query.</span></span> <span data-ttu-id="47dcf-105">É possível usar a cláusula FOR XML em consultas de nível superior e em subconsultas.</span><span class="sxs-lookup"><span data-stu-id="47dcf-105">The FOR XML clause can be used in top-level queries and in sub queries.</span></span> <span data-ttu-id="47dcf-106">A cláusula FOR XML de nível superior pode ser usada apenas na instrução SELECT.</span><span class="sxs-lookup"><span data-stu-id="47dcf-106">The top-level FOR XML clause can be used only in the SELECT statement.</span></span> <span data-ttu-id="47dcf-107">Em subconsultas, FOR XML pode ser usado nas instruções INSERT, UPDATE e DELETE.</span><span class="sxs-lookup"><span data-stu-id="47dcf-107">In sub queries, FOR XML can be used in the INSERT, UPDATE, and DELETE statements.</span></span> <span data-ttu-id="47dcf-108">Ele também pode ser usado em instruções de atribuição.</span><span class="sxs-lookup"><span data-stu-id="47dcf-108">It can also be used in assignment statements.</span></span>  
  
 <span data-ttu-id="47dcf-109">Em uma cláusula FOR XML, você especifica um destes modos:</span><span class="sxs-lookup"><span data-stu-id="47dcf-109">In a FOR XML clause, you specify one of these modes:</span></span>  
  
-   <span data-ttu-id="47dcf-110">RAW</span><span class="sxs-lookup"><span data-stu-id="47dcf-110">RAW</span></span>  
  
-   <span data-ttu-id="47dcf-111">AUTO</span><span class="sxs-lookup"><span data-stu-id="47dcf-111">AUTO</span></span>  
  
-   <span data-ttu-id="47dcf-112">EXPLICIT</span><span class="sxs-lookup"><span data-stu-id="47dcf-112">EXPLICIT</span></span>  
  
-   <span data-ttu-id="47dcf-113">PATH</span><span class="sxs-lookup"><span data-stu-id="47dcf-113">PATH</span></span>  
  
 <span data-ttu-id="47dcf-114">O modo RAW gera um elemento \<row> por linha no conjunto de linhas retornado pela instrução SELECT.</span><span class="sxs-lookup"><span data-stu-id="47dcf-114">The RAW mode generates a single \<row> element per row in the rowset that is returned by the SELECT statement.</span></span> <span data-ttu-id="47dcf-115">É possível gerar hierarquia de XML escrevendo consultas FOR XML aninhadas.</span><span class="sxs-lookup"><span data-stu-id="47dcf-115">You can generate XML hierarchy by writing nested FOR XML queries.</span></span>  
  
 <span data-ttu-id="47dcf-116">O modo AUTO gera aninhamento no XML resultante usando heurística com base na maneira como a instrução SELECT é especificada.</span><span class="sxs-lookup"><span data-stu-id="47dcf-116">The AUTO mode generates nesting in the resulting XML by using heuristics based on the way the SELECT statement is specified.</span></span> <span data-ttu-id="47dcf-117">Você tem controle mínimo sobre a forma do XML gerado.</span><span class="sxs-lookup"><span data-stu-id="47dcf-117">You have minimal control over the shape of the XML generated.</span></span> <span data-ttu-id="47dcf-118">As consultas FOR XML aninhadas podem ser escritas para gerar hierarquia de XML além da forma do XML gerada pela heurística do modo AUTO.</span><span class="sxs-lookup"><span data-stu-id="47dcf-118">The nested FOR XML queries can be written to generate XML hierarchy beyond the XML shape that is generated by AUTO mode heuristics.</span></span>  
  
 <span data-ttu-id="47dcf-119">O modo EXPLICIT permite mais controle sobre a forma do XML.</span><span class="sxs-lookup"><span data-stu-id="47dcf-119">The EXPLICIT mode allows more control over the shape of the XML.</span></span> <span data-ttu-id="47dcf-120">É possível misturar atributos e elementos à vontade para decidir a forma do XML.</span><span class="sxs-lookup"><span data-stu-id="47dcf-120">You can mix attributes and elements at will in deciding the shape of the XML.</span></span> <span data-ttu-id="47dcf-121">Um formato específico é necessário para o conjunto de linhas resultante que é gerado por causa da execução da consulta.</span><span class="sxs-lookup"><span data-stu-id="47dcf-121">It requires a specific format for the resulting rowset that is generated because of query execution.</span></span> <span data-ttu-id="47dcf-122">Em seguida, esse formato do conjunto de linhas é mapeado na forma do XML.</span><span class="sxs-lookup"><span data-stu-id="47dcf-122">This rowset format is then mapped into XML shape.</span></span> <span data-ttu-id="47dcf-123">A força do modo EXPLICIT é misturar atributos e elementos à vontade, criar wrappers e propriedades aninhadas complexas, criar valores separados por espaços (por exemplo, o atributo OrderID pode ter uma lista de valores de ID de ordem) e conteúdo misto.</span><span class="sxs-lookup"><span data-stu-id="47dcf-123">The power of EXPLICIT mode is to mix attributes and elements at will, create wrappers and nested complex properties, create space-separated values (for example, OrderID attribute may have a list of order ID values), and mixed contents.</span></span>  
  
 <span data-ttu-id="47dcf-124">No entanto, a escrita de consultas no modo EXPLICIT pode ser trabalhosa.</span><span class="sxs-lookup"><span data-stu-id="47dcf-124">However, writing EXPLICIT mode queries can be cumbersome.</span></span> <span data-ttu-id="47dcf-125">É possível usar algumas das novas funcionalidades de FOR XML, como escrita da diretiva TYPE e de consultas no modo FOR XML RAW/AUTO/PATH, em vez de usar o modo EXPLICIT para gerar as hierarquias.</span><span class="sxs-lookup"><span data-stu-id="47dcf-125">You can use some of the new FOR XML capabilities, such as writing nested FOR XML RAW/AUTO/PATH mode queries and the TYPE directive, instead of using EXPLICIT mode to generate the hierarchies.</span></span> <span data-ttu-id="47dcf-126">As consultas FOR XML aninhadas podem produzir qualquer XML que possa ser gerado usando o modo EXPLICIT.</span><span class="sxs-lookup"><span data-stu-id="47dcf-126">The nested FOR XML queries can produce any XML that you can generate by using the EXPLICIT mode.</span></span> <span data-ttu-id="47dcf-127">Para obter mais informações, consulte [Usar consultas FOR XML aninhadas](use-nested-for-xml-queries.md) e [Diretiva TYPE em consultas FOR XML](type-directive-in-for-xml-queries.md).</span><span class="sxs-lookup"><span data-stu-id="47dcf-127">For more information, see [Use Nested FOR XML Queries](use-nested-for-xml-queries.md) and [TYPE Directive in FOR XML Queries](type-directive-in-for-xml-queries.md).</span></span>  
  
 <span data-ttu-id="47dcf-128">O modo PATH em conjunto com a funcionalidade de consulta FOR XML aninhada fornece a flexibilidade do modo EXPLICIT de uma maneira mais simples.</span><span class="sxs-lookup"><span data-stu-id="47dcf-128">The PATH mode together with the nested FOR XML query capability provides the flexibility of the EXPLICIT mode in a simpler manner.</span></span>  
  
 <span data-ttu-id="47dcf-129">Esses modos estão em efeito apenas para a execução da consulta para a qual eles estão definidos.</span><span class="sxs-lookup"><span data-stu-id="47dcf-129">These modes are in effect only for the execution of the query for which they are set.</span></span> <span data-ttu-id="47dcf-130">Eles não afetam os resultados de nenhuma consulta subsequente.</span><span class="sxs-lookup"><span data-stu-id="47dcf-130">They do not affect the results of any subsequent queries.</span></span>  
  
 <span data-ttu-id="47dcf-131">FOR XML não é válido para nenhuma seleção usada com uma cláusula FOR BROWSE.</span><span class="sxs-lookup"><span data-stu-id="47dcf-131">FOR XML is not valid for any selection that is used with a FOR BROWSE clause.</span></span>  
  
## <a name="example"></a><span data-ttu-id="47dcf-132">Exemplo</span><span class="sxs-lookup"><span data-stu-id="47dcf-132">Example</span></span>  
 <span data-ttu-id="47dcf-133">A instrução `SELECT` a seguir recupera informações das tabelas `Sales.Customer` e `Sales.SalesOrderHeader` o banco de dados `AdventureWorks2012` .</span><span class="sxs-lookup"><span data-stu-id="47dcf-133">The following `SELECT` statement retrieves information from the `Sales.Customer` and `Sales.SalesOrderHeader` tables in the `AdventureWorks2012` database.</span></span> <span data-ttu-id="47dcf-134">Essa consulta especifica o modo `AUTO` na cláusula `FOR XML` :</span><span class="sxs-lookup"><span data-stu-id="47dcf-134">This query specifies the `AUTO` mode in the `FOR XML` clause:</span></span>  
  
```  
USE AdventureWorks2012  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       OrderHeader.Status  
FROM Sales.Customer Cust   
INNER JOIN Sales.SalesOrderHeader OrderHeader  
ON Cust.CustomerID = OrderHeader.CustomerID  
FOR XML AUTO  
```  
  
## <a name="the-for-xml-clause-and-server-names"></a><span data-ttu-id="47dcf-135">Cláusula FOR XML e nomes de servidores</span><span class="sxs-lookup"><span data-stu-id="47dcf-135">The FOR XML Clause and Server Names</span></span>  
 <span data-ttu-id="47dcf-136">Quando uma instrução SELECT com uma cláusula FOR XML especifica um nome de quatro partes na consulta, o nome do servidor não é retornado no documento XML resultante quando a consulta é executada no computador local.</span><span class="sxs-lookup"><span data-stu-id="47dcf-136">When a SELECT statement with a FOR XML clause specifies a four-part name in the query, the server name is not returned in the resulting XML document when the query is executed on the local computer.</span></span> <span data-ttu-id="47dcf-137">No entanto o nome do servidor é retornado como o nome de quatro partes quando a consulta é executada em um servidor de rede.</span><span class="sxs-lookup"><span data-stu-id="47dcf-137">However, the server name is returned as the four-part name when the query is executed on a network server.</span></span>  
  
 <span data-ttu-id="47dcf-138">Por exemplo, considere esta consulta:</span><span class="sxs-lookup"><span data-stu-id="47dcf-138">For example, consider this query:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person  
FOR XML AUTO  
```  
  
 <span data-ttu-id="47dcf-139">Quando `ServerName` for um servidor local, a consulta retornará seguinte:</span><span class="sxs-lookup"><span data-stu-id="47dcf-139">When `ServerName` is a local server, the query returns the following:</span></span>  
  
```  
<AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="47dcf-140">Quando `ServerName` for um servidor de rede, a consulta retornará seguinte:</span><span class="sxs-lookup"><span data-stu-id="47dcf-140">When `ServerName` is a network server, the query returns the following:</span></span>  
  
```  
<ServerName.AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="47dcf-141">Essa ambiguidade potencial pode ser evitada especificando este alias:</span><span class="sxs-lookup"><span data-stu-id="47dcf-141">This potential ambiguity can be avoided by specifying this alias:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person x  
FOR XML AUTO   
```  
  
 <span data-ttu-id="47dcf-142">Essa consulta retorna o seguinte:</span><span class="sxs-lookup"><span data-stu-id="47dcf-142">This query returns the following:</span></span>  
  
```  
<x LastName="Achong"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="47dcf-143">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="47dcf-143">See Also</span></span>  
 <span data-ttu-id="47dcf-144">[Sintaxe básica da cláusula FOR XML](basic-syntax-of-the-for-xml-clause.md) </span><span class="sxs-lookup"><span data-stu-id="47dcf-144">[Basic Syntax of the FOR XML Clause](basic-syntax-of-the-for-xml-clause.md) </span></span>  
 <span data-ttu-id="47dcf-145">[Usar modo RAW com FOR XML](use-raw-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="47dcf-145">[Use RAW Mode with FOR XML](use-raw-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="47dcf-146">[Usar o modo AUTO com FOR XML](use-auto-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="47dcf-146">[Use AUTO Mode with FOR XML](use-auto-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="47dcf-147">[Usar o modo EXPLICIT com FOR XML](use-explicit-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="47dcf-147">[Use EXPLICIT Mode with FOR XML](use-explicit-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="47dcf-148">[Usar o modo PATH com FOR XML](use-path-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="47dcf-148">[Use PATH Mode with FOR XML](use-path-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="47dcf-149">[SQL Server de &#40;OPENXML&#41;](openxml-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="47dcf-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span></span>  
 [<span data-ttu-id="47dcf-150">Adicionar namespaces a consultas com WITH XMLNAMESPACES</span><span class="sxs-lookup"><span data-stu-id="47dcf-150">Add Namespaces to Queries with WITH XMLNAMESPACES</span></span>](add-namespaces-to-queries-with-with-xmlnamespaces.md)  
  
  
