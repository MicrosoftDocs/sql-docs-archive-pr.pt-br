---
title: Anexar dicas de consulta a um guia de plano | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
ms.assetid: 2131f796-6359-4f9e-9047-da0b3d4dedaf
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 074c69ffefd2b5a7b2ef445f941f97b7130b0732
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87575793"
---
# <a name="attach-query-hints-to-a-plan-guide"></a><span data-ttu-id="2eed2-102">Anexar dicas de consulta para um guia de plano</span><span class="sxs-lookup"><span data-stu-id="2eed2-102">Attach Query Hints to a Plan Guide</span></span>
  <span data-ttu-id="2eed2-103">Pode ser usada qualquer combinação de dicas de consulta válidas em um guia de plano.</span><span class="sxs-lookup"><span data-stu-id="2eed2-103">Any combination of valid query hints can be used in a plan guide.</span></span> <span data-ttu-id="2eed2-104">Quando um guia de plano corresponde a uma consulta, a cláusula OPTION especificada na cláusula de dicas de um guia de plano é adicionada à consulta antes da compilação e otimização.</span><span class="sxs-lookup"><span data-stu-id="2eed2-104">When a plan guide matches a query, the OPTION clause specified in the hints clause of a plan guide is added to the query before it compiles and optimizes.</span></span> <span data-ttu-id="2eed2-105">Se uma consulta que está de acordo com um guia de plano já tem uma cláusula de OPTION, as dicas especificadas no guia substituem aquelas na consulta.</span><span class="sxs-lookup"><span data-stu-id="2eed2-105">If a query that is matched to a plan guide already has an OPTION clause, the query hints specified in the plan guide replace those in the query.</span></span> <span data-ttu-id="2eed2-106">Porém, para que um guia de plano corresponda a uma consulta que já tenha uma cláusula OPTION, deve-se incluir a cláusula OPTION da consulta ao especificar o texto da consulta, para que corresponda à instrução sp_create_plan_guide.</span><span class="sxs-lookup"><span data-stu-id="2eed2-106">However, for a plan guide to match a query that already has an OPTION clause, you must include the OPTION clause of the query when you specify the text of the query to match in the sp_create_plan_guide statement.</span></span> <span data-ttu-id="2eed2-107">Se você quiser que as dicas especificadas no guia de plano sejam adicionadas às dicas que já existem na consulta, em vez de substituí-las, é necessário especificar tanto as dicas originais como as dicas adicionais na cláusula OPTION do guia de plano.</span><span class="sxs-lookup"><span data-stu-id="2eed2-107">If you want the hints specified in the plan guide to be added to the hints that already exist on the query, instead of replacing them, you must specify both the original hints and the additional hints in the OPTION clause of the plan guide.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="2eed2-108">Guias de plano que usam dicas de consulta de forma indevida podem causar problemas de compilação, execução ou de desempenho.</span><span class="sxs-lookup"><span data-stu-id="2eed2-108">Plan guides that misuse query hints can cause compilation, execution, or performance problems.</span></span> <span data-ttu-id="2eed2-109">Guias de plano devem ser usados apenas por desenvolvedores e administradores de banco de dados experientes.</span><span class="sxs-lookup"><span data-stu-id="2eed2-109">Plan guides should be used only by experienced developers and database administrators.</span></span>  
  
## <a name="common-query-hints-used-in-plan-guides"></a><span data-ttu-id="2eed2-110">Consulta de dicas comuns usadas nos guias de plano</span><span class="sxs-lookup"><span data-stu-id="2eed2-110">Common Query Hints Used in Plan Guides</span></span>  
 <span data-ttu-id="2eed2-111">As consultas que podem ser beneficiadas pelos guias de plano, geralmente, têm base em parâmetros podem ser realizadas de modo mais fraco porque usam planos de consulta em cache, cujos valores de parâmetro não representam um cenário de casos graves ou um mais representativos.</span><span class="sxs-lookup"><span data-stu-id="2eed2-111">Queries that can benefit from plan guides are generally parameter-based, and may be performing poorly because they use cached query plans whose parameter values do not represent a worst-case or most representative scenario.</span></span> <span data-ttu-id="2eed2-112">As dicas de consulta de OPTIMIZE FOR e RECOMPILE podem ser usadas para tratar deste problema.</span><span class="sxs-lookup"><span data-stu-id="2eed2-112">The OPTIMIZE FOR and RECOMPILE query hints can be used to address this problem.</span></span> <span data-ttu-id="2eed2-113">OPTIMIZE FOR instrui [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] para usar um valor particular para um parâmetro quando a consulta é aperfeiçoada.</span><span class="sxs-lookup"><span data-stu-id="2eed2-113">OPTIMIZE FOR instructs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to use a particular value for a parameter when the query is optimized.</span></span> <span data-ttu-id="2eed2-114">RECOMPILE instrui o servidor para descartar um plano de consulta após a execução, forçando o otimizador de consulta a recompilar um novo plano da próxima vez que a mesma consulta for executada.</span><span class="sxs-lookup"><span data-stu-id="2eed2-114">RECOMPILE instructs the server to discard a query plan after execution, forcing the query optimizer to recompile a new query plan the next time that the same query is executed.</span></span> <span data-ttu-id="2eed2-115">Para obter um exemplo, consulte [Guias de plano](plan-guides.md).</span><span class="sxs-lookup"><span data-stu-id="2eed2-115">For an example, see [Plan Guides](plan-guides.md).</span></span>  
  
 <span data-ttu-id="2eed2-116">Além disso, é possível especificar as dicas de tabela INDEX, FORCESCAN e FORCESEEK como dicas de consulta.</span><span class="sxs-lookup"><span data-stu-id="2eed2-116">In addition, you can specify the table hints INDEX, FORCESCAN, and FORCESEEK as query hints.</span></span> <span data-ttu-id="2eed2-117">Quando especificadas como dicas de consulta, elas se comportam da mesma forma que uma tabela embutida ou dica de exibição.</span><span class="sxs-lookup"><span data-stu-id="2eed2-117">When specified as query hints, these hints behave like an inline table or view hint.</span></span> <span data-ttu-id="2eed2-118">A dica INDEX força o otimizador de consulta a usar somente os índices especificados para acessar os dados na tabela ou exibição referenciada na consulta.</span><span class="sxs-lookup"><span data-stu-id="2eed2-118">The INDEX hint forces the query optimizer to use only the specified indexes to access the data in the referenced table or view.</span></span> <span data-ttu-id="2eed2-119">A dica FORCESEEK força o otimizador a usar somente uma operação de busca de índice para acessar os dados na tabela ou exibição referenciada.</span><span class="sxs-lookup"><span data-stu-id="2eed2-119">The FORCESEEK hint forces the optimizer to use only an index seek operation to access the data in the referenced table or view.</span></span> <span data-ttu-id="2eed2-120">Essas dicas fornecem funcionalidade de guia de plano adicional e permitem uma maior influência em relação à otimização de consultas que usam o guia de plano.</span><span class="sxs-lookup"><span data-stu-id="2eed2-120">These hints provide additional plan guide functionality and allow you to have more influence over the optimization of queries that use the plan guide.</span></span>  
  
  
