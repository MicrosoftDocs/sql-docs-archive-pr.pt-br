---
title: Chaves de criptografia do SQL Server e banco de dados (Mecanismo de Banco de Dados) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- keys [SQL Server], database encryption
ms.assetid: 15c0a5e8-9177-484c-ae75-8c552dc0dac0
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: f846e74e0afd89c6bb10a4aa9a23a6420b6a613a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87686223"
---
# <a name="sql-server-and-database-encryption-keys-database-engine"></a><span data-ttu-id="44511-102">Chaves de criptografia do SQL Server e banco de dados (Mecanismo de Banco de Dados)</span><span class="sxs-lookup"><span data-stu-id="44511-102">SQL Server and Database Encryption Keys (Database Engine)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="44511-103">usa chaves de criptografia para ajudar a proteger dados, credenciais e informações de conexão armazenados em um banco de dados de servidor.</span><span class="sxs-lookup"><span data-stu-id="44511-103">uses encryption keys to help secure data, credentials, and connection information that is stored in a server database.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="44511-104">tem dois tipos de chaves: *simétrica* e *asimétrica*.</span><span class="sxs-lookup"><span data-stu-id="44511-104">has two kinds of keys: *symmetric* and *asymmetric*.</span></span> <span data-ttu-id="44511-105">As chaves simétricas usam a mesma senha para criptografar e descriptografar dados.</span><span class="sxs-lookup"><span data-stu-id="44511-105">Symmetric keys use the same password to encrypt and decrypt data.</span></span> <span data-ttu-id="44511-106">As chaves assimétricas usam uma senha para criptografar dados (chamada chave *pública* ) e outra para descriptografar dados (chamada chave *privada* ).</span><span class="sxs-lookup"><span data-stu-id="44511-106">Asymmetric keys use one password to encrypt data (called the *public* key) and another to decrypt data (called the *private* key).</span></span>  
  
 <span data-ttu-id="44511-107">No [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], as chaves de criptografia incluem uma combinação de chaves públicas, privadas e assimétricas, usadas para proteger dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="44511-107">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], encryption keys include a combination of public, private, and symmetric keys that are used to protect sensitive data.</span></span> <span data-ttu-id="44511-108">A chave simétrica é criada durante a inicialização do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] quando você inicia pela primeira vez a instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="44511-108">The symmetric key is created during [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] initialization when you first start the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="44511-109">A chave é usada pelo [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] para criptografar dados confidenciais que são armazenados no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="44511-109">The key is used by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to encrypt sensitive data that is stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="44511-110">As chaves públicas e privadas são criadas pelo sistema operacional e são usadas para proteger a chave simétrica.</span><span class="sxs-lookup"><span data-stu-id="44511-110">Public and private keys are created by the operating system and they are used to protect the symmetric key.</span></span> <span data-ttu-id="44511-111">Um par de chaves pública e privada é criado para cada instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que armazena dados confidenciais em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44511-111">A public and private key pair is created for each [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance that stores sensitive data in a database.</span></span>  
  
## <a name="applications-for-sql-server-and-database-keys"></a><span data-ttu-id="44511-112">Aplicativos para o SQL Server e chaves de banco de dados</span><span class="sxs-lookup"><span data-stu-id="44511-112">Applications for SQL Server and Database Keys</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="44511-113">tem dois aplicativos principais para chaves: uma *SMK (chave mestra de serviço)* gerada e para uma instância [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , e uma *DMK (chave mestra de banco de dados)* usada para um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44511-113">has two primary applications for keys: a *service master key* (SMK) generated on and for a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance, and a *database master key* (DMK) used for a database.</span></span>  
  
 <span data-ttu-id="44511-114">A SMK é gerada automaticamente na primeira vez que a instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] é iniciada, e é usada para criptografar a senha, as credenciais e a chave mestra de banco de dados de um servidor vinculado.</span><span class="sxs-lookup"><span data-stu-id="44511-114">The SMK is automatically generated the first time the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] instance is started and is used to encrypt a linked server password, credentials, and the database master key.</span></span> <span data-ttu-id="44511-115">A SMK é criptografada com a chave do computador local usando a DPAPI (API de proteção de dados do Windows).</span><span class="sxs-lookup"><span data-stu-id="44511-115">The SMK is encrypted by using the local computer key using the Windows Data Protection API (DPAPI).</span></span> <span data-ttu-id="44511-116">A DPAPI usa uma chave derivada das credenciais do Windows da conta de serviço do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e das credenciais do computador.</span><span class="sxs-lookup"><span data-stu-id="44511-116">The DPAPI uses a key that is derived from the Windows credentials of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account and the computer's credentials.</span></span> <span data-ttu-id="44511-117">A chave mestra de serviço só pode ser descriptografada pela conta de serviço sob a qual foi criada ou por um principal que tenha acesso às credenciais da máquina.</span><span class="sxs-lookup"><span data-stu-id="44511-117">The service master key can only be decrypted by the service account under which it was created or by a principal that has access to the machine's credentials.</span></span>  
  
 <span data-ttu-id="44511-118">A chave mestra de banco de dados é uma chave simétrica usada para proteger as chaves privadas dos certificados e as chaves assimétricas presentes no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44511-118">The database master key is a symmetric key that is used to protect the private keys of certificates and asymmetric keys that are present in the database.</span></span> <span data-ttu-id="44511-119">Ela também pode ser usada para criptografar dados, mas tem limitações de comprimento que a tornam pouco prática para os dados do que usar uma chave simétrica.</span><span class="sxs-lookup"><span data-stu-id="44511-119">It can also be used to encrypt data, but it has length limitations that make it less practical for data than using a symmetric key.</span></span>  
  
 <span data-ttu-id="44511-120">Quando é criada, a chave mestra é criptografada com o algoritmo DES Triplo e uma senha fornecida pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="44511-120">When it is created, the master key is encrypted by using the Triple DES algorithm and a user-supplied password.</span></span> <span data-ttu-id="44511-121">Para habilitar a descriptografia automática da chave mestra, uma cópia da chave é criptografada com o uso da SMK.</span><span class="sxs-lookup"><span data-stu-id="44511-121">To enable the automatic decryption of the master key, a copy of the key is encrypted by using the SMK.</span></span> <span data-ttu-id="44511-122">Ela é armazenada no banco de dados em que é usada e no banco de dados `master` do sistema.</span><span class="sxs-lookup"><span data-stu-id="44511-122">It is stored in both the database where it is used and in the `master` system database.</span></span>  
  
 <span data-ttu-id="44511-123">A cópia da DMK armazenada no banco de dados `master` do sistema é silenciosamente atualizada sempre que a DMK é alterada.</span><span class="sxs-lookup"><span data-stu-id="44511-123">The copy of the DMK stored in the `master` system database is silently updated whenever the DMK is changed.</span></span> <span data-ttu-id="44511-124">No entanto, esse padrão pode ser alterado com o uso da opção `DROP ENCRYPTION BY SERVICE MASTER KEY` da instrução `ALTER MASTER KEY`.</span><span class="sxs-lookup"><span data-stu-id="44511-124">However, this default can be changed by using the `DROP ENCRYPTION BY SERVICE MASTER KEY` option of the `ALTER MASTER KEY` statement.</span></span> <span data-ttu-id="44511-125">Uma DMK não criptografada pela chave mestra de serviço deve ser aberta com a instrução `OPEN MASTER KEY` e uma senha.</span><span class="sxs-lookup"><span data-stu-id="44511-125">A DMK that is not encrypted by the service master key must be opened by using the `OPEN MASTER KEY` statement and a password.</span></span>  
  
## <a name="managing-sql-server-and-database-keys"></a><span data-ttu-id="44511-126">Gerenciando o SQL Server e chaves de banco de dados</span><span class="sxs-lookup"><span data-stu-id="44511-126">Managing SQL Server and Database Keys</span></span>  
 <span data-ttu-id="44511-127">O gerenciamento de chaves de criptografia consiste na criação de novas chaves de banco de dados, na criação de um backup das chaves de servidor e de banco de dados, além de saber quando e como restaurar, excluir ou alterar as chaves.</span><span class="sxs-lookup"><span data-stu-id="44511-127">Managing encryption keys consists of creating new database keys, creating a backup of the server and database keys, and knowing when and how to restore, delete, or change the keys.</span></span>  
  
 <span data-ttu-id="44511-128">Para gerenciar chaves simétricas, você pode usar as ferramentas incluídas no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] para fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="44511-128">To manage symmetric keys, you can use the tools included in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] to do the following:</span></span>  
  
-   <span data-ttu-id="44511-129">Fazer backup de uma cópia das chaves de servidor e de banco de dados para poder usá-las para recuperar uma instalação de servidor, ou como parte de uma migração planejada.</span><span class="sxs-lookup"><span data-stu-id="44511-129">Back up a copy of the server and database keys so that you can use them to recover a server installation, or as part of a planned migration.</span></span>  
  
-   <span data-ttu-id="44511-130">Restaurar uma chave salva anteriormente em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44511-130">Restore a previously saved key to a database.</span></span> <span data-ttu-id="44511-131">Isso permite que uma nova instância de servidor acesse dados existentes que ela não criptografou originalmente.</span><span class="sxs-lookup"><span data-stu-id="44511-131">This enables a new server instance to access existing data that it did not originally encrypt.</span></span>  
  
-   <span data-ttu-id="44511-132">Excluir os dados criptografados em um banco de dados no evento improvável que você não possa mais acessar dados criptografados.</span><span class="sxs-lookup"><span data-stu-id="44511-132">Delete the encrypted data in a database in the unlikely event that you can no longer access encrypted data.</span></span>  
  
-   <span data-ttu-id="44511-133">Recriar chaves e criptografar novamente os dados no evento improvável que a chave seja comprometida.</span><span class="sxs-lookup"><span data-stu-id="44511-133">Re-create keys and re-encrypt data in the unlikely event that the key is compromised.</span></span> <span data-ttu-id="44511-134">Como prática recomendável de segurança, você deve recriar as chaves periodicamente (por exemplo, a cada poucos meses) para proteger o servidor contra ataques que tentem decifrar as chaves.</span><span class="sxs-lookup"><span data-stu-id="44511-134">As a security best practice, you should re-create the keys periodically (for example, every few months) to protect the server from attacks that try to decipher the keys.</span></span>  
  
-   <span data-ttu-id="44511-135">Adicionar ou remover uma instância do servidor de uma implantação em expansão do servidor em que vários servidores compartilham um único banco de dados e a chave que fornece criptografia reversível para esse banco de dados.</span><span class="sxs-lookup"><span data-stu-id="44511-135">Add or remove a server instance from a server scale-out deployment where multiple servers share both a single database and the key that provides reversible encryption for that database.</span></span>  
  
## <a name="important-security-information"></a><span data-ttu-id="44511-136">Informações importantes sobre segurança</span><span class="sxs-lookup"><span data-stu-id="44511-136">Important Security Information</span></span>  
 <span data-ttu-id="44511-137">O acesso a objetos protegidos pela chave mestra de serviço requer ou a conta de Serviço do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que foi usada para criar a chave, ou a conta do computador (máquina).</span><span class="sxs-lookup"><span data-stu-id="44511-137">Accessing objects secured by the service master key requires either the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account that was used to create the key or the computer (machine) account.</span></span> <span data-ttu-id="44511-138">Ou seja, o computador está ligado ao sistema em que a chave foi criada.</span><span class="sxs-lookup"><span data-stu-id="44511-138">That is, the computer is tied to the system where the key was created.</span></span> <span data-ttu-id="44511-139">Você pode alterar a conta de Serviço do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]*ou* a conta do computador, sem perder o acesso à chave.</span><span class="sxs-lookup"><span data-stu-id="44511-139">You can change the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Service account *or* the computer account without losing access to the key.</span></span> <span data-ttu-id="44511-140">Porém, se alterar ambos, você perderá o acesso à chave mestra de serviço.</span><span class="sxs-lookup"><span data-stu-id="44511-140">However, if you change both, you will lose access to the service master key.</span></span> <span data-ttu-id="44511-141">Se perder o acesso a essa chave sem um desses dois elementos, você não poderá descriptografar dados e objetos criptografados com o uso da chave original.</span><span class="sxs-lookup"><span data-stu-id="44511-141">If you lose access to the service master key without one of these two elements, you be unable to decrypt data and objects encrypted by using the original key.</span></span>  
  
 <span data-ttu-id="44511-142">As conexões protegidas com a chave mestra de serviço não podem ser restauradas sem essa chave.</span><span class="sxs-lookup"><span data-stu-id="44511-142">Connections secured with the service master key cannot be restored without the service master key.</span></span>  
  
 <span data-ttu-id="44511-143">O acesso aos objetos e dados protegidos com a chave mestra de banco de dados requer apenas a senha usada para ajudar a proteger a chave.</span><span class="sxs-lookup"><span data-stu-id="44511-143">Access to objects and data secured with the database master key require only the password that is used to help secure the key.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="44511-144">Se você perder todo o acesso às chaves descritas anteriormente, perderá o acesso a objetos, conexões e dados protegidos por essas chaves.</span><span class="sxs-lookup"><span data-stu-id="44511-144">If you lose all access to the keys described earlier, you will lose access to the objects, connections, and data secured by those keys.</span></span> <span data-ttu-id="44511-145">É possível restaurar a chave mestra de serviço, conforme descrito nos links aqui mostrados, ou você pode voltar ao sistema de criptografia original para recuperar o acesso.</span><span class="sxs-lookup"><span data-stu-id="44511-145">You can restore the service master key, as described in the links that are shown here, or you can go back to the original encrypting system to recover the access.</span></span> <span data-ttu-id="44511-146">Não há nenhuma "porta dos fundos" para recuperar o acesso.</span><span class="sxs-lookup"><span data-stu-id="44511-146">There is no "back-door" to recover the access.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="44511-147">Nesta seção</span><span class="sxs-lookup"><span data-stu-id="44511-147">In This Section</span></span>  
 [<span data-ttu-id="44511-148">Chave mestra de serviço</span><span class="sxs-lookup"><span data-stu-id="44511-148">Service Master Key</span></span>](service-master-key.md)  
 <span data-ttu-id="44511-149">Fornece uma breve explicação da chave mestra de serviço e suas práticas recomendadas.</span><span class="sxs-lookup"><span data-stu-id="44511-149">Provides a brief explanation for the service master key and its best practices.</span></span>  
  
 [<span data-ttu-id="44511-150">Gerenciamento Extensível de Chaves &#40;EKM&#41;</span><span class="sxs-lookup"><span data-stu-id="44511-150">Extensible Key Management &#40;EKM&#41;</span></span>](extensible-key-management-ekm.md)  
 <span data-ttu-id="44511-151">Explica como usar sistemas de gerenciamento de chaves de terceiros com o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="44511-151">Explains how to use third-party key management systems with [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="44511-152">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="44511-152">Related Tasks</span></span>  
 [<span data-ttu-id="44511-153">Fazer backup da chave mestra de serviço</span><span class="sxs-lookup"><span data-stu-id="44511-153">Back Up the Service Master Key</span></span>](back-up-the-service-master-key.md)  
  
 [<span data-ttu-id="44511-154">Restaurar a chave mestra de serviço</span><span class="sxs-lookup"><span data-stu-id="44511-154">Restore the Service Master Key</span></span>](restore-the-service-master-key.md)  
  
 [<span data-ttu-id="44511-155">Criar uma chave mestra de banco de dados</span><span class="sxs-lookup"><span data-stu-id="44511-155">Create a Database Master Key</span></span>](create-a-database-master-key.md)  
  
 [<span data-ttu-id="44511-156">Fazer backup da chave mestra de um banco de dados</span><span class="sxs-lookup"><span data-stu-id="44511-156">Back Up a Database Master Key</span></span>](back-up-a-database-master-key.md)  
  
 [<span data-ttu-id="44511-157">Restaurar uma chave mestra de banco de dados</span><span class="sxs-lookup"><span data-stu-id="44511-157">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
 [<span data-ttu-id="44511-158">Criar chaves simétricas idênticas em dois servidores</span><span class="sxs-lookup"><span data-stu-id="44511-158">Create Identical Symmetric Keys on Two Servers</span></span>](create-identical-symmetric-keys-on-two-servers.md)  
  
 [<span data-ttu-id="44511-159">Gerenciamento extensível de chaves usando o Cofre de Chaves do Azure &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="44511-159">Extensible Key Management Using Azure Key Vault &#40;SQL Server&#41;</span></span>](extensible-key-management-using-azure-key-vault-sql-server.md)  
  
 [<span data-ttu-id="44511-160">Habilitar TDE usando EKM</span><span class="sxs-lookup"><span data-stu-id="44511-160">Enable TDE Using EKM</span></span>](enable-tde-on-sql-server-using-ekm.md)  
  
## <a name="related-content"></a><span data-ttu-id="44511-161">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="44511-161">Related Content</span></span>  
 [<span data-ttu-id="44511-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="44511-162">CREATE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-master-key-transact-sql)  
  
 [<span data-ttu-id="44511-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="44511-163">ALTER SERVICE MASTER KEY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-service-master-key-transact-sql)  
  
 [<span data-ttu-id="44511-164">Restaurar uma chave mestra de banco de dados</span><span class="sxs-lookup"><span data-stu-id="44511-164">Restore a Database Master Key</span></span>](restore-a-database-master-key.md)  
  
## <a name="see-also"></a><span data-ttu-id="44511-165">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="44511-165">See Also</span></span>  
 <span data-ttu-id="44511-166">[Fazer backup e restaurar as chave de criptografia do Reporting Services](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="44511-166">[Back Up and Restore Reporting Services Encryption Keys](../../../reporting-services/install-windows/ssrs-encryption-keys-back-up-and-restore-encryption-keys.md) </span></span>  
 <span data-ttu-id="44511-167">[Excluir e recriar chaves de criptografia &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span><span class="sxs-lookup"><span data-stu-id="44511-167">[Delete and Re-create Encryption Keys  &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/ssrs-encryption-keys-delete-and-re-create-encryption-keys.md) </span></span>  
 <span data-ttu-id="44511-168">[Adicionar e remover chaves de criptografia para implantação escalável &#40;Gerenciador de Configurações do SSRS&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span><span class="sxs-lookup"><span data-stu-id="44511-168">[Add and Remove Encryption Keys for Scale-Out Deployment &#40;SSRS Configuration Manager&#41;](../../../reporting-services/install-windows/add-and-remove-encryption-keys-for-scale-out-deployment.md) </span></span>  
 [<span data-ttu-id="44511-169">TDE &#40;Transparent Data Encryption&#41;</span><span class="sxs-lookup"><span data-stu-id="44511-169">Transparent Data Encryption &#40;TDE&#41;</span></span>](transparent-data-encryption.md)  
  
  
