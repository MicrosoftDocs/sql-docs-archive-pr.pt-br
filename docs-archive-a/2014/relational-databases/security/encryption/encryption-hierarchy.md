---
title: Hierarquia de criptografia | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- encryption [SQL Server], hierarchies
- cryptography [SQL Server], hierarchies
- encryption keys [SQL Server]
- security [SQL Server], encryption
- hierarchies [SQL Server], encryption
ms.assetid: 96c276d5-1bba-4e95-b678-10f059f1fbcf
author: jaszymas
ms.author: jaszymas
ms.openlocfilehash: d38bb83c2f6a2487e547c4686be5c65bc012e33e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685492"
---
# <a name="encryption-hierarchy"></a><span data-ttu-id="2373e-102">Hierarquia de criptografia</span><span class="sxs-lookup"><span data-stu-id="2373e-102">Encryption Hierarchy</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="2373e-103">criptografa dados com uma criptografia hierárquica e infraestrutura de gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="2373e-103">encrypts data with a hierarchical encryption and key management infrastructure.</span></span> <span data-ttu-id="2373e-104">Cada camada criptografa a camada abaixo dela usando uma combinação de certificados, chaves assimétricas e chaves simétricas.</span><span class="sxs-lookup"><span data-stu-id="2373e-104">Each layer encrypts the layer below it by using a combination of certificates, asymmetric keys, and symmetric keys.</span></span> <span data-ttu-id="2373e-105">Chaves assimétricas e chaves simétricas podem ser armazenadas fora do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] em um módulo EKM (Gerenciamento Extensível de Chaves).</span><span class="sxs-lookup"><span data-stu-id="2373e-105">Asymmetric keys and symmetric keys can be stored outside of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] in an Extensible Key Management (EKM) module.</span></span>  
  
 <span data-ttu-id="2373e-106">A ilustração a seguir mostra que cada camada da hierarquia de criptografia criptografa a camada abaixo dela e exibe as configurações de criptografia mais comuns.</span><span class="sxs-lookup"><span data-stu-id="2373e-106">The following illustration shows that each layer of the encryption hierarchy encrypts the layer beneath it, and displays the most common encryption configurations.</span></span> <span data-ttu-id="2373e-107">O acesso ao início da hierarquia normalmente é protegido por uma senha.</span><span class="sxs-lookup"><span data-stu-id="2373e-107">The access to the start of the hierarchy is usually protected by a password.</span></span>  
  
 <span data-ttu-id="2373e-108">![Exibe algumas combinações de criptografia em uma pilha.](../../../database-engine/media/encryption-hierarchy-stack.gif "Exibe algumas combinações de criptografia em uma pilha.")</span><span class="sxs-lookup"><span data-stu-id="2373e-108">![Displays some encryption combinations in a stack.](../../../database-engine/media/encryption-hierarchy-stack.gif "Displays some encryption combinations in a stack.")</span></span>  
  
 <span data-ttu-id="2373e-109">Lembre-se dos seguintes conceitos:</span><span class="sxs-lookup"><span data-stu-id="2373e-109">Keep in mind the following concepts:</span></span>  
  
-   <span data-ttu-id="2373e-110">Para obter melhor desempenho, criptografe os dados usando chaves simétricas em vez de certificados ou chaves assimétricas.</span><span class="sxs-lookup"><span data-stu-id="2373e-110">For best performance, encrypt data using symmetric keys instead of certificates or asymmetric keys.</span></span>  
  
-   <span data-ttu-id="2373e-111">As chaves-mestre do banco de dados são protegidas pela Chave Mestra do Serviço.</span><span class="sxs-lookup"><span data-stu-id="2373e-111">Database master keys are protected by the Service Master Key.</span></span> <span data-ttu-id="2373e-112">A Chave Mestra do Serviço é criada pela configuração do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] e é criptografada com a DPAPI (API de proteção de dados) do Windows.</span><span class="sxs-lookup"><span data-stu-id="2373e-112">The Service Master Key is created by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] setup and is encrypted with the Windows Data Protection API (DPAPI).</span></span>  
  
-   <span data-ttu-id="2373e-113">Outras hierarquias de criptografia que empilham camadas adicionais são possíveis.</span><span class="sxs-lookup"><span data-stu-id="2373e-113">Other encryption hierarchies stacking additional layers are possible.</span></span>  
  
-   <span data-ttu-id="2373e-114">Um módulo de Gerenciamento Extensível de Chaves (EKM) mantém chaves simétricas ou assimétricas fora do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2373e-114">An Extensible Key Management (EKM) module holds symmetric or asymmetric keys outside of SQL Server.</span></span>  
  
-   <span data-ttu-id="2373e-115">A TDE (Criptografia Transparente de Dados) deve usar uma chave simétrica chamada de chave de criptografia de banco de dados que é protegida por um certificado protegido pela chave mestra de banco de dados do banco de dados mestre ou por uma chave assimétrica armazenada em um EKM.</span><span class="sxs-lookup"><span data-stu-id="2373e-115">Transparent Data Encryption (TDE) must use a symmetric key called the database encryption key which is protected by either a certificate protected by the database master key of the master database, or by an asymmetric key stored in an EKM.</span></span>  
  
-   <span data-ttu-id="2373e-116">A Chave Mestra do Serviço e todas as Chaves Mestras do Banco de Dados são chaves simétricas.</span><span class="sxs-lookup"><span data-stu-id="2373e-116">The Service Master Key and all Database Master Keys are symmetric keys.</span></span>  
  
 <span data-ttu-id="2373e-117">A ilustração a seguir mostra as mesmas informações de uma maneira alternativa.</span><span class="sxs-lookup"><span data-stu-id="2373e-117">The following illustration shows the same information in an alternative manner.</span></span>  
  
 <span data-ttu-id="2373e-118">![Exibe algumas combinações de criptografia em uma roda.](../../../database-engine/media/encryption-hierarchy-wheel.gif "Exibe algumas combinações de criptografia em uma roda.")</span><span class="sxs-lookup"><span data-stu-id="2373e-118">![Displays some encryption combinations in a wheel.](../../../database-engine/media/encryption-hierarchy-wheel.gif "Displays some encryption combinations in a wheel.")</span></span>  
  
 <span data-ttu-id="2373e-119">Este diagrama ilustra os seguintes conceitos adicionais:</span><span class="sxs-lookup"><span data-stu-id="2373e-119">This diagram illustrates the following additional concepts:</span></span>  
  
-   <span data-ttu-id="2373e-120">Nesta ilustração, as setas indicam hierarquias de criptografia comuns.</span><span class="sxs-lookup"><span data-stu-id="2373e-120">In this illustration, arrows indicate common encryption hierarchies.</span></span>  
  
-   <span data-ttu-id="2373e-121">As chaves simétricas e assimétricas no EKM podem proteger o acesso às chaves simétricas e assimétricas armazenadas no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2373e-121">Symmetric and asymmetric keys in the EKM can protect access to the symmetric and asymmetric keys stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="2373e-122">A linha pontilhada associada ao EKM indica que as chaves no EKM podem substituir as chaves simétricas e assimétricas armazenadas no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2373e-122">The dotted line associated with EKM indicates that keys in the EKM could replace the symmetric and asymmetric keys stored in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="encryption-mechanisms"></a><span data-ttu-id="2373e-123">Mecanismos de criptografia</span><span class="sxs-lookup"><span data-stu-id="2373e-123">Encryption Mechanisms</span></span>  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="2373e-124">fornece os seguintes mecanismos para criptografia:</span><span class="sxs-lookup"><span data-stu-id="2373e-124">provides the following mechanisms for encryption:</span></span>  
  
-   [!INCLUDE[tsql](../../../includes/tsql-md.md)] <span data-ttu-id="2373e-125">funções</span><span class="sxs-lookup"><span data-stu-id="2373e-125">functions</span></span>  
  
-   <span data-ttu-id="2373e-126">Chaves assimétricas</span><span class="sxs-lookup"><span data-stu-id="2373e-126">Asymmetric keys</span></span>  
  
-   <span data-ttu-id="2373e-127">Chaves simétricas</span><span class="sxs-lookup"><span data-stu-id="2373e-127">Symmetric keys</span></span>  
  
-   <span data-ttu-id="2373e-128">Certificados</span><span class="sxs-lookup"><span data-stu-id="2373e-128">Certificates</span></span>  
  
-   <span data-ttu-id="2373e-129">Criptografia de Dados Transparente</span><span class="sxs-lookup"><span data-stu-id="2373e-129">Transparent Data Encryption</span></span>  
  
### <a name="transact-sql-functions"></a><span data-ttu-id="2373e-130">Funções Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="2373e-130">Transact-SQL Functions</span></span>  
 <span data-ttu-id="2373e-131">Itens individuais podem ser criptografados quando são inseridos ou atualizados usando funções [!INCLUDE[tsql](../../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="2373e-131">Individual items can be encrypted as they are inserted or updated using [!INCLUDE[tsql](../../../includes/tsql-md.md)] functions.</span></span> <span data-ttu-id="2373e-132">Para obter mais informações, veja [ENCRYPTBYPASSPHRASE &#40;Transact-SQL&#41;](/sql/t-sql/functions/encryptbypassphrase-transact-sql) e [DECRYPTBYPASSPHRASE &#40;Transact-SQL&#41;](/sql/t-sql/functions/decryptbypassphrase-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="2373e-132">For more information, see [ENCRYPTBYPASSPHRASE &#40;Transact-SQL&#41;](/sql/t-sql/functions/encryptbypassphrase-transact-sql) and [DECRYPTBYPASSPHRASE &#40;Transact-SQL&#41;](/sql/t-sql/functions/decryptbypassphrase-transact-sql).</span></span>  
  
### <a name="certificates"></a><span data-ttu-id="2373e-133">Certificados</span><span class="sxs-lookup"><span data-stu-id="2373e-133">Certificates</span></span>  
 <span data-ttu-id="2373e-134">Um certificado de chave pública, geralmente chamado apenas de certificado, é uma instrução assinada digitalmente que associa o valor de uma chave pública à identidade da pessoa, dispositivo ou serviço que mantém a chave privada correspondente.</span><span class="sxs-lookup"><span data-stu-id="2373e-134">A public key certificate, usually just called a certificate, is a digitally-signed statement that binds the value of a public key to the identity of the person, device, or service that holds the corresponding private key.</span></span> <span data-ttu-id="2373e-135">Os certificados são emitidos e assinados por uma autoridade de certificação (CA).</span><span class="sxs-lookup"><span data-stu-id="2373e-135">Certificates are issued and signed by a certification authority (CA).</span></span> <span data-ttu-id="2373e-136">A entidade que recebe um certificado de uma CA é o assunto desse certificado.</span><span class="sxs-lookup"><span data-stu-id="2373e-136">The entity that receives a certificate from a CA is the subject of that certificate.</span></span> <span data-ttu-id="2373e-137">Normalmente os certificados contêm as seguintes informações.</span><span class="sxs-lookup"><span data-stu-id="2373e-137">Typically, certificates contain the following information.</span></span>  
  
-   <span data-ttu-id="2373e-138">A chave pública do assunto.</span><span class="sxs-lookup"><span data-stu-id="2373e-138">The public key of the subject.</span></span>  
  
-   <span data-ttu-id="2373e-139">A informações de identificador do assunto, como o nome e endereço de email.</span><span class="sxs-lookup"><span data-stu-id="2373e-139">The identifier information of the subject, such as the name and e-mail address.</span></span>  
  
-   <span data-ttu-id="2373e-140">O período de validade.</span><span class="sxs-lookup"><span data-stu-id="2373e-140">The validity period.</span></span> <span data-ttu-id="2373e-141">Este é o período no qual o certificado é considerado válido.</span><span class="sxs-lookup"><span data-stu-id="2373e-141">This is the length of time that the certificate is considered valid.</span></span>  
  
     <span data-ttu-id="2373e-142">Um certificado só é válido pelo período de tempo especificado nele; cada certificado contém as datas **Válido a partir de** e **Válido até** .</span><span class="sxs-lookup"><span data-stu-id="2373e-142">A certificate is valid only for the period of time specified within it; every certificate contains **Valid From** and **Valid To** dates.</span></span> <span data-ttu-id="2373e-143">Estas datas definem os limites do período de validade.</span><span class="sxs-lookup"><span data-stu-id="2373e-143">These dates set the boundaries of the validity period.</span></span> <span data-ttu-id="2373e-144">Depois que o período de validade de um certificado chega ao fim, um novo certificado deve ser solicitado pelo assunto do certificado agora expirado.</span><span class="sxs-lookup"><span data-stu-id="2373e-144">When the validity period for a certificate has passed, a new certificate must be requested by the subject of the now-expired certificate.</span></span>  
  
-   <span data-ttu-id="2373e-145">Informações de identificador de emissor.</span><span class="sxs-lookup"><span data-stu-id="2373e-145">Issuer identifier information.</span></span>  
  
-   <span data-ttu-id="2373e-146">A assinatura digital do emissor.</span><span class="sxs-lookup"><span data-stu-id="2373e-146">The digital signature of the issuer.</span></span>  
  
     <span data-ttu-id="2373e-147">Esta assinatura atesta a validade da associação entre a chave pública e as informações de identificador do assunto.</span><span class="sxs-lookup"><span data-stu-id="2373e-147">This signature attests to the validity of the binding between the public key and the identifier information of the subject.</span></span> <span data-ttu-id="2373e-148">(O processo de assinar digitalmente as informações força a transformação de informações, bem como de algumas informações secretas mantidas pelo remetente, em uma marca chamada assinatura).</span><span class="sxs-lookup"><span data-stu-id="2373e-148">(The process of digitally signing information entails transforming the information, as well as some secret information held by the sender, into a tag called a signature.)</span></span>  
  
 <span data-ttu-id="2373e-149">O principal benefício dos certificados é que o host não precisa manter um conjunto de senhas para assuntos individuais.</span><span class="sxs-lookup"><span data-stu-id="2373e-149">A primary benefit of certificates is that they relieve hosts of the need to maintain a set of passwords for individual subjects.</span></span> <span data-ttu-id="2373e-150">Ao contrário, o host só precisa estabelecer confiança em um emissor de certificado, que pode então assinar um número ilimitado de certificados.</span><span class="sxs-lookup"><span data-stu-id="2373e-150">Instead, the host merely establishes trust in a certificate issuer, which may then sign an unlimited number of certificates.</span></span>  
  
 <span data-ttu-id="2373e-151">Quando um host,como um servidor Web seguro, designa um emissor como uma autoridade raiz confiável, ele confia implicitamente nas políticas que o emissor usou para estabelecer as associações dos certificados que ele emitiu.</span><span class="sxs-lookup"><span data-stu-id="2373e-151">When a host, such as a secure Web server, designates an issuer as a trusted root authority, the host implicitly trusts the policies that the issuer has used to establish the bindings of certificates it issues.</span></span> <span data-ttu-id="2373e-152">Consequentemente, o host confia que o emissor verificou a identidade do assunto do certificado.</span><span class="sxs-lookup"><span data-stu-id="2373e-152">In effect, the host trusts that the issuer has verified the identity of the certificate subject.</span></span> <span data-ttu-id="2373e-153">Um host designa um emissor como uma autoridade raiz confiável colocando o certificado autoassinado do emissor, que contém a chave pública dele, no repositório de certificados da autoridade de certificação raiz confiável do computador host.</span><span class="sxs-lookup"><span data-stu-id="2373e-153">A host designates an issuer as a trusted root authority by putting the self-signed certificate of the issuer, which contains the public key of the issuer, into the trusted root certification authority certificate store of the host computer.</span></span> <span data-ttu-id="2373e-154">As autoridades de certificação intermediárias ou subordinadas são confiáveis apenas se tiverem um caminho de certificação válido de uma autoridade de certificação raiz confiável.</span><span class="sxs-lookup"><span data-stu-id="2373e-154">Intermediate or subordinate certification authorities are trusted only if they have a valid certification path from a trusted root certification authority.</span></span>  
  
 <span data-ttu-id="2373e-155">O emissor pode revogar um certificado antes de sua expiração.</span><span class="sxs-lookup"><span data-stu-id="2373e-155">The issuer can revoke a certificate before it expires.</span></span> <span data-ttu-id="2373e-156">A revogação cancela a associação de uma chave pública para uma identidade que é declarada no certificado.</span><span class="sxs-lookup"><span data-stu-id="2373e-156">Revocation cancels the binding of a public key to an identity that is asserted in the certificate.</span></span> <span data-ttu-id="2373e-157">Cada emissor mantém uma lista de revogação de certificados que pode ser usada pelos programas quando eles estiverem verificando a validade de qualquer certificado especificado.</span><span class="sxs-lookup"><span data-stu-id="2373e-157">Each issuer maintains a certificate revocation list that can be used by programs when they are checking the validity of any given certificate.</span></span>  
  
 <span data-ttu-id="2373e-158">Os certificados autoassinados criados pelo [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] seguem o padrão X.509 e oferecem suporte aos campos X.509 v1.</span><span class="sxs-lookup"><span data-stu-id="2373e-158">The self-signed certificates created by [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] follow the X.509 standard and support the X.509 v1 fields.</span></span>  
  
### <a name="asymmetric-keys"></a><span data-ttu-id="2373e-159">Chaves assimétricas</span><span class="sxs-lookup"><span data-stu-id="2373e-159">Asymmetric Keys</span></span>  
 <span data-ttu-id="2373e-160">Uma chave assimétrica é composta de uma chave privada e uma chave pública correspondente.</span><span class="sxs-lookup"><span data-stu-id="2373e-160">An asymmetric key is made up of a private key and the corresponding public key.</span></span> <span data-ttu-id="2373e-161">Cada chave pode descriptografar dados criptografados por outra chave.</span><span class="sxs-lookup"><span data-stu-id="2373e-161">Each key can decrypt data encrypted by the other.</span></span> <span data-ttu-id="2373e-162">A criptografia assimétrica e a descriptografia usam muitos recursos, mas eles fornecem um nível mais alto de segurança que a criptografia simétrica.</span><span class="sxs-lookup"><span data-stu-id="2373e-162">Asymmetric encryption and decryption are relatively resource-intensive, but they provide a higher level of security than symmetric encryption.</span></span> <span data-ttu-id="2373e-163">Uma chave assimétrica pode ser usada ao criptografar uma chave simétrica para armazenamento em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2373e-163">An asymmetric key can be used to encrypt a symmetric key for storage in a database.</span></span>  
  
### <a name="symmetric-keys"></a><span data-ttu-id="2373e-164">Chaves simétricas</span><span class="sxs-lookup"><span data-stu-id="2373e-164">Symmetric Keys</span></span>  
 <span data-ttu-id="2373e-165">Uma chave simétrica é uma chave usada para criptografia e descriptografia.</span><span class="sxs-lookup"><span data-stu-id="2373e-165">A symmetric key is one key that is used for both encryption and decryption.</span></span> <span data-ttu-id="2373e-166">A criptografia e a descriptografia que usam uma chave simétrica são rápidas e adequadas ao uso de rotina com dados confidenciais no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2373e-166">Encryption and decryption by using a symmetric key is fast, and suitable for routine use with sensitive data in the database.</span></span>  
  
### <a name="transparent-data-encryption"></a><span data-ttu-id="2373e-167">Criptografia de Dados Transparente</span><span class="sxs-lookup"><span data-stu-id="2373e-167">Transparent Data Encryption</span></span>  
 <span data-ttu-id="2373e-168">A TDE (Criptografia Transparente de Dados) é um caso especial de criptografia que usa uma chave simétrica.</span><span class="sxs-lookup"><span data-stu-id="2373e-168">Transparent Data Encryption (TDE) is a special case of encryption using a symmetric key.</span></span> <span data-ttu-id="2373e-169">Ela criptografa um banco de dados inteiro usando a chave simétrica chamada de chave de criptografia de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="2373e-169">TDE encrypts an entire database using that symmetric key called the database encryption key.</span></span> <span data-ttu-id="2373e-170">A chave de criptografia de banco de dados é protegida por outras chaves ou certificados que são protegidos pela chave mestra de banco de dados ou por uma chave assimétrica armazenada em um módulo EKM.</span><span class="sxs-lookup"><span data-stu-id="2373e-170">The database encryption key is protected by other keys or certificates which are protected either by the database master key or by an asymmetric key stored in an EKM module.</span></span> <span data-ttu-id="2373e-171">Para obter mais informações, veja [TDE &#40;Transparent Data Encryption&#41;](transparent-data-encryption.md).</span><span class="sxs-lookup"><span data-stu-id="2373e-171">For more information, see [Transparent Data Encryption &#40;TDE&#41;](transparent-data-encryption.md).</span></span>  
  
## <a name="related-content"></a><span data-ttu-id="2373e-172">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="2373e-172">Related Content</span></span>  
 [<span data-ttu-id="2373e-173">Protegendo o SQL Server</span><span class="sxs-lookup"><span data-stu-id="2373e-173">Securing SQL Server</span></span>](../securing-sql-server.md)  
  
 [<span data-ttu-id="2373e-174">Funções de segurança &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="2373e-174">Security Functions &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/functions/security-functions-transact-sql)  
  
## <a name="see-also"></a><span data-ttu-id="2373e-175">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="2373e-175">See Also</span></span>  
 <span data-ttu-id="2373e-176">[Hierarquia de permissões &#40;Mecanismo de banco de dados&#41;](../permissions-hierarchy-database-engine.md) </span><span class="sxs-lookup"><span data-stu-id="2373e-176">[Permissions Hierarchy &#40;Database Engine&#41;](../permissions-hierarchy-database-engine.md) </span></span>  
 [<span data-ttu-id="2373e-177">Protegíveis</span><span class="sxs-lookup"><span data-stu-id="2373e-177">Securables</span></span>](../securables.md)  
  
  
