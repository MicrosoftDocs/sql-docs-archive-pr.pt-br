---
title: Atualizar um banco de dados utilizando Desanexar e Anexar (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- database attaching [SQL Server]
- upgrading databases
- database upgrades [SQL Server]
- database detaching [SQL Server]
- detaching databases [SQL Server]
- attaching databases [SQL Server]
ms.assetid: 99f66ed9-3a75-4e38-ad7d-6c27cc3529a9
author: stevestein
ms.author: sstein
ms.openlocfilehash: d430825fd862ff49b867790f366200a524df3c1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572102"
---
# <a name="upgrade-a-database-using-detach-and-attach-transact-sql"></a><span data-ttu-id="d2385-102">Atualizar um banco de dados utilizando Desanexar e Anexar (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d2385-102">Upgrade a Database Using Detach and Attach (Transact-SQL)</span></span>
  <span data-ttu-id="d2385-103">Este tópico descreve como usar operações de desanexação e anexação para atualizar um banco de dados do [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d2385-103">This topic describes how to use detach and attach operations to upgrade a database in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="d2385-104">Depois de ser anexado ao [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], o banco de dados estará disponível imediatamente e, em seguida, será atualizado.</span><span class="sxs-lookup"><span data-stu-id="d2385-104">After being attached to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database is available immediately and is automatically upgraded.</span></span>  
  
 <span data-ttu-id="d2385-105">**Neste tópico**</span><span class="sxs-lookup"><span data-stu-id="d2385-105">**In This Topic**</span></span>  
  
-   <span data-ttu-id="d2385-106">**Antes de começar:**</span><span class="sxs-lookup"><span data-stu-id="d2385-106">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="d2385-107">Limitações e restrições</span><span class="sxs-lookup"><span data-stu-id="d2385-107">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="d2385-108">Recomendações</span><span class="sxs-lookup"><span data-stu-id="d2385-108">Recommendations</span></span>](#Recommendations)  
  
-   <span data-ttu-id="d2385-109">**Para atualizar um banco de dados do SQL Server:**</span><span class="sxs-lookup"><span data-stu-id="d2385-109">**To Upgrade a SQL Server Database:**</span></span>  
  
     [<span data-ttu-id="d2385-110">Usando operações de anexação e desanexação</span><span class="sxs-lookup"><span data-stu-id="d2385-110">Using detach and attach operations</span></span>](#SSMSProcedure)  
  
-   <span data-ttu-id="d2385-111">**Follow Up:**  [After Upgrading a SQL Server Database](#FollowUp)</span><span class="sxs-lookup"><span data-stu-id="d2385-111">**Follow Up:**  [After Upgrading a SQL Server Database](#FollowUp)</span></span>  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="d2385-112">Antes de começar</span><span class="sxs-lookup"><span data-stu-id="d2385-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="d2385-113">Limitações e restrições</span><span class="sxs-lookup"><span data-stu-id="d2385-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="d2385-114">Os bancos de dados de sistema não podem ser anexados.</span><span class="sxs-lookup"><span data-stu-id="d2385-114">The system databases cannot be attached.</span></span>  
  
-   <span data-ttu-id="d2385-115">Anexe e desanexe a desabilitação do encadeamento de propriedades de bancos de dados ao definir sua opção **encadeamento de propriedades de bancos de dados** como 0.</span><span class="sxs-lookup"><span data-stu-id="d2385-115">Attach and detach disable cross-database ownership chaining for the database by setting its **cross db ownership chaining** option to 0.</span></span> <span data-ttu-id="d2385-116">Para obter informações sobre como habilitar o encadeamento, veja [Opção cross db ownership chaining de configuração de servidor](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="d2385-116">For information about enabling chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
-   <span data-ttu-id="d2385-117">Quando anexar um banco de dados replicado que foi copiado em vez de desanexado:</span><span class="sxs-lookup"><span data-stu-id="d2385-117">When attaching a replicated database that was copied instead of detached:</span></span>  
  
    -   <span data-ttu-id="d2385-118">Se você anexar o banco de dados a uma versão atualizada da mesma instância do servidor, será necessário executar **sp_vupgrade_replication** para atualizar a replicação após a conclusão da operação de anexação.</span><span class="sxs-lookup"><span data-stu-id="d2385-118">If you attach the database to an upgraded version of the same server instance, you must execute **sp_vupgrade_replication** to upgrade replication after the attach operation finishes.</span></span> <span data-ttu-id="d2385-119">Para obter mais informações, veja [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d2385-119">For more information, see [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="d2385-120">Se você anexar o banco de dados a uma instância de servidor diferente (independentemente da versão), deverá executar **sp_removedbreplication** para remover a replicação após a conclusão da operação de anexação.</span><span class="sxs-lookup"><span data-stu-id="d2385-120">If you attach the database to a different server instance (regardless of version), you must execute **sp_removedbreplication** to remove replication after the attach operation finishes.</span></span> <span data-ttu-id="d2385-121">Para obter mais informações, veja [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d2385-121">For more information, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="d2385-122">Recomendações</span><span class="sxs-lookup"><span data-stu-id="d2385-122">Recommendations</span></span>  
 <span data-ttu-id="d2385-123">Não é recomendável anexar ou restaurar bancos de dados de origem desconhecida ou não confiável.</span><span class="sxs-lookup"><span data-stu-id="d2385-123">We recommend that you do not attach or restore databases from unknown or untrusted sources.</span></span> <span data-ttu-id="d2385-124">Esses bancos de dados podem conter um código mal-intencionado que pode executar um código [!INCLUDE[tsql](../../includes/tsql-md.md)] inesperado ou provocar erros modificando o esquema ou a estrutura física do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d2385-124">Such databases could contain malicious code that might execute unintended [!INCLUDE[tsql](../../includes/tsql-md.md)] code or cause errors by modifying the schema or the physical database structure.</span></span> <span data-ttu-id="d2385-125">Antes de usar um banco de dados de origem desconhecida ou não confiável, execute [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) no banco de dados, em um servidor que não seja de produção. Além disso, examine o código, como procedimentos armazenados ou outro código definido pelo usuário, no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d2385-125">Before you use a database from an unknown or untrusted source, run [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) on the database on a nonproduction server and also examine the code, such as stored procedures or other user-defined code, in the database.</span></span>  
  
##  <a name="to-upgrade-a-database-by-using-detach-and-attach"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d2385-126">Para atualizar um banco de dados usando desanexar e anexar</span><span class="sxs-lookup"><span data-stu-id="d2385-126">To Upgrade a Database by Using Detach and Attach</span></span>  
  
1.  <span data-ttu-id="d2385-127">Desanexe o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d2385-127">Detach the database.</span></span> <span data-ttu-id="d2385-128">Para obter mais informações, veja [Desanexar um banco de dados](detach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="d2385-128">For more information, see [Detach a Database](detach-a-database.md).</span></span>  
  
2.  <span data-ttu-id="d2385-129">Opcionalmente, mova o arquivo ou arquivos de banco de dados desanexados e o arquivo ou arquivos de log.</span><span class="sxs-lookup"><span data-stu-id="d2385-129">Optionally, move the detached database file or files and the log file or files.</span></span>  
  
     <span data-ttu-id="d2385-130">Você deverá mover os arquivos de log junto com os arquivos de dados, mesmo se pretender criar novos arquivos de log.</span><span class="sxs-lookup"><span data-stu-id="d2385-130">You should move the log files along with the data files, even if you intend to create new log files.</span></span> <span data-ttu-id="d2385-131">Em alguns casos, reanexar um banco de dados exige seus arquivos de log existentes.</span><span class="sxs-lookup"><span data-stu-id="d2385-131">In some cases, reattaching a database requires its existing log files.</span></span> <span data-ttu-id="d2385-132">Portanto, mantenha todos os arquivos de log desanexados até que o banco de dados seja anexado com êxito sem eles.</span><span class="sxs-lookup"><span data-stu-id="d2385-132">Therefore, always keep all the detached log files until the database has been successfully attached without them.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d2385-133">Se você tentar anexar o banco de dados sem especificar o arquivo de log, a operação de anexação procurará o arquivo de log em seu local original.</span><span class="sxs-lookup"><span data-stu-id="d2385-133">If you try to attach the database without specifying the log file, the attach operation will look for the log file in its original location.</span></span> <span data-ttu-id="d2385-134">Se ainda existir uma cópia original do log nesse local, essa cópia será anexada.</span><span class="sxs-lookup"><span data-stu-id="d2385-134">If the original copy of the log still exists in that location, that copy is attached.</span></span> <span data-ttu-id="d2385-135">Para evitar a utilização do arquivo de log original, especifique o caminho do novo arquivo de log ou remova a cópia original do arquivo de log (depois de copiá-la para o novo local).</span><span class="sxs-lookup"><span data-stu-id="d2385-135">To avoid using the original log file, either specify the path of the new log file or remove the original copy of the log file (after copying it to the new location).</span></span>  
  
3.  <span data-ttu-id="d2385-136">Anexe os arquivos copiados à instância do [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d2385-136">Attach the copied files to the instance of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="d2385-137">Para obter mais informações, consulte [Attach a Database](attach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="d2385-137">For more information, see [Attach a Database](attach-a-database.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="d2385-138">Exemplo</span><span class="sxs-lookup"><span data-stu-id="d2385-138">Example</span></span>  
 <span data-ttu-id="d2385-139">O exemplo a seguir atualiza uma cópia de um banco de dados de uma versão anterior do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d2385-139">The following example upgrades a copy of a database from an earlier version of SQL Server.</span></span> <span data-ttu-id="d2385-140">As instruções [!INCLUDE[tsql](../../includes/tsql-md.md)] são executadas em uma janela do Editor de Consultas conectada à instância do servidor à qual está anexado.</span><span class="sxs-lookup"><span data-stu-id="d2385-140">The [!INCLUDE[tsql](../../includes/tsql-md.md)] statements are executed in a Query Editor window that is connected to the server instance to which is attached.</span></span>  
  
1.  <span data-ttu-id="d2385-141">Desanexe o banco de dados executando as seguintes instruções [!INCLUDE[tsql](../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="d2385-141">Detach the database by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statements:</span></span>  
  
    ```  
    USE master;  
    GO  
    EXEC sp_detach_db @dbname = N'MyDatabase';  
    GO  
    ```  
  
2.  <span data-ttu-id="d2385-142">Usando o método de sua escolha, copie os arquivos de dados e log no novo local.</span><span class="sxs-lookup"><span data-stu-id="d2385-142">Using the method of your choice, copy the data and log files to the new location.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d2385-143">Para um banco de dados de produção, coloque o banco de dados e o log de transações em discos separados.</span><span class="sxs-lookup"><span data-stu-id="d2385-143">For a production database, place the database and transaction log on separate disks.</span></span>  
  
     <span data-ttu-id="d2385-144">Para copiar arquivos pela rede para um disco ou um computador remoto, utilize o nome UNC (Convenção Universal de Nomenclatura) do local remoto.</span><span class="sxs-lookup"><span data-stu-id="d2385-144">To copy files over the network to a disk on a remote computer, use the universal naming convention (UNC) name of the remote location.</span></span> <span data-ttu-id="d2385-145">Um nome UNC usa o formato **\\\\** _nomedoservidor_ **\\** _ShareName_ **\\** _caminho_ **\\** _filename_.</span><span class="sxs-lookup"><span data-stu-id="d2385-145">A UNC name takes the form **\\\\**_Servername_**\\**_Sharename_**\\**_Path_**\\**_Filename_.</span></span> <span data-ttu-id="d2385-146">Assim como ocorre com a gravação de arquivos no disco rígido local, deverão ser concedidas, à conta do usuário utilizada pela instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], as permissões apropriadas exigidas para ler ou gravar em um arquivo no disco remoto.</span><span class="sxs-lookup"><span data-stu-id="d2385-146">As with writing files to the local hard disk, the appropriate permissions that are required to read or write to a file on the remote disk must be granted to the user account used by the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
3.  <span data-ttu-id="d2385-147">Anexe o banco de dados movido e, opcionalmente, seu log executando a seguinte instrução [!INCLUDE[tsql](../../includes/tsql-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="d2385-147">Attach the moved database and, optionally, its log by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
    ```  
    USE master;  
    GO  
    CREATE DATABASE MyDatabase   
        ON (FILENAME = 'C:\MySQLServer\MyDatabase.mdf'),  
        (FILENAME = 'C:\MySQLServer\Database.ldf')  
        FOR ATTACH;  
    GO  
    ```  
  
     <span data-ttu-id="d2385-148">No [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], um banco de dados anexado recentemente não fica imediatamente visível no Pesquisador de Objetos.</span><span class="sxs-lookup"><span data-stu-id="d2385-148">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], a newly attached database is not immediately visible in Object Explorer.</span></span> <span data-ttu-id="d2385-149">Para exibir o banco de dados, no Pesquisador de Objetos, clique em **Exibir** e depois em **Atualizar**.</span><span class="sxs-lookup"><span data-stu-id="d2385-149">To view the database, in Object Explorer, click **View,** and then **Refresh**.</span></span> <span data-ttu-id="d2385-150">Quando o nó **Bancos de Dados** for expandido no Pesquisador de Objetos, o banco de dados recentemente anexado será exibido na lista de bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="d2385-150">When the **Databases** node is expanded in Object Explorer, the newly attached database now appears in the list of databases.</span></span>  
  
##  <a name="follow-up-after-upgrading-a-sql-server-database"></a><a name="FollowUp"></a> <span data-ttu-id="d2385-151">Acompanhamento: Depois de atualizar um banco de dados do SQL Server</span><span class="sxs-lookup"><span data-stu-id="d2385-151">Follow Up: After Upgrading a SQL Server Database</span></span>  
 <span data-ttu-id="d2385-152">Se o banco de dados tiver índices de texto completo, o processo de atualização importará, redefinirá ou recriará esses índices, dependendo da configuração da propriedade de servidor **upgrade_option** .</span><span class="sxs-lookup"><span data-stu-id="d2385-152">If the database has full-text indexes, the upgrade process either imports, resets, or rebuilds them, depending on the setting of the **upgrade_option** server property.</span></span> <span data-ttu-id="d2385-153">Se a opção de atualização for definida como importar (**upgrade_option** = 2) ou recriar (**upgrade_option** = 0), os índices de texto completo permanecerão indisponíveis durante a atualização.</span><span class="sxs-lookup"><span data-stu-id="d2385-153">If the upgrade option is set to import (**upgrade_option** = 2) or rebuild (**upgrade_option** = 0), the full-text indexes will be unavailable during the upgrade.</span></span> <span data-ttu-id="d2385-154">Dependendo da quantidade de dados a serem indexados, a importação pode levar várias horas, e a recriação pode ser até dez vezes mais demorada.</span><span class="sxs-lookup"><span data-stu-id="d2385-154">Depending the amount of data being indexed, importing can take several hours, and rebuilding can take up to ten times longer.</span></span> <span data-ttu-id="d2385-155">Lembre-se também de que, quando a opção de atualização estiver definida para importar, os índices de texto completo associados serão recriados se um catálogo de texto completo não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="d2385-155">Note also that when the upgrade option is set to import, the associated full-text indexes are rebuilt if a full-text catalog is not available.</span></span> <span data-ttu-id="d2385-156">Para alterar a configuração da propriedade de servidor **upgrade_option** , use [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d2385-156">To change the setting of the **upgrade_option** server property, use [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span>  
  
### <a name="database-compatibility-level-after-upgrade"></a><span data-ttu-id="d2385-157">Nível de compatibilidade do banco de dados após a atualização</span><span class="sxs-lookup"><span data-stu-id="d2385-157">Database Compatibility Level After Upgrade</span></span>  
 <span data-ttu-id="d2385-158">Se o nível de compatibilidade de um banco de dados de usuário for 100 ou mais alto antes da atualização, ele permanecerá o mesmo depois da atualização.</span><span class="sxs-lookup"><span data-stu-id="d2385-158">If the compatibility level of a user database is 100 or higher before upgrade, it remains the same after upgrade.</span></span> <span data-ttu-id="d2385-159">Se o nível de compatibilidade for 90 ou inferior antes da atualização, no banco de dados atualizado, o nível de compatibilidade será definido como 100, que é o nível de compatibilidade mais baixo com suporte no [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d2385-159">If the compatibility level is 90 before upgrade in the upgraded database, the compatibility level is set to 100, which is the lowest supported compatibility level in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="d2385-160">Para obter mais informações, veja [Nível de compatibilidade de ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span><span class="sxs-lookup"><span data-stu-id="d2385-160">For more information, see [ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span></span>  
  
### <a name="managing-metadata-on-the-upgraded-server-instance"></a><span data-ttu-id="d2385-161">Gerenciando metadados na instância do servidor atualizado</span><span class="sxs-lookup"><span data-stu-id="d2385-161">Managing Metadata on the Upgraded Server Instance</span></span>  
 <span data-ttu-id="d2385-162">Quando você anexa um banco de dados à outra instância do servidor, para oferecer uma utilização consistente aos usuários e aplicativos, pode ser necessário recriar alguns, ou todos os metadados, para o banco de dados, como logons, trabalhos e permissões, na outra instância do servidor.</span><span class="sxs-lookup"><span data-stu-id="d2385-162">When you attach a database onto another server instance, to provide a consistent experience to users and applications, you might have to re-create some or all of the metadata for the database, such as logins, jobs, and permissions, on the other server instance.</span></span> <span data-ttu-id="d2385-163">Para obter mais informações, consulte [Gerenciar metadados ao disponibilizar um banco de dados em outra instância do servidor &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="d2385-163">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>  
  
### <a name="service-master-key-and-database-master-key-encryption-changes-from-3des-to-aes"></a><span data-ttu-id="d2385-164">A Chave mestra de serviço e a Criptografia de Chave Mestra de Banco de dados é alterada de 3DES para AES</span><span class="sxs-lookup"><span data-stu-id="d2385-164">Service Master Key and Database Master Key Encryption changes from 3DES to AES</span></span>  
 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] <span data-ttu-id="d2385-165">e versões posteriores usam o algoritmo de criptografia AES para proteger a SMK (chave mestra de serviço) e a DMK (chave mestra de banco de dados).</span><span class="sxs-lookup"><span data-stu-id="d2385-165">and higher versions uses the AES encryption algorithm to protect the service master key (SMK) and the database master key (DMK).</span></span> <span data-ttu-id="d2385-166">O AES é um algoritmo de criptografia mais novo que o 3DES usado em versões anteriores.</span><span class="sxs-lookup"><span data-stu-id="d2385-166">AES is a newer encryption algorithm than 3DES used in earlier versions.</span></span> <span data-ttu-id="d2385-167">Quando um banco de dados é anexado ou restaurado pela primeira vez a uma nova instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], uma cópia da chave mestra de banco de dados (criptografada pela chave mestra de serviço) ainda não está armazenada no servidor.</span><span class="sxs-lookup"><span data-stu-id="d2385-167">When a database is first attached or restored to a new instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a copy of the database master key (encrypted by the service master key) is not yet stored in the server.</span></span> <span data-ttu-id="d2385-168">Você deve usar a instrução `OPEN MASTER KEY` para descriptografar a chave mestra do banco de dados (DMK).</span><span class="sxs-lookup"><span data-stu-id="d2385-168">You must use the `OPEN MASTER KEY` statement to decrypt the database master key (DMK).</span></span> <span data-ttu-id="d2385-169">Uma vez que a DMK foi descriptografada, você tem a opção de permitir a descriptografia automática futuramente usando a instrução `ALTER MASTER KEY REGENERATE` para fornecer ao servidor uma cópia da DMK criptografada com a SMK.</span><span class="sxs-lookup"><span data-stu-id="d2385-169">Once the DMK has been decrypted, you have the option of enabling automatic decryption in the future by using the `ALTER MASTER KEY REGENERATE` statement to provision the server with a copy of the DMK, encrypted with the service master key (SMK).</span></span> <span data-ttu-id="d2385-170">Quando um banco de dados for atualizado de uma versão anterior, a DMK deverá ser regenerada para usar o algoritmo AES mais recente.</span><span class="sxs-lookup"><span data-stu-id="d2385-170">When a database has been upgraded from an earlier version, the DMK should be regenerated to use the newer AES algorithm.</span></span> <span data-ttu-id="d2385-171">Para obter mais informações sobre como regenerar a DMK, veja [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d2385-171">For more information about regenerating the DMK, see [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span> <span data-ttu-id="d2385-172">O tempo necessário para regenerar a chave DMK para atualizar o AES depende do número de objetos protegidos pela DMK.</span><span class="sxs-lookup"><span data-stu-id="d2385-172">The time required to regenerate the DMK key to upgrade to AES depends upon the number of objects protected by the DMK.</span></span> <span data-ttu-id="d2385-173">É necessário regenerar a chave DMK para atualizar o AES somente uma vez, isso não tem impacto sobre regenerações futuras como parte de uma estratégia de rotação de chave.</span><span class="sxs-lookup"><span data-stu-id="d2385-173">Regenerating the DMK key to upgrade to AES is only necessary once, and has no impact on future regenerations as part of a key rotation strategy.</span></span>  
  
  
