---
title: SQL Server arquivos de dados no Azure | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87678777"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="05c51-102">Arquivos de dados do SQL Server no Azure</span><span class="sxs-lookup"><span data-stu-id="05c51-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="05c51-103">SQL Server arquivos de dados no Azure habilita o suporte nativo para SQL Server arquivos de banco de dados armazenados como BLOBs do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="05c51-104">Ele permite que você crie um banco de dados no SQL Server em execução no local ou em uma máquina virtual no Azure com um local de armazenamento dedicado para seus dados no armazenamento de BLOBs do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="05c51-105">Esse aprimoramento simplifica especialmente a movimentação de bancos de dados entre computadores usando operações de anexação e desanexação.</span><span class="sxs-lookup"><span data-stu-id="05c51-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="05c51-106">Além disso, ele fornece um local de armazenamento alternativo para os arquivos de backup do banco de dados, permitindo que você restaure de ou para o armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="05c51-107">Em virtude disso, ele permite várias soluções híbridas ao fornecer vários benefícios para virtualização de dados, movimentação de dados, segurança e disponibilidade, baixo custo e facilidade de manutenção, o que proporciona alta disponibilidade e dimensionamento elástico.</span><span class="sxs-lookup"><span data-stu-id="05c51-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="05c51-108">Este tópico apresenta conceitos e considerações que são fundamentais para armazenar SQL Server arquivos de dados no serviço de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="05c51-109">Para obter uma experiência prática sobre como usar esse novo recurso, consulte [tutorial: SQL Server arquivos de dados no serviço de armazenamento do Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05c51-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="05c51-110">O diagrama a seguir demonstra que esse aprimoramento permite que você armazene SQL Server arquivos de banco de dados como BLOBs do Azure no armazenamento do Azure, independentemente de onde o servidor reside.</span><span class="sxs-lookup"><span data-stu-id="05c51-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="05c51-111">![Integração do SQL Server com o armazenamento do Azure](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "Integração do SQL Server com o armazenamento do Azure")</span><span class="sxs-lookup"><span data-stu-id="05c51-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="05c51-112">Benefícios do uso de SQL Server arquivos de dados no Azure</span><span class="sxs-lookup"><span data-stu-id="05c51-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="05c51-113">**Benefícios da migração fácil e rápida:** esse recurso simplifica o processo de migração movendo um banco de dados de cada vez entre computadores locais e também entre ambientes locais e de nuvem, sem nenhuma alteração de aplicativo.</span><span class="sxs-lookup"><span data-stu-id="05c51-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="05c51-114">Em virtude disso, ele oferece suporte a uma migração incremental, preservando sua infraestrutura existente local.</span><span class="sxs-lookup"><span data-stu-id="05c51-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="05c51-115">Além disso, ter acesso a um armazenamento de dados centralizado simplifica a lógica do aplicativo quando um aplicativo precisa ser executado em vários locais em um ambiente local.</span><span class="sxs-lookup"><span data-stu-id="05c51-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="05c51-116">Em alguns casos, pode ser necessário configurar rapidamente os centros de computação em locais dispersos geograficamente, que coletam dados de várias origens diferentes.</span><span class="sxs-lookup"><span data-stu-id="05c51-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="05c51-117">Ao usar esse novo aprimoramento, em vez de mover dados de um local para outro, você pode armazenar vários bancos de dado como BLOBs do Azure e, em seguida, executar scripts Transact-SQL para criar bancos de dados nos computadores locais ou máquinas virtuais.</span><span class="sxs-lookup"><span data-stu-id="05c51-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="05c51-118">**Benefícios de armazenamento ilimitado e de custo:** Esse recurso permite que você tenha armazenamento ilimitado fora do local no Azure, aproveitando os recursos de computação locais.</span><span class="sxs-lookup"><span data-stu-id="05c51-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="05c51-119">Ao usar o Azure como um local de armazenamento, você pode se concentrar facilmente na lógica do aplicativo sem a sobrecarga do gerenciamento de hardware.</span><span class="sxs-lookup"><span data-stu-id="05c51-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="05c51-120">Se você perder um nó de computação no local, poderá configurar um novo sem nenhuma movimentação de dados.</span><span class="sxs-lookup"><span data-stu-id="05c51-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="05c51-121">**Benefícios de alta disponibilidade e recuperação de desastre:** O uso de SQL Server arquivos de dados no recurso do Azure pode simplificar as soluções de alta disponibilidade e recuperação de desastres.</span><span class="sxs-lookup"><span data-stu-id="05c51-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="05c51-122">Por exemplo, se uma máquina virtual no Azure ou uma instância do SQL Server falhar, você poderá recriar seus bancos de dados em um novo computador apenas restabelecendo os links para os BLOBs do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="05c51-123">**Benefícios de segurança:** esse novo aprimoramento permite que você separe uma instância de computação de uma instância de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="05c51-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="05c51-124">Você pode ter um banco de dados totalmente criptografado com a descriptografia ocorrendo apenas na instância de computação, mas não em uma instância de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="05c51-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="05c51-125">Ou seja, com esse novo aprimoramento, você poderá criptografar todos os dados na nuvem pública usando certificados de TDE (Criptografia de Dados Transparente), que são separados fisicamente dos dados.</span><span class="sxs-lookup"><span data-stu-id="05c51-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="05c51-126">As chaves de TDE podem ser armazenadas no banco de dados mestre, que é armazenado localmente em seu computador local seguro fisicamente e com backup feito localmente.</span><span class="sxs-lookup"><span data-stu-id="05c51-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="05c51-127">Você pode usar essas chaves locais para criptografar os dados que residem no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="05c51-128">Se suas credenciais de conta de armazenamento de nuvem forem roubadas, seus dados permanecerão seguros porque os certificados de TDE sempre residirão no local.</span><span class="sxs-lookup"><span data-stu-id="05c51-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="05c51-129">Conceitos e requisitos</span><span class="sxs-lookup"><span data-stu-id="05c51-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="05c51-130">Conceitos de Armazenamento do Azure</span><span class="sxs-lookup"><span data-stu-id="05c51-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="05c51-131">Ao usar o recurso de arquivos de dados do SQL Server no Azure, você precisará criar um contêiner e uma conta de armazenamento no Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="05c51-132">Em seguida, você precisará criar uma credencial do SQL Server, que inclui as informações sobre a política do contêiner, assim como uma assinatura de acesso compartilhado que é necessária para acessar o contêiner.</span><span class="sxs-lookup"><span data-stu-id="05c51-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="05c51-133">No Azure, uma conta de armazenamento representa o nível mais alto do namespace para acessar BLOBs.</span><span class="sxs-lookup"><span data-stu-id="05c51-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="05c51-134">Uma conta de armazenamento pode conter um número ilimitado de contêineres, contanto que o seu tamanho total seja menor que 500 TB.</span><span class="sxs-lookup"><span data-stu-id="05c51-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="05c51-135">Para obter as informações mais recentes sobre os limites de armazenamento, consulte [Assinatura e limites de serviço, cotas e restrições do Azure](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span><span class="sxs-lookup"><span data-stu-id="05c51-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="05c51-136">Um contêiner fornece um agrupamento de um conjunto de blobs.</span><span class="sxs-lookup"><span data-stu-id="05c51-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="05c51-137">Todos os blobs devem estar em um contêiner.</span><span class="sxs-lookup"><span data-stu-id="05c51-137">All Blobs must be in a container.</span></span> <span data-ttu-id="05c51-138">Uma conta pode conter um número ilimitado de contêineres.</span><span class="sxs-lookup"><span data-stu-id="05c51-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="05c51-139">Da mesma maneira, um contêiner também pode armazenar um número ilimitado de blobs.</span><span class="sxs-lookup"><span data-stu-id="05c51-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="05c51-140">Há dois tipos de blobs que podem ser armazenados no Armazenamento do Azure: blobs de blocos e de páginas.</span><span class="sxs-lookup"><span data-stu-id="05c51-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="05c51-141">Esse novo recurso usa blobs de página, que podem ter até 1 TB de tamanho e são mais eficientes quando os intervalos de bytes em um arquivo são alterados com frequência.</span><span class="sxs-lookup"><span data-stu-id="05c51-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="05c51-142">Você pode acessar blobs usando o seguinte formato de URL: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span><span class="sxs-lookup"><span data-stu-id="05c51-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="05c51-143">Considerações sobre cobrança do Azure</span><span class="sxs-lookup"><span data-stu-id="05c51-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="05c51-144">Estimar o custo do uso dos Serviços do Azure é uma questão importante do processo de tomada de decisão e planejamento.</span><span class="sxs-lookup"><span data-stu-id="05c51-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="05c51-145">Ao armazenar arquivos de dados do SQL Server no Armazenamento do Azure, você precisa pagar os custos associados ao armazenamento e às transações.</span><span class="sxs-lookup"><span data-stu-id="05c51-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="05c51-146">Além disso, a implementação do recurso Arquivos de Dados do SQL Server no Armazenamento do Azure exige uma renovação da concessão de Blob em intervalos de 45 a 60 segundos implicitamente.</span><span class="sxs-lookup"><span data-stu-id="05c51-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="05c51-147">Isso também resulta em custo de transações por arquivo de banco de dados, como arquivos .mdf e .ldf.</span><span class="sxs-lookup"><span data-stu-id="05c51-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="05c51-148">Com base em nossas estimativas, o custo de renovar concessões para dois arquivos de banco de dados (.mdf e .ldf) seria de aproximadamente 2 centavos por mês, de acordo com o modelo de preços atual.</span><span class="sxs-lookup"><span data-stu-id="05c51-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="05c51-149">Recomendamos que você use as informações na página [Preços do Azure](https://azure.microsoft.com/pricing/) para ajudar a estimar os custos mensais associados ao uso do Armazenamento do Azure e das Máquinas Virtuais do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="05c51-150">Conceitos do SQL Server</span><span class="sxs-lookup"><span data-stu-id="05c51-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="05c51-151">Ao usar esse novo aprimoramento, você deverá fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="05c51-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="05c51-152">Criar uma política em um contêiner e gerar uma chave SAS (assinatura de acesso compartilhado).</span><span class="sxs-lookup"><span data-stu-id="05c51-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="05c51-153">Para cada contêiner usado por um arquivo de dados ou de log, você deve criar uma Credencial do SQL Server cujo nome corresponda ao caminho do contêiner.</span><span class="sxs-lookup"><span data-stu-id="05c51-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="05c51-154">É necessário armazenar as informações relacionadas ao contêiner do Armazenamento do Azure, seu nome de política associado e a chave SAS no repositório de credenciais do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="05c51-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="05c51-155">O exemplo a seguir pressupõe que um contêiner de armazenamento do Azure foi criado e uma política foi criada com direitos de leitura, gravação, lista.</span><span class="sxs-lookup"><span data-stu-id="05c51-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="05c51-156">Criar uma política em um contêiner gera uma chave de SAS que pode ser mantida não criptografada na memória e usada pelo SQL Server para acessar os arquivos de blob no contêiner.</span><span class="sxs-lookup"><span data-stu-id="05c51-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="05c51-157">No snippet de código a seguir, substitua `'your SAS key'` por uma entrada semelhante à seguinte: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span><span class="sxs-lookup"><span data-stu-id="05c51-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="05c51-158">Para obter mais informações, consulte [criar e usar uma assinatura de acesso compartilhado](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span><span class="sxs-lookup"><span data-stu-id="05c51-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="05c51-159">se houver alguma referência ativa aos arquivos de dados em um contêiner, as tentativas de excluir as credenciais correspondentes do SQL Server apresentarão falha.</span><span class="sxs-lookup"><span data-stu-id="05c51-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="05c51-160">Segurança</span><span class="sxs-lookup"><span data-stu-id="05c51-160">Security</span></span>  
 <span data-ttu-id="05c51-161">Veja abaixo os requisitos e as considerações sobre segurança ao armazenar os Arquivos de Dados do SQL Server no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="05c51-162">Ao criar um contêiner para o serviço de armazenamento de Blobs do Azure, recomendamos que você defina o acesso como privado.</span><span class="sxs-lookup"><span data-stu-id="05c51-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="05c51-163">Quando você define o acesso como privado, o contêiner e os dados de blob podem ser lidos somente pelo proprietário da conta do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="05c51-164">Ao armazenar arquivos de banco de dados do SQL Server no Armazenamento do Azure, você precisará usar uma assinatura de acesso compartilhado, um URI que concede direitos de acesso restrito a contêineres, blobs, filas e tabelas.</span><span class="sxs-lookup"><span data-stu-id="05c51-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="05c51-165">Ao usar uma assinatura de acesso compartilhado, você poderá habilitar o SQL Server a acessar recursos em sua conta de armazenamento sem compartilhar a chave de conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="05c51-166">Além disso, recomendamos que você continue a implementar as práticas tradicionais de segurança locais para seus bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="05c51-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="05c51-167">Pré-requisitos da instalação</span><span class="sxs-lookup"><span data-stu-id="05c51-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="05c51-168">Os seguintes são pré-requisitos de instalação ao armazenar SQL Server arquivos de dados no Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="05c51-169">**SQL Server local:** o SQL Server 2014 inclui esse recurso.</span><span class="sxs-lookup"><span data-stu-id="05c51-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="05c51-170">Para saber como baixar o SQL Server 2014, consulte [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="05c51-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="05c51-171">SQL Server em execução em uma máquina virtual do Azure: se você estiver instalando o SQL Server em uma máquina virtual do Azure, instale o SQL Server 2014 ou atualize a instância existente.</span><span class="sxs-lookup"><span data-stu-id="05c51-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="05c51-172">Da mesma forma, você também pode criar uma nova máquina virtual no Azure usando a imagem da plataforma SQL Server 2014.</span><span class="sxs-lookup"><span data-stu-id="05c51-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="05c51-173">Para saber como baixar o SQL Server 2014, consulte [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="05c51-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="05c51-174">Limitações</span><span class="sxs-lookup"><span data-stu-id="05c51-174">Limitations</span></span>  
  
-   <span data-ttu-id="05c51-175">Na versão atual desse recurso, `FileStream` não há suporte para armazenamento de dados no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="05c51-176">Você pode armazenar `Filestream` dados em um banco de dado local integrado do armazenamento do Azure, mas não pode mover dados FILESTREAM entre computadores usando o armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="05c51-177">Para os dados do `FileStream`, recomendamos que você continue usando as técnicas tradicionais para mover os arquivos (.mdf, .ldf) associados ao Filestream entre computadores diferentes.</span><span class="sxs-lookup"><span data-stu-id="05c51-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="05c51-178">Atualmente, essa nova melhoria não dá suporte a mais de uma instância do SQL Server acessando os mesmos arquivos de banco de dados no Armazenamento do Azure ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="05c51-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="05c51-179">Se o Servidor A estiver online com um arquivo de banco de dados ativo e o Servidor B for iniciado por acidente e também tiver um banco de dados que aponta para o mesmo arquivo de dados, o segundo servidor não iniciará o banco de dados com um código de erro **5120 Não é possível abrir o arquivo físico "%.\*ls". Erro no sistema operacional %d: "%ls"** .</span><span class="sxs-lookup"><span data-stu-id="05c51-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="05c51-180">Apenas arquivos .mdf, .ldf e .ndf podem ser armazenados no Armazenamento do Azure usando o recurso Arquivos de Dados do SQL Server no Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="05c51-181">Ao usar o recurso Arquivos de Dados do SQL Server no Azure, não haverá suporte para a replicação geográfica em sua conta de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="05c51-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="05c51-182">Se uma conta de armazenamento for replicada geograficamente e um failover geográfico acontecer, poderá haver corrupção de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="05c51-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="05c51-183">Cada blob pode ser até no máximo 1 TB de tamanho.</span><span class="sxs-lookup"><span data-stu-id="05c51-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="05c51-184">Isso cria um limite superior para dados do banco de dados individual e arquivos de log que podem ser armazenados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="05c51-185">Não é possível armazenar dados OLTP in-memory no Blob do Azure usando o recurso Arquivos de Dados do SQL Server no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="05c51-186">Isso ocorre porque o OLTP na memória tem uma dependência de `FileStream` e, na versão atual desse recurso, `FileStream` não há suporte para armazenamento de dados no armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="05c51-187">Ao usar SQL Server arquivos de dados no recurso do Azure, SQL Server executa todas as comparações de caminho de arquivo ou URL usando o conjunto de agrupamentos no `master` banco de dados.</span><span class="sxs-lookup"><span data-stu-id="05c51-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="05c51-188">Os `AlwaysOn Availability Groups` têm suporte contanto que você não adicione novos arquivos de banco de dados ao banco de dados primário.</span><span class="sxs-lookup"><span data-stu-id="05c51-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="05c51-189">Se uma operação de banco de dados exigir que um novo arquivo seja criado no banco de dados primário, primeiro desabilite os grupos de disponibilidade AlwaysOn no nó secundário.</span><span class="sxs-lookup"><span data-stu-id="05c51-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="05c51-190">Em seguida, execute a operação de banco de dados no banco de dados primário e faça o backup do banco de dados no nó primário.</span><span class="sxs-lookup"><span data-stu-id="05c51-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="05c51-191">Em seguida, restaure o banco de dados para o nó secundário e habilite os grupos de disponibilidade AlwaysOn no nó secundário.</span><span class="sxs-lookup"><span data-stu-id="05c51-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="05c51-192">Observe que as instâncias de cluster de failover do AlwaysOn não têm suporte ao usar o SQL Server arquivos de dados no recurso do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="05c51-193">Durante a operação normal, o SQL Server usa concessões temporárias para reservar os blobs para armazenamento com uma renovação de cada concessão de blob a cada 45 a 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="05c51-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="05c51-194">Se um servidor falhar e outra instância do SQL Server configurada para usar os mesmos blobs tiver sido iniciada, a nova instância aguardará até 60 segundos pela concessão existente expirar no blob.</span><span class="sxs-lookup"><span data-stu-id="05c51-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="05c51-195">Se você quiser anexar o banco de dados a outra instância e não puder aguardar a concessão expirar dentro de 60 segundos, interrompa explicitamente a concessão no blob para evitar falhas em operações de anexação.</span><span class="sxs-lookup"><span data-stu-id="05c51-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="05c51-196">Suporte a ferramentas e referência de programação</span><span class="sxs-lookup"><span data-stu-id="05c51-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="05c51-197">Esta seção descreve as ferramentas e as bibliotecas de referência de programação que podem ser usadas ao armazenar arquivos de dados do SQL Server no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="05c51-198">Suporte ao PowerShell</span><span class="sxs-lookup"><span data-stu-id="05c51-198">PowerShell support</span></span>  
 <span data-ttu-id="05c51-199">No SQL Server 2014, você pode usar cmdlets do PowerShell para armazenar SQL Server arquivos de dados no serviço de armazenamento de BLOBs do Azure referenciando um caminho de URL de armazenamento de BLOBs em vez de um caminho de arquivo.</span><span class="sxs-lookup"><span data-stu-id="05c51-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="05c51-200">Você pode acessar blobs usando o seguinte formato de URL`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span><span class="sxs-lookup"><span data-stu-id="05c51-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="05c51-201">Suporte a objeto SQL Server e contadores de desempenho</span><span class="sxs-lookup"><span data-stu-id="05c51-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="05c51-202">A partir do SQL Server 2014, um novo objeto SQL Server foi adicionado para ser usado com o recurso Arquivos de Dados do SQL Server no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="05c51-203">O novo objeto SQL Server é chamado de [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) e pode ser usado pelo Monitor do Sistema para monitorar a atividade ao executar o SQL Server com o Armazenamento do Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="05c51-204">Suporte ao SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="05c51-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="05c51-205">O SQL Server Management Studio permite usar esse recurso por meio de várias janelas da caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="05c51-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="05c51-206">Por exemplo, você pode digitar o caminho de URL do contêiner de armazenamento, como `https://teststorageaccnt.blob.core.windows.net/testcontainer/` como **Caminho** em várias janelas da caixa de diálogo, como **Novo Banco de Dados**, **Anexar Banco de Dados**e **Restaurar Banco de Dados**.</span><span class="sxs-lookup"><span data-stu-id="05c51-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="05c51-207">Para obter mais informações, consulte [tutorial: SQL Server arquivos de dados no serviço de armazenamento do Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05c51-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="05c51-208">Suporte ao SQL Server Management Objects</span><span class="sxs-lookup"><span data-stu-id="05c51-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="05c51-209">Ao usar o recurso Arquivos de Dados do SQL Server no Azure, há suporte para o SMO (SQL Server Management Objects).</span><span class="sxs-lookup"><span data-stu-id="05c51-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="05c51-210">Se um objeto SMO exigir um caminho de arquivo, use o formato de URL do BLOB em vez do caminho de um arquivo local, como `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span><span class="sxs-lookup"><span data-stu-id="05c51-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="05c51-211">Para obter mais informações sobre SQL SMO (Server Management Objects), consulte [Guia de Programação do SQL SMO &#40;SQL Server Management Objects&#41;](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) nos Manuais Online do SQL Server.</span><span class="sxs-lookup"><span data-stu-id="05c51-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="05c51-212">Suporte a Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="05c51-212">Transact-SQL support</span></span>  
 <span data-ttu-id="05c51-213">Esse novo recurso introduziu a seguinte alteração na área de superfície do Transact-SQL:</span><span class="sxs-lookup"><span data-stu-id="05c51-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="05c51-214">Uma nova coluna **int** , **credential_id**, na exibição do sistema **sys.master_files** .</span><span class="sxs-lookup"><span data-stu-id="05c51-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="05c51-215">A coluna **credential_id** é usada para habilitar arquivos de dados habilitados para o Armazenamento do Azure para a referência cruzada a sys.credentials das credenciais criadas para eles.</span><span class="sxs-lookup"><span data-stu-id="05c51-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="05c51-216">Você pode usá-la para solucionar problemas, como, por exemplo, uma credencial que não pode ser excluída quando há um arquivo de banco de dados que a utiliza.</span><span class="sxs-lookup"><span data-stu-id="05c51-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="05c51-217">Solução de problemas para SQL Server arquivos de dados no Azure</span><span class="sxs-lookup"><span data-stu-id="05c51-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="05c51-218">Para evitar erros devido a recursos sem suporte ou limitações, primeiro analise [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span><span class="sxs-lookup"><span data-stu-id="05c51-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="05c51-219">Veja abaixo a lista de erros que você pode obter ao usar o recurso Arquivos de Dados do SQL Server no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="05c51-220">**Erros de autenticação**</span><span class="sxs-lookup"><span data-stu-id="05c51-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="05c51-221">*Não é possível remover a credencial “%.\*ls”, pois ela é usada por um arquivo de banco de dados ativo.*  </span><span class="sxs-lookup"><span data-stu-id="05c51-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="05c51-222">Resolução: você poderá ver este erro ao tentar remover uma credencial que ainda está sendo usada por um arquivo de banco de dados ativo no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="05c51-223">Para descartar a credencial, primeiro exclua o blob associado que contém esse arquivo de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="05c51-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="05c51-224">Para excluir um blob que tem uma concessão ativa, primeiro você deve interromper a concessão.</span><span class="sxs-lookup"><span data-stu-id="05c51-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="05c51-225">*A assinatura de acesso compartilhado não foi criada no contêiner corretamente.*  </span><span class="sxs-lookup"><span data-stu-id="05c51-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="05c51-226">Resolução: verifique se você criou uma assinatura de acesso compartilhado no contêiner corretamente.</span><span class="sxs-lookup"><span data-stu-id="05c51-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="05c51-227">Examine as instruções fornecidas na lição 2 em [tutorial: SQL Server arquivos de dados no serviço de armazenamento do Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05c51-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="05c51-228">*A credencial do SQL Server não foi criada corretamente.*  </span><span class="sxs-lookup"><span data-stu-id="05c51-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="05c51-229">Resolução: Verifique se você usou “Assinatura de Acesso Compartilhado” para o campo **Identity** e criou um segredo corretamente.</span><span class="sxs-lookup"><span data-stu-id="05c51-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="05c51-230">Examine as instruções fornecidas na lição 3 em [tutorial: SQL Server arquivos de dados no serviço de armazenamento do Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05c51-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="05c51-231">**Erros de blob de concessão:**</span><span class="sxs-lookup"><span data-stu-id="05c51-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="05c51-232">Erro ao tentar iniciar o SQL Server depois da falha de outra instância usando os mesmos arquivos de blob.</span><span class="sxs-lookup"><span data-stu-id="05c51-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="05c51-233">Resolução: durante a operação normal, o SQL Server usa concessões temporárias para reservar os blobs para armazenamento com uma renovação de cada concessão de blob a cada 45 a 60 segundos.</span><span class="sxs-lookup"><span data-stu-id="05c51-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="05c51-234">Se um servidor falhar e outra instância do SQL Server configurada para usar os mesmos blobs tiver sido iniciada, a nova instância aguardará até 60 segundos pela concessão existente expirar no blob.</span><span class="sxs-lookup"><span data-stu-id="05c51-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="05c51-235">Se você quiser anexar o banco de dados a outra instância e não puder aguardar a concessão expirar dentro de 60 segundos, interrompa explicitamente a concessão no blob para evitar falhas em operações de anexação.</span><span class="sxs-lookup"><span data-stu-id="05c51-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="05c51-236">**Erros de banco de dados**</span><span class="sxs-lookup"><span data-stu-id="05c51-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="05c51-237">*Erros ao criar um banco de dados* </span><span class="sxs-lookup"><span data-stu-id="05c51-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="05c51-238">Resolução: examine as instruções fornecidas na lição 4 em [tutorial: SQL Server arquivos de dados no serviço de armazenamento do Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05c51-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="05c51-239">*Erros ao executar a instrução Alter* </span><span class="sxs-lookup"><span data-stu-id="05c51-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="05c51-240">Resolução: execute a instrução Alterar Banco de Dados quando o banco de dados estiver online.</span><span class="sxs-lookup"><span data-stu-id="05c51-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="05c51-241">Ao copiar os arquivos de dados no Armazenamento do Azure, sempre crie um blob de páginas, não um blob de blocos.</span><span class="sxs-lookup"><span data-stu-id="05c51-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="05c51-242">Caso contrário, ALTER Database falhará.</span><span class="sxs-lookup"><span data-stu-id="05c51-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="05c51-243">Examine as instruções fornecidas na lição 7 em [tutorial: SQL Server arquivos de dados no serviço de armazenamento do Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05c51-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="05c51-244">*Código de erro 5120 não é possível abrir o arquivo físico "%. \* ls ". Erro do sistema operacional% d: "% ls"* </span><span class="sxs-lookup"><span data-stu-id="05c51-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="05c51-245">Resolução: Atualmente, essa nova melhoria não dá suporte a mais de uma instância do SQL Server acessando os mesmos arquivos de banco de dados no Armazenamento do Azure ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="05c51-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="05c51-246">Se o Servidor A estiver online com um arquivo de banco de dados ativo e o Servidor B for iniciado por acidente e também tiver um banco de dados que aponta para o mesmo arquivo de dados, o segundo servidor não iniciará o banco de dados com um código de erro *5120 Não é possível abrir o arquivo físico "%.\*ls". Erro no sistema operacional %d: "%ls"* .</span><span class="sxs-lookup"><span data-stu-id="05c51-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="05c51-247">Para resolver esse problema, primeiro determine se você precisa que o ServerA acesse o arquivo de banco de dados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="05c51-248">Se não precisar, basta remover as conexões entre o ServerA e os arquivos de banco de dados no Armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="05c51-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="05c51-249">Para fazer isso, siga estas etapas:</span><span class="sxs-lookup"><span data-stu-id="05c51-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="05c51-250">Defina o caminho do arquivo do Servidor A para uma pasta local usando a instrução ALTER Database.</span><span class="sxs-lookup"><span data-stu-id="05c51-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="05c51-251">Defina o banco de dados como offline no Servidor A.</span><span class="sxs-lookup"><span data-stu-id="05c51-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="05c51-252">Em seguida, copie os arquivos de banco de dados do Armazenamento do Azure para a pasta local no Servidor A. Isso garante que o ServerA ainda terá uma cópia do banco de dados localmente.</span><span class="sxs-lookup"><span data-stu-id="05c51-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="05c51-253">Defina o banco de dados como online.</span><span class="sxs-lookup"><span data-stu-id="05c51-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="05c51-254">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="05c51-254">See Also</span></span>  
 [<span data-ttu-id="05c51-255">Tutorial: Arquivos de dados do SQL Server no serviço de Armazenamento do Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="05c51-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
