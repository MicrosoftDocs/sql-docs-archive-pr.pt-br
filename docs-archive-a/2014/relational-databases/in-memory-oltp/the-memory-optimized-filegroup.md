---
title: O grupo de arquivos com otimização de memória | Microsoft Docs
ms.custom: ''
ms.date: 11/19/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 14106cc9-816b-493a-bcb9-fe66a1cd4630
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: a4ab6423159d0ba5a27af152cc5578905f57eec6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87583053"
---
# <a name="the-memory-optimized-filegroup"></a><span data-ttu-id="bc63f-102">O grupo de arquivos com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="bc63f-102">The Memory Optimized Filegroup</span></span>
  <span data-ttu-id="bc63f-103">Para criar tabelas com otimização de memória, você deve primeiro criar um grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-103">To create memory-optimized tables, you must first create a memory-optimized filegroup.</span></span> <span data-ttu-id="bc63f-104">O grupo de arquivos com otimização de memória retém um ou mais contêineres.</span><span class="sxs-lookup"><span data-stu-id="bc63f-104">The memory-optimized filegroup holds one or more containers.</span></span> <span data-ttu-id="bc63f-105">Cada contêiner contém arquivos de dados ou arquivos delta, ou então ambos.</span><span class="sxs-lookup"><span data-stu-id="bc63f-105">Each container contains data files or delta files or both.</span></span>  
  
 <span data-ttu-id="bc63f-106">Embora as linhas de dados das tabelas `SCHEMA_ONLY` não persistam e os metadados para tabelas otimizadas para memória e procedimentos armazenados compilados nativamente estejam armazenados nos catálogos tradicionais, o mecanismo [!INCLUDE[hek_2](../../includes/hek-2-md.md)] ainda requer um grupo de arquivos com otimização de memória para tabelas otimizadas para memória `SCHEMA_ONLY` para fornecer uma experiência uniforme para bancos de dados com tabelas otimizadas para memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-106">Even though data rows from `SCHEMA_ONLY` tables are not persisted and the metadata for memory-optimized tables and natively compiled stored procedures is stored in the traditional catalogs, the [!INCLUDE[hek_2](../../includes/hek-2-md.md)] engine still requires a memory-optimized filegroup for `SCHEMA_ONLY` memory-optimized tables to provide a uniform experience for databases with memory-optimized tables.</span></span>  
  
 <span data-ttu-id="bc63f-107">O grupo de arquivos com otimização de memória baseia-se no grupo de arquivos do fluxo de arquivos, com as seguintes diferenças:</span><span class="sxs-lookup"><span data-stu-id="bc63f-107">The memory-optimized filegroup is based on filestream filegroup, with the following differences:</span></span>  
  
-   <span data-ttu-id="bc63f-108">Só é possível criar um grupo de arquivos com otimização de memória por banco de dados.</span><span class="sxs-lookup"><span data-stu-id="bc63f-108">You can only create one memory-optimized filegroup per database.</span></span> <span data-ttu-id="bc63f-109">É necessário marcar explicitamente o grupo de arquivos como contendo o memory_optimized_data.</span><span class="sxs-lookup"><span data-stu-id="bc63f-109">You need to explicitly mark the filegroup as containing memory_optimized_data.</span></span> <span data-ttu-id="bc63f-110">Você pode criar o grupo de arquivos ao criar o banco de dados ou poderá adicioná-lo posteriormente:</span><span class="sxs-lookup"><span data-stu-id="bc63f-110">You can create the filegroup when you create the database or you can add it later:</span></span>  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILEGROUP imoltp_mod CONTAINS MEMORY_OPTIMIZED_DATA  
    ```  
  
-   <span data-ttu-id="bc63f-111">é necessário adicionar um ou mais contêineres ao grupo de arquivos MEMORY_OPTIMIZED_DATA.</span><span class="sxs-lookup"><span data-stu-id="bc63f-111">You need to add one or more containers to the MEMORY_OPTIMIZED_DATA filegroup.</span></span> <span data-ttu-id="bc63f-112">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="bc63f-112">For example:</span></span>  
  
    ```sql  
    ALTER DATABASE imoltp ADD FILE (name='imoltp_mod1', filename='c:\data\imoltp_mod1') TO FILEGROUP imoltp_mod  
    ```  
  
-   <span data-ttu-id="bc63f-113">Não é necessário habilitar o fluxo de arquivos ([Habilitar e configurar FILESTREAM](../blob/enable-and-configure-filestream.md)) para criar um grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-113">You do not need to enable filestream ([Enable and Configure FILESTREAM](../blob/enable-and-configure-filestream.md)) to create a memory-optimized filegroup.</span></span> <span data-ttu-id="bc63f-114">O mapeamento do fluxo de arquivos é realizado pelo mecanismo [!INCLUDE[hek_2](../../includes/hek-2-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="bc63f-114">The mapping to filestream is done by the [!INCLUDE[hek_2](../../includes/hek-2-md.md)] engine.</span></span>  
  
-   <span data-ttu-id="bc63f-115">Você pode adicionar novos contêineres a um grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-115">You can add new containers to a memory-optimized filegroup.</span></span> <span data-ttu-id="bc63f-116">Talvez seja necessário um novo contêiner para expandir o armazenamento necessário para a tabela com otimização de memória durável e também para distribuir e/s entre vários contêineres.</span><span class="sxs-lookup"><span data-stu-id="bc63f-116">You may need a new container to expand the storage needed for durable memory-optimized table and also to distribute I/O across multiple containers.</span></span>  
  
-   <span data-ttu-id="bc63f-117">O movimento dos dados com um grupo de arquivos com otimização de memória é otimizado em uma configuração do Grupo de Disponibilidade AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="bc63f-117">Data movement with a memory-optimized filegroup is optimized in an AlwaysOn Availability Group configuration.</span></span> <span data-ttu-id="bc63f-118">Diferente dos arquivos do fluxo de arquivos enviados para as réplicas secundárias, os arquivos de ponto de verificação (tanto de dados quanto de delta) no grupo de arquivos com otimização de memória não são enviados para as réplicas secundárias.</span><span class="sxs-lookup"><span data-stu-id="bc63f-118">Unlike filestream files that are sent to secondary replicas, the checkpoint files (both data and delta) within the memory-optimized filegroup are not sent to secondary replicas.</span></span> <span data-ttu-id="bc63f-119">Os arquivos de dados e delta são criados usando o log de transação na réplica secundária.</span><span class="sxs-lookup"><span data-stu-id="bc63f-119">The data and delta files are constructed using the transaction log on the secondary replica.</span></span>  
  
<span data-ttu-id="bc63f-120">As limitações a seguir do grupo de arquivos com otimização de memória,</span><span class="sxs-lookup"><span data-stu-id="bc63f-120">The following limitations of memory-optimized filegroup,</span></span>  
  
-   <span data-ttu-id="bc63f-121">Depois de criar um grupo de arquivos com otimização de memória, você somente poderá removê-lo ao descartar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="bc63f-121">Once you create a memory-optimized filegroup, you can only remove it by dropping the database.</span></span> <span data-ttu-id="bc63f-122">Em um ambiente de produção, é muito improvável que você precise remover o grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-122">In a production environment, it is unlikely that you will need to remove the memory-optimized filegroup.</span></span>  
  
-   <span data-ttu-id="bc63f-123">Não é possível descartar um contêiner não vazio ou mover os pares de dados e arquivo delta para outro contêiner no grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-123">You cannot drop a non-empty container or move data and delta file pairs to another container in the memory-optimized filegroup.</span></span>  
  
## <a name="configuring-a-memory-optimized-filegroup"></a><span data-ttu-id="bc63f-124">Configurando um grupo de arquivos com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="bc63f-124">Configuring a Memory-Optimized Filegroup</span></span>  
<span data-ttu-id="bc63f-125">Considere criar múltiplos contêineres em um grupo de arquivos com otimização de memória e distribui-los em diferentes unidades para obter mais largura de banda para transferir os dados para a memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-125">Consider creating multiple containers in the memory-optimized filegroup and distribute them on different drives to achieve more bandwidth to stream the data into memory.</span></span>  
  
<span data-ttu-id="bc63f-126">Ao configurar o armazenamento, é necessário fornecer espaço livre em disco de quatro vezes o tamanho das tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-126">When configuring storage, you must provide free disk space that is four times the size of durable memory-optimized tables.</span></span> <span data-ttu-id="bc63f-127">Verifique se o subsistema de e/s dá suporte ao IOPS necessário para sua carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="bc63f-127">Ensure that your I/O subsystem supports the required IOPS for your workload.</span></span> <span data-ttu-id="bc63f-128">Se os pares de dados e arquivo delta forem preenchidos em um IOPS específico, será necessário três vezes o tamanho do IOPS para abranger as operações de armazenamento e mesclagem.</span><span class="sxs-lookup"><span data-stu-id="bc63f-128">If data and delta file pairs are populated at a given IOPS, you need three times that IOPS to account for storing and merge operations.</span></span> <span data-ttu-id="bc63f-129">Você pode adicionar capacidade de armazenamento e IOPS adicionando um ou mais contêineres ao grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="bc63f-129">You can add storage capacity and IOPS by adding one or more containers to the memory-optimized filegroup.</span></span>  
  
<span data-ttu-id="bc63f-130">Em um contêiner múltiplo, cenário com várias unidades, os arquivos de dados e delta são alocados em rodízio nos contêineres.</span><span class="sxs-lookup"><span data-stu-id="bc63f-130">In a multiple container, multiple drive scenario, data and delta files are allocated in a round-robin fashion into containers.</span></span> <span data-ttu-id="bc63f-131">O primeiro arquivo de dados é alocado no primeiro contêiner e o arquivo delta é alocado no próximo contêiner, repetindo o padrão de alocação.</span><span class="sxs-lookup"><span data-stu-id="bc63f-131">The first data file is allocated from the first container and the delta file is allocated from the next container and this allocation pattern repeats.</span></span> <span data-ttu-id="bc63f-132">Este esquema de alocação distribui os dados e os arquivos delta uniformemente entre os contêineres se você possui um arquivo ímpar de unidades, cada um mapeado para um contêiner.</span><span class="sxs-lookup"><span data-stu-id="bc63f-132">This allocation scheme distributes data and delta files evenly across containers if you have an odd number of drives, each mapped to one container.</span></span> <span data-ttu-id="bc63f-133">Contudo, se você possuir um número par de unidades, cada um mapeado para um contêiner, isso poderá resultar no armazenamento desequilibrado dos dados para unidades ímpares e arquivos deltas mapeados para unidades pares.</span><span class="sxs-lookup"><span data-stu-id="bc63f-133">However, if you have an even number of drives, each mapped to a container, it can result in imbalanced storage with data files mapped to odd drives and delta files mapped to even drives.</span></span> <span data-ttu-id="bc63f-134">Para obter um fluxo balanceado de e/s na recuperação, considere colocar pares de dados e arquivos Delta nos mesmos eixos/armazenamento, conforme descrito no exemplo a seguir.</span><span class="sxs-lookup"><span data-stu-id="bc63f-134">To obtain a balanced stream of I/O on recovery, consider placing pairs of data and delta files on the same spindles/storage as described in the example below.</span></span>  

> [!CAUTION]
> <span data-ttu-id="bc63f-135">Se um `MAXSIZE` valor está definido para o grupo de arquivos com otimização de memória e arquivos de ponto de verificação excedem o tamanho máximo do contêiner, o banco de dados se torna suspeito.</span><span class="sxs-lookup"><span data-stu-id="bc63f-135">If a `MAXSIZE` value is set for the memory-optimized filegroup, and checkpoint files exceed the max size of the container, then the database will become SUSPECT.</span></span>   
> <span data-ttu-id="bc63f-136">Nesse caso, não tente definir o banco de dados como OFFLINE e ONLINE, fazendo o banco de dados permanecer no estado RECOVERY_PENDING.</span><span class="sxs-lookup"><span data-stu-id="bc63f-136">In this case do not attempt to set the database OFFLINE and ONLINE, causing the database to stay in RECOVERY_PENDING state.</span></span>
  
### <a name="example"></a><span data-ttu-id="bc63f-137">Exemplo</span><span class="sxs-lookup"><span data-stu-id="bc63f-137">Example</span></span> 
<span data-ttu-id="bc63f-138">Considere um grupo de arquivos com otimização de memória com dois contêineres: contêiner 1 na unidade X e contêiner 2 nas unidades Y.</span><span class="sxs-lookup"><span data-stu-id="bc63f-138">Consider a memory-optimized filegroup with two containers: container 1 on drive X and container 2 on drives Y.</span></span>  
<span data-ttu-id="bc63f-139">Visto que a alocação dos arquivos de dados e delta é realizada em rodízio, o contêiner 1 somente possuirá os arquivos de dados, enquanto o contêiner 2 possuirá somente arquivos delta, o que levará ao desequilíbrio do armazenamento bem como das operações de entrada e saída por segundo, pois os arquivos de dados são significativamente maiores que os arquivos delta.</span><span class="sxs-lookup"><span data-stu-id="bc63f-139">Since the allocation of data and delta files is done in round-robin fashion, container 1 will only have data files and container 2 will only have delta files, which leads to imbalanced persistence for storage as well as input/output operations per second, as data files are significantly larger than the delta files.</span></span>    
<span data-ttu-id="bc63f-140">Para distribuir arquivos Delta e de dados uniformemente entre as unidades X e Y, crie quatro contêineres em vez de dois e mapeie os dois primeiros contêineres para a unidade X e os dois próximos contêineres para a unidade Y.</span><span class="sxs-lookup"><span data-stu-id="bc63f-140">To distribute data and delta files uniformly across drives X and Y, create four containers instead of two, and map the first two containers to drive X and the next two containers to drive Y.</span></span>  
<span data-ttu-id="bc63f-141">Com a alocação Round Robin, os primeiros dados e o primeiro arquivo Delta serão alocados do contêiner-1 e do contêiner-2, respectivamente, que são mapeados para a unidade X.</span><span class="sxs-lookup"><span data-stu-id="bc63f-141">With round-robin allocation, the first data and first delta file will be allocated from container-1 and container-2 respectively, which are mapped to drive X.</span></span>   
<span data-ttu-id="bc63f-142">Da mesma forma, os próximos dados e o arquivo Delta serão alocados do contêiner-3 e do contêiner-4 que são mapeados para a unidade Y. Isso permite a distribuição uniforme de dados e arquivos Delta em duas unidades.</span><span class="sxs-lookup"><span data-stu-id="bc63f-142">Similarly, the next data and delta file will be allocated from container-3 and container-4 which are mapped to drive Y. This allows distributing data and delta files across two drives uniformly.</span></span>  
 
  
## <a name="see-also"></a><span data-ttu-id="bc63f-143">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="bc63f-143">See Also</span></span>  
<span data-ttu-id="bc63f-144">[Criando e gerenciando armazenamento para objetos com otimização de memória](creating-and-managing-storage-for-memory-optimized-objects.md)   </span><span class="sxs-lookup"><span data-stu-id="bc63f-144">[Creating and Managing Storage for Memory-Optimized Objects](creating-and-managing-storage-for-memory-optimized-objects.md)   </span></span>  
[<span data-ttu-id="bc63f-145">Arquivos e grupos de arquivos do banco de dados</span><span class="sxs-lookup"><span data-stu-id="bc63f-145">Database Files and Filegroups</span></span>](../../relational-databases/databases/database-files-and-filegroups.md)    
  
