---
title: Fazendo backup de um banco de dados com tabelas com otimização de memória | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 83d47694-e56d-4dae-b54e-14945bf8ba31
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 176448aa9d4bab4101ab2db12ffc9a8a7fd1a5b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87570008"
---
# <a name="backing-up-a-database-with-memory-optimized-tables"></a><span data-ttu-id="4a479-102">Fazendo backup de um banco de dados com tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="4a479-102">Backing Up a Database with Memory-Optimized Tables</span></span>
  <span data-ttu-id="4a479-103">As tabelas com otimização de memória são incluídas no backup como parte de backups regulares de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-103">Memory-optimized tables are backed up as part of regular database backups.</span></span> <span data-ttu-id="4a479-104">Quanto às tabelas baseadas em disco, o CHECKSUM de dados e os pares de arquivos delta são validados como parte do backup de banco de dados para detectar corrupção do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="4a479-104">As for disk-based tables, the CHECKSUM of data and delta file pairs is validated as part of the database backup to detect storage corruption.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4a479-105">Durante um backup, se você detectar um erro de CHECKSUM em um ou mais arquivos em um grupo de arquivos com otimização de memória, você não poderá restaurar e reiniciar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-105">During a backup, if you detect a CHECKSUM error in one or more files in a memory-optimized filegroup, you will not be able to restore and restart the database.</span></span> <span data-ttu-id="4a479-106">Nessa situação, você deve restaurar seu banco de dados com o último backup válido.</span><span class="sxs-lookup"><span data-stu-id="4a479-106">In that situation, you must, restore your database with the last known good backup.</span></span> <span data-ttu-id="4a479-107">Se você não tiver um backup, poderá exportar os dados das tabelas com otimização de memória e as tabelas baseadas em disco e recarregá-las depois que você remover e recriar o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-107">If you don't have a backup, you can export the data from memory-optimized tables and disk-based tables and reload after you drop and recreate the database.</span></span>  
  
 <span data-ttu-id="4a479-108">Um backup completo de um banco de dados com uma ou mais tabelas com otimização de memória consiste no armazenamento alocado para tabelas baseadas em disco (se houver), no log de transações ativas e nos pares de arquivos de dados e delta (também conhecidos como pares de arquivos de ponto de verificação) para tabelas otimizadas para memória.</span><span class="sxs-lookup"><span data-stu-id="4a479-108">A full backup of a database with one or more memory-optimized tables consists of the allocated storage for disk-based tables (if any), the active transaction log, and the data and delta file pairs (also known as checkpoint file pairs) for memory-optimized tables.</span></span> <span data-ttu-id="4a479-109">No entanto, como descrito em [Durabilidade de tabelas com otimização de memória](memory-optimized-tables.md), o armazenamento usado por tabelas com otimização de memória pode ser muito maior do que seu tamanho em memória, e afeta o tamanho do backup do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-109">However, as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md), the storage used by memory-optimized tables can be much larger than its size in memory, and it affects the size of the database backup.</span></span>  
  
## <a name="full-database-backup"></a><span data-ttu-id="4a479-110">Backup de banco de dados Completo</span><span class="sxs-lookup"><span data-stu-id="4a479-110">Full Database Backup</span></span>  
 <span data-ttu-id="4a479-111">Esta discussão se concentrará em backups de banco de dados para bancos de dados que têm apenas tabelas com otimização de memória, uma vez que o backup de tabelas baseadas em disco é igual.</span><span class="sxs-lookup"><span data-stu-id="4a479-111">This discussion will focus on database backups for databases with just durable memory-optimized tables, because the backup for disk-based tables is the same.</span></span> <span data-ttu-id="4a479-112">Os pares do arquivos de ponto de verificação no grupo de arquivos com otimização de memória poderia estar em diversos estados.</span><span class="sxs-lookup"><span data-stu-id="4a479-112">The checkpoint file pairs in the memory-optimized filegroup could be in various states.</span></span> <span data-ttu-id="4a479-113">A tabela a seguir descreve qual parte dos arquivos é inserida no backup.</span><span class="sxs-lookup"><span data-stu-id="4a479-113">The table below describes what part of the files is backed.</span></span>  
  
|<span data-ttu-id="4a479-114">Estado do par de arquivos de ponto de verificação</span><span class="sxs-lookup"><span data-stu-id="4a479-114">Checkpoint File Pair State</span></span>|<span data-ttu-id="4a479-115">Backup</span><span class="sxs-lookup"><span data-stu-id="4a479-115">Backup</span></span>|  
|--------------------------------|------------|  
|<span data-ttu-id="4a479-116">PRECREATED</span><span class="sxs-lookup"><span data-stu-id="4a479-116">PRECREATED</span></span>|<span data-ttu-id="4a479-117">Somente metadados de arquivo</span><span class="sxs-lookup"><span data-stu-id="4a479-117">File metadata only</span></span>|  
|<span data-ttu-id="4a479-118">UNDER CONSTRUCTION</span><span class="sxs-lookup"><span data-stu-id="4a479-118">UNDER CONSTRUCTION</span></span>|<span data-ttu-id="4a479-119">Somente metadados de arquivo</span><span class="sxs-lookup"><span data-stu-id="4a479-119">File metadata only</span></span>|  
|<span data-ttu-id="4a479-120">Ativo</span><span class="sxs-lookup"><span data-stu-id="4a479-120">Active</span></span>|<span data-ttu-id="4a479-121">Metadados de arquivo mais bytes usados</span><span class="sxs-lookup"><span data-stu-id="4a479-121">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="4a479-122">Origem mesclada</span><span class="sxs-lookup"><span data-stu-id="4a479-122">Merge source</span></span>|<span data-ttu-id="4a479-123">Metadados de arquivo mais bytes usados</span><span class="sxs-lookup"><span data-stu-id="4a479-123">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="4a479-124">Destino de mesclagem</span><span class="sxs-lookup"><span data-stu-id="4a479-124">Merge target</span></span>|<span data-ttu-id="4a479-125">Somente metadados de arquivo</span><span class="sxs-lookup"><span data-stu-id="4a479-125">File metadata only</span></span>|  
|<span data-ttu-id="4a479-126">REQUIRED FOR BACKUP/HA</span><span class="sxs-lookup"><span data-stu-id="4a479-126">REQUIRED FOR BACKUP/HA</span></span>|<span data-ttu-id="4a479-127">Metadados de arquivo mais bytes usados</span><span class="sxs-lookup"><span data-stu-id="4a479-127">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="4a479-128">IN TRANSITION TO TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="4a479-128">IN TRANSITION TO TOMBSTONE</span></span>|<span data-ttu-id="4a479-129">Somente metadados de arquivo</span><span class="sxs-lookup"><span data-stu-id="4a479-129">File metadata only</span></span>|  
|<span data-ttu-id="4a479-130">TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="4a479-130">TOMBSTONE</span></span>|<span data-ttu-id="4a479-131">Somente metadados de arquivo</span><span class="sxs-lookup"><span data-stu-id="4a479-131">File metadata only</span></span>|  
  
 <span data-ttu-id="4a479-132">O tamanho dos backups de banco de dados com uma ou mais tabelas com otimização de memória normalmente é maior do que o tamanho em memória mas menor do que o do armazenamento em disco.</span><span class="sxs-lookup"><span data-stu-id="4a479-132">The size of database backups with one or more memory-optimized tables is typically larger than its size in memory but smaller than the on-disk storage.</span></span> <span data-ttu-id="4a479-133">O tamanho adicional dependerá do número de linhas excluídas e do número de pares de arquivo de ponto de verificação nos estados Origem de mesclagem e REQUIRED FOR BACKUP/HA, que dependem indiretamente da carga de trabalho.</span><span class="sxs-lookup"><span data-stu-id="4a479-133">The extra size will depend upon the number of deleted rows and the number of checkpoint file pairs in the states Merge source and REQUIRED FOR BACKUP/HA which indirectly depends upon the workload.</span></span> <span data-ttu-id="4a479-134">Para obter descrições dos Estados dos pares de arquivos de ponto de verificação, consulte [Sys. dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4a479-134">For descriptions of the states for checkpoint file pairs, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>  
  
### <a name="estimating-size-of-full-database-backup"></a><span data-ttu-id="4a479-135">Estimando o tamanho do backup de banco de dados completo</span><span class="sxs-lookup"><span data-stu-id="4a479-135">Estimating Size of Full Database Backup</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="4a479-136">É recomendável que você não use o valor de BackupSizeInBytes para estimar o tamanho do backup para O OLTP in-memory.</span><span class="sxs-lookup"><span data-stu-id="4a479-136">It's recommended that you not use the BackupSizeInBytes value to estimate the backup size for In-Memory OLTP.</span></span>  
  
 <span data-ttu-id="4a479-137">O primeiro cenário de carga de trabalho é para (principalmente) inserir.</span><span class="sxs-lookup"><span data-stu-id="4a479-137">The first workload scenario is for (mostly) insert.</span></span> <span data-ttu-id="4a479-138">Neste cenário, a maioria dos arquivos de dados estará no estado Ativo, totalmente carregados e com muito poucas linhas excluídas.</span><span class="sxs-lookup"><span data-stu-id="4a479-138">In this scenario, most data files will be in the Active state, fully loaded, and with very few deleted rows.</span></span> <span data-ttu-id="4a479-139">O tamanho do backup do banco de dados estará próximo do tamanho dos dados na memória.</span><span class="sxs-lookup"><span data-stu-id="4a479-139">The size of database backup up will be close to the size of data in memory.</span></span>  
  
 <span data-ttu-id="4a479-140">O segundo cenário de carga de trabalho é para operações frequentes de inserção, exclusão e atualização: no pior caso, cada um dos pares de arquivos de ponto de verificação será 50% carregado, após a contabilidade das linhas excluídas.</span><span class="sxs-lookup"><span data-stu-id="4a479-140">The second workload scenario is for frequent insert, delete, and update operations: In the worst case, each of the checkpoint file pairs are 50% loaded, after accounting for the deleted rows.</span></span> <span data-ttu-id="4a479-141">Dessa forma, o tamanho do backup de banco de dados terá pelo menos 2 vezes o tamanho dos dados na memória.</span><span class="sxs-lookup"><span data-stu-id="4a479-141">So the size of the database backup will at least be 2 times the size of data in memory.</span></span> <span data-ttu-id="4a479-142">Além disso, alguns pares de arquivos de ponto de verificação nos estados Origem de mesclagem e Necessário para backup/alta disponibilidade se somarão ao tamanho do backup de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-142">Additionally, there will few checkpoint file pairs in states Merge source and Required for backup/high availability that will add to the size of database backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="4a479-143">Backups diferenciais de bancos de dados com tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="4a479-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="4a479-144">O armazenamento de tabelas com otimização de memória consiste em dados e arquivos delta, conforme descrito em [Durabilidade de tabelas com otimização de memória](memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="4a479-144">The storage for memory-optimized tables consists of data and delta files as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md).</span></span> <span data-ttu-id="4a479-145">O backup diferencial de um banco de dados com tabelas com otimização de memória contém os seguintes dados:</span><span class="sxs-lookup"><span data-stu-id="4a479-145">The differential backup of a database with memory-optimized tables contains the following data:</span></span>  
  
-   <span data-ttu-id="4a479-146">O backup diferencial para grupos de arquivos que armazenam tabelas baseadas em disco não é afetado pela presença de tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="4a479-146">Differential backup for filegroups storing disk-based tables is not affected by the presence of memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="4a479-147">O log de transações ativas é igual ao de um backup total do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-147">The active transaction log is the same as in a full database backup.</span></span>  
  
-   <span data-ttu-id="4a479-148">Para um grupo de arquivos de dados com otimização de memória, o backup diferencial usa o mesmo algoritmo que o backup total do banco de dados para identificar os arquivos de dados e delta para o backup, mas depois ele filtra o subconjunto de arquivos da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="4a479-148">For a memory-optimized data filegroup, the differential backup uses the same algorithm as full database backup to identify the data and delta files for backup but it then filters out the subset of files as follows:</span></span>  
  
    -   <span data-ttu-id="4a479-149">Um arquivo de dados contém linhas recém-inseridas e, quando está cheio, ele é fechado e marcado como somente leitura.</span><span class="sxs-lookup"><span data-stu-id="4a479-149">A data file contains newly inserted rows and when it is full, it is closed and marked read-only.</span></span> <span data-ttu-id="4a479-150">Um arquivo de dados será armazenado em backup apenas se ele tiver sido fechado após o último backup completo do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-150">A data file is backed up only if it was closed after the last full database backup.</span></span> <span data-ttu-id="4a479-151">O backup diferencial só realiza o backup de arquivos de dados que contêm as linhas inseridas desde o último backup completo do banco de dados, com exceção de um cenário de atualização e exclusão onde é possível que algumas das linhas inseridas já tenham sido marcadas para coleta de lixo ou já tenham sido limpas pelo coletor de lixo.</span><span class="sxs-lookup"><span data-stu-id="4a479-151">The differential backup only backups up data files containing the inserted rows since the last full database backup with the exception of an update and delete scenario where it is possible that some of the inserted rows may have already been either marked for garbage collection or already garbage collected.</span></span>  
  
    -   <span data-ttu-id="4a479-152">Um arquivo delta armazena referências às linhas de dados excluídas.</span><span class="sxs-lookup"><span data-stu-id="4a479-152">A delta file stores references to the deleted data rows.</span></span> <span data-ttu-id="4a479-153">Como qualquer transação futura pode excluir uma linha, um arquivo delta pode ser modificado a qualquer momento em seu tempo de vida, pois ele nunca é fechado.</span><span class="sxs-lookup"><span data-stu-id="4a479-153">Since any future transaction can delete a row, a delta file can be modified anytime in its life time, it is never closed.</span></span> <span data-ttu-id="4a479-154">Um arquivo delta é sempre armazenado em backup.</span><span class="sxs-lookup"><span data-stu-id="4a479-154">A delta file is always backed up.</span></span> <span data-ttu-id="4a479-155">Os arquivos delta costumam usam menos de 10% do armazenamento; portanto, os arquivos delta têm um impacto mínimo sobre o tamanho do backup diferencial.</span><span class="sxs-lookup"><span data-stu-id="4a479-155">Delta files typically use less than 10% of the storage, so delta files have a minimal impact on the size of differential backup.</span></span>  
  
 <span data-ttu-id="4a479-156">Se as tabelas com otimização de memória forem uma parte significativa do tamanho do banco de dados, o backup diferencial poderá reduzir significativamente o tamanho do backup do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-156">If memory-optimized tables are a significant portion of your database size, the differential backup can significantly reduce the size of your database backup.</span></span>  
  
 <span data-ttu-id="4a479-157">Para cargas de trabalho típicas de OLTP, os backups diferenciais serão significativamente menores do que os backups completos de banco de dados.</span><span class="sxs-lookup"><span data-stu-id="4a479-157">For typical OLTP workloads, the differential backups will be considerably smaller than the full database backups.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4a479-158">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="4a479-158">See Also</span></span>  
 [<span data-ttu-id="4a479-159">Backup, restauração e recuperação de tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="4a479-159">Backup, Restore, and Recovery of Memory-Optimized Tables</span></span>](restore-and-recovery-of-memory-optimized-tables.md)  
  
  
