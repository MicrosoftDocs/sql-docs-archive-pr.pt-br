---
title: Durabilidade para tabelas com otimização de memória | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: d304c94d-3ab4-47b0-905d-3c8c2aba9db6
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 1d48d671b23d7b7b17557e7829d6f2522c375acd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87684222"
---
# <a name="durability-for-memory-optimized-tables"></a><span data-ttu-id="e2cc5-102">Durabilidade de tabelas com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="e2cc5-102">Durability for Memory-Optimized Tables</span></span>
  [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] <span data-ttu-id="e2cc5-103">fornece a durabilidade completa para tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-103">provides full durability for memory-optimized tables.</span></span> <span data-ttu-id="e2cc5-104">Quando uma transação que modificou uma tabela com otimização de memória é confirmada, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (como faz em tabelas baseadas em disco), garante que as alterações sejam permanentes (sobreviverão uma reinicialização do banco de dados), contanto que o armazenamento subjacente esteja disponível.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-104">When a transaction that changed a memory-optimized table commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (as it does for disk-based tables), guarantees that the changes are permanent (will survive a database restart), provided the underlying storage is available.</span></span> <span data-ttu-id="e2cc5-105">Há dois principais componentes de durabilidade: log de transações e persistência das alterações de dados para armazenamento em disco.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-105">There are two key components of durability: transaction logging and persisting data changes to on-disk storage.</span></span>

## <a name="transaction-log"></a><span data-ttu-id="e2cc5-106">Log de Transações</span><span class="sxs-lookup"><span data-stu-id="e2cc5-106">Transaction Log</span></span>
 <span data-ttu-id="e2cc5-107">Todas as alterações feitas nas tabelas baseadas em disco ou tabelas duráveis com otimização de memória são capturadas em um ou mais registros de log de transações.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-107">All changes made to disk-based tables or durable memory-optimized tables are captured in one or more transaction log records.</span></span> <span data-ttu-id="e2cc5-108">Depois da confirmação de uma transação, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] grava os registros de log associados com a transação no disco antes de comunicar ao aplicativo ou à sessão de usuário que a transação foi confirmada.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-108">When a transaction commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] writes the log records associated with the transaction to disk before communicating to the application or user session that the transaction has committed.</span></span> <span data-ttu-id="e2cc5-109">Isso garante que as alterações feitas pela transação sejam duráveis.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-109">This guarantees that changes made by the transaction are durable.</span></span> <span data-ttu-id="e2cc5-110">O log de transações para tabelas com otimização de memória está totalmente integrado ao mesmo fluxo de log usado por tabelas baseadas em disco.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-110">The transaction log for memory-optimized tables is fully integrated with the same log stream used by disk-based tables.</span></span> <span data-ttu-id="e2cc5-111">Essa integração permite que operações existentes de backup, recuperação e restauração do log de transações continuem funcionando, sem exigir etapas adicionais.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-111">This integration allows existing transaction log backup, recover, and restore operations to continue to work without requiring any additional steps.</span></span> <span data-ttu-id="e2cc5-112">No entanto, como o [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] pode aumentar significativamente a taxa de transferência de transações de sua carga de trabalho, será necessário verificar se o armazenamento de log de transações está configurado adequadamente para controlar os requisitos de aumento de E/S.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-112">However, since [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] can increase transaction throughput of your workload significantly, you need to make sure that transaction log storage is configured appropriately to handle the increased IO requirements.</span></span>

## <a name="data-and-delta-files"></a><span data-ttu-id="e2cc5-113">Arquivos delta e de dados</span><span class="sxs-lookup"><span data-stu-id="e2cc5-113">Data and Delta Files</span></span>
 <span data-ttu-id="e2cc5-114">Os dados nas tabelas com otimização de memória são armazenados como as linhas de dados de forma livre que são vinculadas por meio de um ou mais índices de memória, na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-114">The data in memory-optimized tables is stored as free-form data rows that are linked through one or more in-memory indexes, in memory.</span></span> <span data-ttu-id="e2cc5-115">Não há nenhuma estrutura de página para linhas de dados, como as usadas para tabelas baseadas em disco.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-115">There are no page structures for data rows, such as those used for disk-based tables.</span></span> <span data-ttu-id="e2cc5-116">Quando o aplicativo está pronto para confirmar a transação, o [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] gera os registros de log para a transação.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-116">When the application is ready to commit the transaction, the [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] generates the log records for the transaction.</span></span> <span data-ttu-id="e2cc5-117">A persistência de tabelas com otimização de memória é feita com um conjunto de dados e arquivos delta usando um thread em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-117">The persistence of memory-optimized tables is done with a set of data and delta files using a background thread.</span></span> <span data-ttu-id="e2cc5-118">Os dados e os arquivos delta estão localizados em um ou mais contêineres (com o mesmo mecanismo usado para dados FILESTREAM).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-118">The data and delta files are located in one or more containers (using the same mechanism used for FILESTREAM data).</span></span> <span data-ttu-id="e2cc5-119">Esses contêineres são mapeados para um novo tipo de grupo de arquivos, chamado de grupo de arquivos com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-119">These containers are mapped to a new type of filegroup, called a memory-optimized filegroup.</span></span>

 <span data-ttu-id="e2cc5-120">Os dados são gravados nesses arquivos de maneira estritamente sequencial, o que minimiza a latência do disco na rotação da mídia.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-120">Data is written to these files in a strictly sequential fashion, which minimizes disk latency for spinning media.</span></span> <span data-ttu-id="e2cc5-121">Você pode usar vários contêineres em discos diferentes para distribuir a atividade de E/S.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-121">You can use multiple containers on different disks to distribute the I/O activity.</span></span> <span data-ttu-id="e2cc5-122">Os arquivos delta e de dados em vários contêineres em discos diferentes aumentarão o desempenho de recuperação quando os dados forem lidos nos arquivos delta e de dados em disco, na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-122">Data and delta files in multiple containers on different disks will increase recovery performance when data is read from the data and delta files on disk, into memory.</span></span>

 <span data-ttu-id="e2cc5-123">Um aplicativo não pode acessar diretamente arquivos delta e de dados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-123">An application does not directly access data and delta files.</span></span> <span data-ttu-id="e2cc5-124">Todas as leituras e gravações de dados usam dados na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-124">All data reads and writes use in-memory data.</span></span>

### <a name="the-data-file"></a><span data-ttu-id="e2cc5-125">O arquivo de dados</span><span class="sxs-lookup"><span data-stu-id="e2cc5-125">The Data File</span></span>
 <span data-ttu-id="e2cc5-126">Um arquivo de dados contém linhas de uma ou mais tabelas com otimização de memória que foram inseridas por várias transações como parte das operações INSERT ou UPDATE.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-126">A data file contains rows from one or more memory-optimized tables that were inserted by multiple transactions as part of INSERT or UPDATE operations.</span></span> <span data-ttu-id="e2cc5-127">Por exemplo, uma linha pode ser de uma tabela com otimização de memória T1 e a linha seguinte pode ser da tabela com otimização de memória T2.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-127">For example, one row can be from memory-optimized table T1 and the next row can be from memory-optimized table T2.</span></span> <span data-ttu-id="e2cc5-128">As linhas são acrescentadas ao arquivo de dados na ordem das transações no log de transações, tornando o acesso aos dados sequencial.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-128">The rows are appended to the data file in the order of transactions in the transaction log, making data access sequential.</span></span> <span data-ttu-id="e2cc5-129">Isso permite uma taxa de transferência de E/S significativamente melhor em comparação com a E/S aleatória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-129">This enables an order of magnitude better I/O throughput compared to random I/O.</span></span> <span data-ttu-id="e2cc5-130">Cada arquivo de dados é dimensionado aproximadamente para 128MB para computadores com mais memória que 16GB e 16MB para computadores com menos que ou igual a 16GB.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-130">Each data file is sized approximately to 128MB for computers with memory greater than 16GB, and 16MB for computers with less than or equal to 16GB.</span></span> <span data-ttu-id="e2cc5-131">Quando o arquivo de dados estiver cheio, as linhas inseridas por novas transações serão armazenadas em outro arquivo de dados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-131">Once the data file is full, the rows inserted by new transactions are stored in another data file.</span></span> <span data-ttu-id="e2cc5-132">Com o tempo, as linhas de tabelas com otimização de memória duráveis são armazenadas em um de mais arquivos de dados e em cada arquivo de dados que contém linhas de um intervalo não contíguo, mas contíguo de transações.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-132">Over time, the rows from durable memory-optimized tables are stored in one of more data files and each data file containing rows from a disjoint but contiguous range of transactions.</span></span> <span data-ttu-id="e2cc5-133">Por exemplo, um arquivo de dados com o carimbo de data/hora de confirmação de transação no intervalo de (100, 200) tem todas as linhas inseridas por transações com o carimbo de data/hora de confirmação maior que 100 e menor que ou igual a 200.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-133">For example a data file with transaction commit timestamp in the range of (100, 200) has all the rows inserted by transactions that have commit timestamp greater than 100 and less than or equal to 200.</span></span> <span data-ttu-id="e2cc5-134">O carimbo de data/hora de confirmação é um número que aumenta de forma monotônica atribuído a uma transação quando está pronto para confirmação.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-134">The commit timestamp is a monotonically increasing number assigned to a transaction when it is ready to commit.</span></span> <span data-ttu-id="e2cc5-135">Cada transação tem um carimbo de data/hora de confirmação exclusivo.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-135">Each transaction has a unique commit timestamp.</span></span>

 <span data-ttu-id="e2cc5-136">Quando uma linha é excluída ou atualizada, ela não é removida, nem alterada no local no arquivo de dados, mas as linhas excluídas são rastreadas em outro tipo de arquivo: o arquivo delta.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-136">When a row is deleted or updated, the row is not removed or changed in-place in the data file but the deleted rows are tracked in another type of file: the delta file.</span></span> <span data-ttu-id="e2cc5-137">As operações de atualização são processadas como uma tupla de operações de exclusão e inserção para cada linha.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-137">Update operations are processed as a tuple of delete and insert operations for each row.</span></span> <span data-ttu-id="e2cc5-138">Isso elimina a E/S aleatória no arquivo de dados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-138">This eliminates random IO on the data file.</span></span>

### <a name="the-delta-file"></a><span data-ttu-id="e2cc5-139">O arquivo delta</span><span class="sxs-lookup"><span data-stu-id="e2cc5-139">The Delta File</span></span>
 <span data-ttu-id="e2cc5-140">Cada arquivo de dados é emparelhado com um arquivo delta que tem o mesmo intervalo de transações e rastreia as linhas excluídas inseridas por transações nesse intervalo.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-140">Each data file is paired with a delta file that has the same transaction range and tracks the deleted rows inserted by transactions in the transaction range.</span></span> <span data-ttu-id="e2cc5-141">Estes arquivos de dados e delta são chamados de Par de Arquivos de Ponto de Verificação (CFP) e são a unidade da alocação e deslocamento, bem como a unidade de operações de Mesclagem.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-141">This data and delta file is referred to as a Checkpoint File Pair (CFP) and it is the unit of allocation and deallocation as well as the unit for Merge operations.</span></span> <span data-ttu-id="e2cc5-142">Por exemplo, um arquivo delta correspondente ao intervalo de transações (100, 200) armazenará as linhas excluídas que foram inseridas por transações no intervalo (100, 200).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-142">For example, a delta file corresponding to transaction range (100, 200) will store deleted rows that were inserted by transactions in the range (100, 200).</span></span> <span data-ttu-id="e2cc5-143">Assim como os arquivos de dados, o arquivo delta é acessado sequencialmente.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-143">Like data files, the delta file is accessed sequentially.</span></span>

 <span data-ttu-id="e2cc5-144">Quando uma linha é excluída, ela não é removida do arquivo de dados, mas uma referência a ela é anexada ao arquivo delta associado ao intervalo de transações em que essa linha de dados foi inserida.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-144">When a row is deleted, the row is not removed from the data file but a reference to the row is appended to the delta file associated with the transaction range where this data row was inserted.</span></span> <span data-ttu-id="e2cc5-145">Como a linha de dados a ser excluída já existe no arquivo de dados, o arquivo delta armazena apenas as informações de referência `{inserting_tx_id, row_id, deleting_tx_id }` e segue a ordem do log transacional das operações de exclusão ou atualização originais.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-145">Since the row to be deleted already exists in the data file, the delta file only stores the reference information `{inserting_tx_id, row_id, deleting_tx_id }` and it follows the transactional log order of the originating delete or update operations.</span></span>

## <a name="populating-data-and-delta-files"></a><span data-ttu-id="e2cc5-146">Populando arquivos de dados e delta</span><span class="sxs-lookup"><span data-stu-id="e2cc5-146">Populating Data and Delta Files</span></span>
 <span data-ttu-id="e2cc5-147">Os arquivos de dados e delta são populados por um thread em segundo plano chamado de ponto de verificação offline.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-147">Data and delta file are populated by a background thread called offline checkpoint.</span></span> <span data-ttu-id="e2cc5-148">Esse thread lê os registros do log de transações gerados por transações confirmadas em tabelas com otimização de memória e anexa informações sobre as linhas inseridas e excluídas em arquivos delta e de dados apropriados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-148">This thread reads the transaction log records generated by committed transactions on memory-optimized tables and appends information about the inserted and deleted rows into appropriate data and delta files.</span></span> <span data-ttu-id="e2cc5-149">Diferentemente das tabelas baseadas em disco, nas quais páginas de dados/índice são liberadas com E/S aleatória quando o ponto de verificação é realizado, a persistência da tabela com otimização de memória é uma operação em segundo plano contínua.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-149">Unlike disk-based tables where data/index pages are flushed with random I/O when checkpoint is done, the persistence of memory-optimized table is continuous background operation.</span></span> <span data-ttu-id="e2cc5-150">Vários arquivos delta são acessados, pois uma transação pode excluir ou atualizar qualquer linha que foi inserida por qualquer transação anterior.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-150">Multiple delta files are accessed because a transaction can delete or update any row that was inserted by any previous transaction.</span></span> <span data-ttu-id="e2cc5-151">As informações de exclusão sempre são anexadas no final do arquivo delta.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-151">Deletion information is always appended at the end of the delta file.</span></span> <span data-ttu-id="e2cc5-152">Por exemplo, uma transação com um carimbo de data/hora de confirmação de 600 insere uma linha nova e exclui linhas inseridas por transações com um carimbo de data/hora de confirmação de 150, 250 e 450, conforme mostrado na imagem a seguir.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-152">For example, a transaction with a commit timestamp of 600 inserts one new row and deletes rows inserted by transactions with a commit timestamp of 150, 250 and 450 as shown in the picture below.</span></span> <span data-ttu-id="e2cc5-153">As quatro operações de E/S de arquivo (três para linhas excluídas e uma para as linhas recentemente inseridas) são operações somente de acréscimo nos arquivos delta e de dados correspondentes.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-153">All 4 file I/O operations (three for deleted rows and 1 for the newly inserted rows), are append-only operations to the corresponding delta and data files.</span></span>

 <span data-ttu-id="e2cc5-154">![Registros de leitura de log para tabelas com otimização de memória.](../../database-engine/media/read-logs-hekaton.gif "Registros de leitura de log para tabelas com otimização de memória.")</span><span class="sxs-lookup"><span data-stu-id="e2cc5-154">![Read log records for memory-optimized tables.](../../database-engine/media/read-logs-hekaton.gif "Read log records for memory-optimized tables.")</span></span>

## <a name="accessing-data-and-delta-files"></a><span data-ttu-id="e2cc5-155">Acessando arquivos delta e de dados</span><span class="sxs-lookup"><span data-stu-id="e2cc5-155">Accessing Data and Delta Files</span></span>
 <span data-ttu-id="e2cc5-156">Os pares de arquivos de dados e delta são acessados quando as situações a seguir ocorrem.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-156">Data and delta file pairs are accessed when the following occurs.</span></span>

 <span data-ttu-id="e2cc5-157">Thread de ponto de verificação offline esse thread anexa inserções e exclusões a linhas de dados com otimização de memória para os pares de arquivos Delta e de dados correspondentes.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-157">Offline checkpoint thread This thread appends inserts and deletes to memory-optimized data rows, to the corresponding data and delta file pairs.</span></span>

 <span data-ttu-id="e2cc5-158">Operação de mesclagem a operação mescla um ou mais pares de arquivos Delta e de dados e cria um novo par de arquivos Delta e de dados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-158">Merge operation The operation merges one or more data and delta file pairs and creates a new data and delta file pair.</span></span>

 <span data-ttu-id="e2cc5-159">Durante a recuperação de falha quando [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] o é reiniciado ou o banco de dados é colocado online novamente, o dado com otimização de memória é populado usando os pares de arquivos Delta e de dados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-159">During crash recovery When [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is restarted or the database is brought back online, the memory-optimized data is populated using the data and delta file pairs.</span></span> <span data-ttu-id="e2cc5-160">O arquivo delta atua como um filtro para as linhas excluídas ao ler as linhas do arquivo de dados correspondente.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-160">The delta file acts as a filter for the deleted rows when reading the rows from the corresponding data file.</span></span> <span data-ttu-id="e2cc5-161">Como cada par de arquivos delta e de dados é independente, esses arquivos são carregados paralelamente para reduzir o tempo necessário para popular os dados na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-161">Because each data and delta file pair is independent, these files are loaded in parallel to reduce the time taken to populate data into memory.</span></span> <span data-ttu-id="e2cc5-162">Depois que os dados forem carregados na memória, o mecanismo OLTP na memória aplicará os registros de log de transações ativos ainda não cobertos pelos arquivos de ponto de verificação para que os dados com otimização de memória sejam concluídos.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-162">Once the data has been loaded into memory, the In-Memory OLTP engine applies the active transaction log records not yet covered by the checkpoint files so that the memory-optimized data is complete.</span></span>

 <span data-ttu-id="e2cc5-163">Durante a operação de restauração, os arquivos de ponto de verificação OLTP na memória são criados a partir do backup de banco de dados e um ou mais backups de log de transações são aplicados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-163">During restore operation The In-Memory OLTP checkpoint files are created from the database backup, and then one or more transaction log backups are applied.</span></span> <span data-ttu-id="e2cc5-164">Assim como na recuperação de pane, o mecanismo OLTP na memória carrega os dados na memória paralelamente para minimizar o impacto no tempo de recuperação.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-164">As with crash recovery, the In-Memory OLTP engine loads data into memory in parallel, to minimize the impact on recovery time.</span></span>

## <a name="merging-data-and-delta-files"></a><span data-ttu-id="e2cc5-165">Mesclando arquivos delta e de dados</span><span class="sxs-lookup"><span data-stu-id="e2cc5-165">Merging Data and Delta Files</span></span>
 <span data-ttu-id="e2cc5-166">Os dados de tabelas com otimização de memória são armazenados em um ou mais pares de arquivos delta e de dados (também denominados pares de arquivos de ponto de verificação ou CFP).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-166">The data for memory optimized tables is stored in one or more data and delta file pairs (also called a checkpoint file pair, or CFP).</span></span> <span data-ttu-id="e2cc5-167">Os arquivos de dados armazenam linhas inseridas e os arquivos delta referenciam linhas excluídas.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-167">Data files store inserted rows and delta files reference deleted rows.</span></span> <span data-ttu-id="e2cc5-168">Durante a execução de uma carga de trabalho OLTP, enquanto as operações DML atualizam, inserem e excluem linhas, novos CFPs são criados para persistir as novas linhas e a referência às linhas excluídas é anexada aos arquivos delta.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-168">During the execution of an OLTP workload, as the DML operations update, insert, and delete rows, new CFPs are created to persist the new rows, and the reference to the deleted rows is appended to delta files.</span></span>

 <span data-ttu-id="e2cc5-169">Os metadados de todos os CFPs fechados anteriormente e atualmente ativos são armazenados em uma estrutura de matriz interna referenciada como a matriz de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-169">The metadata of all previously-closed and currently active CFPs is stored in an internal array structure referred to as the storage array.</span></span> <span data-ttu-id="e2cc5-170">É uma matriz de tamanho finito (8.192 entradas) de CFPs.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-170">It is a finitely sized (8,192 entries) array of CFPs.</span></span> <span data-ttu-id="e2cc5-171">As entradas na matriz de armazenamento são ordenadas pelo intervalo de transações.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-171">The entries in the storage array are ordered by transaction range.</span></span> <span data-ttu-id="e2cc5-172">Os CFPs na matriz de armazenamento (junto com o final do log) representam todo o estado em disco necessário para recuperar um banco de dados com tabelas com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-172">The CFPs in the storage array (along with the tail of the log) represent all the on-disk state required to recover a database with memory-optimized tables.</span></span>

 <span data-ttu-id="e2cc5-173">Com o tempo, com as operações DML, o número de CFPs cresce fazendo a matriz de armazenamento alcançar a capacidade, que apresenta os seguintes desafios:</span><span class="sxs-lookup"><span data-stu-id="e2cc5-173">Over time, with DML operations, the number of CFPs grow causing the storage array to reach capacity, which introduces the following challenges:</span></span>

-   <span data-ttu-id="e2cc5-174">Linhas excluídas.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-174">Deleted rows.</span></span>  <span data-ttu-id="e2cc5-175">As linhas excluídas permanecem no arquivo de dados, mas são marcadas como excluídas no arquivo delta correspondente.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-175">Deleted rows remain in the data file but are marked as deleted in the corresponding delta file.</span></span> <span data-ttu-id="e2cc5-176">Essas linhas não são mais necessárias e serão removidas do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-176">These rows are no longer needed and will be removed from the storage.</span></span> <span data-ttu-id="e2cc5-177">Se as linhas excluídas não foram removidas de CFPs, elas usarão o espaço desnecessariamente e tornarão o tempo de recuperação mais lento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-177">If deleted rows were not removed from CFPs, they would use space unnecessarily and make recovery time slower.</span></span>

-   <span data-ttu-id="e2cc5-178">Matriz de armazenamento cheia.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-178">Storage array full.</span></span> <span data-ttu-id="e2cc5-179">Quando são alocadas 8.000 entradas na matriz de armazenamento (192 entradas na matriz são reservadas para que as mesclagens existentes disputem ou permitam que você faça mesclagens manuais), nenhuma nova transação DML pode ser executada em tabelas duráveis com otimização de memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-179">When there 8,000 entries in the storage array are allocated (192 entries in the array are reserved for existing merges to compete or to allow you to do manual merges), no new DML transactions can be executed on durable memory-optimized tables.</span></span> <span data-ttu-id="e2cc5-180">Somente as operações de ponto de verificação e mesclagem podem consumir as entradas restantes.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-180">Only checkpoint and merge operations are allowed to consume the remaining entries.</span></span> <span data-ttu-id="e2cc5-181">Isso assegura que as transações DML não preencham a matriz e que algumas entradas na matriz sejam reservadas para mesclar os arquivos existentes e reclamar espaço na matriz.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-181">This ensures that DML transactions do not fill the array and that some entries in the array are reserved to merge existing files and to reclaim space in the array.</span></span>

-   <span data-ttu-id="e2cc5-182">Sobrecarga de manipulação da matriz de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-182">Storage array manipulation overhead.</span></span> <span data-ttu-id="e2cc5-183">Os processos internos procuram na matriz de armazenamento operações como localizar o arquivo delta para anexar informações sobre uma linha excluída.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-183">Internal processes search the storage array for operations such as finding the delta file to append information about a deleted row.</span></span> <span data-ttu-id="e2cc5-184">O custo dessas operações aumenta com o número de entradas.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-184">The cost of these operations increases with the number of entries.</span></span>

 <span data-ttu-id="e2cc5-185">Para ajudar a evitar essas ineficiências, os CFPs fechados mais antigos são mesclados, com base em uma política de mesclagem descrita abaixo, para que a matriz de armazenamento seja compactada para representar o mesmo conjunto de dados, com um número reduzido de CFPs.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-185">To help prevent these inefficiencies, the older closed CFPs are merged, based on a merge policy described below, so the storage array is compacted to represent the same set of data, with a reduced number of CFPs.</span></span>

 <span data-ttu-id="e2cc5-186">O tamanho total da memória de todas as tabelas duráveis em um banco de dados não deve exceder 250 GB.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-186">The total in-memory size of all durable tables in a database should not exceed 250 GB.</span></span> <span data-ttu-id="e2cc5-187">As tabelas duráveis que usam até 250 GB de memória irão, supondo operações de inserção, exclusão e atualização, exigir na média 500 GB de espaço de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-187">Durable tables that use up to 250 GB of memory will, assuming insert, delete, and update operations, require on average 500 GB of storage space.</span></span> <span data-ttu-id="e2cc5-188">Os 4.000 pares de arquivos delta e de dados no grupo de arquivos com otimização de memória são necessários para oferecer suporte a 500 GB de espaço de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-188">4,000 data and delta file pairs in the memory-optimized file group are required to support the 500 GB of storage space.</span></span>

 <span data-ttu-id="e2cc5-189">As sobrecargas de curto prazo na atividade do banco de dados pode causar atrasos no ponto de verificação e nas operações de mesclagem, o que aumentará o número de pares de arquivos delta e de dados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-189">Short-term surges in database activity may cause checkpoint and merge operations lag, which will increase the number of required data and delta file pairs.</span></span> <span data-ttu-id="e2cc5-190">Para acomodar picos de sobrecarga de curto prazo na atividade de banco de dados, o sistema de armazenamento poderá alocar até 8.000 pares de arquivos delta e de dados até um total de 1TB de armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-190">To accommodate short-term surges spikes in database activity, the storage system can allocate up to 8,000 data and delta file pairs up to a total of 1TB of storage.</span></span> <span data-ttu-id="e2cc5-191">Quando o limite é atingido, nenhuma nova transação será permitida no banco de dados até que as operações de ponto de verificação recuperem o atraso.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-191">When that limit is reached, there will be no new transactions allowed on the database until checkpoint operations catch up.</span></span> <span data-ttu-id="e2cc5-192">Se o tamanho de tabelas duráveis na memória exceder 250GB por longos períodos de tempo, há uma possibilidade de atingir o limite de 8.000 pares de arquivo.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-192">If the size of durable tables in memory exceeds 250GB for long periods of time, there is a chance of reaching the 8,000 file pair limit.</span></span>

 <span data-ttu-id="e2cc5-193">A operação de mesclagem utiliza como entrada um ou mais CFPs fechados adjacentes (denominados a origem da mesclagem) com base em uma política de mesclagem definida internamente e produz um CFP resultante, chamado destino de mesclagem.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-193">The merge operation takes as input one or more adjacent closed CFPs (called merge source) based on an internally defined merge policy, and produces one resultant CFP, called the merge target.</span></span> <span data-ttu-id="e2cc5-194">As entradas em cada arquivo delta dos CFPs de origem são usadas para filtrar linhas do arquivo de dados correspondente para remover as linhas de dados que não são necessárias.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-194">The entries in each delta file of the source CFPs are used to filter rows from the corresponding data file to remove the data rows that are not needed.</span></span> <span data-ttu-id="e2cc5-195">As linhas restantes nos CFPs de origem são consolidadas em um CFP de destino.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-195">The remaining rows in the source CFPs are consolidated into one target CFP.</span></span> <span data-ttu-id="e2cc5-196">Após a conclusão da mesclagem, o CFP de destino de mesclagem resultante substitui os CFPs de origem (origens de mesclagem).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-196">After the merge is complete, the resultant merge-target CFP replaces the source CFPs (merge sources).</span></span> <span data-ttu-id="e2cc5-197">Os CFPs de origem de mesclagem passam por uma fase de transição antes de sua remoção do armazenamento.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-197">The merge-source CFPs go through a transition phase before they are removed from storage.</span></span>

 <span data-ttu-id="e2cc5-198">No exemplo abaixo, o grupo de arquivos da tabela com otimização de memória tem quatro pares de arquivos delta e de dados no carimbo de data/hora 500 que contém dados de transações anteriores.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-198">In the example below, the memory-optimized table file group has four data and delta file pairs at timestamp 500 containing data from previous transactions.</span></span> <span data-ttu-id="e2cc5-199">Por exemplo, as linhas no primeiro arquivo de dados correspondem a transações com carimbo de data/hora superior a 100 e inferior ou igual a 200; alternativamente representados como (100, 200].</span><span class="sxs-lookup"><span data-stu-id="e2cc5-199">For example, the rows in the first data file correspond to transactions with timestamp greater than 100 and less than or equal to 200; alternatively represented as (100, 200].</span></span> <span data-ttu-id="e2cc5-200">O segundo e terceiro arquivos de dados apresentam menos de 50% de utilização após a contagem das linhas marcadas como excluídas.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-200">The second and third data files are shown to be less than 50 percent full after accounting for the rows marked as deleted.</span></span> <span data-ttu-id="e2cc5-201">A operação de mesclagem combina esses dois CFPs e cria um novo CFP que contém transações com carimbo de data/hora superior a 200 e inferior ou igual a 400, que é o intervalo combinado desses dois CFPs.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-201">The merge operation combines these two CFPs and creates a new CFP containing transactions with timestamp greater than 200 and less than or equal to 400, which is the combined range of these two CFPs.</span></span> <span data-ttu-id="e2cc5-202">Você vê outro CFP com intervalo (500, 600] e o arquivo delta não vazio do intervalo de transações (200, 400] mostra que a operação de mesclagem pode ser realizada junto com atividades transacionais, incluindo a exclusão de mais linhas dos CFPs de origem.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-202">You see another CFP with range (500, 600] and non-empty delta file for transaction range (200, 400] shows that merge operation can be done concurrently with transactional activity including deleting more rows from the source CFPs.</span></span>

 <span data-ttu-id="e2cc5-203">![O diagrama mostra o grupo de arquivo de tabela com otimização de memória](../../database-engine/media/storagediagram-hekaton.png "O diagrama mostra o grupo de arquivo de tabela com otimização de memória")</span><span class="sxs-lookup"><span data-stu-id="e2cc5-203">![Diagram shows memory optimized table file group](../../database-engine/media/storagediagram-hekaton.png "Diagram shows memory optimized table file group")</span></span>

 <span data-ttu-id="e2cc5-204">Um thread de segundo plano avalia todos os CFPs fechados usando uma política de mesclagem e, em seguida, inicia uma ou mais solicitações de mesclagem para os CFPs de qualificação.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-204">A background thread evaluates all closed CFPs using a merge policy and then initiates one or more merge requests for the qualifying CFPs.</span></span> <span data-ttu-id="e2cc5-205">Essas solicitações de mesclagem são processadas pelo thread de ponto de verificação offline.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-205">These merge requests are processed by the offline checkpoint thread.</span></span> <span data-ttu-id="e2cc5-206">A avaliação da política de mesclagem é feita periodicamente e também quando um ponto de verificação é fechado.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-206">The evaluation of merge policy is done periodically and also when a checkpoint is closed.</span></span>

### <a name="sssql14-merge-policy"></a>[!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="e2cc5-207">Política de mesclagem</span><span class="sxs-lookup"><span data-stu-id="e2cc5-207">Merge Policy</span></span>
 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="e2cc5-208">implementa a seguinte política de mesclagem:</span><span class="sxs-lookup"><span data-stu-id="e2cc5-208">implements the following merge policy:</span></span>

-   <span data-ttu-id="e2cc5-209">Uma mesclagem será agendada se dois ou mais CFPs consecutivos puderem ser consolidados, após a contagem das linhas excluídas, para que as linhas resultantes possam caber em 1 CFP do tamanho ideal.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-209">A merge is scheduled if 2 or more consecutive CFPs can be consolidated, after accounting for deleted rows, such that the resultant rows can fit into 1 CFP of ideal size.</span></span> <span data-ttu-id="e2cc5-210">O tamanho ideal do CFP é determinado desta forma:</span><span class="sxs-lookup"><span data-stu-id="e2cc5-210">The ideal size of CFP is determined as follows:</span></span>

    -   <span data-ttu-id="e2cc5-211">Se um computador tiver memória menor ou igual a 16 GB, o arquivo de dados será de 16 MB e o arquivo delta será de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-211">If a computer has less than or equal to 16GB of memory, the data file is 16MB and delta file is 1MB.</span></span>

    -   <span data-ttu-id="e2cc5-212">Se um computador tiver memória maior de 16 GB, o arquivo de dados será de 128 MB e o arquivo delta será de 16 MB.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-212">If a computer has greater than 16GB of memory, the data file is 128MB and delta file is 16MB.</span></span>

-   <span data-ttu-id="e2cc5-213">Um único CFP pode ser automesclado caso o arquivo de dados exceda 256 MB e mais da metade das linhas serão excluídas.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-213">A single CFP can be self-merged if the data file exceeds 256 MB and more than half of the rows are deleted.</span></span> <span data-ttu-id="e2cc5-214">Um arquivo de dados poderá ficar com mais de 128 MB se, por exemplo, uma única transação ou várias transações simultâneas inserirem ou atualizarem grandes quantidades de dados, forçando o arquivo de dados a crescer além de seu tamanho ideal porque uma transação não pode se estender por vários CFPs.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-214">A data file can grow larger than 128MB if, for example, a single transaction or multiple concurrent transactions inserts or updates large amount of data, forcing the data file to grow beyond its ideal size because a transaction cannot span multiple CFPs.</span></span>

 <span data-ttu-id="e2cc5-215">Veja alguns exemplos que mostram os CFPs que serão mesclados na política de mesclagem:</span><span class="sxs-lookup"><span data-stu-id="e2cc5-215">Here are some examples that show the CFPs that will be merged under the merge policy:</span></span>

|<span data-ttu-id="e2cc5-216">CFPs de origem adjacentes (% de utilização)</span><span class="sxs-lookup"><span data-stu-id="e2cc5-216">Adjacent CFPs Source Files (% full)</span></span>|<span data-ttu-id="e2cc5-217">Seleção de mesclagem</span><span class="sxs-lookup"><span data-stu-id="e2cc5-217">Merge Selection</span></span>|
|-------------------------------------------|---------------------|
|<span data-ttu-id="e2cc5-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span><span class="sxs-lookup"><span data-stu-id="e2cc5-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span></span>|<span data-ttu-id="e2cc5-219">(CFP0, CFP1)</span><span class="sxs-lookup"><span data-stu-id="e2cc5-219">(CFP0, CFP1)</span></span><br /><br /> <span data-ttu-id="e2cc5-220">O CFP2 não será escolhido, pois tornará o arquivo de dados resultante maior que 100% do tamanho ideal.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-220">CFP2 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="e2cc5-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span><span class="sxs-lookup"><span data-stu-id="e2cc5-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span></span>|<span data-ttu-id="e2cc5-222">(CFP0, CFP1, CFP2).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-222">(CFP0, CFP1, CFP2).</span></span> <span data-ttu-id="e2cc5-223">Os arquivos são escolhidos a partir da esquerda.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-223">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="e2cc5-224">O CTP3 não será escolhido, pois tornará o arquivo de dados resultante maior que 100% do tamanho ideal.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-224">CTP3 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="e2cc5-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span><span class="sxs-lookup"><span data-stu-id="e2cc5-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span></span>|<span data-ttu-id="e2cc5-226">(CFP1, CFP2, CFP3).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-226">(CFP1, CFP2, CFP3).</span></span> <span data-ttu-id="e2cc5-227">Os arquivos são escolhidos a partir da esquerda.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-227">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="e2cc5-228">O CFP0 é ignorado, pois se combinado com o CFP1, o arquivo de dados resultante será maior que 100% do tamanho ideal.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-228">CFP0 is skipped because if combined with CFP1, the resultant data file will be greater than 100% of the ideal size.</span></span>|

 <span data-ttu-id="e2cc5-229">Nem todos os CFPs com o espaço disponível se qualificam para mesclagem.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-229">Not all CFPs with available space qualify for merge.</span></span> <span data-ttu-id="e2cc5-230">Por exemplo, se dois CFPs adjacentes apresentarem 60% de utilização, eles não estarão qualificados para mesclagem e cada um desses CFPs terá 40% do armazenamento não usado.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-230">For example, if two adjacent CFPs are 60% full, they will not qualify for merge and each of these CFPs will have 40% storage unused.</span></span> <span data-ttu-id="e2cc5-231">No pior caso, todos os CFPs terão 50% de utilização, uma utilização do armazenamento de apenas 50%.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-231">In the worst case, all CFPs will be 50% full, a storage utilization of only 50%.</span></span> <span data-ttu-id="e2cc5-232">Embora as linhas excluídas possam existir no armazenamento porque os CFPs não se qualificam para mesclagem, essas linhas talvez já tenham sido removidas da memória pela coleta de lixo na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-232">While the deleted rows may exist in storage because the CFPs don't qualify for merge, the deleted rows may have already been removed from memory by in-memory garbage collection.</span></span> <span data-ttu-id="e2cc5-233">O gerenciamento de armazenamento e de memória é independente da coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-233">The management of storage and the memory is independent from garbage collection.</span></span> <span data-ttu-id="e2cc5-234">O armazenamento ocupado pelos CFPs ativos (nem todos os CFPs estão sendo atualizados) pode ser até 2 vezes maior do que o tamanho de tabelas duráveis na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-234">Storage taken by active CFPs (not all CFPs are being updated) can be up to 2 times larger than the size of durable tables in memory.</span></span>

 <span data-ttu-id="e2cc5-235">Se necessário, uma mesclagem manual pode ser executada explicitamente chamando [Sys. sp_xtp_merge_checkpoint_files &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-235">If needed, a manual merge can be explicitly performed by calling [sys.sp_xtp_merge_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span></span>

### <a name="life-cycle-of-a-cfp"></a><span data-ttu-id="e2cc5-236">Ciclo de vida de um CFP</span><span class="sxs-lookup"><span data-stu-id="e2cc5-236">Life Cycle of a CFP</span></span>
 <span data-ttu-id="e2cc5-237">Transição de CPFs por vários estados antes de poderem ser desalocados.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-237">CPFs transition through several states before they can be deallocated.</span></span> <span data-ttu-id="e2cc5-238">A qualquer momento, os CFPs estarão em uma das seguintes fases: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE e TOMBSTONE.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-238">At any given time, the CFPs are in one of the following phases: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE, and TOMBSTONE.</span></span> <span data-ttu-id="e2cc5-239">Para obter uma descrição dessas fases, veja [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-239">For a description of these phases, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>

 <span data-ttu-id="e2cc5-240">Após a contagem do armazenamento ocupado pelos CFPs em diversos estados, o armazenamento geral ocupado pelas tabelas com otimização de memória duráveis poderá ser muito maior do que 2 vezes o tamanho das tabelas na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-240">After accounting for the storage taken by CFPs in various states, the overall storage taken by durable memory-optimized tables can be much larger than 2 times the size of the tables in memory.</span></span> <span data-ttu-id="e2cc5-241">A [&#41;DMV. dm_db_xtp_checkpoint_files &#40;Transact-SQL](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) pode ser consultada para listar todos os CFPS no grupo de arquivos com otimização de memória, incluindo sua fase.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-241">The DMV [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) can be queried to list all the CFPs in the memory-optimized filegroup, including their phase.</span></span> <span data-ttu-id="e2cc5-242">A transição de estados de CFPs de MERGE SOURCE para TOMBSTONE e por fim a coleta de lixo pode demorar cinco pontos de verificação, com cada ponto de verificação seguido por um backup de log de transações, caso o banco de dados esteja configurado para o modelo de recuperação completa ou bulk-logged.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-242">Transitioning CFPs from MERGE SOURCE state to TOMBSTONE and ultimately garbage collection can take up five checkpoints, with each checkpoint followed by a transaction log backup, if the database is configured for full or bulk-logged recovery model.</span></span>

 <span data-ttu-id="e2cc5-243">Você pode forçar manualmente o ponto de verificação seguido pelo backup de log para acelerar a coleta de lixo, mas isso adicionaria 5 CFPs vazios (5 pares de arquivos de dados/delta com o arquivo de dados de tamanho de 128 MB).</span><span class="sxs-lookup"><span data-stu-id="e2cc5-243">You can manually force the checkpoint followed by log backup to expedite the garbage collection but then this will add 5 empty CFPs (5 data/delta file pairs with data file of size 128MB each).</span></span> <span data-ttu-id="e2cc5-244">Nos cenários de produção, os backups automáticos de pontos de verificação e log ocorrem como parte da estratégia de backup que executará a transição perfeita de CFPs por essas fases, sem a necessidade de nenhuma intervenção manual.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-244">In production scenarios, the automatic checkpoints and log backups taken as part of backup strategy will seamlessly transition CFPs through these phases without requiring any manual intervention.</span></span> <span data-ttu-id="e2cc5-245">O impacto do processo de coleta de lixo é que os bancos de dados com tabelas com otimização de memória podem ter um tamanho de armazenamento maior em comparação com seu tamanho na memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-245">The impact of the garbage collection process is that databases with memory-optimized tables may have a larger storage size compared to its size in memory.</span></span> <span data-ttu-id="e2cc5-246">Não é raro para CFPs serem até quatro vezes o tamanho das tabelas com otimização de memória duráveis em memória.</span><span class="sxs-lookup"><span data-stu-id="e2cc5-246">It is not uncommon for CFPs to be up to four times the size of the durable memory-optimized tables in memory.</span></span>

## <a name="see-also"></a><span data-ttu-id="e2cc5-247">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="e2cc5-247">See Also</span></span>
 [<span data-ttu-id="e2cc5-248">Criando e gerenciando armazenamento para objetos com otimização de memória</span><span class="sxs-lookup"><span data-stu-id="e2cc5-248">Creating and Managing Storage for Memory-Optimized Objects</span></span>](creating-and-managing-storage-for-memory-optimized-objects.md)


