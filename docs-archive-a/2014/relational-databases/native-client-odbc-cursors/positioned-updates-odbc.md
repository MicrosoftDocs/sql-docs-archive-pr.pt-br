---
title: Atualizações posicionadas (ODBC) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, cursors
- SQLSetPos function
- SQLSetCursorName function
- ODBC applications, cursors
- cursors [ODBC], positioned updates
- positioned updates [ODBC]
- ODBC cursors, positioned updates
ms.assetid: ff404e02-630f-474d-b5d4-06442b756991
author: rothja
ms.author: jroth
ms.openlocfilehash: 20272014e32632117e6282e5929d1d21789852df
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572066"
---
# <a name="positioned-updates-odbc"></a><span data-ttu-id="e485c-102">Atualizações posicionadas (ODBC)</span><span class="sxs-lookup"><span data-stu-id="e485c-102">Positioned Updates (ODBC)</span></span>
  <span data-ttu-id="e485c-103">O ODBC dá suporte a dois métodos para executar atualizações posicionadas em um cursor:</span><span class="sxs-lookup"><span data-stu-id="e485c-103">ODBC supports two methods for performing positioned updates in a cursor:</span></span>  
  
-   <span data-ttu-id="e485c-104">**SQLSetPos**</span><span class="sxs-lookup"><span data-stu-id="e485c-104">**SQLSetPos**</span></span>  
  
-   <span data-ttu-id="e485c-105">Cláusula WHERE CURRENT OF</span><span class="sxs-lookup"><span data-stu-id="e485c-105">WHERE CURRENT OF clause</span></span>  
  
 <span data-ttu-id="e485c-106">A abordagem mais comum é usar **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="e485c-106">The more common approach is to use **SQLSetPos**.</span></span> <span data-ttu-id="e485c-107">Ela tem as seguintes opções:</span><span class="sxs-lookup"><span data-stu-id="e485c-107">It has the following options.</span></span>  
  
 <span data-ttu-id="e485c-108">SQL_POSITION</span><span class="sxs-lookup"><span data-stu-id="e485c-108">SQL_POSITION</span></span>  
 <span data-ttu-id="e485c-109">Posiciona o cursor ODBC em uma linha específica do conjunto de linhas atual.</span><span class="sxs-lookup"><span data-stu-id="e485c-109">Positions the cursor on a specific row in the current rowset.</span></span>  
  
 <span data-ttu-id="e485c-110">SQL_REFRESH</span><span class="sxs-lookup"><span data-stu-id="e485c-110">SQL_REFRESH</span></span>  
 <span data-ttu-id="e485c-111">Atualiza variáveis de programa associadas às colunas de conjunto de resultados com os valores da linha em que cursor está atualmente posicionado.</span><span class="sxs-lookup"><span data-stu-id="e485c-111">Refreshes program variables bound to the result set columns with the values from the row the cursor is currently positioned on.</span></span>  
  
 <span data-ttu-id="e485c-112">SQL_UPDATE</span><span class="sxs-lookup"><span data-stu-id="e485c-112">SQL_UPDATE</span></span>  
 <span data-ttu-id="e485c-113">Atualiza a linha atual do cursor com os valores armazenados nas variáveis de programa associadas às colunas do conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="e485c-113">Updates the current row in the cursor with the values stored in the program variables bound to the result set columns.</span></span>  
  
 <span data-ttu-id="e485c-114">SQL_DELETE</span><span class="sxs-lookup"><span data-stu-id="e485c-114">SQL_DELETE</span></span>  
 <span data-ttu-id="e485c-115">Exclui a linha atual do cursor.</span><span class="sxs-lookup"><span data-stu-id="e485c-115">Deletes the current row in the cursor.</span></span>  
  
 <span data-ttu-id="e485c-116">**SQLSetPos** pode ser usado com qualquer conjunto de resultados de instrução quando a instrução manipula atributos de cursor está definida para usar cursores de servidor.</span><span class="sxs-lookup"><span data-stu-id="e485c-116">**SQLSetPos** can be used with any statement result set when the statement handle cursor attributes are set to use server cursors.</span></span> <span data-ttu-id="e485c-117">As colunas do conjunto de resultados devem ser associadas para programar variáveis.</span><span class="sxs-lookup"><span data-stu-id="e485c-117">The result set columns must be bound to program variables.</span></span> <span data-ttu-id="e485c-118">Assim que o aplicativo tiver obtido uma linha, ele chamará **SQLSetPos**(SQL_POSTION) para posicionar o cursor na linha.</span><span class="sxs-lookup"><span data-stu-id="e485c-118">As soon as the application has fetched a row it calls **SQLSetPos**(SQL_POSTION) to position the cursor on the row.</span></span> <span data-ttu-id="e485c-119">O aplicativo pode então chamar SQLSetPos(SQL_DELETE) para excluir a linha atual ou pode mover novos valores de dados para as variáveis do programa associado e chamar SQLSetPos(SQL_UPDATE) para atualizar a linha atual.</span><span class="sxs-lookup"><span data-stu-id="e485c-119">The application could then call SQLSetPos(SQL_DELETE) to delete the current row, or it can move new data values into the bound program variables and call SQLSetPos(SQL_UPDATE) to update the current row.</span></span>  
  
 <span data-ttu-id="e485c-120">Os aplicativos podem atualizar ou excluir qualquer linha no conjunto de linhas com **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="e485c-120">Applications can update or delete any row in the rowset with **SQLSetPos**.</span></span> <span data-ttu-id="e485c-121">Chamar **SQLSetPos** é uma alternativa conveniente para construir e executar uma instrução SQL.</span><span class="sxs-lookup"><span data-stu-id="e485c-121">Calling **SQLSetPos** is a convenient alternative to constructing and executing an SQL statement.</span></span> <span data-ttu-id="e485c-122">**SQLSetPos** opera no conjunto de linhas atual e pode ser usado somente após uma chamada para [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span><span class="sxs-lookup"><span data-stu-id="e485c-122">**SQLSetPos** operates on the current rowset and can be used only after a call to [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span></span>  
  
 <span data-ttu-id="e485c-123">O tamanho do conjunto de linhas é definido por uma chamada para [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) com um argumento de atributo de SQL_ATTR_ROW_ARRAY_SIZE.</span><span class="sxs-lookup"><span data-stu-id="e485c-123">Rowset size is set by a call to [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) with an attribute argument of SQL_ATTR_ROW_ARRAY_SIZE.</span></span> <span data-ttu-id="e485c-124">**SQLSetPos** usa um novo tamanho de conjunto de linhas, mas somente após uma chamada para **SQLFetch** ou **SQLFetchScroll**.</span><span class="sxs-lookup"><span data-stu-id="e485c-124">**SQLSetPos** uses a new rowset size, but only after a call to **SQLFetch** or **SQLFetchScroll**.</span></span> <span data-ttu-id="e485c-125">Por exemplo, se o tamanho do conjunto de linhas for alterado, **SQLSetPos** será chamado e, em seguida, **SQLFetch** ou **SQLFetchScroll** será chamado.</span><span class="sxs-lookup"><span data-stu-id="e485c-125">For example, if the rowset size is changed, **SQLSetPos** is called and then **SQLFetch** or **SQLFetchScroll** is called.</span></span> <span data-ttu-id="e485c-126">A chamada para **SQLSetPos** usa o tamanho antigo do conjunto de linhas, mas **SQLFetch** ou **SQLFetchScroll** usa o novo tamanho do conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="e485c-126">The call to **SQLSetPos** uses the old rowset size, but **SQLFetch** or **SQLFetchScroll** uses the new rowset size.</span></span>  
  
 <span data-ttu-id="e485c-127">A primeira linha do conjunto de linhas é o número de linha 1.</span><span class="sxs-lookup"><span data-stu-id="e485c-127">The first row in the rowset is row number 1.</span></span> <span data-ttu-id="e485c-128">O argumento RowNumber em **SQLSetPos** deve identificar uma linha no conjunto de linhas; ou seja, seu valor deve estar no intervalo entre 1 e o número de linhas que foram buscadas mais recentemente.</span><span class="sxs-lookup"><span data-stu-id="e485c-128">The RowNumber argument in **SQLSetPos** must identify a row in the rowset; that is, its value must be in the range between 1 and the number of rows that were most recently fetched.</span></span> <span data-ttu-id="e485c-129">Ele pode ser menor que o tamanho do conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="e485c-129">This may be less than the rowset size.</span></span> <span data-ttu-id="e485c-130">Se RowNumber for 0, a operação se aplicará a toda linha no conjunto de linhas.</span><span class="sxs-lookup"><span data-stu-id="e485c-130">If RowNumber is 0, the operation applies to every row in the rowset.</span></span>  
  
 <span data-ttu-id="e485c-131">A operação de exclusão de **SQLSetPos** faz com que a fonte de dados exclua uma ou mais linhas selecionadas de uma tabela.</span><span class="sxs-lookup"><span data-stu-id="e485c-131">The delete operation of **SQLSetPos** makes the data source delete one or more selected rows of a table.</span></span> <span data-ttu-id="e485c-132">Para excluir linhas com **SQLSetPos**, o aplicativo chama **SQLSetPos** com a operação definida como SQL_DELETE e RowNumber definido como o número da linha a ser excluída.</span><span class="sxs-lookup"><span data-stu-id="e485c-132">To delete rows with **SQLSetPos**, the application calls **SQLSetPos** with Operation set to SQL_DELETE and RowNumber set to the number of the row to delete.</span></span> <span data-ttu-id="e485c-133">Se RowNumber for 0, todas as linhas do conjunto de linhas serão excluídas.</span><span class="sxs-lookup"><span data-stu-id="e485c-133">If RowNumber is 0, all rows in the rowset are deleted.</span></span>  
  
 <span data-ttu-id="e485c-134">Depois que **SQLSetPos** retorna, a linha excluída é a linha atual e seu status é SQL_ROW_DELETED.</span><span class="sxs-lookup"><span data-stu-id="e485c-134">After **SQLSetPos** returns, the deleted row is the current row and its status is SQL_ROW_DELETED.</span></span> <span data-ttu-id="e485c-135">A linha não pode ser usada em nenhuma operação posicionada adicional, como chamadas para [SQLGetData](../native-client-odbc-api/sqlgetdata.md) ou **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="e485c-135">The row cannot be used in any additional positioned operations, such as calls to [SQLGetData](../native-client-odbc-api/sqlgetdata.md) or **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="e485c-136">Quando você exclui todas as linhas do conjunto de linhas (RowNumber é igual a 0), o aplicativo pode impedir que o driver exclua determinadas linhas usando a matriz de operação de linha, assim como para a operação de atualização de **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="e485c-136">When you delete all rows of the rowset (RowNumber is equal to 0), the application can prevent the driver from deleting certain rows by using the row operation array just like for the update operation of **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="e485c-137">Todas as linhas excluídas devem existir no conjunto de resultados.</span><span class="sxs-lookup"><span data-stu-id="e485c-137">Every row that is deleted should be a row that exists in the result set.</span></span> <span data-ttu-id="e485c-138">Se os buffers do aplicativo tiverem sido preenchidos pela busca e se uma matriz de status de linha tiver sido mantida, seus valores em cada uma das novas posições não deverão ser SQL_ROW_DELETED, SQL_ROW_ERROR ou SQL_ROW_NOROW.</span><span class="sxs-lookup"><span data-stu-id="e485c-138">If the application buffers were filled by fetching, and if a row status array has been maintained, its values at each of these row positions should not be SQL_ROW_DELETED, SQL_ROW_ERROR, or SQL_ROW_NOROW.</span></span>  
  
 <span data-ttu-id="e485c-139">Atualizações posicionadas também pode ser executadas usando a cláusula WHERE CURRENT OF nas instruções UPDATE, DELETE e INSERT.</span><span class="sxs-lookup"><span data-stu-id="e485c-139">Positioned updates can also be performed using the WHERE CURRENT OF clause on UPDATE, DELETE, and INSERT statements.</span></span> <span data-ttu-id="e485c-140">ONDE CURRENT OF exige um nome de cursor que o ODBC gerará quando a função [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) for chamada ou que você pode especificar chamando **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="e485c-140">WHERE CURRENT OF requires a cursor name that ODBC will generate when the [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) function is called, or which you can specify by calling **SQLSetCursorName**.</span></span> <span data-ttu-id="e485c-141">As etapas gerais a seguir são usadas para executar uma atualização WHERE CURRENT OF em um aplicativo ODBC:</span><span class="sxs-lookup"><span data-stu-id="e485c-141">The following are general steps used to perform a WHERE CURRENT OF update in an ODBC application:</span></span>  
  
-   <span data-ttu-id="e485c-142">Chame **SQLSetCursorName** para estabelecer um nome de cursor para o identificador de instrução.</span><span class="sxs-lookup"><span data-stu-id="e485c-142">Call **SQLSetCursorName** to establish a cursor name for the statement handle.</span></span>  
  
-   <span data-ttu-id="e485c-143">Compile uma instrução SELECT com uma cláusula FOR UPDATE DE e execute-a.</span><span class="sxs-lookup"><span data-stu-id="e485c-143">Build a SELECT statement with a FOR UPDATE OF clause and execute it.</span></span>  
  
-   <span data-ttu-id="e485c-144">Chame **SQLFetchScroll** para recuperar um conjunto de linhas ou **SQLFetch** para recuperar uma linha.</span><span class="sxs-lookup"><span data-stu-id="e485c-144">Call **SQLFetchScroll** to retrieve a rowset or **SQLFetch** to retrieve a row.</span></span>  
  
-   <span data-ttu-id="e485c-145">Chame **SQLSetPos** (SQL_POSITION) para posicionar o cursor na linha.</span><span class="sxs-lookup"><span data-stu-id="e485c-145">Call **SQLSetPos** (SQL_POSITION) to position the cursor on the row.</span></span>  
  
-   <span data-ttu-id="e485c-146">Crie e execute uma instrução UPDATE com uma cláusula WHERE CURRENT OF usando o nome do cursor definido com **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="e485c-146">Build and execute an UPDATE statement with a WHERE CURRENT OF clause using the cursor name set with **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="e485c-147">Como alternativa, você poderia chamar **SQLGetCursorName** depois de executar a instrução SELECT em vez de chamar **SQLSetCursorName** antes de executar a instrução SELECT.</span><span class="sxs-lookup"><span data-stu-id="e485c-147">Alternatively, you could call **SQLGetCursorName** after you execute the SELECT statement instead of calling **SQLSetCursorName** before executing the SELECT statement.</span></span> <span data-ttu-id="e485c-148">**SQLGetCursorName** retorna um nome de cursor padrão atribuído pelo ODBC se você não definir um nome de cursor usando **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="e485c-148">**SQLGetCursorName** returns a default cursor name assigned by ODBC if you do not set a cursor name using **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="e485c-149">**SQLSetPos** é preferível quando atual de quando você está usando cursores de servidor.</span><span class="sxs-lookup"><span data-stu-id="e485c-149">**SQLSetPos** is preferred over WHERE CURRENT OF when you are using server cursors.</span></span> <span data-ttu-id="e485c-150">Se você estiver usando um cursor atualizável estático com a biblioteca de cursores ODBC, a biblioteca de cursores implementará as atualizações WHERE CURRENT OF com os valores de chave para a tabela subjacente.</span><span class="sxs-lookup"><span data-stu-id="e485c-150">If you are using a static, updatable cursor with the ODBC cursor library, the cursor library implements WHERE CURRENT OF updates by adding a WHERE clause with the key values for the underlying table.</span></span> <span data-ttu-id="e485c-151">Isso pode provocar atualizações não pretendidas, caso as chaves da tabela não foram exclusivas.</span><span class="sxs-lookup"><span data-stu-id="e485c-151">This can cause unintended updates if the keys in the table are not unique.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e485c-152">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="e485c-152">See Also</span></span>  
 [<span data-ttu-id="e485c-153">Usando cursores &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="e485c-153">Using Cursors &#40;ODBC&#41;</span></span>](using-cursors-odbc.md)  
  
  
