---
title: Índices Columnstore descritos | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- indexes creation, columnstore
- indexes [SQL Server], columnstore
- columnstore index
- columnstore index, described
- xVelocity, columnstore indexes
ms.assetid: f98af4a5-4523-43b1-be8d-1b03c3217839
author: mikeraymsft
ms.author: mikeray
ms.openlocfilehash: 80a29b8e8cc5b53c09369156a5cf5f717e9447a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87685126"
---
# <a name="columnstore-indexes-described"></a><span data-ttu-id="3c724-102">Columnstore Indexes Described</span><span class="sxs-lookup"><span data-stu-id="3c724-102">Columnstore Indexes Described</span></span>
  <span data-ttu-id="3c724-103">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *índice columnstore na memória* armazena e gerencia dados usando o armazenamento de dados baseado em coluna e o processamento de consulta baseado em coluna.</span><span class="sxs-lookup"><span data-stu-id="3c724-103">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *in-memory columnstore index* stores and manages data by using column-based data storage and column-based query processing.</span></span> <span data-ttu-id="3c724-104">Os índices columnstore funcionam bem para as cargas de trabalho de data warehouse que executam principalmente carregamentos em massa e consultas somente leitura.</span><span class="sxs-lookup"><span data-stu-id="3c724-104">Columnstore indexes work well for data warehousing workloads that primarily perform bulk loads and read-only queries.</span></span> <span data-ttu-id="3c724-105">Use o índice columnstore para obter um ganho de **desempenho de consulta até 10 vezes maior** sobre o armazenamento tradicional orientado por linha e de **compactação de dados até 7 vezes maior** sobre o tamanho dos dados não compactados.</span><span class="sxs-lookup"><span data-stu-id="3c724-105">Use the columnstore index to achieve up to **10x query performance** gains over traditional row-oriented storage, and up to **7x data compression** over the uncompressed data size.</span></span>

> [!NOTE]
>  <span data-ttu-id="3c724-106">Exibimos o índice columnstore clusterizado como o padrão para armazenar grandes tabelas de fatos de data warehouse e esperamos que ele seja usado na maioria dos cenários de data warehouse.</span><span class="sxs-lookup"><span data-stu-id="3c724-106">We view the clustered columnstore index as the standard for storing large data warehousing fact tables, and expect it will be used in most data warehousing scenarios.</span></span> <span data-ttu-id="3c724-107">Uma vez que o índice columnstore clusterizado é atualizável, a carga de trabalho pode executar um grande número de operações de inserção, atualização e exclusão.</span><span class="sxs-lookup"><span data-stu-id="3c724-107">Since the clustered columnstore index is updateable, your workload can perform a large number of insert, update, and delete operations.</span></span>

## <a name="contents"></a><span data-ttu-id="3c724-108">Sumário</span><span class="sxs-lookup"><span data-stu-id="3c724-108">Contents</span></span>

-   [<span data-ttu-id="3c724-109">Noções básicas</span><span class="sxs-lookup"><span data-stu-id="3c724-109">Basics</span></span>](#basics)

-   [<span data-ttu-id="3c724-110">Carregando dados</span><span class="sxs-lookup"><span data-stu-id="3c724-110">Loading Data</span></span>](#dataload)

-   [<span data-ttu-id="3c724-111">Dicas de desempenho</span><span class="sxs-lookup"><span data-stu-id="3c724-111">Performance Tips</span></span>](#performance)

-   [<span data-ttu-id="3c724-112">Tarefas e tópicos relacionados</span><span class="sxs-lookup"><span data-stu-id="3c724-112">Related Tasks and Topics</span></span>](#related)

##  <a name="basics"></a><a name="basics"></a><span data-ttu-id="3c724-113">Algumas</span><span class="sxs-lookup"><span data-stu-id="3c724-113">Basics</span></span>
 <span data-ttu-id="3c724-114">Um *columnstore index* é uma tecnologia para armazenamento, recuperação e gerenciamento de dados usando um formato de dados colunar, chamado columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-114">A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> <span data-ttu-id="3c724-115">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] oferece suporte a índices columnstore clusterizados e não clusterizados.</span><span class="sxs-lookup"><span data-stu-id="3c724-115">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="3c724-116">Ambos usam a mesma tecnologia de columnstore na memória, mas possuem diferenças na finalidade e nos recursos aos quais oferecem suporte.</span><span class="sxs-lookup"><span data-stu-id="3c724-116">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

###  <a name="benefits"></a><a name="benefits"></a> <span data-ttu-id="3c724-117">Benefícios</span><span class="sxs-lookup"><span data-stu-id="3c724-117">Benefits</span></span>
 <span data-ttu-id="3c724-118">Os índices columnstore funcionam bem na maioria das consultas somente leitura que executam a análise em grandes conjuntos de dados.</span><span class="sxs-lookup"><span data-stu-id="3c724-118">Columnstore indexes work well for mostly read-only queries that perform analysis on large data sets.</span></span> <span data-ttu-id="3c724-119">Geralmente, essas são consultas sobre cargas de trabalho de data warehousing.</span><span class="sxs-lookup"><span data-stu-id="3c724-119">Often, these are queries for data warehousing workloads.</span></span> <span data-ttu-id="3c724-120">Os índices columnstore permitem ganhos de desempenho alto para consultas que usam digitalizações completas de tabela e não são apropriados para consultas que buscam nos dados, procurando um valor específico.</span><span class="sxs-lookup"><span data-stu-id="3c724-120">Columnstore indexes give high performance gains for queries that use full table scans, and are not well-suited for queries that seek into the data, searching for a particular value.</span></span>

 <span data-ttu-id="3c724-121">Benefícios do índice columnstore:</span><span class="sxs-lookup"><span data-stu-id="3c724-121">Columnstore Index benefits:</span></span>

-   <span data-ttu-id="3c724-122">As colunas muitas vezes têm dados semelhantes, o que resulta em altas taxas de compactação.</span><span class="sxs-lookup"><span data-stu-id="3c724-122">Columns often have similar data, which results in high compression rates.</span></span>

-   <span data-ttu-id="3c724-123">As altas taxas de compactação melhoram o desempenho da consulta usando um menor volume na memória.</span><span class="sxs-lookup"><span data-stu-id="3c724-123">High compression rates improve query performance by using a smaller in-memory footprint.</span></span> <span data-ttu-id="3c724-124">Por sua vez, o desempenho da consulta pode ser melhorado porque o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] pode realizar mais operações de consulta e dados na memória.</span><span class="sxs-lookup"><span data-stu-id="3c724-124">In turn, query performance can improve because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can perform more query and data operations in-memory.</span></span>

-   <span data-ttu-id="3c724-125">Um novo mecanismo de execução de consulta chamado execução do modo em lotes foi adicionado ao SQL Server, o que reduz bastante o uso da CPU.</span><span class="sxs-lookup"><span data-stu-id="3c724-125">A new query execution mechanism called batch-mode execution has been added to SQL Server that reduces CPU usage by a large amount.</span></span> <span data-ttu-id="3c724-126">A execução do modo em lotes é integrada ao formato de armazenamento columnstore e otimizado com base nele.</span><span class="sxs-lookup"><span data-stu-id="3c724-126">Batch-mode execution is closely integrated with, and optimized around, the columnstore storage format.</span></span> <span data-ttu-id="3c724-127">A execução do modo em lote às vezes é conhecida como execução baseada em vetor ou vetorizado.</span><span class="sxs-lookup"><span data-stu-id="3c724-127">Batch-mode execution is sometimes known as vector-based or vectorized execution.</span></span>

-   <span data-ttu-id="3c724-128">Muitas vezes, as consultas selecionam apenas algumas colunas de uma tabela, o que reduz a E/S total da mídia física.</span><span class="sxs-lookup"><span data-stu-id="3c724-128">Queries often select only a few columns from a table, which reduces total I/O from the physical media.</span></span>

### <a name="columnstore-versions"></a><span data-ttu-id="3c724-129">Versões de columnstore</span><span class="sxs-lookup"><span data-stu-id="3c724-129">Columnstore Versions</span></span>
 <span data-ttu-id="3c724-130">O SQL Server 2012, o SQL Server 2012 Parallel Data Warehouse e o SQL Server 2014 usam índices columnstore para acelerar consultas comuns de data warehouse.</span><span class="sxs-lookup"><span data-stu-id="3c724-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse, and SQL Server 2014 all use columnstore indexes to accelerate common data warehouse queries.</span></span> <span data-ttu-id="3c724-131">O SQL Server 2012 apresentou dois novos recursos: um índice columnstore não clusterizado e um recurso de execução de consulta baseada em vetor que processa dados em unidades chamadas "lotes".</span><span class="sxs-lookup"><span data-stu-id="3c724-131">SQL Server 2012 introduced two new features: a nonclustered columnstore index and a vector-based query execution capability that processes data in units called "batches."</span></span> <span data-ttu-id="3c724-132">O SQL Server 2014 tem os recursos do SQL Server 2012 mais os índices columnstore clusterizados atualizáveis.</span><span class="sxs-lookup"><span data-stu-id="3c724-132">SQL Server 2014 has the features of SQL Server 2012 plus updateable clustered columnstore indexes.</span></span>

### <a name="key-characteristics"></a><span data-ttu-id="3c724-133">Principais características</span><span class="sxs-lookup"><span data-stu-id="3c724-133">Key Characteristics</span></span>

||
|-|
|<span data-ttu-id="3c724-134">**Aplica-se a**: do [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] ao [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3c724-134">**Applies to**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="3c724-135">No [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], um índice columnstore clusterizado:</span><span class="sxs-lookup"><span data-stu-id="3c724-135">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a clustered columnstore index:</span></span>

-   <span data-ttu-id="3c724-136">Está disponível nas edições Enterprise, Developer e Evaluation.</span><span class="sxs-lookup"><span data-stu-id="3c724-136">Is available in Enterprise, Developer, and Evaluation editions.</span></span>

-   <span data-ttu-id="3c724-137">É atualizável.</span><span class="sxs-lookup"><span data-stu-id="3c724-137">Is updateable.</span></span>

-   <span data-ttu-id="3c724-138">É o método de armazenamento primário para toda a tabela.</span><span class="sxs-lookup"><span data-stu-id="3c724-138">Is the primary storage method for the entire table.</span></span>

-   <span data-ttu-id="3c724-139">Não tem colunas de chave.</span><span class="sxs-lookup"><span data-stu-id="3c724-139">Has no key columns.</span></span> <span data-ttu-id="3c724-140">Todas as colunas são colunas incluídas.</span><span class="sxs-lookup"><span data-stu-id="3c724-140">All columns are included columns.</span></span>

-   <span data-ttu-id="3c724-141">É o único índice na tabela.</span><span class="sxs-lookup"><span data-stu-id="3c724-141">Is the only index on the table.</span></span> <span data-ttu-id="3c724-142">Não pode ser combinado com nenhum outro índice.</span><span class="sxs-lookup"><span data-stu-id="3c724-142">It cannot be combined with any other indexes.</span></span>

-   <span data-ttu-id="3c724-143">Pode ser configurado para usar a columnstore ou compressão de arquivamento columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-143">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="3c724-144">Não armazena fisicamente colunas em uma ordem classificada.</span><span class="sxs-lookup"><span data-stu-id="3c724-144">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="3c724-145">Em vez disso, ele armazena dados para aprimorar a compactação e o desempenho.</span><span class="sxs-lookup"><span data-stu-id="3c724-145">Instead, it stores data to improve compression and performance.</span></span>

||
|-|
|<span data-ttu-id="3c724-146">**Aplica-se a**: do [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] ao [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3c724-146">**Applies to**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="3c724-147">No [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], um índice columnstore não clusterizado:</span><span class="sxs-lookup"><span data-stu-id="3c724-147">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a nonclustered columnstore index:</span></span>

-   <span data-ttu-id="3c724-148">Pode indexar um subconjunto das colunas no índice clusterizado ou heap.</span><span class="sxs-lookup"><span data-stu-id="3c724-148">Can index a subset of columns in the clustered index or heap.</span></span> <span data-ttu-id="3c724-149">Por exemplo, pode indexar as colunas frequentemente usadas.</span><span class="sxs-lookup"><span data-stu-id="3c724-149">For example, it can index the frequently used columns.</span></span>

-   <span data-ttu-id="3c724-150">Exige armazenamento extra para armazenar uma cópia das colunas no índice.</span><span class="sxs-lookup"><span data-stu-id="3c724-150">Requires extra storage to store a copy of the columns in the index.</span></span>

-   <span data-ttu-id="3c724-151">É atualizado com a recriação do índice ou a alternância entre e saída de partições. Ele não é atualizável usando as operações DML, como INSERT, Update e Delete.</span><span class="sxs-lookup"><span data-stu-id="3c724-151">Is updated by rebuilding the index or switching partitions in and out. It is not updateable by using the DML operations such as insert, update, and delete.</span></span>

-   <span data-ttu-id="3c724-152">Pode ser combinado com outros índices na tabela.</span><span class="sxs-lookup"><span data-stu-id="3c724-152">Can be combined with other indexes on the table.</span></span>

-   <span data-ttu-id="3c724-153">Pode ser configurado para usar a columnstore ou compressão de arquivamento columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-153">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="3c724-154">Não armazena fisicamente colunas em uma ordem classificada.</span><span class="sxs-lookup"><span data-stu-id="3c724-154">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="3c724-155">Em vez disso, ele armazena dados para aprimorar a compactação e o desempenho.</span><span class="sxs-lookup"><span data-stu-id="3c724-155">Instead, it stores data to improve compression and performance.</span></span> <span data-ttu-id="3c724-156">A pré-classificação de dados antes da criação do índice columnstore não é necessária, mas pode melhorar a compactação columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-156">Pre-sorting the data before creating the columnstore index is not required, but can improve columnstore compression.</span></span>

###  <a name="key-concepts-and-terms"></a><a name="Concepts"></a><span data-ttu-id="3c724-157">Principais conceitos e termos</span><span class="sxs-lookup"><span data-stu-id="3c724-157">Key Concepts and Terms</span></span>
 <span data-ttu-id="3c724-158">Os termos e conceitos principais a seguir estão associados aos índices columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-158">The following key terms and concepts are associated with columnstore indexes.</span></span>

 <span data-ttu-id="3c724-159">índice columnstore um *índice columnstore* é uma tecnologia para armazenar, recuperar e gerenciar dados usando um formato de dados de coluna, chamado columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-159">columnstore index A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> <span data-ttu-id="3c724-160">O [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] oferece suporte a índices columnstore clusterizados e não clusterizados.</span><span class="sxs-lookup"><span data-stu-id="3c724-160">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="3c724-161">Ambos usam a mesma tecnologia de columnstore na memória, mas possuem diferenças na finalidade e nos recursos aos quais oferecem suporte.</span><span class="sxs-lookup"><span data-stu-id="3c724-161">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

 <span data-ttu-id="3c724-162">columnstore um *columnstore* são dados organizados logicamente como uma tabela com linhas e colunas e fisicamente armazenados em um formato de dados de coluna.</span><span class="sxs-lookup"><span data-stu-id="3c724-162">columnstore A *columnstore* is data that is logically organized as a table with rows and columns, and physically stored in a column-wise data format.</span></span>

 <span data-ttu-id="3c724-163">o rowgroup é um *armazenamento* de dados que é organizado logicamente como uma tabela com linhas e colunas e, em seguida, armazenado fisicamente em um formato de dados de linha.</span><span class="sxs-lookup"><span data-stu-id="3c724-163">rowstore A *rowstore* is data that is logically organized as a table with rows and columns, and then physically stored in a row-wise data format.</span></span> <span data-ttu-id="3c724-164">Esse tem sido o modo tradicional de armazenar dados da tabela relacional.</span><span class="sxs-lookup"><span data-stu-id="3c724-164">This has been the traditional way to store relational table data.</span></span>

 <span data-ttu-id="3c724-165">os grupos de linhas e de colunas para altas taxas de alto desempenho e alta compactação, o índice columnstore fatiam a tabela em grupos de linha, chamados de grupo de linhas e, em seguida, compacta cada grupo de linhas de forma inteligente.</span><span class="sxs-lookup"><span data-stu-id="3c724-165">rowgroups and column segments For high performance and high compression rates, the columnstore index slices the table into groups of rows, called row groups, and then compresses each row group in a column-wise manner.</span></span> <span data-ttu-id="3c724-166">O número de linhas no grupo de linhas deve ser grande o suficiente para melhorar as taxas de compactação e pequeno o suficiente para se beneficiar com as operações na memória.</span><span class="sxs-lookup"><span data-stu-id="3c724-166">The number of rows in the row group must be large enough to improve compression rates, and small enough to benefit from in-memory operations.</span></span>

 <span data-ttu-id="3c724-167">grupo *de linhas um rowgroup é um* grupo de linhas que são compactadas no formato columnstore ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="3c724-167">row group A *rowgroup* is a group of rows that are compressed into columnstore format at the same time.</span></span>

 <span data-ttu-id="3c724-168">segmento de coluna um *segmento de coluna* é uma coluna de dados de dentro do rowgroup.</span><span class="sxs-lookup"><span data-stu-id="3c724-168">column segment A *column segment* is a column of data from within the rowgroup.</span></span>

-   <span data-ttu-id="3c724-169">Um grupo de linhas normalmente contém o número máximo de linhas por grupo de linhas que é 1.048.576 linhas.</span><span class="sxs-lookup"><span data-stu-id="3c724-169">A rowgroup usually contains the maximum number of rows per rowgroup which is 1,048,576 rows.</span></span>

-   <span data-ttu-id="3c724-170">Cada rowgroup contém um segmento de coluna para cada coluna na tabela.</span><span class="sxs-lookup"><span data-stu-id="3c724-170">Each rowgroup contains one column segment for every column in the table.</span></span>

-   <span data-ttu-id="3c724-171">Cada segmento de coluna é compactado junto e armazenado em meio físico.</span><span class="sxs-lookup"><span data-stu-id="3c724-171">Each column segment is compressed together and stored on physical media.</span></span>

 <span data-ttu-id="3c724-172">![Segmento de coluna](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "segmento de coluna")</span><span class="sxs-lookup"><span data-stu-id="3c724-172">![Column segment](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "Column segment")</span></span>

 <span data-ttu-id="3c724-173">índice columnstore não clusterizado um *índice columnstore não clusterizado* é um índice somente leitura criado em um índice clusterizado ou tabela de heap existente.</span><span class="sxs-lookup"><span data-stu-id="3c724-173">nonclustered columnstore index A *nonclustered columnstore index* is a read-only index created on an existing clustered index or heap table.</span></span> <span data-ttu-id="3c724-174">Contém uma cópia de um subconjunto de colunas, até e incluindo todas as colunas na tabela.</span><span class="sxs-lookup"><span data-stu-id="3c724-174">It contains a copy of a subset of columns, up to and including all of the columns in the table..</span></span> <span data-ttu-id="3c724-175">A tabela é somente leitura enquanto contém um índice columnstore não clusterizado.</span><span class="sxs-lookup"><span data-stu-id="3c724-175">The table is read-only while it contains a nonclustered columnstore index.</span></span>

 <span data-ttu-id="3c724-176">Um índice columnstore não clusterizado fornece uma maneira de ter um índice columnstore para execução de consultas de análise e, ao mesmo tempo, executar operações somente leitura na tabela original.</span><span class="sxs-lookup"><span data-stu-id="3c724-176">A nonclustered columnstore index provides a way to have a columnstore index for running analysis queries while at the same time performing read-only operations on the original table.</span></span>

 <span data-ttu-id="3c724-177">![índice columnstore não clusterizado](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "índice columnstore não clusterizado")</span><span class="sxs-lookup"><span data-stu-id="3c724-177">![Nonclustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "Nonclustered columnstore index")</span></span>

 <span data-ttu-id="3c724-178">índice columnstore clusterizado um *índice columnstore clusterizado* é o armazenamento físico para a tabela inteira e é o único índice para a tabela.</span><span class="sxs-lookup"><span data-stu-id="3c724-178">clustered columnstore index A *clustered columnstore index* is the physical storage for the entire table and is the only index for the table.</span></span> <span data-ttu-id="3c724-179">O índice clusterizado é atualizável.</span><span class="sxs-lookup"><span data-stu-id="3c724-179">The clustered index is updateable.</span></span> <span data-ttu-id="3c724-180">Você pode executar operações de inserção, exclusão e atualização no índice e pode carregar dados em massa no índice.</span><span class="sxs-lookup"><span data-stu-id="3c724-180">You can perform insert, delete, and update operations on the index and you can bulk load data into the index.</span></span>

 <span data-ttu-id="3c724-181">![Índice columnstore clusterizado](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Índice columnstore clusterizado")</span><span class="sxs-lookup"><span data-stu-id="3c724-181">![Clustered Columnstore Index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Clustered Columnstore Index")</span></span>

 <span data-ttu-id="3c724-182">Para reduzir a fragmentação dos segmentos de coluna e melhorar o desempenho, o índice columnstore pode armazenar alguns dados temporariamente em uma tabela rowstore, chamada deltastore, mais uma árvore B de IDs para as linhas excluídas.</span><span class="sxs-lookup"><span data-stu-id="3c724-182">To reduce fragmentation of the column segments and improve performance, the columnstore index might store some data temporarily into a rowstore table, called a deltastore, plus a B-Tree of IDs for deleted rows.</span></span> <span data-ttu-id="3c724-183">As operações de deltastore são tratadas em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="3c724-183">The deltastore operations are handled behind the scenes.</span></span> <span data-ttu-id="3c724-184">Para retornar os resultados corretos da consulta, o índice columnstore clusterizado combina os resultados da consulta de columnstore e deltastore.</span><span class="sxs-lookup"><span data-stu-id="3c724-184">To return the correct query results, the clustered columnstore index combines query results from both the columnstore and the deltastore.</span></span>

 <span data-ttu-id="3c724-185">deltastore usado somente com índices columnstore clusterizados, um *deltastore* é uma tabela do RowNumber que armazena linhas até que o número de linhas seja grande o suficiente para ser movido para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-185">deltastore Used with clustered columnstore indexes only, a *deltastore* is a rowstore table that stores rows until the number of rows is large enough to be moved into the columnstore.</span></span> <span data-ttu-id="3c724-186">Um deltastore é usado com índices columnstore clusterizados para melhorar o desempenho do carregamento e de outras operações DML.</span><span class="sxs-lookup"><span data-stu-id="3c724-186">A deltastore is used with clustered columnstore indexes to improve performance for loading and other DML operations.</span></span>

 <span data-ttu-id="3c724-187">Durante o carregamento em massa grande, a maioria das linhas vai diretamente para o columnstore sem passar pelo deltastore.</span><span class="sxs-lookup"><span data-stu-id="3c724-187">During a large bulk load, most of the rows go directly to the columnstore without passing through the deltastore.</span></span> <span data-ttu-id="3c724-188">No fim do carregamento em massa, o número de linhas pode ser muito pouco para atender ao tamanho mínimo de um rowgroup, que é de 102.400 linhas.</span><span class="sxs-lookup"><span data-stu-id="3c724-188">Some rows at the end of the bulk load might be too few in number to meet the minimum size of a rowgroup which is 102,400 rows.</span></span> <span data-ttu-id="3c724-189">Quando isso ocorre, as linhas finais vão para o deltastore, e não para o columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-189">When this happens, the final rows go to the deltastore instead of the columnstore.</span></span> <span data-ttu-id="3c724-190">Para carregamento em massa pequeno, menos de 102.400 linhas, todas as linhas vão diretamente para o deltastore.</span><span class="sxs-lookup"><span data-stu-id="3c724-190">For small bulk loads with less than 102,400 rows, all of the rows go directly to the deltastore.</span></span>

 <span data-ttu-id="3c724-191">Quando o deltastore atinge o número máximo de linhas, ele é fechado.</span><span class="sxs-lookup"><span data-stu-id="3c724-191">When the deltastore reaches the maximum number of rows, it becomes closed.</span></span> <span data-ttu-id="3c724-192">Um processo de movimentação de tupla verifica os grupos de linhas fechados.</span><span class="sxs-lookup"><span data-stu-id="3c724-192">A tuple-move process checks for closed row groups.</span></span> <span data-ttu-id="3c724-193">Quando encontra o grupo de linhas fechado, compacta-o e armazena-o no columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-193">When it finds the closed rowgroup, it compresses it and stores it into the columnstore.</span></span>

##  <a name="loading-data"></a><a name="dataload"></a><span data-ttu-id="3c724-194">Carregando dados</span><span class="sxs-lookup"><span data-stu-id="3c724-194">Loading Data</span></span>

###  <a name="loading-data-into-a-nonclustered-columnstore-index"></a><a name="dataload_nci"></a><span data-ttu-id="3c724-195">Carregando dados em um índice Columnstore não clusterizado</span><span class="sxs-lookup"><span data-stu-id="3c724-195">Loading Data into a Nonclustered Columnstore Index</span></span>
 <span data-ttu-id="3c724-196">Para carregar dados em um índice columnstore não clusterizado, primeiro carregue dados em uma tabela de armazenamento tradicional armazenada como um índice de heap ou cluster e, em seguida, crie o índice columnstore não clusterizado com [Create COLUMNSTORE index &#40;&#41;Transact-SQL ](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="3c724-196">To load data into a nonclustered columnstore index, first load data into a traditional rowstore table stored as a heap or clustered index, and then create the nonclustered columnstore index with [CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

 <span data-ttu-id="3c724-197">![Carregando dados em um índice columnstore](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Carregando dados em um índice columnstore")</span><span class="sxs-lookup"><span data-stu-id="3c724-197">![Loading data into a columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Loading data into a columnstore index")</span></span>

 <span data-ttu-id="3c724-198">Uma tabela com um índice columnstore não clusterizado é somente leitura até que o índice seja removido ou desabilitado.</span><span class="sxs-lookup"><span data-stu-id="3c724-198">A table with a nonclustered columnstore index is read-only until the index is dropped or disabled.</span></span> <span data-ttu-id="3c724-199">Para atualizar a tabela e o índice columnstore não clusterizado, você pode alternar as partições para dentro e para fora. Você também pode desabilitar o índice, atualizar a tabela e, em seguida, recompilar o índice.</span><span class="sxs-lookup"><span data-stu-id="3c724-199">To update the table and the nonclustered columnstore index you can switch partitions in and out. You can also disable the index, update the table, and then rebuild the index.</span></span>

 <span data-ttu-id="3c724-200">Para obter mais informações, consulte [Using Nonclustered Columnstore Indexes](indexes.md)</span><span class="sxs-lookup"><span data-stu-id="3c724-200">For more information see [Using Nonclustered Columnstore Indexes](indexes.md)</span></span>

###  <a name="loading-data-into-a-clustered-columnstore-index"></a><a name="dataload_cci"></a><span data-ttu-id="3c724-201">Carregando dados em um índice Columnstore clusterizado</span><span class="sxs-lookup"><span data-stu-id="3c724-201">Loading Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="3c724-202">![Carregamento em um índice columnstore clusterizado](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Carregamento em um índice columnstore clusterizado")</span><span class="sxs-lookup"><span data-stu-id="3c724-202">![Loading into a clustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Loading into a clustered columnstore index")</span></span>

 <span data-ttu-id="3c724-203">Como sugere o diagrama, para carregar dados em um índice columnstore clusterizado, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="3c724-203">As the diagram suggests, to load data into a clustered columnstore index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

1.  <span data-ttu-id="3c724-204">Insere rowgroups de tamanho máximo diretamente no columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-204">Inserts maximum-size rowgroups directly into the columnstore.</span></span> <span data-ttu-id="3c724-205">À medida que os dados são carregados, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] atribui as linhas de dados por ordem de chegada em um rowgroup aberto.</span><span class="sxs-lookup"><span data-stu-id="3c724-205">As the data is loaded, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] assigns the data rows in a first-come first-serve order into an open rowgroup.</span></span>

2.  <span data-ttu-id="3c724-206">Para cada rowgroup, depois que ele atinge o tamanho máximo, o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="3c724-206">For each rowgroup, after it reaches the maximum size, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

    1.  <span data-ttu-id="3c724-207">Marca o rowgroup como CLOSED.</span><span class="sxs-lookup"><span data-stu-id="3c724-207">Marks the rowgroup as CLOSED.</span></span>

    2.  <span data-ttu-id="3c724-208">Ignora o deltastore.</span><span class="sxs-lookup"><span data-stu-id="3c724-208">Bypasses the deltastore.</span></span>

    3.  <span data-ttu-id="3c724-209">Compacta cada segmento de coluna com o rowgroup com a compactação columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-209">Compresses each column segment with the rowgroup with columnstore compression.</span></span>

    4.  <span data-ttu-id="3c724-210">Armazena fisicamente cada segmento de coluna compactado no columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-210">Physically stores each compressed column segment into the columnstore.</span></span>

3.  <span data-ttu-id="3c724-211">Insere as linhas restantes no columnstore ou deltastore, como se segue:</span><span class="sxs-lookup"><span data-stu-id="3c724-211">Inserts the remaining rows into the columnstore or the deltastore as follows:</span></span>

    1.  <span data-ttu-id="3c724-212">Se o número de linhas atender ao requisito de linhas mínimas por rowgroup, as linhas serão adicionadas ao columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-212">If the number of rows meets the minimum rows per rowgroup requirement, the rows are added to the columnstore.</span></span>

    2.  <span data-ttu-id="3c724-213">Se o número de linhas for menor que o mínimo de linhas por rowgroup, as linhas serão adicionadas ao deltastore.</span><span class="sxs-lookup"><span data-stu-id="3c724-213">If the number of rows is less than the minimum rows per rowgroup, the rows are added to the deltastore.</span></span>

 <span data-ttu-id="3c724-214">Para obter mais informações sobre tarefas e processos de deltastore, consulte [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span><span class="sxs-lookup"><span data-stu-id="3c724-214">For more information about deltastore tasks and processes, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span></span>

##  <a name="performance-tips"></a><a name="performance"></a><span data-ttu-id="3c724-215">Dicas de desempenho</span><span class="sxs-lookup"><span data-stu-id="3c724-215">Performance Tips</span></span>

### <a name="plan-for-enough-memory-to-create-columnstore-indexes-in-parallel"></a><span data-ttu-id="3c724-216">Planejar memória suficiente para criar índices columnstore em paralelo</span><span class="sxs-lookup"><span data-stu-id="3c724-216">Plan for enough memory to create columnstore indexes in parallel</span></span>
 <span data-ttu-id="3c724-217">Criar um índice columnstore é, por padrão, uma operação paralela, a menos que a memória seja restrita.</span><span class="sxs-lookup"><span data-stu-id="3c724-217">Creating a columnstore index is by default a parallel operation unless memory is constrained.</span></span> <span data-ttu-id="3c724-218">Criar o índice em paralelo exige mais memória do que criar o índice em série.</span><span class="sxs-lookup"><span data-stu-id="3c724-218">Creating the index in parallel requires more memory than creating the index serially.</span></span> <span data-ttu-id="3c724-219">Quando há bastante memória, a criação de um índice columnstore assume a ordem de 1,5 vezes mais longa do que a criação de uma árvore B nas mesmas colunas.</span><span class="sxs-lookup"><span data-stu-id="3c724-219">When there is ample memory, creating a columnstore index takes on the order of 1.5 times as long as building a B-tree on the same columns.</span></span>

 <span data-ttu-id="3c724-220">A memória necessária para criar um índice columnstore depende do número de colunas, do número de colunas de cadeia de caracteres, do grau de paralelismo (DOP) e as características dos dados.</span><span class="sxs-lookup"><span data-stu-id="3c724-220">The memory required for creating a columnstore index depends on the number of columns, the number of string columns, the degree of parallelism (DOP), and the characteristics of the data.</span></span> <span data-ttu-id="3c724-221">Por exemplo, se sua tabela tiver menos de um milhão de linhas, o SQL Server usará apenas um thread para criar o índice columnstore.</span><span class="sxs-lookup"><span data-stu-id="3c724-221">For example, if your table has fewer than one million rows, SQL Server will use only one thread to create the columnstore index.</span></span>

 <span data-ttu-id="3c724-222">Se a sua tabela tiver mais de um milhão de linhas, mas o SQL Server não puder obter uma quantidade de memória suficiente para criar o índice usando MAXDOP, o SQL Server diminuirá automaticamente MAXDOP conforme o necessário de acordo com a quantidade de memória disponível.</span><span class="sxs-lookup"><span data-stu-id="3c724-222">If your table has more than one million rows, but SQL Server cannot get a large enough memory grant to create the index using MAXDOP, SQL Server will automatically decrease MAXDOP as needed to fit into the available memory grant.</span></span>  <span data-ttu-id="3c724-223">Em alguns casos, o DOP deve ser diminuído para um para criar o índice na memória restrita.</span><span class="sxs-lookup"><span data-stu-id="3c724-223">In some cases, DOP must be decreased to one in order to build the index under constrained memory.</span></span>

##  <a name="related-tasks-and-topics"></a><a name="related"></a><span data-ttu-id="3c724-224">Tópicos e tarefas relacionadas</span><span class="sxs-lookup"><span data-stu-id="3c724-224">Related Tasks and Topics</span></span>

### <a name="nonclustered-columnstore-indexes"></a><span data-ttu-id="3c724-225">Índices columnstore não clusterizados</span><span class="sxs-lookup"><span data-stu-id="3c724-225">Nonclustered Columnstore Indexes</span></span>
 <span data-ttu-id="3c724-226">Para tarefas comuns, consulte [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="3c724-226">For common tasks, see [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="3c724-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="3c724-228">[ALTER INDEX &#40;&#41;Transact-SQL](/sql/t-sql/statements/alter-index-transact-sql) com recompilação.</span><span class="sxs-lookup"><span data-stu-id="3c724-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD.</span></span>

-   [<span data-ttu-id="3c724-229">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-229">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

### <a name="clustered-columnstore-indexes"></a><span data-ttu-id="3c724-230">Índices columnstore clusterizados</span><span class="sxs-lookup"><span data-stu-id="3c724-230">Clustered Columnstore Indexes</span></span>
 <span data-ttu-id="3c724-231">Para tarefas comuns, consulte [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="3c724-231">For common tasks, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="3c724-232">CRIAR índice COLUMNSTORE CLUSTERIZAdo &#40;&#41;Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="3c724-232">CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="3c724-233">[ALTER INDEX &#40;&#41;Transact-SQL](/sql/t-sql/statements/alter-index-transact-sql) com recompilação ou reorganização.</span><span class="sxs-lookup"><span data-stu-id="3c724-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD or REORGANIZE.</span></span>

-   [<span data-ttu-id="3c724-234">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-234">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

-   [<span data-ttu-id="3c724-235">INSERT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-235">INSERT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/insert-transact-sql)

-   [<span data-ttu-id="3c724-236">UPDATE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-236">UPDATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/update-transact-sql)

-   [<span data-ttu-id="3c724-237">DELETE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-237">DELETE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/delete-transact-sql)

### <a name="metadata"></a><span data-ttu-id="3c724-238">Metadados</span><span class="sxs-lookup"><span data-stu-id="3c724-238">Metadata</span></span>
 <span data-ttu-id="3c724-239">Todas as colunas em um índice columnstore são armazenadas nos metadados como colunas incluídas.</span><span class="sxs-lookup"><span data-stu-id="3c724-239">All of the columns in a columnstore index are stored in the metadata as included columns.</span></span> <span data-ttu-id="3c724-240">O índice columnstore não tem colunas de chave.</span><span class="sxs-lookup"><span data-stu-id="3c724-240">The columnstore index does not have key columns.</span></span>

-   [<span data-ttu-id="3c724-241">sys.indexes &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-241">sys.indexes &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql)

-   [<span data-ttu-id="3c724-242">sys.index_columns &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-242">sys.index_columns &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-index-columns-transact-sql)

-   [<span data-ttu-id="3c724-243">sys.partitions &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-243">sys.partitions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-partitions-transact-sql)

-   [<span data-ttu-id="3c724-244">sys.column_store_segments &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-244">sys.column_store_segments &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-segments-transact-sql)

-   [<span data-ttu-id="3c724-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-dictionaries-transact-sql)

-   [<span data-ttu-id="3c724-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="3c724-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-row-groups-transact-sql)


