---
title: Usando WQL com o provedor WMI para eventos de servidor | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: wmi
ms.topic: reference
helpviewer_keywords:
- queries [WMI]
- query language [WMI]
- WMI Query Language [WMI]
- WQL [WMI]
- WMI Provider for Server Events, WQL
ms.assetid: 58b67426-1e66-4445-8e2c-03182e94c4be
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: df2bbf5c6031781494695f95116441fde34bf4f5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87573842"
---
# <a name="using-wql-with-the-wmi-provider-for-server-events"></a><span data-ttu-id="284f3-102">Usando o WQL com o Provedor WMI para eventos de servidor</span><span class="sxs-lookup"><span data-stu-id="284f3-102">Using WQL with the WMI Provider for Server Events</span></span>
  <span data-ttu-id="284f3-103">Os aplicativos de gerenciamento acessam eventos [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] que usam o Provedor WMI para eventos de servidor emitindo instruções WQL.</span><span class="sxs-lookup"><span data-stu-id="284f3-103">Management applications access [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] events using the WMI Provider for Server Events by issuing WMI Query Language (WQL) statements.</span></span> <span data-ttu-id="284f3-104">O WQL é um subconjunto simplificado da linguagem SQL, com algumas extensões específicas do WMI.</span><span class="sxs-lookup"><span data-stu-id="284f3-104">WQL is a simplified subset of structured query language (SQL), with some WMI-specific extensions.</span></span> <span data-ttu-id="284f3-105">Ao usar o WQL, um aplicativo recupera um tipo de evento em uma instância específica do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], um banco de dados ou um objeto de banco de dados (o único objeto com suporte no momento é o de fila).</span><span class="sxs-lookup"><span data-stu-id="284f3-105">In using WQL, an application retrieves an event type against a specific instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a database, or a database object (the only object currently supported is queue).</span></span> <span data-ttu-id="284f3-106">O provedor WMI para eventos de servidor traduz a consulta em uma notificação de evento que é criada no banco de dados de destino para notificações de eventos no escopo do banco de dados ou no escopo do objeto, ou no banco de dados **mestre** para notificações de eventos no escopo do servidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-106">The WMI Provider for Server Events translates the query into an event notification that is created in the target database for database-scoped or object-scoped event notifications, or in the **master** database for server-scoped event notifications.</span></span>  
  
 <span data-ttu-id="284f3-107">Por exemplo, considere a seguinte consulta WQL:</span><span class="sxs-lookup"><span data-stu-id="284f3-107">For example, consider the following WQL query:</span></span>  
  
```  
SELECT * FROM DDL_DATABASE_LEVEL_EVENTS WHERE DatabaseName = 'AdventureWorks'  
```  
  
 <span data-ttu-id="284f3-108">A partir dessa consulta, o Provedor WMI tenta gerar o equivalente dessa notificação de eventos no servidor de destino:</span><span class="sxs-lookup"><span data-stu-id="284f3-108">From this query, the WMI Provider tries to produce the equivalent of this event notification on the target server:</span></span>  
  
```  
USE AdventureWorks ;  
GO  
  
CREATE EVENT NOTIFICATION SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9  
    ON DATABASE  
    WITH FAN_IN  
    FOR DDL_DATABASE_LEVEL_EVENTS  
    TO SERVICE   
        'SQL/Notifications/ProcessWMIEventProviderNotification/v1.0',  
        'A7E5521A-1CA6-4741-865D-826F804E5135';  
GO  
```  
  
 <span data-ttu-id="284f3-109">O argumento na cláusula `FROM` da consulta WQL (`DDL_DATABASE_LEVEL_EVENTS`) pode ser qualquer evento válido no qual uma notificação de eventos pode ser criada.</span><span class="sxs-lookup"><span data-stu-id="284f3-109">The argument in the `FROM` clause of the WQL query (`DDL_DATABASE_LEVEL_EVENTS`) can be any valid event upon which an event notification can be created.</span></span> <span data-ttu-id="284f3-110">Os argumentos nas cláusulas `SELECT` e `WHERE` podem especificar qualquer propriedade de evento associada com um evento ou seu evento pai.</span><span class="sxs-lookup"><span data-stu-id="284f3-110">The arguments in the `SELECT` and `WHERE` clauses can specify any event property associated with an event or its parent event.</span></span> <span data-ttu-id="284f3-111">Para obter uma lista de eventos válidos e propriedades de eventos, consulte [Event Notifications (mecanismo de banco de dados)](https://technet.microsoft.com/library/ms182602.aspx).</span><span class="sxs-lookup"><span data-stu-id="284f3-111">For a list of valid events and event properties, see [Event Notifications (Database Engine)](https://technet.microsoft.com/library/ms182602.aspx).</span></span>  
  
 <span data-ttu-id="284f3-112">Há suporte explícito do Provedor WMI para eventos de servidor à sintaxe WQL a seguir.</span><span class="sxs-lookup"><span data-stu-id="284f3-112">The following WQL syntax is supported explicitly by the WMI Provider for Server Events.</span></span> <span data-ttu-id="284f3-113">É possível especificar sintaxe WQL adicional, mas ela não é específica deste provedor e é analisada pelo serviço de host WMI.</span><span class="sxs-lookup"><span data-stu-id="284f3-113">Additional WQL syntax may be specified, but it is not specific to this provider and is parsed instead by the WMI host service.</span></span> <span data-ttu-id="284f3-114">Para obter mais informações sobre a linguagem de consulta WMI, consulte a documentação do WQL no MSDN (Microsoft Developer Network).</span><span class="sxs-lookup"><span data-stu-id="284f3-114">For more information about the WMI Query Language, see the WQL documentation on the Microsoft Developer Network (MSDN).</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="284f3-115">Sintaxe</span><span class="sxs-lookup"><span data-stu-id="284f3-115">Syntax</span></span>  
  
```  
  
SELECT { event_property [ ,...n ] | * }  
FROM event_type   
WHERE where_condition  
```  
  
## <a name="arguments"></a><span data-ttu-id="284f3-116">Argumentos</span><span class="sxs-lookup"><span data-stu-id="284f3-116">Arguments</span></span>  
 <span data-ttu-id="284f3-117">*event_property*</span><span class="sxs-lookup"><span data-stu-id="284f3-117">*event_property*</span></span>  
 <span data-ttu-id="284f3-118">É uma propriedade de um evento.</span><span class="sxs-lookup"><span data-stu-id="284f3-118">Is a property of an event.</span></span> <span data-ttu-id="284f3-119">Exemplos incluem `PostTime`, `SPID` e `LoginName`.</span><span class="sxs-lookup"><span data-stu-id="284f3-119">Examples include `PostTime`, `SPID`, and `LoginName`.</span></span> <span data-ttu-id="284f3-120">Pesquise cada evento listado no [provedor WMI para classes de eventos de servidor e propriedades](wmi-provider-for-server-events-classes-and-properties.md) para determinar quais propriedades ele contém.</span><span class="sxs-lookup"><span data-stu-id="284f3-120">Look up each event listed in [WMI Provider for Server Events Classes and Properties](wmi-provider-for-server-events-classes-and-properties.md) to determine which properties it holds.</span></span> <span data-ttu-id="284f3-121">Por exemplo, o evento DDL_DATABASE_LEVEL_EVENTS contém as propriedades `DatabaseName` e `UserName`.</span><span class="sxs-lookup"><span data-stu-id="284f3-121">For example, the DDL_DATABASE_LEVEL_EVENTS event holds the `DatabaseName` and `UserName` properties.</span></span> <span data-ttu-id="284f3-122">Ele também herda as propriedades `SQLInstance`, `LoginName`, `PostTime`, `SPID` e `ComputerName` de seus eventos pai.</span><span class="sxs-lookup"><span data-stu-id="284f3-122">It also inherits the `SQLInstance`, `LoginName`, `PostTime`, `SPID`, and `ComputerName` properties from its parent events.</span></span>  
  
 <span data-ttu-id="284f3-123">**,** *... n*</span><span class="sxs-lookup"><span data-stu-id="284f3-123">**,** *...n*</span></span>  
 <span data-ttu-id="284f3-124">Indica que *event_property* pode ser consultada várias vezes, separadas por vírgulas.</span><span class="sxs-lookup"><span data-stu-id="284f3-124">Indicates that *event_property* can be queried multiple times, separated by commas.</span></span>  
  
 \*  
 <span data-ttu-id="284f3-125">Especifica que todas as propriedades associadas com um evento são consultadas.</span><span class="sxs-lookup"><span data-stu-id="284f3-125">Specifies that all properties associated with an event are queried.</span></span>  
  
 <span data-ttu-id="284f3-126">*event_type*</span><span class="sxs-lookup"><span data-stu-id="284f3-126">*event_type*</span></span>  
 <span data-ttu-id="284f3-127">É qualquer evento no qual uma notificação de eventos pode ser criada.</span><span class="sxs-lookup"><span data-stu-id="284f3-127">Is any event against which an event notification can be created.</span></span> <span data-ttu-id="284f3-128">Para obter uma lista de eventos disponíveis, consulte [provedor WMI para classes e propriedades de eventos de servidor](https://technet.microsoft.com/library/ms186449.aspx).</span><span class="sxs-lookup"><span data-stu-id="284f3-128">For a list of available events, see [WMI Provider for Server Events Classes and Properties](https://technet.microsoft.com/library/ms186449.aspx).</span></span> <span data-ttu-id="284f3-129">Observe que os nomes de *tipo de evento* correspondem ao mesmo *event_type*  |  *event_group* que podem ser especificados quando você cria manualmente uma notificação de evento usando criar notificação de eventos.</span><span class="sxs-lookup"><span data-stu-id="284f3-129">Note that *event type* names correspond to the same *event_type* | *event_group* that can be specified when you manually create an event notification by using CREATE EVENT NOTIFICATION.</span></span> <span data-ttu-id="284f3-130">Os exemplos de *tipo de evento* incluem CREATE_TABLE, LOCK_DEADLOCK, DDL_USER_EVENTS e TRC_DATABASE.</span><span class="sxs-lookup"><span data-stu-id="284f3-130">Examples of *event type* include CREATE_TABLE, LOCK_DEADLOCK, DDL_USER_EVENTS, and TRC_DATABASE.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="284f3-131">Certos procedimentos armazenados do sistema que executam operações similares a DDL também podem acionar notificações de eventos.</span><span class="sxs-lookup"><span data-stu-id="284f3-131">Certain system stored procedures that perform DDL-like operations can also fire event notifications.</span></span> <span data-ttu-id="284f3-132">Teste as notificações de eventos para determinar suas respostas aos procedimentos armazenados que são executados.</span><span class="sxs-lookup"><span data-stu-id="284f3-132">Test your event notifications to determine their responses to system stored procedures that are run.</span></span> <span data-ttu-id="284f3-133">Por exemplo, a instrução CREATE TYPE e **sp_addtype** procedimento armazenado acionarão uma notificação de evento que é criada em um evento CREATE_TYPE.</span><span class="sxs-lookup"><span data-stu-id="284f3-133">For example, the CREATE TYPE statement and **sp_addtype** stored procedure will both fire an event notification that is created on a CREATE_TYPE event.</span></span> <span data-ttu-id="284f3-134">No entanto, o procedimento armazenado **sp_rename** não aciona nenhuma notificação de evento.</span><span class="sxs-lookup"><span data-stu-id="284f3-134">However, the **sp_rename** stored procedure does not fire any event notifications.</span></span> <span data-ttu-id="284f3-135">Para obter mais informações, consulte[eventos DDL](../triggers/ddl-events.md).</span><span class="sxs-lookup"><span data-stu-id="284f3-135">For more information, see[DDL Events](../triggers/ddl-events.md).</span></span>  
  
 <span data-ttu-id="284f3-136">*where_condition*</span><span class="sxs-lookup"><span data-stu-id="284f3-136">*where_condition*</span></span>  
 <span data-ttu-id="284f3-137">É um predicado de consulta de cláusula WHERE composto por nomes de *event_property* e operadores lógicos e de comparação.</span><span class="sxs-lookup"><span data-stu-id="284f3-137">Is a WHERE clause query predicate made up of *event_property* names and logical and comparison operators.</span></span> <span data-ttu-id="284f3-138">O *where_condition* determina o escopo no qual a notificação de evento correspondente é registrada no banco de dados de destino.</span><span class="sxs-lookup"><span data-stu-id="284f3-138">The *where_condition* determines the scope in which the corresponding event notification is registered in the target database.</span></span> <span data-ttu-id="284f3-139">Ele também pode atuar como um filtro para direcionar um esquema ou objeto específico do qual consultar *event_type.*</span><span class="sxs-lookup"><span data-stu-id="284f3-139">It can also act as a filter to target a particular schema or object from which to query *event_type.*</span></span> <span data-ttu-id="284f3-140">Para obter mais informações, consulte a seção Comentários, mais adiante neste tópico.</span><span class="sxs-lookup"><span data-stu-id="284f3-140">For more information, see the Remarks section later in this topic.</span></span>  
  
 <span data-ttu-id="284f3-141">Somente o operando `=` pode ser usado juntamente com `DatabaseName`, `SchemaName` e `ObjectName`.</span><span class="sxs-lookup"><span data-stu-id="284f3-141">Only the `=` operand can be used together with `DatabaseName`, `SchemaName`, and `ObjectName`.</span></span> <span data-ttu-id="284f3-142">Não é possível usar outras expressões com essas propriedades de eventos.</span><span class="sxs-lookup"><span data-stu-id="284f3-142">Other expressions cannot be used with these event properties.</span></span>  
  
## <a name="remarks"></a><span data-ttu-id="284f3-143">Comentários</span><span class="sxs-lookup"><span data-stu-id="284f3-143">Remarks</span></span>  
 <span data-ttu-id="284f3-144">O *where_condition* da sintaxe do provedor WMI para eventos de servidor determina o seguinte:</span><span class="sxs-lookup"><span data-stu-id="284f3-144">The *where_condition* of the WMI Provider for Server Events syntax determines the following:</span></span>  
  
-   <span data-ttu-id="284f3-145">O escopo pelo qual o provedor tenta recuperar o *event_type*especificado: nível de servidor, nível de banco de dados ou nível de objeto (o único objeto com suporte no momento é a fila).</span><span class="sxs-lookup"><span data-stu-id="284f3-145">The scope by which the provider tries to retrieve the specified *event_type*: the server level, database level, or object level (the only object currently supported is queue).</span></span> <span data-ttu-id="284f3-146">Por fim, esse escopo determina o tipo de notificação de eventos criado no banco de dados de destino.</span><span class="sxs-lookup"><span data-stu-id="284f3-146">Ultimately, this scope determines the type of event notification created in the target database.</span></span> <span data-ttu-id="284f3-147">Esse processo chamou o registro de notificação de eventos.</span><span class="sxs-lookup"><span data-stu-id="284f3-147">This process called event notification registration.</span></span>  
  
-   <span data-ttu-id="284f3-148">O banco de dados, o esquema e o objeto, quando apropriado, no qual registrar.</span><span class="sxs-lookup"><span data-stu-id="284f3-148">The database, schema, and object, where appropriate, on which to register.</span></span>  
  
 <span data-ttu-id="284f3-149">O Provedor WMI para eventos de servidor usa um algoritmo ascendente, o primeiro que for válido (first fit), a fim de gerar o escopo mais restrito possível para a EVENT NOTIFICATION subjacente.</span><span class="sxs-lookup"><span data-stu-id="284f3-149">The WMI Provider for Server Events uses a bottom-up, first-fit algorithm to produce the narrowest possible scope for the underlying EVENT NOTIFICATION.</span></span> <span data-ttu-id="284f3-150">O algoritmo tenta minimizar a atividade interna no servidor e o tráfego de rede entre a instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] e o processo do host WMI.</span><span class="sxs-lookup"><span data-stu-id="284f3-150">The algorithm tries to minimize internal activity on the server and network traffic between the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] and the WMI host process.</span></span> <span data-ttu-id="284f3-151">O provedor examina a *event_type* especificada na cláusula From e as condições na cláusula WHERE e tenta registrar a notificação de evento subjacente com o escopo mais estreito possível.</span><span class="sxs-lookup"><span data-stu-id="284f3-151">The provider examines the *event_type* specified in the FROM clause and the conditions in the WHERE clause, and tries to register the underlying EVENT NOTIFICATION with the narrowest possible scope.</span></span> <span data-ttu-id="284f3-152">Se o provedor não puder registrar com o escopo mais restrito, ele tentará registrar com escopos sucessivamente superiores, até que um registro finalmente tenha êxito.</span><span class="sxs-lookup"><span data-stu-id="284f3-152">If the provider cannot register at the narrowest scope, it tries to register at successively higher scopes until a registration finally succeeds.</span></span> <span data-ttu-id="284f3-153">Se o escopo mais alto (o nível de servidor) for atingido e falhar, um erro será retornado ao consumidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-153">If it reaches the highest scope the server-level) and fails, it returns an error to the consumer.</span></span>  
  
 <span data-ttu-id="284f3-154">Por exemplo, se DatabaseName =**'** AdventureWorks **'** for especificado na cláusula WHERE, o provedor tentará registrar uma notificação de evento no [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] banco de dados.</span><span class="sxs-lookup"><span data-stu-id="284f3-154">For example, if DatabaseName=**'** AdventureWorks **'** is specified in the WHERE clause, the provider tries to register an event notification in the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database.</span></span> <span data-ttu-id="284f3-155">Se o banco de dados [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] existir e o cliente que fez a chamada tiver as permissões necessárias para criar uma notificação de eventos em [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)], o registro terá êxito.</span><span class="sxs-lookup"><span data-stu-id="284f3-155">If the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database exists and the calling client has the required permissions to create an event notification in [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)], the registration is successful.</span></span> <span data-ttu-id="284f3-156">Caso contrário, será feita uma tentativa de registrar a notificação de eventos no nível de servidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-156">Otherwise, an attempt is made to register the event notification at the server level.</span></span> <span data-ttu-id="284f3-157">O registro terá êxito se o cliente WMI tiver as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="284f3-157">The registration succeeds if the WMI client has the required permissions.</span></span> <span data-ttu-id="284f3-158">Porém, neste cenário, os eventos não são retornados ao cliente até que o banco de dados [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] tenha sido criado.</span><span class="sxs-lookup"><span data-stu-id="284f3-158">However, under this scenario, events are not returned to the client until the [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database has been created.</span></span>  
  
 <span data-ttu-id="284f3-159">O *where_condition* também pode atuar como um filtro para limitar ainda mais a consulta a um banco de dados, esquema ou objeto específico.</span><span class="sxs-lookup"><span data-stu-id="284f3-159">The *where_condition* can also act as a filter to additionally limit the query to a specific database, schema, or object.</span></span> <span data-ttu-id="284f3-160">Por exemplo, considere a seguinte consulta WQL:</span><span class="sxs-lookup"><span data-stu-id="284f3-160">For example, consider the following WQL query:</span></span>  
  
```  
SELECT * FROM ALTER_TABLE   
WHERE DatabaseName = 'AdventureWorks' AND SchemaName = 'Sales'   
    AND ObjectType='Table' AND ObjectName = 'SalesOrderDetail'  
```  
  
 <span data-ttu-id="284f3-161">Dependendo do resultado do processo de registro, essa consulta WQL pode ser registrada no nível de banco de dados ou de servidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-161">Depending on the outcome of the registration process, this WQL query may be registered either at the database or server level.</span></span> <span data-ttu-id="284f3-162">Entretanto, mesmo se registrada no nível de servidor, no final o provedor filtra quaisquer eventos `ALTER_TABLE` que não se aplicam à tabela `AdventureWorks.Sales.SalesOrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="284f3-162">However, even if it is registered at the server level, the provider ultimately filters any `ALTER_TABLE` events that do not apply to the `AdventureWorks.Sales.SalesOrderDetail` table.</span></span> <span data-ttu-id="284f3-163">Em outras palavras, o provedor retorna apenas as propriedades dos eventos `ALTER_TABLE` que ocorrem naquela tabela específica.</span><span class="sxs-lookup"><span data-stu-id="284f3-163">In other words, the provider returns only the properties of the `ALTER_TABLE` events that occur on that specific table.</span></span>  
  
 <span data-ttu-id="284f3-164">Se uma expressão composta, como `DatabaseName='AW1'` OR `DatabaseName='AW2'`, for especificada, será feita uma tentativa de registrar uma única notificação de eventos no escopo do servidor, em vez de duas notificações de eventos separadas.</span><span class="sxs-lookup"><span data-stu-id="284f3-164">If a compound expression such as `DatabaseName='AW1'` OR `DatabaseName='AW2'` is specified, an attempt is made to register a single event notification at the server scope instead of two separate event notifications.</span></span> <span data-ttu-id="284f3-165">O registro terá êxito se o cliente que fez a chamada tiver as permissões.</span><span class="sxs-lookup"><span data-stu-id="284f3-165">The registration succeeds if the calling client has permissions.</span></span>  
  
 <span data-ttu-id="284f3-166">Se `SchemaName='X' AND ObjectType='Y' AND ObjectName='Z'` forem todos especificados na `WHERE` cláusula, será feita uma tentativa de registrar a notificação de eventos diretamente no objeto `Z` no esquema `X` .</span><span class="sxs-lookup"><span data-stu-id="284f3-166">If `SchemaName='X' AND ObjectType='Y' AND ObjectName='Z'` are all specified in the `WHERE` clause, an attempt is made to register the event notification directly on object `Z` in schema `X`.</span></span> <span data-ttu-id="284f3-167">O registro terá êxito se o cliente tiver as permissões.</span><span class="sxs-lookup"><span data-stu-id="284f3-167">The registration succeeds if the client has permissions.</span></span> <span data-ttu-id="284f3-168">Observe que, no momento, os eventos de nível de objeto têm suporte apenas em filas e somente para o QUEUE_ACTIVATION *event_type*.</span><span class="sxs-lookup"><span data-stu-id="284f3-168">Note that currently, object-level events are supported only on queues, and only for the QUEUE_ACTIVATION *event_type*.</span></span>  
  
 <span data-ttu-id="284f3-169">Observe que nem todos os eventos podem ser consultados em qualquer escopo específico.</span><span class="sxs-lookup"><span data-stu-id="284f3-169">Note that not all events can be queried at any particular scope.</span></span> <span data-ttu-id="284f3-170">Por exemplo, uma consulta WQL em um evento de rastreamento, como Lock_Deadlock, ou um grupo de eventos de rastreamento, como TRC_LOCKS, podem ser registrado apenas no nível de servidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-170">For example, a WQL query on a trace event such as Lock_Deadlock, or a trace event group such as TRC_LOCKS, can only be registered at the server level.</span></span> <span data-ttu-id="284f3-171">De forma semelhante, o evento CREATE_ENDPOINT e o grupo de eventos DDL_ENDPOINT_EVENTS também podem ser registrados apenas no nível de servidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-171">Similarly, the CREATE_ENDPOINT event and the DDL_ENDPOINT_EVENTS event group can also be registered only at the server level.</span></span> <span data-ttu-id="284f3-172">Para obter mais informações sobre o escopo apropriado para o registro de eventos, consulte [criando notificações de eventos](https://technet.microsoft.com/library/ms175854\(v=sql.105\).aspx).</span><span class="sxs-lookup"><span data-stu-id="284f3-172">For more information about the appropriate scope for registering events, see [Designing Event Notifications](https://technet.microsoft.com/library/ms175854\(v=sql.105\).aspx).</span></span> <span data-ttu-id="284f3-173">Uma tentativa de registrar uma consulta WQL cujo *event_type* só pode ser registrado no nível do servidor sempre é feita no nível do servidor.</span><span class="sxs-lookup"><span data-stu-id="284f3-173">An attempt to register a WQL query whose *event_type* can only be registered at the server level is always made at the server level.</span></span> <span data-ttu-id="284f3-174">O registro terá êxito se o cliente WMI tiver as permissões.</span><span class="sxs-lookup"><span data-stu-id="284f3-174">Registration succeeds if the WMI client has permissions.</span></span> <span data-ttu-id="284f3-175">Caso contrário, será retornado um erro ao cliente.</span><span class="sxs-lookup"><span data-stu-id="284f3-175">Otherwise, an error is returned to the client.</span></span> <span data-ttu-id="284f3-176">Entretanto, em alguns casos, você ainda pode usar a cláusula WHERE como um filtro para eventos em nível de servidor com base nas propriedades que correspondem ao evento.</span><span class="sxs-lookup"><span data-stu-id="284f3-176">In some cases, however, you can still use the WHERE clause as a filter for server-level events based on the properties that correspond to the event.</span></span> <span data-ttu-id="284f3-177">Por exemplo, vários eventos de rastreamento têm uma propriedade `DatabaseName` que pode ser usada na cláusula WHERE como um filtro.</span><span class="sxs-lookup"><span data-stu-id="284f3-177">For example, many trace events have a `DatabaseName` property that can be used in the WHERE clause as a filter.</span></span>  
  
 <span data-ttu-id="284f3-178">As notificações de eventos no escopo do servidor são criadas no banco de dados **mestre** e podem ser consultadas quanto aos metadados usando a exibição do catálogo [Sys. server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="284f3-178">Server-scoped event notifications are created in the **master** database and can be queried for metadata by using the [sys.server_event_notifications](/sql/relational-databases/system-catalog-views/sys-server-event-notifications-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="284f3-179">As notificações de eventos no escopo do banco de dados ou no escopo do objeto são criadas no banco de dados especificado e podem ser consultadas para obter os metadados usando a exibição do catálogo [Sys. event_notifications](/sql/relational-databases/system-catalog-views/sys-event-notifications-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="284f3-179">Database-scoped or object-scoped event notifications are created in the specified database and can be queried for metadata by using the [sys.event_notifications](/sql/relational-databases/system-catalog-views/sys-event-notifications-transact-sql) catalog view.</span></span> <span data-ttu-id="284f3-180">(A exibição do catálogo deve ser prefixada com o nome do banco de dados correspondente.)</span><span class="sxs-lookup"><span data-stu-id="284f3-180">(You must prefix the catalog view with the corresponding database name.)</span></span>  
  
## <a name="examples"></a><span data-ttu-id="284f3-181">Exemplos</span><span class="sxs-lookup"><span data-stu-id="284f3-181">Examples</span></span>  
  
### <a name="a-querying-for-events-at-the-server-scope"></a><span data-ttu-id="284f3-182">a.</span><span class="sxs-lookup"><span data-stu-id="284f3-182">A.</span></span> <span data-ttu-id="284f3-183">Consultando eventos no escopo de servidor</span><span class="sxs-lookup"><span data-stu-id="284f3-183">Querying for events at the server scope</span></span>  
 <span data-ttu-id="284f3-184">A consulta WQL a seguir recupera todas as propriedades de evento de qualquer evento de rastreamento `SERVER_MEMORY_CHANGE` que ocorre na instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="284f3-184">The following WQL query retrieves all event properties for any `SERVER_MEMORY_CHANGE` trace event that occurs on the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
```  
SELECT * FROM SERVER_MEMORY_CHANGE  
```  
  
### <a name="b-querying-for-events-at-the-database-scope"></a><span data-ttu-id="284f3-185">B.</span><span class="sxs-lookup"><span data-stu-id="284f3-185">B.</span></span> <span data-ttu-id="284f3-186">Consultando eventos no escopo de banco de dados</span><span class="sxs-lookup"><span data-stu-id="284f3-186">Querying for events at the database scope</span></span>  
 <span data-ttu-id="284f3-187">A consulta WQL a seguir recupera propriedades de evento específicas de qualquer evento que ocorre no banco de dados `AdventureWorks` e existe que existe no grupo de eventos `DDL_DATABASE_LEVEL_EVENTS`.</span><span class="sxs-lookup"><span data-stu-id="284f3-187">The following WQL query retrieves specific event properties for any event that occurs in the `AdventureWorks` database and exists under the `DDL_DATABASE_LEVEL_EVENTS` event group.</span></span>  
  
```  
SELECT SPID, SQLInstance, DatabaseName FROM DDL_DATABASE_LEVEL_EVENTS   
WHERE DatabaseName = 'AdventureWorks'   
```  
  
### <a name="c-querying-for-events-at-the-database-scope-filtering-by-schema-and-object"></a><span data-ttu-id="284f3-188">C.</span><span class="sxs-lookup"><span data-stu-id="284f3-188">C.</span></span> <span data-ttu-id="284f3-189">Consultando eventos no escopo de banco de dados, filtrando por esquema e objeto</span><span class="sxs-lookup"><span data-stu-id="284f3-189">Querying for events at the database scope, filtering by schema and object</span></span>  
 <span data-ttu-id="284f3-190">A consulta a seguir recupera todas as propriedades de evento de qualquer evento `ALTER_TABLE` que ocorre na tabela `AdventureWorks.Sales.SalesOrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="284f3-190">The following query retrieves all event properties for any `ALTER_TABLE` event that occurs on table `AdventureWorks.Sales.SalesOrderDetail`.</span></span>  
  
```  
SELECT * FROM ALTER_TABLE   
WHERE DatabaseName = 'AdventureWorks' AND SchemaName = 'Sales'   
    AND ObjectType='Table' AND ObjectName = 'SalesOrderDetail'  
```  
  
## <a name="see-also"></a><span data-ttu-id="284f3-191">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="284f3-191">See Also</span></span>  
 <span data-ttu-id="284f3-192">[Provedor WMI para conceitos de eventos de servidor](https://technet.microsoft.com/library/ms180560.aspx) </span><span class="sxs-lookup"><span data-stu-id="284f3-192">[WMI Provider for Server Events Concepts](https://technet.microsoft.com/library/ms180560.aspx) </span></span>  
 [<span data-ttu-id="284f3-193">Notificações de eventos (Mecanismo de Banco de Dados)</span><span class="sxs-lookup"><span data-stu-id="284f3-193">Event Notifications (Database Engine)</span></span>](https://technet.microsoft.com/library/ms182602.aspx)  
  
  
