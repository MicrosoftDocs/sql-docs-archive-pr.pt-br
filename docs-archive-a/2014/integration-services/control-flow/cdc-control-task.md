---
title: Tarefa Controle CDC | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.ssis.designer.cdccontroltask.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 36f98a02842353fd5196432738f4ebd8b2efb46c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87573241"
---
# <a name="cdc-control-task"></a><span data-ttu-id="43c35-102">Tarefa Controle de CDC</span><span class="sxs-lookup"><span data-stu-id="43c35-102">CDC Control Task</span></span>
  <span data-ttu-id="43c35-103">A tarefa Controle de CDC é usada para controlar o ciclo de vida de pacotes de captura de dados de alterações (CDC).</span><span class="sxs-lookup"><span data-stu-id="43c35-103">The CDC Control task is used to control the life cycle of change data capture (CDC) packages.</span></span> <span data-ttu-id="43c35-104">Ela trata a sincronização de pacotes CDC com o pacote de carga inicial e o gerenciamento de intervalos de LSN (número de sequência de log) processados na execução de um pacote CDC.</span><span class="sxs-lookup"><span data-stu-id="43c35-104">It handles CDC package synchronization with the initial load package, the management of Log Sequence Number (LSN) ranges that are processed in a run of a CDC package.</span></span> <span data-ttu-id="43c35-105">Além disso, a tarefa Controle de CDC lida com cenários de erro e recuperação.</span><span class="sxs-lookup"><span data-stu-id="43c35-105">In addition, the CDC Control task deals with error scenarios and recovery.</span></span>  
  
 <span data-ttu-id="43c35-106">A tarefa Controle de CDC mantém o estado do pacote CDC em uma variável de pacote SSIS e também pode persisti-lo em uma tabela de banco de dados para que o estado seja mantido nas ativações de pacote e entre vários pacotes que juntos executam um processo CDC comum (por exemplo, uma tarefa pode ser responsável pelo carregamento inicial e a outra pelas atualizações trickle-feed).</span><span class="sxs-lookup"><span data-stu-id="43c35-106">The CDC Control task maintains the state of the CDC package in an SSIS package variable and it can also persist it in a database table so that the state is maintained across package activations and between multiple packages that together perform a common CDC process (for example, one task may be responsible for the initial loading and the other for the trickle-feed updates).</span></span>  
  
 <span data-ttu-id="43c35-107">A tarefa Controle de CDC oferece suporte a dois grupos de operações.</span><span class="sxs-lookup"><span data-stu-id="43c35-107">The CDC Control task supports two groups of operations.</span></span> <span data-ttu-id="43c35-108">Um grupo trata a sincronização de carga inicial e processamento de alteração e o outro gerencia o intervalo do processamento de alteração de LSNs para uma execução de um pacote CDC e acompanha o que foi processada com êxito.</span><span class="sxs-lookup"><span data-stu-id="43c35-108">One group handles the synchronization of initial load and change processing, and the other manages the change-processing range of LSNs for a run of a CDC package and keeps track of what was processed successfully.</span></span>  
  
 <span data-ttu-id="43c35-109">As operações seguintes tratam a sincronização da carga inicial e o processamento de alteração:</span><span class="sxs-lookup"><span data-stu-id="43c35-109">The following operations handle the synchronization of initial load and change processing:</span></span>  
  
|<span data-ttu-id="43c35-110">Operação</span><span class="sxs-lookup"><span data-stu-id="43c35-110">Operation</span></span>|<span data-ttu-id="43c35-111">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="43c35-111">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="43c35-112">ResetCdcState</span><span class="sxs-lookup"><span data-stu-id="43c35-112">ResetCdcState</span></span>|<span data-ttu-id="43c35-113">Esta operação é usada para reiniciar o estado de CDC persistente associado ao contexto de CDC atual.</span><span class="sxs-lookup"><span data-stu-id="43c35-113">This operation is used to reset the persistent CDC state associated with the current CDC context.</span></span> <span data-ttu-id="43c35-114">Depois que esta operação é executada, o LSN máximo atual da tabela `sys.fn_cdc_get_max_lsn` do carimbo de data/hora de LSN torna-se o início do intervalo para o próximo intervalo de processamento.</span><span class="sxs-lookup"><span data-stu-id="43c35-114">After this operation is run, the current maximum LSN from the LSN-timestamp `sys.fn_cdc_get_max_lsn` table becomes the start of the range for the next processing range.</span></span> <span data-ttu-id="43c35-115">Esta operação exige uma conexão com o banco de dados de origem.</span><span class="sxs-lookup"><span data-stu-id="43c35-115">This operation requires a connection to the source database.</span></span>|  
|<span data-ttu-id="43c35-116">MarkInitialLoadStart</span><span class="sxs-lookup"><span data-stu-id="43c35-116">MarkInitialLoadStart</span></span>|<span data-ttu-id="43c35-117">Esta operação é usada no começo de um pacote da carga inicial para registrar o LSN atual no banco de dados de origem antes de o pacote da carga inicial começar a ler as tabelas de origem.</span><span class="sxs-lookup"><span data-stu-id="43c35-117">This operation is used at the beginning of an initial-load package to record the current LSN in the source database before the initial-load package starts reading the source tables.</span></span> <span data-ttu-id="43c35-118">Isso exige uma conexão com o banco de dados de origem para chamar `sys.fn_cdc_get_max_lsn`.</span><span class="sxs-lookup"><span data-stu-id="43c35-118">This requires a connection to the source database to call `sys.fn_cdc_get_max_lsn`.</span></span><br /><br /> <span data-ttu-id="43c35-119">Se você selecionar MarkInitialLoadStart ao trabalhar no [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (ou seja, não Oracle), o usuário especificado no gerenciador de conexões deverá ser db_owner ou sysadmin.</span><span class="sxs-lookup"><span data-stu-id="43c35-119">If you select MarkInitialLoadStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is, not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="43c35-120">MarkInitialLoadEnd</span><span class="sxs-lookup"><span data-stu-id="43c35-120">MarkInitialLoadEnd</span></span>|<span data-ttu-id="43c35-121">A operação é usada no início de um pacote da carga inicial para registrar o LSN atual no banco de dados de origem depois de o pacote da carga inicial terminar de ler as tabelas de origem.</span><span class="sxs-lookup"><span data-stu-id="43c35-121">This operation is used at the end of an initial-load package to record the current LSN in the source database after the initial-load package finished reading the source tables.</span></span> <span data-ttu-id="43c35-122">Este LSN é determinado pela gravação da hora atual quando esta operação ocorreu e, em seguida, consultando a tabela de mapeamento `cdc.lsn_time_`no banco de dados CDC, procurando uma alteração que ocorreu depois daquele momento</span><span class="sxs-lookup"><span data-stu-id="43c35-122">This LSN is determined by recording the current time when this operation occurred and then querying the `cdc.lsn_time_`mapping table in the CDC database looking for a change that occurred after that time.</span></span><br /><br /> <span data-ttu-id="43c35-123">Se você selecionar MarkInitialLoadEnd ao trabalhar no [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (ou seja, não Oracle), o usuário especificado no gerenciador de conexões deverá ser db_owner ou sysadmin.</span><span class="sxs-lookup"><span data-stu-id="43c35-123">If you select MarkInitialLoadEnd when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="43c35-124">MarkCdcStart</span><span class="sxs-lookup"><span data-stu-id="43c35-124">MarkCdcStart</span></span>|<span data-ttu-id="43c35-125">Esta operação é usada quando a carga inicial é feita de um banco de dados de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="43c35-125">This operation is used when then the initial load is made from a snapshot database.</span></span> <span data-ttu-id="43c35-126">Nesse caso, o processamento de alteração deve ser iniciado imediatamente depois do LSN do instantâneo.</span><span class="sxs-lookup"><span data-stu-id="43c35-126">In this case, the change processing should start immediately after the snapshot LSN.</span></span> <span data-ttu-id="43c35-127">Você pode especificar o nome do banco de dados de instantâneo a ser usado e a tarefa Controle de CDC consulta o [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] para obter o LSN de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="43c35-127">You can specify the name of the snapshot database to use and the CDC Control task queries [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] for the snapshot LSN.</span></span> <span data-ttu-id="43c35-128">Você também tem a opção de especificar diretamente o LSN de instantâneo.</span><span class="sxs-lookup"><span data-stu-id="43c35-128">You also have the option to directly specify the snapshot LSN.</span></span><br /><br /> <span data-ttu-id="43c35-129">Se você selecionar MarkCdcStart ao trabalhar no [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (ou seja, não Oracle), o usuário especificado no gerenciador de conexões deverá ser db_owner ou sysadmin.</span><span class="sxs-lookup"><span data-stu-id="43c35-129">If you select MarkCdcStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
  
 <span data-ttu-id="43c35-130">As operações seguintes são usadas para gerenciar o intervalo de processamento:</span><span class="sxs-lookup"><span data-stu-id="43c35-130">The following operations are used to manage the processing range:</span></span>  
  
|<span data-ttu-id="43c35-131">Operação</span><span class="sxs-lookup"><span data-stu-id="43c35-131">Operation</span></span>|<span data-ttu-id="43c35-132">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="43c35-132">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="43c35-133">GetProcessingRange</span><span class="sxs-lookup"><span data-stu-id="43c35-133">GetProcessingRange</span></span>|<span data-ttu-id="43c35-134">Esta operação é usada antes da chamada ao fluxo de dados que usa o fluxo de dados de Origem CDC.</span><span class="sxs-lookup"><span data-stu-id="43c35-134">This operation is used before invoking the data flow that uses the CDC Source data flow.</span></span> <span data-ttu-id="43c35-135">Ele estabelece um intervalo de LSNs que o fluxo de dados de origem de CDC lê quando é invocado.</span><span class="sxs-lookup"><span data-stu-id="43c35-135">It establishes a range of LSNs that the CDC Source data flow reads when invoked.</span></span> <span data-ttu-id="43c35-136">O intervalo é armazenado em uma variável de pacote SSIS que é usada pela Origem de CDC durante o processamento de fluxo de dados.</span><span class="sxs-lookup"><span data-stu-id="43c35-136">The range is stored in an SSIS package variable that is used by the CDC Source during data-flow processing.</span></span><br /><br /> <span data-ttu-id="43c35-137">Para obter mais informações sobre os armazenados, consulte [Definir uma variável de estado](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="43c35-137">For more information about the states that are stored, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>|  
|<span data-ttu-id="43c35-138">MarkProcessedRange</span><span class="sxs-lookup"><span data-stu-id="43c35-138">MarkProcessedRange</span></span>|<span data-ttu-id="43c35-139">: Esta operação é executada depois de cada execução de CDC (depois que o fluxo de dados de CDC é concluído com êxito) para registrar o último LSN que foi processado completamente na execução de CDC.</span><span class="sxs-lookup"><span data-stu-id="43c35-139">: This operation is executed after each CDC run (after the CDC data flow is completed successfully) to record the last LSN that was fully processed in the CDC run.</span></span> <span data-ttu-id="43c35-140">Da próxima vez que o GetProcessingRange for executado, essa posição será o início do intervalo de processamento.</span><span class="sxs-lookup"><span data-stu-id="43c35-140">The next time GetProcessingRange is executed, this position is the start of the processing range.</span></span>|  
  
## <a name="handling-cdc-state-persistency"></a><span data-ttu-id="43c35-141">Lidando com a persistência de estado CDC</span><span class="sxs-lookup"><span data-stu-id="43c35-141">Handling CDC State Persistency</span></span>  
 <span data-ttu-id="43c35-142">A tarefa Controle de CDC mantém um estado persistente entre ativações.</span><span class="sxs-lookup"><span data-stu-id="43c35-142">The CDC Control task maintains a persistent state between activations.</span></span> <span data-ttu-id="43c35-143">As informações armazenadas no estado CDC são usadas para determinar e manter o intervalo de processamento do pacote CDC e para detectar condições de erro.</span><span class="sxs-lookup"><span data-stu-id="43c35-143">The information stored in the CDC state is used to determine and maintain the processing range for the CDC package and for detecting error conditions.</span></span> <span data-ttu-id="43c35-144">O estado persistente é armazenado como uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="43c35-144">The persistent state is stored as a string.</span></span> <span data-ttu-id="43c35-145">Para obter mais informações, consulte [Definir uma variável de estado](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="43c35-145">For more information, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>  
  
 <span data-ttu-id="43c35-146">A tarefa Controle de CDC oferece suporte a dois tipos de persistência de estado</span><span class="sxs-lookup"><span data-stu-id="43c35-146">The CDC Control task supports two types of state persistency</span></span>  
  
-   <span data-ttu-id="43c35-147">Persistência de Estado Manual: nesse caso, a tarefa Controle de CDC gerencia o estado armazenado em uma variável de pacote, mas o desenvolvedor do pacote deve ler a variável de um repositório persistente antes de chamar o Controle de CDC e depois gravá-lo nesse repositório persistente após o Controle de CDC ser chamado pela última vez e a execução do CDC for concluída.</span><span class="sxs-lookup"><span data-stu-id="43c35-147">Manual State Persistency: In this case, the CDC Control task manages the state stored in a package variable but the package developer must read the variable from a persistent store before calling the CDC Control and then write it back to that persistent store after the CDC Control is last called and the CDC run completes.</span></span>  
  
-   <span data-ttu-id="43c35-148">Persistência de Estado Automática: o estado CDC é armazenado em uma tabela em um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="43c35-148">Automatic State Persistency: The CDC state is stored in a table in a database.</span></span> <span data-ttu-id="43c35-149">O estado é armazenado com um nome fornecido na propriedade **StateName** em uma tabela nomeada na propriedade **Tabela a Ser Usada para Armazenar o Estado** , localizada em um gerenciador de conexões selecionado para armazenar o estado.</span><span class="sxs-lookup"><span data-stu-id="43c35-149">The state is stored under a name provided in the **StateName** property in a table named in the **Table to Use for Storing State** property, which is located in a selected connection manager for storing the state.</span></span> <span data-ttu-id="43c35-150">O padrão é o gerenciador de conexões de origem, mas a prática comum é usar o gerenciador de conexões de destino.</span><span class="sxs-lookup"><span data-stu-id="43c35-150">The default is the source connection manager but the common practice is for it to be the target connection manager.</span></span> <span data-ttu-id="43c35-151">A tarefa Controle de CDC atualiza o valor do estado na tabela de estado e isso é confirmado como parte da transação de ambiente.</span><span class="sxs-lookup"><span data-stu-id="43c35-151">The CDC Control task updates the state value in the state table and this is committed as part of the ambient transaction.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="43c35-152">Tratamento de erros</span><span class="sxs-lookup"><span data-stu-id="43c35-152">Error Handling</span></span>  
 <span data-ttu-id="43c35-153">A tarefa Controle de CDC pode relatar um erro quando:</span><span class="sxs-lookup"><span data-stu-id="43c35-153">The CDC Control task may report an error when:</span></span>  
  
-   <span data-ttu-id="43c35-154">Não lê o estado persistente do CDC ou ao quando a atualização do estado persistente falha.</span><span class="sxs-lookup"><span data-stu-id="43c35-154">It fails to read the persistent CDC state or when updating the persistent state fails.</span></span>  
  
-   <span data-ttu-id="43c35-155">Não lê as informações de LSN atuais do banco de dados de origem.</span><span class="sxs-lookup"><span data-stu-id="43c35-155">It fails to read the current LSN information from the source database.</span></span>  
  
-   <span data-ttu-id="43c35-156">O estado CDC lido não é consistente.</span><span class="sxs-lookup"><span data-stu-id="43c35-156">The CDC state read is not consistent.</span></span>  
  
 <span data-ttu-id="43c35-157">Em todos esses casos, a tarefa Controle de CDC relata um erro que pode ser tratado do modo padrão como o SSIS trata erros de fluxo de controle.</span><span class="sxs-lookup"><span data-stu-id="43c35-157">In all of these cases, the CDC Control task reports an error that can be handled in the standard way SSIS handles control-flow errors.</span></span>  
  
 <span data-ttu-id="43c35-158">A tarefa Controle de CDC também pode relatar um aviso quando a operação Obter Intervalo de Processamento é chamada diretamente depois de outra operação do mesmo tipo sem que Marcar Intervalo Processado seja chamada.</span><span class="sxs-lookup"><span data-stu-id="43c35-158">The CDC Control task may also report a warning when the Get Processing Range operation is invoked directly after another Get Processing Range operation without Mark Processed Range being called.</span></span> <span data-ttu-id="43c35-159">Essa é uma indicação de que a execução anterior falhou ou que outro pacote CDC pode estar sendo executado com o mesmo nome do estado CDC.</span><span class="sxs-lookup"><span data-stu-id="43c35-159">This is an indication that the previous run failed or that another CDC package may be running using the same CDC state name.</span></span>  
  
## <a name="configuring-the-cdc-control-task"></a><span data-ttu-id="43c35-160">Configurando a tarefa Controle de CDC</span><span class="sxs-lookup"><span data-stu-id="43c35-160">Configuring the CDC Control Task</span></span>  
 <span data-ttu-id="43c35-161">Você pode definir as propriedades por meio do Designer SSIS ou programaticamente.</span><span class="sxs-lookup"><span data-stu-id="43c35-161">You can set properties through SSIS Designer or programmatically.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="43c35-162">Nesta seção</span><span class="sxs-lookup"><span data-stu-id="43c35-162">In This Section</span></span>  
  
-   [<span data-ttu-id="43c35-163">Editor da Tarefa Controle de CDC</span><span class="sxs-lookup"><span data-stu-id="43c35-163">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
-   [<span data-ttu-id="43c35-164">Propriedades personalizadas da tarefa Controle de CDC</span><span class="sxs-lookup"><span data-stu-id="43c35-164">CDC Control Task Custom Properties</span></span>](cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="43c35-165">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="43c35-165">Related Tasks</span></span>  
 [<span data-ttu-id="43c35-166">Definir uma variável de estado</span><span class="sxs-lookup"><span data-stu-id="43c35-166">Define a State Variable</span></span>](../data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a><span data-ttu-id="43c35-167">Conteúdo relacionado</span><span class="sxs-lookup"><span data-stu-id="43c35-167">Related Content</span></span>  
  
-   <span data-ttu-id="43c35-168">Artigo técnico [Instalando o Change Data Capture do Microsoft SQL Server 2012 para Oracle da Attunity](https://go.microsoft.com/fwlink/?LinkId=252958)em social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="43c35-168">Technical article, [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="43c35-169">Artigo técnico [Solucionando problemas de configuração do Microsoft Change Data Capture para Oracle da Attunity](https://go.microsoft.com/fwlink/?LinkId=252960)em social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="43c35-169">Technical article, [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="43c35-170">Artigo técnico [Solucionando erros de instância CDC no Microsoft Change Data Capture para Oracle da Attunity](https://go.microsoft.com/fwlink/?LinkId=252961)em social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="43c35-170">Technical article, [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), on social.technet.microsoft.com.</span></span>  
  
  
