---
title: Loop através de arquivos e tabelas do Excel por meio de um contêiner do Loop Foreach | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- connections [Integration Services], Excel
- Excel [Integration Services]
- connection managers [Integration Services], Excel
ms.assetid: a5393c1a-cc37-491a-a260-7aad84dbff68
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 51de779b6869d80245302741035e6169aa750c83
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87572627"
---
# <a name="loop-through-excel-files-and-tables-by-using-a-foreach-loop-container"></a><span data-ttu-id="05744-102">Loop por meio de arquivos do Excel e tabelas usando um contêiner de Loop Foreach</span><span class="sxs-lookup"><span data-stu-id="05744-102">Loop through Excel Files and Tables by Using a Foreach Loop Container</span></span>
  <span data-ttu-id="05744-103">Os procedimentos neste tópico descrevem como criar um loop através de pastas de trabalho do Excel ou através de tabelas em uma pasta de trabalho do Excel, usando o contêiner Loop Foreach com o enumerador apropriado.</span><span class="sxs-lookup"><span data-stu-id="05744-103">The procedures in this topic describe how to loop through the Excel workbooks in a folder, or through the tables in an Excel workbook, by using the Foreach Loop container with the appropriate enumerator.</span></span>  
  
### <a name="to-loop-through-excel-files-by-using-the-foreach-file-enumerator"></a><span data-ttu-id="05744-104">Para criar um loop através de arquivos do Excel usando o enumerador de Arquivo Foreach</span><span class="sxs-lookup"><span data-stu-id="05744-104">To loop through Excel files by using the Foreach File enumerator</span></span>  
  
1.  <span data-ttu-id="05744-105">Crie uma variável de cadeia que receberá o caminho atual do Excel e nome de arquivo em cada iteração do loop.</span><span class="sxs-lookup"><span data-stu-id="05744-105">Create a string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="05744-106">Para evitar problemas de validação, atribua um caminho de Excel válido e um nome de arquivo como o valor inicial da variável.</span><span class="sxs-lookup"><span data-stu-id="05744-106">To avoid validation issues, assign a valid Excel path and file name as the initial value of the variable.</span></span> <span data-ttu-id="05744-107">(A expressão de amostra exibida mais adiante neste procedimento usa o nome da variável, `ExcelFile`.)</span><span class="sxs-lookup"><span data-stu-id="05744-107">(The sample expression shown later in this procedure uses the variable name, `ExcelFile`.)</span></span>  
  
2.  <span data-ttu-id="05744-108">Como alternativa, crie outra variável de cadeia que irá conter o valor do argumento Propriedades Estendidas da cadeia de conexão do Excel.</span><span class="sxs-lookup"><span data-stu-id="05744-108">Optionally, create another string variable that will hold the value for the Extended Properties argument of the Excel connection string.</span></span> <span data-ttu-id="05744-109">Este argumento contém uma série de valores que especificam a versão do Excel, determinam se a primeira linha contém nomes de coluna e se o modo de importação é usado.</span><span class="sxs-lookup"><span data-stu-id="05744-109">This argument contains a series of values that specify the Excel version and determine whether the first row contains column names, and whether import mode is used.</span></span> <span data-ttu-id="05744-110">(A expressão de amostra exibida mais adiante neste procedimento usa o nome de variável `ExtProperties`, com um valor inicial de “`Excel 8.0;HDR=Yes`”.)</span><span class="sxs-lookup"><span data-stu-id="05744-110">(The sample expression shown later in this procedure uses the variable name `ExtProperties`, with an initial value of "`Excel 8.0;HDR=Yes`".)</span></span>  
  
     <span data-ttu-id="05744-111">Se você não usar uma variável para o argumento Propriedades Estendidas, adicione-a manualmente à expressão que contém a cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="05744-111">If you do not use a variable for the Extended Properties argument, then you must add it manually to the expression that contains the connection string.</span></span>  
  
3.  <span data-ttu-id="05744-112">Adicione um contêiner Loop Foreach à guia **fluxo de controle** . Para obter informações sobre como configurar o contêiner Loop Foreach, consulte [configurar um contêiner Loop Foreach](foreach-loop-container.md).</span><span class="sxs-lookup"><span data-stu-id="05744-112">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop Container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="05744-113">Na página **Coleção** do **Editor de Loop Foreach**, selecione o enumerador de Arquivo Foreach, especifique a pasta na qual as pastas de trabalho do Excel ficam situadas e especifique o filtro de arquivo (geralmente \*.xls).</span><span class="sxs-lookup"><span data-stu-id="05744-113">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach File enumerator, specify the folder in which the Excel workbooks are located, and specify the file filter (ordinarily \*.xls).</span></span>  
  
5.  <span data-ttu-id="05744-114">Na página **Mapeamento de Variáveis** , mapeie Index 0 para uma variável de cadeia definida pelo usuário que receberá o caminho atual do Excel e o nome de arquivo em cada iteração do loop.</span><span class="sxs-lookup"><span data-stu-id="05744-114">On the **Variable Mapping** page, map Index 0 to a user-defined string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="05744-115">(A expressão de amostra exibida mais adiante neste procedimento usa o nome da variável `ExcelFile`.)</span><span class="sxs-lookup"><span data-stu-id="05744-115">(The sample expression shown later in this procedure uses the variable name `ExcelFile`.)</span></span>  
  
6.  <span data-ttu-id="05744-116">Feche o **Editor de Loop Foreach**.</span><span class="sxs-lookup"><span data-stu-id="05744-116">Close the **Foreach Loop Editor**.</span></span>  
  
7.  <span data-ttu-id="05744-117">Adicione um gerenciador de conexões do Excel para o pacote conforme descrito em [Adicionar, excluir ou compartilhar um Gerenciador de Conexões em um pacote](../add-delete-or-share-a-connection-manager-in-a-package.md).</span><span class="sxs-lookup"><span data-stu-id="05744-117">Add an Excel connection manager to the package as described in [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span> <span data-ttu-id="05744-118">Selecione uma pasta de trabalho existente do Excel para a conexão para evitar erros de validação.</span><span class="sxs-lookup"><span data-stu-id="05744-118">Select an existing Excel workbook file for the connection to avoid validation errors.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="05744-119">Para evitar erros de validação conforme você configura tarefas e componentes de fluxo de dados que usam esse gerenciador de conexões do Excel, selecione uma pasta de trabalho existente do Excel no **Editor do Gerenciador de Conexões do Excel**.</span><span class="sxs-lookup"><span data-stu-id="05744-119">To avoid validation errors as you configure tasks and data flow components that use this Excel connection manager, select an existing Excel workbook in the **Excel Connection Manager Editor**.</span></span> <span data-ttu-id="05744-120">O gerenciador de conexões não usará esta pasta de trabalho em tempo de execução depois que você configurar uma expressão para a propriedade `ConnectionString` conforme descrito nas etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="05744-120">The connection manager will not use this workbook at run time after you configure an expression for the `ConnectionString` property as described in the following steps.</span></span> <span data-ttu-id="05744-121">Após criar e configurar o pacote, você pode limpar o valor da propriedade `ConnectionString` na janela Propriedades.</span><span class="sxs-lookup"><span data-stu-id="05744-121">After you create and configure the package, you can clear the value of the `ConnectionString` property in the Properties window.</span></span> <span data-ttu-id="05744-122">No entanto, se você limpar esse valor, a propriedade da cadeia de conexão do gerenciador de conexões do Excel não será mais válida até que Loop Foreach seja executado.</span><span class="sxs-lookup"><span data-stu-id="05744-122">However, if you clear this value, the connection string property of the Excel connection manager is no longer valid until the Foreach Loop runs.</span></span> <span data-ttu-id="05744-123">Portanto você deve definir a propriedade `DelayValidation` como `True` nas tarefas ou no pacote em que o gerenciador de conexões é usado para evitar erros de validação.</span><span class="sxs-lookup"><span data-stu-id="05744-123">Therefore you must set the `DelayValidation` property to `True` on the tasks in which the connection manager is used, or on the package, to avoid validation errors.</span></span>  
    >   
    >  <span data-ttu-id="05744-124">Você também deve usar o valor padrão de `False` para a propriedade `RetainSameConnection` do gerenciador de conexões do Excel.</span><span class="sxs-lookup"><span data-stu-id="05744-124">You must also use the default value of `False` for the `RetainSameConnection` property of the Excel connection manager.</span></span> <span data-ttu-id="05744-125">Se você alterar esse valor para `True`, cada iteração do loop continuará a abrir a primeira pasta de trabalho do Excel.</span><span class="sxs-lookup"><span data-stu-id="05744-125">If you change this value to `True`, each iteration of the loop will continue to open the first Excel workbook.</span></span>  
  
8.  <span data-ttu-id="05744-126">Selecione o novo gerenciador de conexões do Excel, clique na propriedade **Expressões** na janela Propriedades e clique nas reticências.</span><span class="sxs-lookup"><span data-stu-id="05744-126">Select the new Excel connection manager, click the **Expressions** property in the Properties window, and then click the ellipsis.</span></span>  
  
9. <span data-ttu-id="05744-127">No **Editor de expressões de propriedade**, selecione a `ConnectionString` propriedade e clique nas reticências.</span><span class="sxs-lookup"><span data-stu-id="05744-127">In the **Property Expressions Editor**, select the `ConnectionString` property, and then click the ellipsis.</span></span>  
  
10. <span data-ttu-id="05744-128">No Construtor de Expressões, digite a expressão a seguir:</span><span class="sxs-lookup"><span data-stu-id="05744-128">In the Expression Builder, enter the following expression:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=\"" + @[User::ExtProperties] + "\""  
    ```  
  
     <span data-ttu-id="05744-129">Observe o uso do caractere de escape "\\" para não ter que usar as aspas exigidas no valor do argumento Propriedades Estendidas.</span><span class="sxs-lookup"><span data-stu-id="05744-129">Note the use of the escape character "\\" to escape the inner quotation marks required around the value of the Extended Properties argument.</span></span>  
  
     <span data-ttu-id="05744-130">O argumento Propriedades Estendidas não é opcional.</span><span class="sxs-lookup"><span data-stu-id="05744-130">The Extended Properties argument is not optional.</span></span> <span data-ttu-id="05744-131">Se você não usar uma variável para conter seu valor, adicione-a manualmente à expressão, como neste exemplo de um arquivo do Excel 2003:</span><span class="sxs-lookup"><span data-stu-id="05744-131">If you do not use a variable to contain its value, then you must add it manually to the expression, as in the following example for an Excel 2003 file:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=Excel 8.0"  
    ```  
  
11. <span data-ttu-id="05744-132">Crie tarefas no contêiner Loop Foreach que usam o gerenciador de conexões do Excel para executar as mesmas operações em cada pasta de trabalho do Excel que corresponde ao local e padrão de arquivo especificado.</span><span class="sxs-lookup"><span data-stu-id="05744-132">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel workbook that matches the specified file location and pattern.</span></span>  
  
### <a name="to-loop-through-excel-tables-by-using-the-foreach-adonet-schema-rowset-enumerator"></a><span data-ttu-id="05744-133">Para criar um loop através de tabelas do Excel usando o enumerador de Conjunto de Linhas de Esquema ADO.NET Foreach</span><span class="sxs-lookup"><span data-stu-id="05744-133">To loop through Excel tables by using the Foreach ADO.NET Schema Rowset enumerator</span></span>  
  
1.  <span data-ttu-id="05744-134">Crie um gerenciador de conexões ADO.NET que use o provedor OLE DB do Microsoft Jet para se conectar a uma pasta de trabalho do Excel.</span><span class="sxs-lookup"><span data-stu-id="05744-134">Create an ADO.NET connection manager that uses the Microsoft Jet OLE DB Provider to connect to an Excel workbook.</span></span> <span data-ttu-id="05744-135">Na página Tudo da caixa de diálogo **Gerenciador de Conexões** , insira o Excel 8.0 como o valor da propriedade Propriedades Estendidas.</span><span class="sxs-lookup"><span data-stu-id="05744-135">On the All page of the **Connection Manager** dialog box, make sure that you enter Excel 8.0 as the value of the Extended Properties property.</span></span> <span data-ttu-id="05744-136">Para obter mais informações, consulte [adicionar, excluir ou compartilhar um Gerenciador de Conexão em um pacote](../add-delete-or-share-a-connection-manager-in-a-package.md).</span><span class="sxs-lookup"><span data-stu-id="05744-136">For more information, see [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span>  
  
2.  <span data-ttu-id="05744-137">Crie uma variável de cadeia que receberá o nome da tabela atual em cada iteração do loop.</span><span class="sxs-lookup"><span data-stu-id="05744-137">Create a string variable that will receive the name of the current table on each iteration of the loop.</span></span>  
  
3.  <span data-ttu-id="05744-138">Adicione um contêiner Loop Foreach à guia **fluxo de controle** . Para obter informações sobre como configurar o contêiner Loop Foreach, consulte [configurar um contêiner Loop Foreach](foreach-loop-container.md).</span><span class="sxs-lookup"><span data-stu-id="05744-138">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="05744-139">Na página **Coleção** do **Editor de Loop Foreach**, selecione o Enumerador de Conjunto de Linhas de Esquema ADO.NET Foreach.</span><span class="sxs-lookup"><span data-stu-id="05744-139">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach ADO.NET Schema Rowset enumerator.</span></span>  
  
5.  <span data-ttu-id="05744-140">Como valor de **Conexão**, selecione o gerenciador de conexões ADO.NET que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="05744-140">As the value of **Connection**, select the ADO.NET connection manager that you created previously.</span></span>  
  
6.  <span data-ttu-id="05744-141">Como valor de **Esquema**, selecione Tabelas.</span><span class="sxs-lookup"><span data-stu-id="05744-141">As the value of **Schema**, select Tables.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="05744-142">A lista de tabelas em uma pasta de trabalho do Excel inclui planilhas (que têm o sufixo $) e intervalos nomeados.</span><span class="sxs-lookup"><span data-stu-id="05744-142">The list of tables in an Excel workbook includes both worksheets (which have the $ suffix) and named ranges.</span></span> <span data-ttu-id="05744-143">Se você tiver que filtrar a lista para apenas planilhas ou apenas intervalos nomeados, talvez seja necessário gravar o código personalizado em uma tarefa Script para essa finalidade.</span><span class="sxs-lookup"><span data-stu-id="05744-143">If you have to filter the list for only worksheets or only named ranges, you may have to write custom code in a Script task for this purpose.</span></span> <span data-ttu-id="05744-144">Para obter mais informações, consulte [Trabalhando com arquivos do Excel com a tarefa Script](script-task.md).</span><span class="sxs-lookup"><span data-stu-id="05744-144">For more information, see [Working with Excel Files with the Script Task](script-task.md).</span></span>  
  
7.  <span data-ttu-id="05744-145">Na página **Mapeamentos de Variáveis** , mapeie Index 2 para a variável de cadeia criada anteriormente para manter o nome da tabela atual.</span><span class="sxs-lookup"><span data-stu-id="05744-145">On the **Variable Mappings** page, map Index 2 to the string variable created earlier to hold the name of the current table.</span></span>  
  
8.  <span data-ttu-id="05744-146">Feche o **Editor de Loop Foreach**.</span><span class="sxs-lookup"><span data-stu-id="05744-146">Close the **Foreach Loop Editor**.</span></span>  
  
9. <span data-ttu-id="05744-147">Crie tarefas no contêiner Loop Foreach que usam o gerenciador de conexões do Excel para executar as mesmas operações em cada tabela do Excel na pasta de trabalho especificada.</span><span class="sxs-lookup"><span data-stu-id="05744-147">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel table in the specified workbook.</span></span> <span data-ttu-id="05744-148">Se você usar uma tarefa Script para examinar o nome de tabela enumerado ou para trabalhar com tabelas individualmente, lembre-se de adicionar a variável de cadeia à propriedade ReadOnlyVariables da tarefa Script.</span><span class="sxs-lookup"><span data-stu-id="05744-148">If you use a Script Task to examine the enumerated table name or to work with each table, remember to add the string variable to the ReadOnlyVariables property of the Script task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="05744-149">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="05744-149">See Also</span></span>  
 <span data-ttu-id="05744-150">[Importar dados do Excel ou exportar dados para o Excel com SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [configurar um contêiner Loop Foreach](foreach-loop-container.md) </span><span class="sxs-lookup"><span data-stu-id="05744-150">[Import data from Excel or export data to Excel with SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [Configure a Foreach Loop Container](foreach-loop-container.md) </span></span>  
 <span data-ttu-id="05744-151">[Adicionar ou alterar uma expressão de propriedade](../expressions/add-or-change-a-property-expression.md) </span><span class="sxs-lookup"><span data-stu-id="05744-151">[Add or Change a Property Expression](../expressions/add-or-change-a-property-expression.md) </span></span>  
 <span data-ttu-id="05744-152">[Gerenciador de conexões do Excel](../connection-manager/excel-connection-manager.md) </span><span class="sxs-lookup"><span data-stu-id="05744-152">[Excel Connection Manager](../connection-manager/excel-connection-manager.md) </span></span>  
 <span data-ttu-id="05744-153">[Origem do Excel](../data-flow/excel-source.md) </span><span class="sxs-lookup"><span data-stu-id="05744-153">[Excel Source](../data-flow/excel-source.md) </span></span>  
 <span data-ttu-id="05744-154">[Destino do Excel](../data-flow/excel-destination.md) </span><span class="sxs-lookup"><span data-stu-id="05744-154">[Excel Destination](../data-flow/excel-destination.md) </span></span>  
 [<span data-ttu-id="05744-155">Trabalhar com arquivos do Excel com a tarefa Script</span><span class="sxs-lookup"><span data-stu-id="05744-155">Working with Excel Files with the Script Task</span></span>](script-task.md)  
  
  
