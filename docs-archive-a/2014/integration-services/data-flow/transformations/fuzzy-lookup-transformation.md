---
title: Transformação Pesquisa Difusa | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.dts.designer.fuzzylookuptrans.f1
helpviewer_keywords:
- cleaning data
- comparing data
- token delimiters [Integration Services]
- temporary indexes [Integration Services]
- temporary tables [Integration Services]
- Fuzzy Lookup transformation
- reference tables [Integration Services]
- match similar data [Integration Services]
- replacing missing values
- correcting data [Integration Services]
- cache [Integration Services]
- standardizing data [Integration Services]
- lookups [Integration Services]
- confidence scores [Integration Services]
- fuzzy matches
- missing values replaced [Integration Services]
- similarity thresholds [Integration Services]
ms.assetid: 019db426-3de2-4ca9-8667-79fd9a47a068
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 742a87e7425fd65b8af7bcda87c237151d382f77
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87575241"
---
# <a name="fuzzy-lookup-transformation"></a><span data-ttu-id="053e1-102">transformação Pesquisa Difusa</span><span class="sxs-lookup"><span data-stu-id="053e1-102">Fuzzy Lookup Transformation</span></span>
  <span data-ttu-id="053e1-103">A transformação Pesquisa Difusa executa tarefas de limpeza de dados, como padronização de dados, correção de dados e fornecimento de valores ausentes.</span><span class="sxs-lookup"><span data-stu-id="053e1-103">The Fuzzy Lookup transformation performs data cleaning tasks such as standardizing data, correcting data, and providing missing values.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="053e1-104">Para obter informações mais detalhadas sobre a transformação Pesquisa Difusa, incluindo limitações de desempenho e de memória, consulte o white paper, [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604)(Pesquisa Difusa e Agrupamento Difuso no SQL Server Integration Services 2005).</span><span class="sxs-lookup"><span data-stu-id="053e1-104">For more detailed information about the Fuzzy Lookup transformation, including performance and memory limitations, see the white paper, [Fuzzy Lookup and Fuzzy Grouping in SQL Server Integration Services 2005](https://go.microsoft.com/fwlink/?LinkId=96604).</span></span>  
  
 <span data-ttu-id="053e1-105">A transformação Pesquisa Difusa difere da transformação Pesquisa no uso da correspondência difusa.</span><span class="sxs-lookup"><span data-stu-id="053e1-105">The Fuzzy Lookup transformation differs from the Lookup transformation in its use of fuzzy matching.</span></span> <span data-ttu-id="053e1-106">A transformação Pesquisa usa uma junção por igualdade para localizar registros correspondentes na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-106">The Lookup transformation uses an equi-join to locate matching records in the reference table.</span></span> <span data-ttu-id="053e1-107">Ela retorna registros com pelo menos um registro correspondente e retorna registros sem registros correspondentes.</span><span class="sxs-lookup"><span data-stu-id="053e1-107">It returns records with at least one matching record, and returns records with no matching records.</span></span> <span data-ttu-id="053e1-108">Por outro lado, a transformação Pesquisa Difusa usa a correspondência difusa para retornar uma ou mais correspondências aproximadas na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-108">In contrast, the Fuzzy Lookup transformation uses fuzzy matching to return one or more close matches in the reference table.</span></span>  
  
 <span data-ttu-id="053e1-109">A transformação Pesquisa Difusa frequentemente segue uma transformação Pesquisa em um fluxo de dados de pacote.</span><span class="sxs-lookup"><span data-stu-id="053e1-109">A Fuzzy Lookup transformation frequently follows a Lookup transformation in a package data flow.</span></span> <span data-ttu-id="053e1-110">Primeiro, a transformação Pesquisa tenta localizar uma correspondência exata.</span><span class="sxs-lookup"><span data-stu-id="053e1-110">First, the Lookup transformation tries to find an exact match.</span></span> <span data-ttu-id="053e1-111">Se falhar, a transformação Pesquisa Difusa oferecerá correspondências próximas da tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-111">If it fails, the Fuzzy Lookup transformation provides close matches from the reference table.</span></span>  
  
 <span data-ttu-id="053e1-112">A transformação precisa acessar uma fonte de dados de referência que contém os valores usados para limpar e ampliar os dados de entrada.</span><span class="sxs-lookup"><span data-stu-id="053e1-112">The transformation needs access to a reference data source that contains the values that are used to clean and extend the input data.</span></span> <span data-ttu-id="053e1-113">A fonte de dados de referência deve ser uma tabela em um banco de dados do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="053e1-113">The reference data source must be a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="053e1-114">A correspondência entre o valor em uma coluna de entrada e o valor na tabela de referência pode ser uma correspondência exata ou difusa.</span><span class="sxs-lookup"><span data-stu-id="053e1-114">The match between the value in an input column and the value in the reference table can be an exact match or a fuzzy match.</span></span> <span data-ttu-id="053e1-115">Porém, a transformação exige pelo menos uma correspondência de coluna a ser configurada para correspondência difusa.</span><span class="sxs-lookup"><span data-stu-id="053e1-115">However, the transformation requires at least one column match to be configured for fuzzy matching.</span></span> <span data-ttu-id="053e1-116">Se quiser usar apenas a correspondência exata, use a transformação Pesquisa.</span><span class="sxs-lookup"><span data-stu-id="053e1-116">If you want to use only exact matching, use the Lookup transformation instead.</span></span>  
  
 <span data-ttu-id="053e1-117">Essa transformação tem uma entrada e uma saída.</span><span class="sxs-lookup"><span data-stu-id="053e1-117">This transformation has one input and one output.</span></span>  
  
 <span data-ttu-id="053e1-118">Somente as colunas com os tipos de dados `DT_WSTR` e `DT_STR` podem ser usadas em correspondência difusa.</span><span class="sxs-lookup"><span data-stu-id="053e1-118">Only input columns with the `DT_WSTR` and `DT_STR` data types can be used in fuzzy matching.</span></span> <span data-ttu-id="053e1-119">A correspondência exata pode usar qualquer tipo de dados DTS, exceto `DT_TEXT`, `DT_NTEXT` e `DT_IMAGE`.</span><span class="sxs-lookup"><span data-stu-id="053e1-119">Exact matching can use any DTS data type except `DT_TEXT`, `DT_NTEXT`, and `DT_IMAGE`.</span></span> <span data-ttu-id="053e1-120">Para obter mais informações, consulte [Integration Services Data Types](../integration-services-data-types.md).</span><span class="sxs-lookup"><span data-stu-id="053e1-120">For more information, see [Integration Services Data Types](../integration-services-data-types.md).</span></span> <span data-ttu-id="053e1-121">Colunas que participam da junção entre a tabela de entrada e de referência deve ter tipos de dados compatíveis.</span><span class="sxs-lookup"><span data-stu-id="053e1-121">Columns that participate in the join between the input and the reference table must have compatible data types.</span></span> <span data-ttu-id="053e1-122">Por exemplo, é válido unir uma coluna com o `DT_WSTR` tipo de dados DTS a uma coluna com o [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` tipo de dados, mas inválido para unir uma coluna com o `DT_WSTR` tipo de dados a uma coluna com o `int` tipo de dados.</span><span class="sxs-lookup"><span data-stu-id="053e1-122">For example, it is valid to join a column with the DTS `DT_WSTR` data type to a column with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] `nvarchar` data type, but invalid to join a column with the `DT_WSTR` data type to a column with the `int` data type.</span></span>  
  
 <span data-ttu-id="053e1-123">Você pode personalizar essa transformação especificando a quantidade máxima de memória, o algoritmo de comparação de linha e o cache de índices e tabelas de referência que a transformação usa.</span><span class="sxs-lookup"><span data-stu-id="053e1-123">You can customize this transformation by specifying the maximum amount of memory, the row comparison algorithm, and the caching of indexes and reference tables that the transformation uses.</span></span>  
  
 <span data-ttu-id="053e1-124">A quantidade de memória que a transformação Pesquisa Difusa usa pode ser configurada definindo a propriedade personalizada MaxMemoryUsage.</span><span class="sxs-lookup"><span data-stu-id="053e1-124">The amount of memory that the Fuzzy Lookup transformation uses can be configured by setting the MaxMemoryUsage custom property.</span></span> <span data-ttu-id="053e1-125">Você pode especificar o número de megabytes (MB) ou usar o valor 0 para permitir que a transformação use uma quantidade dinâmica de memória com base nas suas necessidades e na memória física disponível.</span><span class="sxs-lookup"><span data-stu-id="053e1-125">You can specify the number of megabytes (MB), or use the value 0, which lets the transformation use a dynamic amount of memory based on its needs and the physical memory available.</span></span> <span data-ttu-id="053e1-126">A propriedade personalizada MaxMemoryUsage pode ser atualizada por uma expressão de propriedade quando o pacote é carregado.</span><span class="sxs-lookup"><span data-stu-id="053e1-126">The MaxMemoryUsage custom property can be updated by a property expression when the package is loaded.</span></span> <span data-ttu-id="053e1-127">Para obter mais informações, consulte [Expressões do Integration Services &#40;SSIS&#41;](../../expressions/integration-services-ssis-expressions.md), [Usar expressões de propriedade em pacotes](../../expressions/use-property-expressions-in-packages.md) e [Propriedades personalizadas da transformação](transformation-custom-properties.md).</span><span class="sxs-lookup"><span data-stu-id="053e1-127">For more information, see [Integration Services &#40;SSIS&#41; Expressions](../../expressions/integration-services-ssis-expressions.md), [Use Property Expressions in Packages](../../expressions/use-property-expressions-in-packages.md), and [Transformation Custom Properties](transformation-custom-properties.md).</span></span>  
  
## <a name="controlling-fuzzy-matching-behavior"></a><span data-ttu-id="053e1-128">Controlando o comportamento da correspondência difusa</span><span class="sxs-lookup"><span data-stu-id="053e1-128">Controlling Fuzzy Matching Behavior</span></span>  
 <span data-ttu-id="053e1-129">A transformação Pesquisa Difusa inclui três recursos para personalizar a pesquisa: número máximo de correspondências para retornar por linha de entrada, delimitadores de token e limites de similaridade.</span><span class="sxs-lookup"><span data-stu-id="053e1-129">The Fuzzy Lookup transformation includes three features for customizing the lookup it performs: maximum number of matches to return per input row, token delimiters, and similarity thresholds.</span></span>  
  
 <span data-ttu-id="053e1-130">A transformação retorna zero ou mais correspondências até o número de correspondências especificadas.</span><span class="sxs-lookup"><span data-stu-id="053e1-130">The transformation returns zero or more matches up to the number of matches specified.</span></span> <span data-ttu-id="053e1-131">A especificação de um número máximo de correspondências não garante que a transformação retorne o número máximo de correspondências; apenas garante que a transformação retorne no máximo o número de correspondências referido.</span><span class="sxs-lookup"><span data-stu-id="053e1-131">Specifying a maximum number of matches does not guarantee that the transformation returns the maximum number of matches; it only guarantees that the transformation returns at most that number of matches.</span></span> <span data-ttu-id="053e1-132">Se você definir o número máximo de correspondências como um valor maior que 1, a saída da transformação poderá incluir mais de uma linha por pesquisa, e algumas das linhas podem ser duplicatas.</span><span class="sxs-lookup"><span data-stu-id="053e1-132">If you set the maximum number of matches to a value greater than 1, the output of the transformation may include more than one row per lookup and some of the rows may be duplicates.</span></span>  
  
 <span data-ttu-id="053e1-133">A transformação fornece um conjunto padrão de delimitadores para criar tokens de dados, mas você pode adicionar delimitadores de token que atendam às necessidades dos seus dados.</span><span class="sxs-lookup"><span data-stu-id="053e1-133">The transformation provides a default set of delimiters used to tokenize the data, but you can add token delimiters to suit the needs of your data.</span></span> <span data-ttu-id="053e1-134">A propriedade Delimiters contém os delimitadores padrão.</span><span class="sxs-lookup"><span data-stu-id="053e1-134">The Delimiters property contains the default delimiters.</span></span> <span data-ttu-id="053e1-135">O uso de token é importante porque define as unidades dentro dos dados, as quais são comparadas umas com as outras.</span><span class="sxs-lookup"><span data-stu-id="053e1-135">Tokenization is important because it defines the units within the data that are compared to each other.</span></span>  
  
 <span data-ttu-id="053e1-136">Os limites de similaridade podem ser definidos nos níveis de componente e de junção.</span><span class="sxs-lookup"><span data-stu-id="053e1-136">The similarity thresholds can be set at the component and join levels.</span></span> <span data-ttu-id="053e1-137">O limite de similaridade relacionado à junção só está disponível quando a transformação executa uma correspondência difusa entre colunas na tabela de referência e de entrada.</span><span class="sxs-lookup"><span data-stu-id="053e1-137">The join-level similarity threshold is only available when the transformation performs a fuzzy match between columns in the input and the reference table.</span></span> <span data-ttu-id="053e1-138">O intervalo de similaridade é de 0 a 1.</span><span class="sxs-lookup"><span data-stu-id="053e1-138">The similarity range is 0 to 1.</span></span> <span data-ttu-id="053e1-139">Quanto mais próximo de 1 for o limite, mais similares as linhas e colunas devem ser para se qualificarem como duplicatas.</span><span class="sxs-lookup"><span data-stu-id="053e1-139">The closer to 1 the threshold is, the more similar the rows and columns must be to qualify as duplicates.</span></span> <span data-ttu-id="053e1-140">Você especifica o limite de similaridade definindo a propriedade MinSimilarity nos níveis de componente e de junção.</span><span class="sxs-lookup"><span data-stu-id="053e1-140">You specify the similarity threshold by setting the MinSimilarity property at the component and join levels.</span></span> <span data-ttu-id="053e1-141">Para satisfazer a similaridade especificada no nível de componente, todas as linhas deverão ter uma similaridade em todas as correspondências que seja maior ou igual ao limite de similaridade especificado no nível de componente.</span><span class="sxs-lookup"><span data-stu-id="053e1-141">To satisfy the similarity that is specified at the component level, all rows must have a similarity across all matches that is greater than or equal to the similarity threshold that is specified at the component level.</span></span> <span data-ttu-id="053e1-142">Ou seja, você não pode especificar uma correspondência muito próxima no nível de componente, a menos que as correspondências relacionadas à linha ou à junção estejam igualmente próximas.</span><span class="sxs-lookup"><span data-stu-id="053e1-142">That is, you cannot specify a very close match at the component level unless the matches at the row or join level are equally close.</span></span>  
  
 <span data-ttu-id="053e1-143">Cada correspondência inclui uma pontuação de similaridade e uma pontuação de confiança.</span><span class="sxs-lookup"><span data-stu-id="053e1-143">Each match includes a similarity score and a confidence score.</span></span> <span data-ttu-id="053e1-144">A pontuação de similaridade é uma medida matemática de similaridade textural entre o registro de entrada e o registro que a transformação Pesquisa Difusa retorna da tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-144">The similarity score is a mathematical measure of the textural similarity between the input record and the record that Fuzzy Lookup transformation returns from the reference table.</span></span> <span data-ttu-id="053e1-145">A pontuação de confiança é uma medida que indica qual a probabilidade de um determinado valor ser a melhor correspondência entre as correspondências encontradas na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-145">The confidence score is a measure of how likely it is that a particular value is the best match among the matches found in the reference table.</span></span> <span data-ttu-id="053e1-146">A pontuação de confiança atribuída a um registro depende dos outros registros correspondentes retornados.</span><span class="sxs-lookup"><span data-stu-id="053e1-146">The confidence score assigned to a record depends on the other matching records that are returned.</span></span> <span data-ttu-id="053e1-147">Por exemplo, a correspondência de *St.* e *Saint* retorna uma baixa pontuação de similaridade, independentemente de outras correspondências.</span><span class="sxs-lookup"><span data-stu-id="053e1-147">For example, matching *St.* and *Saint* returns a low similarity score regardless of other matches.</span></span> <span data-ttu-id="053e1-148">Caso *Saint* seja a única correspondência retornada, a pontuação de confiança será alta.</span><span class="sxs-lookup"><span data-stu-id="053e1-148">If *Saint* is the only match returned, the confidence score is high.</span></span> <span data-ttu-id="053e1-149">Caso *Saint* e *St.* sejam exibidos na tabela de referência, a confiança em *St.* será alta, e a confiança em *Saint* , baixa.</span><span class="sxs-lookup"><span data-stu-id="053e1-149">If both *Saint* and *St.* appear in the reference table, the confidence in *St.* is high and the confidence in *Saint* is low.</span></span> <span data-ttu-id="053e1-150">Porém, a alta similaridade pode não significar confiança alta.</span><span class="sxs-lookup"><span data-stu-id="053e1-150">However, high similarity may not mean high confidence.</span></span> <span data-ttu-id="053e1-151">Por exemplo, se você estiver pesquisando o valor *Chapter 4*, os resultados retornados *Chapter 1*, *Chapter 2*e *Chapter 3* terão uma pontuação de similaridade alta, mas uma baixa pontuação de confiança porque não está claro qual dos resultados é a melhor correspondência.</span><span class="sxs-lookup"><span data-stu-id="053e1-151">For example, if you are looking up the value *Chapter 4*, the returned results *Chapter 1*, *Chapter 2*, and *Chapter 3* have a high similarity score but a low confidence score because it is unclear which of the results is the best match.</span></span>  
  
 <span data-ttu-id="053e1-152">A pontuação de similaridade é representada por um valor decimal entre 0 e 1, em que uma pontuação de similaridade de 1 representa uma correspondência exata entre o valor na coluna de entrada e o valor na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-152">The similarity score is represented by a decimal value between 0 and 1, where a similarity score of 1 means an exact match between the value in the input column and the value in the reference table.</span></span> <span data-ttu-id="053e1-153">A pontuação de confiança, também um valor decimal entre 0 e 1, indica a confiança na correspondência.</span><span class="sxs-lookup"><span data-stu-id="053e1-153">The confidence score, also a decimal value between 0 and 1, indicates the confidence in the match.</span></span> <span data-ttu-id="053e1-154">Se não for encontrada nenhuma correspondência utilizável, as pontuações de similaridade e confiança iguais a 0 serão atribuídas à linha, e as colunas de saída copiadas da tabela de referência conterão valores nulos.</span><span class="sxs-lookup"><span data-stu-id="053e1-154">If no usable match is found, similarity and confidence scores of 0 are assigned to the row, and the output columns copied from the reference table will contain null values.</span></span>  
  
 <span data-ttu-id="053e1-155">Às vezes, é possível que a Pesquisa Difusa não localize correspondências apropriadas na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-155">Sometimes, Fuzzy Lookup may not locate appropriate matches in the reference table.</span></span> <span data-ttu-id="053e1-156">Isso poderá acontecer se o valor de entrada usado em uma pesquisa for uma única palavra curta.</span><span class="sxs-lookup"><span data-stu-id="053e1-156">This can occur if the input value that is used in a lookup is a single, short word.</span></span> <span data-ttu-id="053e1-157">Por exemplo, *helo* não tem correspondência com o valor *hello* em uma tabela de referência quando nenhum outro token está presente na coluna ou em qualquer outra coluna da linha.</span><span class="sxs-lookup"><span data-stu-id="053e1-157">For example, *helo* is not matched with the value *hello* in a reference table when no other tokens are present in that column or any other column in the row.</span></span>  
  
 <span data-ttu-id="053e1-158">As colunas de saída de transformação incluem as colunas de entrada marcadas como de passagem, as selecionadas na tabela de pesquisa e as seguintes colunas adicionais:</span><span class="sxs-lookup"><span data-stu-id="053e1-158">The transformation output columns include the input columns that are marked as pass-through columns, the selected columns in the lookup table, and the following additional columns:</span></span>  
  
-   <span data-ttu-id="053e1-159">**_Similarity**, uma coluna que descreve a similaridade entre valores nas colunas de entrada e de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-159">**_Similarity**, a column that describes the similarity between values in the input and reference columns.</span></span>  
  
-   <span data-ttu-id="053e1-160">**_Confidence**, uma coluna que descreve a qualidade da correspondência.</span><span class="sxs-lookup"><span data-stu-id="053e1-160">**_Confidence**, a column that describes the quality of the match.</span></span>  
  
 <span data-ttu-id="053e1-161">A transformação usa a conexão com o banco de dados do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] para criar as tabelas temporárias usadas pelo algoritmo de correspondência difusa.</span><span class="sxs-lookup"><span data-stu-id="053e1-161">The transformation uses the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database to create the temporary tables that the fuzzy matching algorithm uses.</span></span>  
  
## <a name="running-the-fuzzy-lookup-transformation"></a><span data-ttu-id="053e1-162">Executando a Transformação Pesquisa Difusa</span><span class="sxs-lookup"><span data-stu-id="053e1-162">Running the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="053e1-163">Quando o pacote executar a transformação pela primeira vez, ela copiará a tabela de referência, adicionará uma chave com um tipo de dados de inteiro à tabela nova e criará um índice na coluna-chave.</span><span class="sxs-lookup"><span data-stu-id="053e1-163">When the package first runs the transformation, the transformation copies the reference table, adds a key with an integer data type to the new table, and builds an index on the key column.</span></span> <span data-ttu-id="053e1-164">Em seguida, a transformação criará um índice, denominado índice de correspondência, na cópia da tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-164">Next, the transformation builds an index, called a match index, on the copy of the reference table.</span></span> <span data-ttu-id="053e1-165">O índice de correspondência armazena os resultados da criação de tokens dos valores nas colunas de entrada de transformação e, em seguida, a transformação usa os tokens na operação de pesquisa.</span><span class="sxs-lookup"><span data-stu-id="053e1-165">The match index stores the results of tokenizing the values in the transformation input columns, and the transformation then uses the tokens in the lookup operation.</span></span> <span data-ttu-id="053e1-166">O índice de correspondência é uma tabela em um banco de dados do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="053e1-166">The match index is a table in a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database.</span></span>  
  
 <span data-ttu-id="053e1-167">Quando o pacote for executado novamente, a transformação poderá usar um índice de correspondência existente ou criar um índice novo.</span><span class="sxs-lookup"><span data-stu-id="053e1-167">When the package runs again, the transformation can either use an existing match index or create a new index.</span></span> <span data-ttu-id="053e1-168">Se a tabela de referência for estática, o pacote poderá evitar o processo potencialmente caro de recriar o índice para sessões repetidas de limpeza de dados.</span><span class="sxs-lookup"><span data-stu-id="053e1-168">If the reference table is static, the package can avoid the potentially expensive process of rebuilding the index for repeat sessions of data cleaning.</span></span> <span data-ttu-id="053e1-169">Se você optar por usar um índice existente, o índice será criado na primeira vez em que o pacote for executado.</span><span class="sxs-lookup"><span data-stu-id="053e1-169">If you choose to use an existing index, the index is created the first time that the package runs.</span></span> <span data-ttu-id="053e1-170">Se várias transformações de Pesquisa Difusa usarem a mesma tabela de referência, todas elas poderão usar o mesmo índice.</span><span class="sxs-lookup"><span data-stu-id="053e1-170">If multiple Fuzzy Lookup transformations use the same reference table, they can all use the same index.</span></span> <span data-ttu-id="053e1-171">Para usar novamente o índice, as operações de pesquisa devem ser idênticas; a pesquisa deve usar as mesmas colunas.</span><span class="sxs-lookup"><span data-stu-id="053e1-171">To reuse the index, the lookup operations must be identical; the lookup must use the same columns.</span></span> <span data-ttu-id="053e1-172">Você pode nomear o índice e selecionar a conexão com o banco de dados do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] que salva o índice.</span><span class="sxs-lookup"><span data-stu-id="053e1-172">You can name the index and select the connection to the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that saves the index.</span></span>  
  
 <span data-ttu-id="053e1-173">Se a transformação salvar o índice de correspondência, esse índice poderá ser mantido automaticamente.</span><span class="sxs-lookup"><span data-stu-id="053e1-173">If the transformation saves the match index, the match index can be maintained automatically.</span></span> <span data-ttu-id="053e1-174">Isso significa que toda vez que um registro na tabela de referência for atualizado, o índice de correspondência será também atualizado.</span><span class="sxs-lookup"><span data-stu-id="053e1-174">This means that every time a record in the reference table is updated, the match index is also updated.</span></span> <span data-ttu-id="053e1-175">A manutenção do índice de correspondência pode poupar tempo de processamento porque o índice não precisa ser recriado quando o pacote é executado.</span><span class="sxs-lookup"><span data-stu-id="053e1-175">Maintaining the match index can save processing time, because the index does not have to be rebuilt when the package runs.</span></span> <span data-ttu-id="053e1-176">Você pode especificar como a transformação gerencia o índice de correspondência.</span><span class="sxs-lookup"><span data-stu-id="053e1-176">You can specify how the transformation manages the match index.</span></span>  
  
 <span data-ttu-id="053e1-177">A tabela a seguir descreve as opções de índice de correspondência.</span><span class="sxs-lookup"><span data-stu-id="053e1-177">The following table describes the match index options.</span></span>  
  
|<span data-ttu-id="053e1-178">Opção</span><span class="sxs-lookup"><span data-stu-id="053e1-178">Option</span></span>|<span data-ttu-id="053e1-179">DESCRIÇÃO</span><span class="sxs-lookup"><span data-stu-id="053e1-179">Description</span></span>|  
|------------|-----------------|  
|<span data-ttu-id="053e1-180">**GenerateAndMaintainNewIndex**</span><span class="sxs-lookup"><span data-stu-id="053e1-180">**GenerateAndMaintainNewIndex**</span></span>|<span data-ttu-id="053e1-181">Cria um índice novo, salva-o e faz a sua manutenção.</span><span class="sxs-lookup"><span data-stu-id="053e1-181">Create a new index, save it, and maintain it.</span></span> <span data-ttu-id="053e1-182">A transformação instala acionadores na tabela de referência para manter essa tabela de referência e a tabela de índice sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="053e1-182">The transformation installs triggers on the reference table to keep the reference table and index table synchronized.</span></span>|  
|<span data-ttu-id="053e1-183">**GenerateAndPersistNewIndex**</span><span class="sxs-lookup"><span data-stu-id="053e1-183">**GenerateAndPersistNewIndex**</span></span>|<span data-ttu-id="053e1-184">Cria um índice novo, salva-o, mas não faz a sua manutenção.</span><span class="sxs-lookup"><span data-stu-id="053e1-184">Create a new index and save it, but do not maintain it.</span></span>|  
|<span data-ttu-id="053e1-185">**GenerateNewIndex**</span><span class="sxs-lookup"><span data-stu-id="053e1-185">**GenerateNewIndex**</span></span>|<span data-ttu-id="053e1-186">Cria um índice novo, mas não o salva.</span><span class="sxs-lookup"><span data-stu-id="053e1-186">Create a new index, but do not save it.</span></span>|  
|<span data-ttu-id="053e1-187">**ReuseExistingIndex**</span><span class="sxs-lookup"><span data-stu-id="053e1-187">**ReuseExistingIndex**</span></span>|<span data-ttu-id="053e1-188">Reutiliza um índice existente.</span><span class="sxs-lookup"><span data-stu-id="053e1-188">Reuse an existing index.</span></span>|  
  
### <a name="maintenance-of-the-match-index-table"></a><span data-ttu-id="053e1-189">Manutenção da tabela de índices de correspondência</span><span class="sxs-lookup"><span data-stu-id="053e1-189">Maintenance of the Match Index Table</span></span>  
 <span data-ttu-id="053e1-190">A opção **GenerateAndMaintainNewIndex** instala acionadores na tabela de referência para manter a tabela de índices de referência e a tabela de referência sincronizadas.</span><span class="sxs-lookup"><span data-stu-id="053e1-190">The **GenerateAndMaintainNewIndex** option installs triggers on the reference table to keep the match index table and the reference table synchronized.</span></span> <span data-ttu-id="053e1-191">Se você precisar remover o gatilho instalado, será preciso executar o procedimento armazenado **sp_FuzzyLookupTableMaintenanceUnInstall** e fornecer o nome especificado na propriedade MatchIndexName como o valor de parâmetro de entrada.</span><span class="sxs-lookup"><span data-stu-id="053e1-191">If you have to remove the installed trigger, you must run the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure, and provide the name specified in the MatchIndexName property as the input parameter value.</span></span>  
  
 <span data-ttu-id="053e1-192">Não exclua a tabela de índices de correspondência mantida antes de executar o procedimento armazenado **sp_FuzzyLookupTableMaintenanceUnInstall** .</span><span class="sxs-lookup"><span data-stu-id="053e1-192">You should not delete the maintained match index table before running the **sp_FuzzyLookupTableMaintenanceUnInstall** stored procedure.</span></span> <span data-ttu-id="053e1-193">Se a tabela de índices de correspondência for excluída, os acionadores na tabela de referência não serão executados corretamente.</span><span class="sxs-lookup"><span data-stu-id="053e1-193">If the match index table is deleted, the triggers on the reference table will not execute correctly.</span></span> <span data-ttu-id="053e1-194">Todas as atualizações subsequentes da tabela de referência falharão até que você descarte manualmente os acionadores da tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-194">All subsequent updates to the reference table will fail until you manually drop the triggers on the reference table.</span></span>  
  
 <span data-ttu-id="053e1-195">O comando SQL TRUNCATE TABLE não chama os acionadores DELETE.</span><span class="sxs-lookup"><span data-stu-id="053e1-195">The SQL TRUNCATE TABLE command does not invoke DELETE triggers.</span></span> <span data-ttu-id="053e1-196">Se o comando TRUNCATE TABLE for usado na tabela de referência, a tabela de referência e o índice de correspondência não serão mais sincronizados, e a transformação Pesquisa Difusa falhará.</span><span class="sxs-lookup"><span data-stu-id="053e1-196">If the TRUNCATE TABLE command is used on the reference table, the reference table and the match index will no longer be synchronized and the Fuzzy Lookup transformation fails.</span></span> <span data-ttu-id="053e1-197">Visto que os acionadores que mantêm a tabela de índices de correspondência são instalados na tabela de referência, você deverá usar o comando SQL DELETE em vez do TRUNCATE TABLE.</span><span class="sxs-lookup"><span data-stu-id="053e1-197">While the triggers that maintain the match index table are installed on the reference table, you should use the SQL DELETE command instead of the TRUNCATE TABLE command.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="053e1-198">Quando você seleciona **Manter índice armazenado** na guia **Tabela de Referência** de **Editor de Transformação Pesquisa Difusa**, a transformação usa procedimentos armazenados gerenciados para manter o índice.</span><span class="sxs-lookup"><span data-stu-id="053e1-198">When you select **Maintain stored index** on the **Reference Table** tab of the **Fuzzy Lookup Transformation Editor**, the transformation uses managed stored procedures to maintain the index.</span></span> <span data-ttu-id="053e1-199">Esses procedimentos armazenados gerenciados usam o recurso de integração de CLR (Common Language Runtime) no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="053e1-199">These managed stored procedures use the common language runtime (CLR) integration feature in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="053e1-200">Por padrão, a integração de CLR no [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] não está habilitada.</span><span class="sxs-lookup"><span data-stu-id="053e1-200">By default, CLR integration in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not enabled.</span></span> <span data-ttu-id="053e1-201">Para usar a funcionalidade **Manter índice armazenado** , você deve habilitar a integração de CLR.</span><span class="sxs-lookup"><span data-stu-id="053e1-201">To use the **Maintain stored index** functionality, you must enable CLR integration.</span></span> <span data-ttu-id="053e1-202">Para obter mais informações, consulte [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span><span class="sxs-lookup"><span data-stu-id="053e1-202">For more information, see [Enabling CLR Integration](../../../relational-databases/clr-integration/clr-integration-enabling.md).</span></span>  
>   
>  <span data-ttu-id="053e1-203">Como a opção **Manter índice armazenado** requer a integração CLR, esse recurso funciona apenas quando você seleciona uma tabela de referência em uma instância do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] em que a integração CLR está habilitada.</span><span class="sxs-lookup"><span data-stu-id="053e1-203">Because the **Maintain stored index** option requires CLR integration, this feature works only when you select a reference table on an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] where CLR integration is enabled.</span></span>  
  
## <a name="row-comparison"></a><span data-ttu-id="053e1-204">Comparação de linhas</span><span class="sxs-lookup"><span data-stu-id="053e1-204">Row Comparison</span></span>  
 <span data-ttu-id="053e1-205">Quando você configura a transformação Pesquisa Difusa, é possível especificar o algoritmo de comparação que a transformação usa para localizar registros correspondentes na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-205">When you configure the Fuzzy Lookup transformation, you can specify the comparison algorithm that the transformation uses to locate matching records in the reference table.</span></span> <span data-ttu-id="053e1-206">Se você definir a propriedade exaustiva como `True` , a transformação compara cada linha na entrada para cada linha na tabela de referência.</span><span class="sxs-lookup"><span data-stu-id="053e1-206">If you set the Exhaustive property to `True`, the transformation compares every row in the input to every row in the reference table.</span></span> <span data-ttu-id="053e1-207">Esse algoritmo de comparação pode produzir resultados mais precisos, mas é provável que faça com que a transformação seja executada com mais lentidão, a menos que o número de linhas na tabela de referência seja pequeno.</span><span class="sxs-lookup"><span data-stu-id="053e1-207">This comparison algorithm may produce more accurate results, but it is likely to make the transformation perform more slowly unless the number of rows is the reference table is small.</span></span> <span data-ttu-id="053e1-208">Se a propriedade exaustiva for definida como `True` , a tabela de referência inteira será carregada na memória.</span><span class="sxs-lookup"><span data-stu-id="053e1-208">If the Exhaustive property is set to `True`, the entire reference table is loaded into memory.</span></span> <span data-ttu-id="053e1-209">Para evitar problemas de desempenho, é aconselhável definir a propriedade exaustiva como `True` somente durante o desenvolvimento do pacote.</span><span class="sxs-lookup"><span data-stu-id="053e1-209">To avoid performance issues, it is advisable to set the Exhaustive property to `True` during package development only.</span></span>  
  
 <span data-ttu-id="053e1-210">Se a propriedade exaustiva for definida como `False` , a transformação Pesquisa Difusa retornará apenas as correspondências que têm pelo menos um token indexado ou uma subcadeia de caracteres (a subcadeia de caracteres é chamada de *q-gram*) em comum com o registro de entrada.</span><span class="sxs-lookup"><span data-stu-id="053e1-210">If the Exhaustive property is set to `False`, the Fuzzy Lookup transformation returns only matches that have at least one indexed token or substring (the substring is called a *q-gram*) in common with the input record.</span></span> <span data-ttu-id="053e1-211">Para maximizar a eficiência das pesquisas, apenas um subconjunto dos tokens em cada linha da tabela é indexado na estrutura de índice invertida que a transformação Pesquisa Difusa usa para localizar correspondências.</span><span class="sxs-lookup"><span data-stu-id="053e1-211">To maximize the efficiency of lookups, only a subset of the tokens in each row in the table is indexed in the inverted index structure that the Fuzzy Lookup transformation uses to locate matches.</span></span> <span data-ttu-id="053e1-212">Quando o conjunto de dados de entrada é pequeno, você pode definir exaustiva como `True` para evitar correspondências ausentes para as quais não existem tokens comuns na tabela de índice.</span><span class="sxs-lookup"><span data-stu-id="053e1-212">When the input dataset is small, you can set Exhaustive to `True` to avoid missing matches for which no common tokens exist in the index table.</span></span>  
  
## <a name="caching-of-indexes-and-reference-tables"></a><span data-ttu-id="053e1-213">Cache de índices e tabelas de referência</span><span class="sxs-lookup"><span data-stu-id="053e1-213">Caching of Indexes and Reference Tables</span></span>  
 <span data-ttu-id="053e1-214">Quando você configura a transformação Pesquisa Difusa, é possível especificar se a transformação deve armazenar parcialmente em cache o índice e a tabela de referência na memória antes de a transformação realizar o seu trabalho.</span><span class="sxs-lookup"><span data-stu-id="053e1-214">When you configure the Fuzzy Lookup transformation, you can specify whether the transformation partially caches the index and reference table in memory before the transformation does its work.</span></span> <span data-ttu-id="053e1-215">Se você definir a propriedade WarmCaches como `True` , o índice e a tabela de referência serão carregados na memória.</span><span class="sxs-lookup"><span data-stu-id="053e1-215">If you set the WarmCaches property to `True`, the index and reference table are loaded into memory.</span></span> <span data-ttu-id="053e1-216">Quando a entrada tiver muitas linhas, definir a propriedade WarmCaches como `True` pode melhorar o desempenho da transformação.</span><span class="sxs-lookup"><span data-stu-id="053e1-216">When the input has many rows, setting the WarmCaches property to `True` can improve the performance of the transformation.</span></span> <span data-ttu-id="053e1-217">Quando o número de linhas de entrada é pequeno, definir a propriedade WarmCaches como `False` pode tornar a reutilização de um índice grande mais rapidamente.</span><span class="sxs-lookup"><span data-stu-id="053e1-217">When the number of input rows is small, setting the WarmCaches property to `False` can make the reuse of a large index faster.</span></span>  
  
## <a name="temporary-tables-and-indexes"></a><span data-ttu-id="053e1-218">Tabelas e índices temporários</span><span class="sxs-lookup"><span data-stu-id="053e1-218">Temporary Tables and Indexes</span></span>  
 <span data-ttu-id="053e1-219">Durante a execução, a transformação Pesquisa Difusa cria objetos temporários, como tabelas e índices, no banco de dados do [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] a que a transformação se conecta.</span><span class="sxs-lookup"><span data-stu-id="053e1-219">At run time, the Fuzzy Lookup transformation creates temporary objects, such as tables and indexes, in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database that the transformation connects to.</span></span> <span data-ttu-id="053e1-220">O tamanho dessas tabelas e índices temporários é proporcional ao número de linhas e tokens na tabela de referência e ao número de tokens que a transformação Pesquisa Difusa cria; por esse motivo, eles podem consumir uma grande quantidade de espaço em disco.</span><span class="sxs-lookup"><span data-stu-id="053e1-220">The size of these temporary tables and indexes is proportionate to the number of rows and tokens in the reference table and the number of tokens that the Fuzzy Lookup transformation creates; therefore, they could potentially consume a significant amount of disk space.</span></span> <span data-ttu-id="053e1-221">A transformação também consulta as tabelas temporárias.</span><span class="sxs-lookup"><span data-stu-id="053e1-221">The transformation also queries these temporary tables.</span></span> <span data-ttu-id="053e1-222">Portanto, você deverá considerar a conexão da transformação Pesquisa Difusa a uma instância de não produção de um banco de dados [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , especialmente se o servidor de produção tiver espaço em disco disponível limitado.</span><span class="sxs-lookup"><span data-stu-id="053e1-222">You should therefore consider connecting the Fuzzy Lookup transformation to a non-production instance of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database, especially if the production server has limited disk space available.</span></span>  
  
 <span data-ttu-id="053e1-223">O desempenho dessa transformação poderá melhorar se as tabelas e os índices que ele usa estiverem no computador local.</span><span class="sxs-lookup"><span data-stu-id="053e1-223">The performance of this transformation may improve if the tables and indexes it uses are located on the local computer.</span></span> <span data-ttu-id="053e1-224">Se a tabela de referência que a transformação Pesquisa Difusa usar estiver no servidor de produção, considere copiar a tabela a um servidor de não produção e configurar a transformação Pesquisa Difusa para acessar a cópia.</span><span class="sxs-lookup"><span data-stu-id="053e1-224">If the reference table that the Fuzzy Lookup transformation uses is on the production server, you should consider copying the table to a non-production server and configuring the Fuzzy Lookup transformation to access the copy.</span></span> <span data-ttu-id="053e1-225">Com isso, impede-se que as consultas de pesquisa consumam recursos do servidor de produção.</span><span class="sxs-lookup"><span data-stu-id="053e1-225">By doing this, you can prevent the lookup queries from consuming resources on the production server.</span></span> <span data-ttu-id="053e1-226">Além disso, se a transformação Pesquisa Difusa mantiver o índice de correspondência, ou seja, se MatchIndexOptions for definido como **GenerateAndMaintainNewIndex**, a transformação poderá bloquear a tabela de referência durante a operação de limpeza dos dados e impedir que outros usuários e aplicativos acessem essa tabela.</span><span class="sxs-lookup"><span data-stu-id="053e1-226">In addition, if the Fuzzy Lookup transformation maintains the match index-that is, if MatchIndexOptionsis set to **GenerateAndMaintainNewIndex**-the transformation may lock the reference table for the duration of the data cleaning operation and prevent other users and applications from accessing the table.</span></span>  
  
## <a name="configuring-the-fuzzy-lookup-transformation"></a><span data-ttu-id="053e1-227">Configurando a transformação pesquisa difusa</span><span class="sxs-lookup"><span data-stu-id="053e1-227">Configuring the Fuzzy Lookup Transformation</span></span>  
 <span data-ttu-id="053e1-228">Você pode definir propriedades pelo Designer do [!INCLUDE[ssIS](../../../includes/ssis-md.md)] ou programaticamente.</span><span class="sxs-lookup"><span data-stu-id="053e1-228">You can set properties through [!INCLUDE[ssIS](../../../includes/ssis-md.md)] Designer or programmatically.</span></span>  
  
 <span data-ttu-id="053e1-229">Para obter mais informações sobre as propriedades que podem ser definidas na caixa de diálogo **Editor de Transformação Pesquisa Difusa** , clique em um dos seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="053e1-229">For more information about the properties that you can set in the **Fuzzy Lookup Transformation Editor** dialog box, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="053e1-230">Editor de Transformação Pesquisa Difusa &#40;Guia Tabela de Referência&#41;</span><span class="sxs-lookup"><span data-stu-id="053e1-230">Fuzzy Lookup Transformation Editor &#40;Reference Table Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-reference-table-tab.md)  
  
-   [<span data-ttu-id="053e1-231">Editor de Transformação Pesquisa Difusa &#40;guia Colunas&#41;</span><span class="sxs-lookup"><span data-stu-id="053e1-231">Fuzzy Lookup Transformation Editor &#40;Columns Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-columns-tab.md)  
  
-   [<span data-ttu-id="053e1-232">Editor de Transformação Pesquisa Difusa &#40;Guia Avançado&#41;</span><span class="sxs-lookup"><span data-stu-id="053e1-232">Fuzzy Lookup Transformation Editor &#40;Advanced Tab&#41;</span></span>](../../fuzzy-lookup-transformation-editor-advanced-tab.md)  
  
 <span data-ttu-id="053e1-233">Para obter mais informações sobre as propriedades que podem ser definidas na caixa de diálogo **Editor Avançado** ou programaticamente, clique em um dos seguintes tópicos:</span><span class="sxs-lookup"><span data-stu-id="053e1-233">For more information about the properties that you can set in the **Advanced Editor** dialog box or programmatically, click one of the following topics:</span></span>  
  
-   [<span data-ttu-id="053e1-234">Propriedades comuns</span><span class="sxs-lookup"><span data-stu-id="053e1-234">Common Properties</span></span>](../../common-properties.md)  
  
-   [<span data-ttu-id="053e1-235">Propriedades personalizadas de Transformação</span><span class="sxs-lookup"><span data-stu-id="053e1-235">Transformation Custom Properties</span></span>](transformation-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="053e1-236">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="053e1-236">Related Tasks</span></span>  
 <span data-ttu-id="053e1-237">Para obter detalhes sobre como definir as propriedades de um componente de fluxo de dados, consulte [Definir as propriedades de um componente de fluxo de dados](../set-the-properties-of-a-data-flow-component.md).</span><span class="sxs-lookup"><span data-stu-id="053e1-237">For details about how to set properties of a data flow component, see [Set the Properties of a Data Flow Component](../set-the-properties-of-a-data-flow-component.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="053e1-238">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="053e1-238">See Also</span></span>  
 <span data-ttu-id="053e1-239">[Transformação pesquisa](lookup-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="053e1-239">[Lookup Transformation](lookup-transformation.md) </span></span>  
 <span data-ttu-id="053e1-240">[Transformação Agrupamento Difuso](fuzzy-grouping-transformation.md) </span><span class="sxs-lookup"><span data-stu-id="053e1-240">[Fuzzy Grouping Transformation](fuzzy-grouping-transformation.md) </span></span>  
 [<span data-ttu-id="053e1-241">Transformações do Integration Services</span><span class="sxs-lookup"><span data-stu-id="053e1-241">Integration Services Transformations</span></span>](integration-services-transformations.md)  
  
  
