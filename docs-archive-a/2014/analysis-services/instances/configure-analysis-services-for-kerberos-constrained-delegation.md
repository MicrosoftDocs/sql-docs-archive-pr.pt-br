---
title: Configurar Analysis Services para delegação restrita de Kerberos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 6d751477-6bf1-48b4-8833-5a631bbe7650
author: minewiskan
ms.author: owend
ms.openlocfilehash: 03b852acb4868cd384ef34948c6aff70541638a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87680228"
---
# <a name="configure-analysis-services-for-kerberos-constrained-delegation"></a><span data-ttu-id="ce705-102">Configurar a delegação restrita do Analysis Services para Kerberos)</span><span class="sxs-lookup"><span data-stu-id="ce705-102">Configure Analysis Services for Kerberos constrained delegation</span></span>
  <span data-ttu-id="ce705-103">Ao configurar o Analysis Services para autenticação Kerberos, você provavelmente está mais interessado em obter um destes resultados ou ambos: fazer com que o Analysis Services represente uma identidade de usuário ao consultar dados ou fazer com que o Analysis Services delegue uma identidade de usuário a um serviço de nível inferior.</span><span class="sxs-lookup"><span data-stu-id="ce705-103">When configuring Analysis Services for Kerberos authentication, you are most likely interested in achieving one or both of the following outcomes: having Analysis Services impersonate a user identity when querying data; or having Analysis Services delegate a user identity to a down-level service.</span></span> <span data-ttu-id="ce705-104">Cada cenário tem requisitos de configuração ligeiramente diferentes.</span><span class="sxs-lookup"><span data-stu-id="ce705-104">Each scenario calls for slightly different configuration requirements.</span></span> <span data-ttu-id="ce705-105">Nos dois cenários, é necessário que a verificação assegure que a configuração foi feita corretamente.</span><span class="sxs-lookup"><span data-stu-id="ce705-105">Both scenarios require verification to ensure configuration was done properly.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="ce705-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** é uma ferramenta de diagnóstico que ajuda a solucionar problemas de Kerberos relativos à conectividade com [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ce705-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ce705-107">Para obter mais informações, consulte [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="ce705-107">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="ce705-108">Este tópico contém as seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="ce705-108">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="ce705-109">Permitir que o Analysis Services represente uma identidade de usuário</span><span class="sxs-lookup"><span data-stu-id="ce705-109">Allow Analysis Services to impersonate a user identity</span></span>](#bkmk_impersonate)  
  
-   [<span data-ttu-id="ce705-110">Configurar o Analysis Services para delegação confiável</span><span class="sxs-lookup"><span data-stu-id="ce705-110">Configure Analysis Services for trusted delegation</span></span>](#bkmk_delegate)  
  
-   [<span data-ttu-id="ce705-111">Testar a identidade representada ou delegada</span><span class="sxs-lookup"><span data-stu-id="ce705-111">Test for impersonated or delegated identity</span></span>](#bkmk_test)  
  
> [!NOTE]  
>  <span data-ttu-id="ce705-112">A delegação não será necessária se a conexão ao Analysis Services for um único salto, ou se sua solução usar credenciais armazenadas fornecidas pelo Serviço de Repositório Seguro do SharePoint ou pelo Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="ce705-112">Delegation is not required if the connection to Analysis Services is a single hop, or your solution uses stored credentials provided by SharePoint Secure Store Service or Reporting Services.</span></span> <span data-ttu-id="ce705-113">Se todas as conexões forem conexões diretas do Excel para um banco de dados do Analysis Services ou se elas se basearem em credenciais armazenadas, você poderá usar o Kerberos (ou NTLM) sem precisar configurar a delegação restrita.</span><span class="sxs-lookup"><span data-stu-id="ce705-113">If all connections are direct connections from Excel to an Analysis Services database, or based on stored credentials, you can use Kerberos (or NTLM) without having to configure constrained delegation.</span></span>  
>   
>  <span data-ttu-id="ce705-114">A delegação restrita de Kerberos será necessária se a identidade do usuário tiver que fluir em várias conexões de computador (conhecido como "salto duplo").</span><span class="sxs-lookup"><span data-stu-id="ce705-114">Kerberos constrained delegation is required if the user identity has to flow over multiple computer connections (known as "double-hop").</span></span> <span data-ttu-id="ce705-115">Quando o acesso a dados do Analysis Services for contingente na identidade de usuário, e a solicitação de conexão for proveniente de um serviço de delegação, use a lista de verificação da próxima seção para garantir que o Analysis Services possa representar o chamador original.</span><span class="sxs-lookup"><span data-stu-id="ce705-115">When Analysis Services data access is contingent upon user identity, and the connection request is from a delegating service, use the checklist in the next section to ensure that Analysis Services is able to impersonate the original caller.</span></span> <span data-ttu-id="ce705-116">Para obter mais informações sobre os fluxos de autenticação do Analysis Services, consulte [Autenticação do Microsoft BI e delegação da identidade](https://go.microsoft.com/fwlink/?LinkID=286576).</span><span class="sxs-lookup"><span data-stu-id="ce705-116">For more information about Analysis Services authentication flows, see [Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576).</span></span>  
>   
>  <span data-ttu-id="ce705-117">Como prática de segurança recomendada, a Microsoft sugere sempre a delegação restrita em vez da delegação irrestrita.</span><span class="sxs-lookup"><span data-stu-id="ce705-117">As a security best practice, Microsoft always recommends constrained delegation over unconstrained delegation.</span></span> <span data-ttu-id="ce705-118">A delegação irrestrita é um grande risco de segurança, pois permite que a identidade do serviço represente outro usuário em *qualquer* computador, serviço ou aplicativo downstream (em vez de apenas os serviços definidos explicitamente por meio da delegação restrita).</span><span class="sxs-lookup"><span data-stu-id="ce705-118">Unconstrained delegation is a major security risk because it allows the service identity to impersonate another user on *any* downstream computer, service, or application (as opposed to just those services explicitly defined via constrained delegation).</span></span>  
  
##  <a name="allow-analysis-services-to-impersonate-a-user-identity"></a><a name="bkmk_impersonate"></a><span data-ttu-id="ce705-119">Permitir que Analysis Services represente uma identidade de usuário</span><span class="sxs-lookup"><span data-stu-id="ce705-119">Allow Analysis Services to impersonate a user identity</span></span>  
 <span data-ttu-id="ce705-120">Para permitir que os serviços de nível superior, como o Reporting Services, o IIS ou o SharePoint, representem uma identidade de usuário no Analysis Services, você deve configurar a delegação restrita de Kerberos para esses serviços.</span><span class="sxs-lookup"><span data-stu-id="ce705-120">To allow up-level services such as Reporting Services, IIS, or SharePoint to impersonate a user identity on Analysis Services, you must configure Kerberos constrained delegation for those services.</span></span> <span data-ttu-id="ce705-121">Nesse cenário, o Analysis Services representa o usuário atual que usa a identidade fornecida pelo serviço de delegação, retornando resultados com base na associação de função dessa identidade de usuário.</span><span class="sxs-lookup"><span data-stu-id="ce705-121">In this scenario, Analysis Services impersonates the current user using the identity provided by the delegating service, returning results based on role membership of that user identity.</span></span>  
  
|<span data-ttu-id="ce705-122">Tarefa</span><span class="sxs-lookup"><span data-stu-id="ce705-122">Task</span></span>|<span data-ttu-id="ce705-123">Descrição</span><span class="sxs-lookup"><span data-stu-id="ce705-123">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="ce705-124">Etapa 1: verificar se as contas são adequadas para delegação</span><span class="sxs-lookup"><span data-stu-id="ce705-124">Step 1: Verify that accounts are suitable for delegation</span></span>|<span data-ttu-id="ce705-125">Verifique se as contas usadas para executar os serviços têm as propriedades corretas no Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ce705-125">Ensure that the accounts used to run the services have the correct properties in Active Directory.</span></span> <span data-ttu-id="ce705-126">As contas de serviço do Active Directory não devem ser marcadas como contas confidenciais nem serem especificamente excluídas dos cenários de delegação.</span><span class="sxs-lookup"><span data-stu-id="ce705-126">Service accounts in Active Directory must not be marked as sensitive accounts, or specifically excluded from delegation scenarios.</span></span> <span data-ttu-id="ce705-127">Para obter mais informações, consulte [Noções básicas sobre contas de usuário](https://go.microsoft.com/fwlink/?LinkId=235818).</span><span class="sxs-lookup"><span data-stu-id="ce705-127">For more information, see [Understanding User Accounts](https://go.microsoft.com/fwlink/?LinkId=235818).</span></span><br /><br /> <span data-ttu-id="ce705-128">Importante geralmente, todas as contas e os servidores devem pertencer ao mesmo domínio Active Directory ou a domínios confiáveis na mesma floresta. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="ce705-128">**\*\* Important \*\*** Generally, all accounts and servers must belong to the same Active Directory domain or to trusted domains in the same forest.</span></span> <span data-ttu-id="ce705-129">No entanto, como o Windows Server 2012 dá suporte à delegação além dos limites do domínio, você poderá configurar a delegação restrita do Kerberos além do limite de um domínio se o nível funcional do domínio for Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="ce705-129">However, because Windows Server 2012 supports delegation across domain boundaries, you can configure Kerberos constrained delegation across a domain boundary if the domain functional level is Windows Server 2012.</span></span> <span data-ttu-id="ce705-130">Outra opção é configurar o Analysis Services para acesso HTTP e usar os métodos de autenticação do IIS na conexão do cliente.</span><span class="sxs-lookup"><span data-stu-id="ce705-130">Another alternative is to configure Analysis Services for HTTP access and use IIS authentication methods on the client connection.</span></span> <span data-ttu-id="ce705-131">Para obter mais informações, consulte [Configurar o acesso HTTP ao Analysis Services no IIS &#40;(Serviços de Informações da Internet)&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span><span class="sxs-lookup"><span data-stu-id="ce705-131">For more information, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>|  
|<span data-ttu-id="ce705-132">Etapa 2: registrar o SPN</span><span class="sxs-lookup"><span data-stu-id="ce705-132">Step 2: Register the SPN</span></span>|<span data-ttu-id="ce705-133">Antes de configurar a delegação restrita, você deve registrar um SPN (Nome da Entidade de Serviço) para a instância do Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="ce705-133">Before setting up constrained delegation, you must register a Service Principle Name (SPN) for the Analysis Services instance.</span></span> <span data-ttu-id="ce705-134">Você precisará do SPN do Analysis Services ao configurar a delegação restrita do Kerberos para serviços de camada intermediária.</span><span class="sxs-lookup"><span data-stu-id="ce705-134">You will need the Analysis Services SPN when configuring Kerberos constrained delegation for middle tier services.</span></span> <span data-ttu-id="ce705-135">Consulte [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) para obter instruções.</span><span class="sxs-lookup"><span data-stu-id="ce705-135">See [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) for instructions.</span></span><br /><br /> <span data-ttu-id="ce705-136">Um nome de entidade de serviço (SPN) especifica a identidade exclusiva de um serviço em um domínio configurado para autenticação Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ce705-136">A Service Principle Name (SPN) specifies the unique identity of a service in a domain configured for Kerberos authentication.</span></span> <span data-ttu-id="ce705-137">As conexões de cliente que usam a segurança integrada requerem geralmente um SPN como parte da autenticação SSPI.</span><span class="sxs-lookup"><span data-stu-id="ce705-137">Client connections using integrated security often request an SPN as part of SSPI authentication.</span></span> <span data-ttu-id="ce705-138">A solicitação é encaminhada para um controlador de domínio do Active Directory, com o KDC concedendo um tíquete se o SPN apresentado pelo cliente tiver um registro SPN correspondente no Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ce705-138">The request is forwarded to an Active Directory Domain Controller (DC), with the KDC granting a ticket if the SPN presented by the client has a matching SPN registration in Active Directory.</span></span>|  
|<span data-ttu-id="ce705-139">Etapa 3: configurar a delegação restrita</span><span class="sxs-lookup"><span data-stu-id="ce705-139">Step 3: Configure constrained delegation</span></span>|<span data-ttu-id="ce705-140">Após a validação das contas que você deseja usar e do registro de SPNs para essas contas, a próxima etapa será configurar os serviços de nível superior, como o IIS, o Reporting Services ou os serviços Web do SharePoint para a delegação restrita, especificando o SPN do Analysis Services como o serviço específico para o qual a delegação é permitida.</span><span class="sxs-lookup"><span data-stu-id="ce705-140">After validating the accounts you want to use and registering SPNs for those accounts, your next step is to configure up-level services, such as IIS, Reporting Services, or SharePoint web services for constrained delegation, specifying the Analysis Services SPN as the specific service for which delegation is allowed.</span></span><br /><br /> <span data-ttu-id="ce705-141">Os serviços executados no SharePoint, como os Serviços do Excel ou o Reporting Services no modo do SharePoint, geralmente hospedam pastas de trabalho e relatórios que consomem dados multidimensionais ou de tabela do Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="ce705-141">Services that run in SharePoint, such as Excel Services or Reporting Services in SharePoint mode, often host workbooks and reports that consume Analysis Services multidimensional or tabular data.</span></span> <span data-ttu-id="ce705-142">Configurar a delegação restrita para esses serviços é uma tarefa de configuração comum, necessária para dar suporte à atualização de dados dos Serviços do Excel.</span><span class="sxs-lookup"><span data-stu-id="ce705-142">Configuring constrained delegation for these services is a common configuration task, and necessary for supporting data refresh from Excel Services.</span></span> <span data-ttu-id="ce705-143">Os links a seguir oferecem instruções para serviços do SharePoint, além de outros serviços que provavelmente apresentem uma solicitação de conexão de dados downstream para dados do Analysis Services:</span><span class="sxs-lookup"><span data-stu-id="ce705-143">The following links provide instructions for SharePoint services, as well as other services likely to present a downstream data connection request for Analysis Services data:</span></span><br /><br /> <span data-ttu-id="ce705-144">[Delegação de identidade para Serviços do Excel (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) ou [Como configurar os Serviços do Excel no SharePoint Server 2010 para autenticação Kerberos](https://support.microsoft.com/kb/2466519)</span><span class="sxs-lookup"><span data-stu-id="ce705-144">[Identity delegation for Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) or [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span></span><br /><br /> [<span data-ttu-id="ce705-145">Delegação de identidade para Serviços PerformancePoint (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="ce705-145">Identity delegation for PerformancePoint Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299827)<br /><br /> [<span data-ttu-id="ce705-146">Delegação de identidade para SQL Server Reporting Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="ce705-146">Identity delegation for SQL Server Reporting Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299828)<br /><br /> <span data-ttu-id="ce705-147">Para o IIS 7.0, consulte [Configurar a autenticação do Windows (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) ou [Como configurar o SQL Server 2008 Analysis Services e o SQL Server 2005 Analysis Services para usar a autenticação Kerberos](https://support.microsoft.com/kb/917409).</span><span class="sxs-lookup"><span data-stu-id="ce705-147">For IIS 7.0 see [Configure Windows Authentication (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) or [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>|  
|<span data-ttu-id="ce705-148">Etapa 4: testar conexões</span><span class="sxs-lookup"><span data-stu-id="ce705-148">Step 4: Test connections</span></span>|<span data-ttu-id="ce705-149">Ao testar, conecte-se de computadores remotos, em identidades diferentes, e consulte o Analysis Services usando os mesmos aplicativos que usuários empresariais.</span><span class="sxs-lookup"><span data-stu-id="ce705-149">When testing, connect from remote computers, under different identities, and query Analysis Services using the same applications as business users.</span></span> <span data-ttu-id="ce705-150">Você pode usar o SQL Server Profiler para monitorar a conexão.</span><span class="sxs-lookup"><span data-stu-id="ce705-150">You can use SQL Server Profiler to monitor the connection.</span></span> <span data-ttu-id="ce705-151">Você verá a identidade do usuário na solicitação.</span><span class="sxs-lookup"><span data-stu-id="ce705-151">You should see the user identity on the request.</span></span> <span data-ttu-id="ce705-152">Para obter mais informações, consulte [Testar a identidade representada ou delegada](#bkmk_test) nesta seção.</span><span class="sxs-lookup"><span data-stu-id="ce705-152">For more information, see [Test for impersonated or delegated identity](#bkmk_test) in this section.</span></span>|  
  
##  <a name="configure-analysis-services-for-trusted-delegation"></a><a name="bkmk_delegate"></a><span data-ttu-id="ce705-153">Configurar Analysis Services para delegação confiável</span><span class="sxs-lookup"><span data-stu-id="ce705-153">Configure Analysis Services for trusted delegation</span></span>  
 <span data-ttu-id="ce705-154">A configuração do Analysis Services para delegação restrita de Kerberos permite que o serviço represente uma identidade de cliente em um serviço de nível inferior, como o mecanismo de banco de dados relacional, de modo que os dados possam ser consultados como se o cliente tivesse sido conectado diretamente.</span><span class="sxs-lookup"><span data-stu-id="ce705-154">Configuring Analysis Services for Kerberos constrained delegation allows the service to impersonate a client identity on a down-level service, such as the relational database engine, so that data can be queried as if the client was connected directly.</span></span>  
  
 <span data-ttu-id="ce705-155">Os cenários de delegação do Analysis Services limitam-se a modelos de tabela configurados para o modo `DirectQuery`.</span><span class="sxs-lookup"><span data-stu-id="ce705-155">Delegation scenarios for Analysis Services are limited to tabular models configured for `DirectQuery` mode.</span></span> <span data-ttu-id="ce705-156">Esse é o único cenário em que o Analysis Services pode transmitir credenciais delegadas para outro serviço.</span><span class="sxs-lookup"><span data-stu-id="ce705-156">This is the only scenario in which Analysis Services can pass delegated credentials to another service.</span></span> <span data-ttu-id="ce705-157">Em todos os outros cenários, como os cenários do SharePoint mencionados na seção anterior, o Analysis Services está na extremidade de recebimento da cadeia de delegação.</span><span class="sxs-lookup"><span data-stu-id="ce705-157">In all other scenarios, such as SharePoint scenarios mentioned in the previous section, Analysis Services is on the receiving end of the delegation chain.</span></span> <span data-ttu-id="ce705-158">Para obter mais informações sobre o DirectQuery, consulte [Modo DirectQuery &#40;SSAS de Tabela&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span><span class="sxs-lookup"><span data-stu-id="ce705-158">For more information about DirectQuery, see [DirectQuery Mode &#40;SSAS Tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ce705-159">Um equívoco comum é o de que o armazenamento ROLAP, operações de processamento ou o acesso a partições remotas de alguma forma cria requisitos para a delegação restrita.</span><span class="sxs-lookup"><span data-stu-id="ce705-159">A common misconception is that ROLAP storage, processing operations, or access to remote partitions somehow introduce requirements for constrained delegation.</span></span> <span data-ttu-id="ce705-160">Esse não é o caso.</span><span class="sxs-lookup"><span data-stu-id="ce705-160">This is not the case.</span></span> <span data-ttu-id="ce705-161">Todas essas operações são executadas diretamente pela conta de serviço (também conhecida como a conta de processamento), em seu próprio nome.</span><span class="sxs-lookup"><span data-stu-id="ce705-161">All of these operations are executed directly by the service account (also referred to as the processing account), on its own behalf.</span></span> <span data-ttu-id="ce705-162">A delegação não é obrigatória para essas operações no Analysis Services, pois as permissões para elas são concedidas diretamente para a conta de serviço (por exemplo, concedendo permissões db_datareader no banco de dados relacional para que o serviço possa processar os dados).</span><span class="sxs-lookup"><span data-stu-id="ce705-162">Delegation is not required for these operations in Analysis Services, given that permissions for such operations are granted directly to the service account (for example, granting db_datareader permissions on the relational database so that the service can process data).</span></span> <span data-ttu-id="ce705-163">Para obter mais informações sobre operações do servidor e permissões, consulte [Configurar contas de serviço &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span><span class="sxs-lookup"><span data-stu-id="ce705-163">For more information about server operations and permissions, see [Configure Service Accounts &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span></span>  
  
 <span data-ttu-id="ce705-164">Esta seção explica como configurar o Analysis Services para delegação confiável.</span><span class="sxs-lookup"><span data-stu-id="ce705-164">This section explains how to set up Analysis Services for trusted delegation.</span></span> <span data-ttu-id="ce705-165">Ao concluir essa tarefa, o Analysis Services poderá passar credenciais delegadas para o SQL Server, em suporte ao modo DirectQuery usado em soluções de tabelas.</span><span class="sxs-lookup"><span data-stu-id="ce705-165">After you complete this task, Analysis Services will be able to pass delegated credentials to SQL Server, in support of DirectQuery mode used in Tabular solutions.</span></span>  
  
 <span data-ttu-id="ce705-166">Antes de começar:</span><span class="sxs-lookup"><span data-stu-id="ce705-166">Before you start:</span></span>  
  
-   <span data-ttu-id="ce705-167">Verifique se o Analysis Services foi iniciado.</span><span class="sxs-lookup"><span data-stu-id="ce705-167">Verify that Analysis Services is started.</span></span>  
  
-   <span data-ttu-id="ce705-168">Verifique se o SPN registrado para o Analysis Services é válido.</span><span class="sxs-lookup"><span data-stu-id="ce705-168">Verify the SPN registered for Analysis Services is valid.</span></span> <span data-ttu-id="ce705-169">Para obter instruções, consulte [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md).</span><span class="sxs-lookup"><span data-stu-id="ce705-169">For instructions, see [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span></span>  
  
 <span data-ttu-id="ce705-170">Quando esse dois pré-requisitos forem atendidos, continue com as etapas a seguir.</span><span class="sxs-lookup"><span data-stu-id="ce705-170">When both prerequisites are satisfied, continue with the following steps.</span></span> <span data-ttu-id="ce705-171">Observe que você deve ser um administrador de domínio para configurar a delegação restrita.</span><span class="sxs-lookup"><span data-stu-id="ce705-171">Note that you must be a domain administrator to set up constrained delegation.</span></span>  
  
1.  <span data-ttu-id="ce705-172">Em Usuários e Computadores de Active Directory, localize a conta de serviço na qual o Analysis Services é executado.</span><span class="sxs-lookup"><span data-stu-id="ce705-172">In Active Directory Users and Computers, find the service account under which Analysis Services runs.</span></span> <span data-ttu-id="ce705-173">Clique com o botão direito do mouse na conta de serviço e escolha **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="ce705-173">Right-click the service account and choose **Properties**.</span></span>  
  
     <span data-ttu-id="ce705-174">Para fins ilustrativos, as seguintes captura de tela usam OlapSvc e SQLSvc para representar o Analysis Services e o SQL Server, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="ce705-174">For illustrative purposes, the following screenshots use OlapSvc and SQLSvc to represent Analysis Services and SQL Server, respectively.</span></span>  
  
     <span data-ttu-id="ce705-175">OlapSvc é a conta que será configurada para a delegação restrita ao SQLSvc.</span><span class="sxs-lookup"><span data-stu-id="ce705-175">OlapSvc is the account that will be configured for constrained delegation to SQLSvc.</span></span> <span data-ttu-id="ce705-176">Quando você concluir essa tarefa, o OlapSvc terá permissão para passar credenciais delegadas em um tíquete de serviço para o SQLSvc, representando o chamador original ao solicitar dados.</span><span class="sxs-lookup"><span data-stu-id="ce705-176">When you complete this task, OlapSvc will have permission to pass delegated credentials on a service ticket to SQLSvc, impersonating the original caller when requesting data.</span></span>  
  
2.  <span data-ttu-id="ce705-177">Na guia delegação, selecione **Confiar neste usuário para delegação apenas aos serviços especificados**, seguido por **Usar apenas Kerberos**.</span><span class="sxs-lookup"><span data-stu-id="ce705-177">On the Delegation tab, select **Trust this user for delegation to specified services only**, followed by **Use Kerberos only**.</span></span> <span data-ttu-id="ce705-178">Clique em **Adicionar** para especificar qual serviço do Analysis Services tem permissão para delegar credenciais.</span><span class="sxs-lookup"><span data-stu-id="ce705-178">Click **Add** to specify which service Analysis Services is permitted to delegate credentials.</span></span>  
  
     <span data-ttu-id="ce705-179">A guia delegação só aparece quando a conta de usuário (OlapSvc) é atribuída a um serviço (Analysis Services) e o serviço tem um SPN registrado para ele.</span><span class="sxs-lookup"><span data-stu-id="ce705-179">Delegation tab appears only when the user account (OlapSvc) is assigned to a service (Analysis Services), and the service has an SPN registered for it.</span></span> <span data-ttu-id="ce705-180">O registro de SPN requer que o serviço esteja em execução.</span><span class="sxs-lookup"><span data-stu-id="ce705-180">SPN registration requires that the service is running.</span></span>  
  
     <span data-ttu-id="ce705-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span><span class="sxs-lookup"><span data-stu-id="ce705-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span></span>  
  
3.  <span data-ttu-id="ce705-182">Na página Adicionar Serviços, clique em **Usuários ou Computadores**.</span><span class="sxs-lookup"><span data-stu-id="ce705-182">On the Add Services page, click **Users or Computers**.</span></span>  
  
     <span data-ttu-id="ce705-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span><span class="sxs-lookup"><span data-stu-id="ce705-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span></span>  
  
4.  <span data-ttu-id="ce705-184">Na página Selecionar Usuários ou Computador, insira a conta usada para executar a instância do SQL Server que fornece dados aos bancos de dados modelo de tabela do Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="ce705-184">On the Select Users or Computer page, enter the account used to run the SQL Server instance providing data to Analysis Services tabular model databases.</span></span> <span data-ttu-id="ce705-185">Clique em **OK** para aceitar a conta de serviço.</span><span class="sxs-lookup"><span data-stu-id="ce705-185">Click **OK** to accept the service account.</span></span>  
  
     <span data-ttu-id="ce705-186">Se você não puder selecionar a conta desejada, verifique se o SQL Server está em execução e tem um SPN registrado para essa conta.</span><span class="sxs-lookup"><span data-stu-id="ce705-186">If you cannot select the account you want, verify that SQL Server is running and has an SPN registered for that account.</span></span> <span data-ttu-id="ce705-187">Para obter mais informações sobre os SPNs do mecanismo de banco de dados, consulte [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="ce705-187">For more information about SPNs for the database engine, see [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
     <span data-ttu-id="ce705-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span><span class="sxs-lookup"><span data-stu-id="ce705-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span></span>  
  
5.  <span data-ttu-id="ce705-189">Agora, a instância do SQL Server deve aparecer em Adicionar Serviços.</span><span class="sxs-lookup"><span data-stu-id="ce705-189">The SQL Server instance should now appear in Add Services.</span></span> <span data-ttu-id="ce705-190">Qualquer serviço que também esteja usando essa conta também aparecerá na lista.</span><span class="sxs-lookup"><span data-stu-id="ce705-190">Any service also using that account will also appear in the list.</span></span> <span data-ttu-id="ce705-191">Escolha a instância do SQL Server que você deseja usar.</span><span class="sxs-lookup"><span data-stu-id="ce705-191">Choose the SQL Server instance you want to use.</span></span> <span data-ttu-id="ce705-192">Clique em **OK** para aceitar a instância.</span><span class="sxs-lookup"><span data-stu-id="ce705-192">Click **OK** to accept the instance.</span></span>  
  
     <span data-ttu-id="ce705-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span><span class="sxs-lookup"><span data-stu-id="ce705-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span></span>  
  
6.  <span data-ttu-id="ce705-194">Agora, a página de propriedades da conta de serviço do Analysis Services deve ser semelhante à captura de tela a seguir.</span><span class="sxs-lookup"><span data-stu-id="ce705-194">The properties page of the Analysis Services service account should now look similar to the following screenshot.</span></span> <span data-ttu-id="ce705-195">Clique em **OK** para salvar suas alterações.</span><span class="sxs-lookup"><span data-stu-id="ce705-195">Click **OK** to save your changes.</span></span>  
  
     <span data-ttu-id="ce705-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span><span class="sxs-lookup"><span data-stu-id="ce705-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span></span>  
  
7.  <span data-ttu-id="ce705-197">Verifique se a delegação foi feita com êxito conectando-se a partir de um computador cliente remoto, em uma identidade diferente, e consulte o modelo de tabela.</span><span class="sxs-lookup"><span data-stu-id="ce705-197">Test for successful delegation by connecting from a remote client computer, under a different identity, and query the tabular model.</span></span> <span data-ttu-id="ce705-198">Você verá a identidade do usuário na solicitação no SQL Server Profiler.</span><span class="sxs-lookup"><span data-stu-id="ce705-198">You should see the user identity on the request in SQL Server Profiler.</span></span>  
  
##  <a name="test-for-impersonated-or-delegated-identity"></a><a name="bkmk_test"></a><span data-ttu-id="ce705-199">Testar a identidade representada ou delegada</span><span class="sxs-lookup"><span data-stu-id="ce705-199">Test for impersonated or delegated identity</span></span>  
 <span data-ttu-id="ce705-200">Use o SQL Server Profiler para monitorar a identidade do usuário que está consultando dados.</span><span class="sxs-lookup"><span data-stu-id="ce705-200">Use SQL Server Profiler to monitor the identity of the user who is querying data.</span></span>  
  
1.  <span data-ttu-id="ce705-201">Inicie o **SQL Server Profiler** na instância do Analysis Services e, em seguida, inicie um novo rastreamento.</span><span class="sxs-lookup"><span data-stu-id="ce705-201">Start **SQL Server Profiler** on the Analysis Services instance and then start a new trace.</span></span>  
  
2.  <span data-ttu-id="ce705-202">Em Seleção de Eventos, verifique se `Audit Login` e `Audit Logout` foram verificados na seção Auditoria de Segurança.</span><span class="sxs-lookup"><span data-stu-id="ce705-202">In Events Selection, verify that `Audit Login` and `Audit Logout` are checked in the Security Audit section.</span></span>  
  
3.  <span data-ttu-id="ce705-203">Conecte-se ao Analysis Services por meio de um serviço de aplicativo (como o SharePoint ou o Reporting Services) em um computador cliente remoto.</span><span class="sxs-lookup"><span data-stu-id="ce705-203">Connect to Analysis Services via an application service (such as SharePoint or Reporting Services) from a remote client computer.</span></span> <span data-ttu-id="ce705-204">O evento Logon da Auditoria mostrará a identidade do usuário que está se conectando ao Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="ce705-204">The Audit Login event will show the identity of the user connecting to Analysis Services.</span></span>  
  
 <span data-ttu-id="ce705-205">Os testes completos requerem o uso de ferramentas de monitoramento de rede que podem capturar solicitações e respostas de Kerberos na rede.</span><span class="sxs-lookup"><span data-stu-id="ce705-205">Thorough testing will require the use of network monitoring tools that can capture Kerberos requests and responses on the network.</span></span> <span data-ttu-id="ce705-206">O utilitário Monitor de Rede (netmon.exe), filtrado para Kerberos, pode ser usado nessa tarefa.</span><span class="sxs-lookup"><span data-stu-id="ce705-206">The Network Monitor utility (netmon.exe), filtered for Kerberos, can be used for this task.</span></span> <span data-ttu-id="ce705-207">Para obter mais informações sobre como usar o Netmon 3.4 e outras ferramentas para testar a autenticação do Kerberos, consulte [Como configurar a autenticação Kerberos: configuração principal (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span><span class="sxs-lookup"><span data-stu-id="ce705-207">For more information about using Netmon 3.4 and other tools for testing Kerberos authentication, see [Configuring Kerberos authentication: Core configuration (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span></span>  
  
 <span data-ttu-id="ce705-208">Além disso, consulte [A caixa de diálogo mais confusa no Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) para obter uma descrição completa de cada opção na guia Delegação da caixa de diálogo de propriedades do objeto do Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ce705-208">Additionally, see [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) for a thorough description of each option in the Delegation tab of the Active Directory object's property dialog box.</span></span> <span data-ttu-id="ce705-209">Este artigo também explica como usar o LDP para testar e interpretar os resultados dos testes.</span><span class="sxs-lookup"><span data-stu-id="ce705-209">This article also explains how to use LDP to test and interpret test results.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ce705-210">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="ce705-210">See Also</span></span>  
 <span data-ttu-id="ce705-211">[Autenticação do Microsoft BI e delegação de identidade](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="ce705-211">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="ce705-212">[Autenticação mútua usando Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="ce705-212">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="ce705-213">[Conectar-se ao Analysis Services](connect-to-analysis-services.md) </span><span class="sxs-lookup"><span data-stu-id="ce705-213">[Connect to Analysis Services](connect-to-analysis-services.md) </span></span>  
 <span data-ttu-id="ce705-214">[Registro de SPN para uma instância de Analysis Services](spn-registration-for-an-analysis-services-instance.md) </span><span class="sxs-lookup"><span data-stu-id="ce705-214">[SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) </span></span>  
 [<span data-ttu-id="ce705-215">Propriedades de cadeia de conexão &#40;Analysis Services&#41;</span><span class="sxs-lookup"><span data-stu-id="ce705-215">Connection String Properties &#40;Analysis Services&#41;</span></span>](connection-string-properties-analysis-services.md)  
  
  
