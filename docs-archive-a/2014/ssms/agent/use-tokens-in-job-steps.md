---
title: Usar tokens em etapas de trabalho | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- security [SQL Server Agent], enabling alert job step tokens
- SQL Server Agent jobs, job steps
- tokens [SQL Server]
- escape macros [SQL Server Agent]
ms.assetid: 105bbb66-0ade-4b46-b8e4-f849e5fc4d43
author: stevestein
ms.author: sstein
ms.openlocfilehash: 9d90b6660dd4b65e4e1d9b832b39ffaa275c83bc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87686011"
---
# <a name="use-tokens-in-job-steps"></a><span data-ttu-id="162fe-102">Usar tokens em etapas de trabalho</span><span class="sxs-lookup"><span data-stu-id="162fe-102">Use Tokens in Job Steps</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="162fe-103">O Agent permite usar tokens em scripts de etapas de trabalho [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="162fe-103">Agent allows you to use tokens in [!INCLUDE[tsql](../../includes/tsql-md.md)] job step scripts.</span></span> <span data-ttu-id="162fe-104">O uso de tokens para escrever suas etapas de trabalho oferece a mesma flexibilidade fornecida por variáveis ao escrever programas de software.</span><span class="sxs-lookup"><span data-stu-id="162fe-104">Using tokens when you write your job steps gives you the same flexibility that variables provide when you write software programs.</span></span> <span data-ttu-id="162fe-105">Quando você insere um token em um script de etapa de trabalho, o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent o substitui em tempo de execução, antes de o trabalho ser executado pelo subsistema [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="162fe-105">After you insert a token in a job step script, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces the token at run time, before the job step is executed by the [!INCLUDE[tsql](../../includes/tsql-md.md)] subsystem.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="162fe-106">A partir do [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, a sintaxe de token de etapa de trabalho do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent mudou.</span><span class="sxs-lookup"><span data-stu-id="162fe-106">Starting with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step token syntax changed.</span></span> <span data-ttu-id="162fe-107">Por consequência, uma macro de fuga agora deve acompanhar todos os tokens utilizados em etapas de trabalho ou elas falharão.</span><span class="sxs-lookup"><span data-stu-id="162fe-107">As a result, an escape macro must now accompany all tokens used in job steps, or else those job steps will fail.</span></span> <span data-ttu-id="162fe-108">O uso de macros de escape e a atualização das etapas de trabalho do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent que utilizam tokens são descritos nas seções "Compreendendo o uso de tokens", "Tokens e macros do[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent" e "Atualizando etapas de trabalho para usar macros" a seguir.</span><span class="sxs-lookup"><span data-stu-id="162fe-108">Using escape macros and updating your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job steps that use tokens are described in the following sections, "Understanding Using Tokens," "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Tokens and Macros," and "Updating Job Steps to Use Macros."</span></span> <span data-ttu-id="162fe-109">Além disso, a sintaxe do [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] , que usava colchetes para chamar tokens de etapa de trabalho do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent (por exemplo, "`[DATE]`"), também mudou.</span><span class="sxs-lookup"><span data-stu-id="162fe-109">In addition, the [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] syntax, which used square brackets to call out [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step tokens (for example, "`[DATE]`") has also changed.</span></span> <span data-ttu-id="162fe-110">Agora, deve-se colocar os nomes de token entre parênteses e um sinal de cifrão (`$`) no início da sintaxe do token.</span><span class="sxs-lookup"><span data-stu-id="162fe-110">You must now enclose token names in parentheses and place a dollar sign (`$`) at the beginning of the token syntax.</span></span> <span data-ttu-id="162fe-111">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="162fe-111">For example:</span></span>  
>   
>  <span data-ttu-id="162fe-112">`$(ESCAPE_` *nome da macro* `(DATE))`</span><span class="sxs-lookup"><span data-stu-id="162fe-112">`$(ESCAPE_` *macro name* `(DATE))`</span></span>  
  
## <a name="understanding-using-tokens"></a><span data-ttu-id="162fe-113">Noções básicas sobre o uso de tokens</span><span class="sxs-lookup"><span data-stu-id="162fe-113">Understanding Using Tokens</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="162fe-114">Qualquer usuário Windows com permissões de gravação no Log de Eventos do Windows pode acessar etapas de trabalho ativadas pelos alertas do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent ou alertas do WMI.</span><span class="sxs-lookup"><span data-stu-id="162fe-114">Any Windows user with write permissions on the Windows Event Log can access job steps that are activated by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent alerts or WMI alerts.</span></span> <span data-ttu-id="162fe-115">Para evitar riscos de segurança, os tokens do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent que podem ser usados em trabalhos ativados por alertas encontram-se desabilitados por padrão.</span><span class="sxs-lookup"><span data-stu-id="162fe-115">To avoid this security risk, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent tokens that can be used in jobs activated by alerts are disabled by default.</span></span> <span data-ttu-id="162fe-116">Esses tokens são: **a-DBN**, **a-SVR**, **a-Err**, **a-Sev**, **a-msg**. e **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="162fe-116">These tokens are: **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**., and **WMI(*`property`*)**.</span></span> <span data-ttu-id="162fe-117">Observe que nesta versão, o uso de tokens foi estendido a todos os alertas.</span><span class="sxs-lookup"><span data-stu-id="162fe-117">Note that in this release, use of tokens is extended to all alerting.</span></span>  
>   
>  <span data-ttu-id="162fe-118">Se tiver que usar esses tokens, garanta, primeiro, que apenas membros dos grupos de segurança confiáveis do Windows, como o grupo Administradores, tenham permissões de gravação no Log de Eventos do computador em que reside o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="162fe-118">If you need to use these tokens, first ensure that only members of trusted Windows security groups, such as the Administrators group, have write permissions on the Event Log of the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resides.</span></span> <span data-ttu-id="162fe-119">Depois, clique com o botão direito do mouse em **SQL Server Agent** no Pesquisador de Objetos, selecione **Propriedades**e, na página **Sistema de Alerta** , selecione **Substituir tokens de todas as respostas de trabalho aos alertas** para habilitar esses tokens.</span><span class="sxs-lookup"><span data-stu-id="162fe-119">Then, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select **Replace tokens for all job responses to alerts** to enable these tokens.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="162fe-120">A substituição de tokens do Agent é simples e eficiente: o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent substitui o token por um valor de cadeia de caracteres literal.</span><span class="sxs-lookup"><span data-stu-id="162fe-120">Agent token replacement is simple and efficient: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces an exact literal string value for the token.</span></span> <span data-ttu-id="162fe-121">Todos os tokens diferenciam maiúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="162fe-121">All tokens are case-sensitive.</span></span> <span data-ttu-id="162fe-122">Suas etapas de trabalho devem levar isto em conta e usar aspas corretamente nos tokens utilizados ou converter a cadeia de caracteres de substituição pelo tipo de dados correto.</span><span class="sxs-lookup"><span data-stu-id="162fe-122">Your job steps must take this into account and correctly quote the tokens you use or convert the replacement string to the correct data type.</span></span>  
  
 <span data-ttu-id="162fe-123">Por exemplo, você pode usar a seguinte instrução para imprimir o nome do banco de dados em uma etapa de trabalho:</span><span class="sxs-lookup"><span data-stu-id="162fe-123">For example, you might use the following statement to print the name of the database in a job step:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
 <span data-ttu-id="162fe-124">Neste exemplo, a macro **ESCAPE_SQUOTE** é inserida com o token **A-DBN** .</span><span class="sxs-lookup"><span data-stu-id="162fe-124">In this example, the **ESCAPE_SQUOTE** macro is inserted with the **A-DBN** token.</span></span> <span data-ttu-id="162fe-125">Em tempo de execução, o token **A-DBN** será substituído pelo nome de banco de dados apropriado.</span><span class="sxs-lookup"><span data-stu-id="162fe-125">At run time, the **A-DBN** token will be replaced with the appropriate database name.</span></span> <span data-ttu-id="162fe-126">A macro de fuga ignora eventuais aspas simples que possam ser transmitidas inadvertidamente na cadeia de caracteres de substituição do token.</span><span class="sxs-lookup"><span data-stu-id="162fe-126">The escape macro escapes any single quotation marks that may be inadvertently passed in the token replacement string.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="162fe-127">O Agent substituirá uma aspa simples por duas aspas simples na cadeia de caracteres final.</span><span class="sxs-lookup"><span data-stu-id="162fe-127">Agent will replace one single quotation mark with two single quotation marks in the final string.</span></span>  
  
 <span data-ttu-id="162fe-128">Por exemplo, se a cadeia de caracteres transmitida para substituição do token for `AdventureWorks2012'SELECT @@VERSION --`, o comando executado pela etapa de trabalho do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent será:</span><span class="sxs-lookup"><span data-stu-id="162fe-128">For example, if the string passed to replace the token is `AdventureWorks2012'SELECT @@VERSION --`, the command executed by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step will be:</span></span>  
  
 `PRINT N'Current database name is AdventureWorks2012''SELECT @@VERSION --' ;`  
  
 <span data-ttu-id="162fe-129">Neste caso, a instrução inserida `SELECT @@VERSION`não é executada.</span><span class="sxs-lookup"><span data-stu-id="162fe-129">In this case, the inserted statement, `SELECT @@VERSION`, does not execute.</span></span> <span data-ttu-id="162fe-130">Em vez disso, a aspa simples adicional faz com que o servidor analise a instrução inserida como uma cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="162fe-130">Instead, the extra single quotation mark causes the server to parse the inserted statement as a string.</span></span> <span data-ttu-id="162fe-131">Se a cadeia de caracteres de substituição do token não contiver uma aspa simples, nenhum caractere será ignorado e a etapa de trabalho que contém o token será executada conforme se pretende.</span><span class="sxs-lookup"><span data-stu-id="162fe-131">If the token replacement string does not contain a single quotation mark, no characters are escaped and the job step containing the token executes as intended.</span></span>  
  
 <span data-ttu-id="162fe-132">Para depurar o uso de tokens em suas etapas de trabalho, use instruções de impressão, como `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` , e salve a saída das etapas de trabalho em um arquivo ou tabela.</span><span class="sxs-lookup"><span data-stu-id="162fe-132">To debug token usage in your job steps, use print statements such as `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` and save job step output to a file or table.</span></span> <span data-ttu-id="162fe-133">Use a página **Avançado** da caixa de diálogo **Propriedades da Etapa de Trabalho** para especificar um arquivo ou tabela de saída da etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-133">Use the **Advanced** page of the **Job Step Properties** dialog box to specify a job step output file or table.</span></span>  
  
## <a name="sql-server-agent-tokens-and-macros"></a><span data-ttu-id="162fe-134">Tokens e macros do SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="162fe-134">SQL Server Agent Tokens and Macros</span></span>  
 <span data-ttu-id="162fe-135">As tabelas a seguir listam e descrevem os tokens e macros para os quais há suporte no [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="162fe-135">The following tables list and describe the tokens and macros that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent supports.</span></span>  
  
### <a name="sql-server-agent-tokens"></a><span data-ttu-id="162fe-136">Tokens do SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="162fe-136">SQL Server Agent Tokens</span></span>  
  
|<span data-ttu-id="162fe-137">Token</span><span class="sxs-lookup"><span data-stu-id="162fe-137">Token</span></span>|<span data-ttu-id="162fe-138">Descrição</span><span class="sxs-lookup"><span data-stu-id="162fe-138">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="162fe-139">**(A-DBN)**</span><span class="sxs-lookup"><span data-stu-id="162fe-139">**(A-DBN)**</span></span>|<span data-ttu-id="162fe-140">nome do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="162fe-140">Database name.</span></span> <span data-ttu-id="162fe-141">Se o trabalho é executado por um alerta, o valor de nome de banco de dados substitui este token automaticamente na etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-141">If the job is run by an alert, the database name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="162fe-142">**(A-SVR)**</span><span class="sxs-lookup"><span data-stu-id="162fe-142">**(A-SVR)**</span></span>|<span data-ttu-id="162fe-143">Nome de servidor.</span><span class="sxs-lookup"><span data-stu-id="162fe-143">Server name.</span></span> <span data-ttu-id="162fe-144">Se o trabalho é executado por um alerta, o valor de nome de servidor substitui este token automaticamente na etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-144">If the job is run by an alert, the server name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="162fe-145">**(A-ERR)**</span><span class="sxs-lookup"><span data-stu-id="162fe-145">**(A-ERR)**</span></span>|<span data-ttu-id="162fe-146">Número de erro.</span><span class="sxs-lookup"><span data-stu-id="162fe-146">Error number.</span></span> <span data-ttu-id="162fe-147">Se o trabalho é executado por um alerta, o valor de número de erro substitui este token automaticamente na etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-147">If the job is run by an alert, the error number value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="162fe-148">**(A-SEV)**</span><span class="sxs-lookup"><span data-stu-id="162fe-148">**(A-SEV)**</span></span>|<span data-ttu-id="162fe-149">Severidade do erro.</span><span class="sxs-lookup"><span data-stu-id="162fe-149">Error severity.</span></span> <span data-ttu-id="162fe-150">Se o trabalho é executado por um alerta, o valor de severidade do erro substitui este token automaticamente na etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-150">If the job is run by an alert, the error severity value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="162fe-151">**(A-MSG)**</span><span class="sxs-lookup"><span data-stu-id="162fe-151">**(A-MSG)**</span></span>|<span data-ttu-id="162fe-152">Texto de mensagem.</span><span class="sxs-lookup"><span data-stu-id="162fe-152">Message text.</span></span> <span data-ttu-id="162fe-153">Se o trabalho é executado por um alerta, o valor de texto de mensagem substitui este token automaticamente na etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-153">If the job is run by an alert, the message text value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="162fe-154">**Date**</span><span class="sxs-lookup"><span data-stu-id="162fe-154">**(DATE)**</span></span>|<span data-ttu-id="162fe-155">Data atual (em formato AAAAMMDD).</span><span class="sxs-lookup"><span data-stu-id="162fe-155">Current date (in YYYYMMDD format).</span></span>|  
|<span data-ttu-id="162fe-156">**Inst**</span><span class="sxs-lookup"><span data-stu-id="162fe-156">**(INST)**</span></span>|<span data-ttu-id="162fe-157">Nome da instância.</span><span class="sxs-lookup"><span data-stu-id="162fe-157">Instance name.</span></span> <span data-ttu-id="162fe-158">Para uma instância padrão, este token terá o nome da instância padrão: MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="162fe-158">For a default instance, this token will have the default instance name: MSSQLSERVER.</span></span>|  
|<span data-ttu-id="162fe-159">**JobID**</span><span class="sxs-lookup"><span data-stu-id="162fe-159">**(JOBID)**</span></span>|<span data-ttu-id="162fe-160">ID do trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-160">Job ID.</span></span>|  
|<span data-ttu-id="162fe-161">**(MACH)**</span><span class="sxs-lookup"><span data-stu-id="162fe-161">**(MACH)**</span></span>|<span data-ttu-id="162fe-162">Nome do computador.</span><span class="sxs-lookup"><span data-stu-id="162fe-162">Computer name.</span></span>|  
|<span data-ttu-id="162fe-163">**(MSSA)**</span><span class="sxs-lookup"><span data-stu-id="162fe-163">**(MSSA)**</span></span>|<span data-ttu-id="162fe-164">Nome do serviço do SQLServerAgent mestre.</span><span class="sxs-lookup"><span data-stu-id="162fe-164">Master SQLServerAgent service name.</span></span>|  
|<span data-ttu-id="162fe-165">**(OSCMD)**</span><span class="sxs-lookup"><span data-stu-id="162fe-165">**(OSCMD)**</span></span>|<span data-ttu-id="162fe-166">Prefixo do programa usado para executar etapas de trabalho do **CmdExec** .</span><span class="sxs-lookup"><span data-stu-id="162fe-166">Prefix for the program used to run **CmdExec** job steps.</span></span>|  
|<span data-ttu-id="162fe-167">**(SQLDIR)**</span><span class="sxs-lookup"><span data-stu-id="162fe-167">**(SQLDIR)**</span></span>|<span data-ttu-id="162fe-168">O diretório no qual o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] está instalado.</span><span class="sxs-lookup"><span data-stu-id="162fe-168">The directory in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="162fe-169">Por padrão, este valor é C:\Arquivos de Programas\Microsoft SQL Server\MSSQL.</span><span class="sxs-lookup"><span data-stu-id="162fe-169">By default, this value is C:\Program Files\Microsoft SQL Server\MSSQL.</span></span>|  
|<span data-ttu-id="162fe-170">**(SQLLOGDIR)**</span><span class="sxs-lookup"><span data-stu-id="162fe-170">**(SQLLOGDIR)**</span></span>|<span data-ttu-id="162fe-171">Token de substituição para o caminho da pasta de log de erros do SQL Server – por exemplo, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span><span class="sxs-lookup"><span data-stu-id="162fe-171">Replacement token for the SQL Server error log folder path - for example, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span></span>|  
|<span data-ttu-id="162fe-172">**(STEPCT)**</span><span class="sxs-lookup"><span data-stu-id="162fe-172">**(STEPCT)**</span></span>|<span data-ttu-id="162fe-173">Contagem do número de vezes que a etapa foi executada (excluídas novas tentativas).</span><span class="sxs-lookup"><span data-stu-id="162fe-173">A count of the number of times this step has executed (excluding retries).</span></span> <span data-ttu-id="162fe-174">Pode ser usado pelo comando de etapa para forçar terminação de um loop com várias etapas.</span><span class="sxs-lookup"><span data-stu-id="162fe-174">Can be used by the step command to force termination of a multistep loop.</span></span>|  
|<span data-ttu-id="162fe-175">**(STEPID)**</span><span class="sxs-lookup"><span data-stu-id="162fe-175">**(STEPID)**</span></span>|<span data-ttu-id="162fe-176">ID da etapa.</span><span class="sxs-lookup"><span data-stu-id="162fe-176">Step ID.</span></span>|  
|<span data-ttu-id="162fe-177">**(SRVR)**</span><span class="sxs-lookup"><span data-stu-id="162fe-177">**(SRVR)**</span></span>|<span data-ttu-id="162fe-178">Nome do computador que executa o [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="162fe-178">Name of the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="162fe-179">Se a instância do [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] for uma instância nomeada, incluirá o nome da instância.</span><span class="sxs-lookup"><span data-stu-id="162fe-179">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance is a named instance, this includes the instance name.</span></span>|  
|<span data-ttu-id="162fe-180">**MOMENTO**</span><span class="sxs-lookup"><span data-stu-id="162fe-180">**(TIME)**</span></span>|<span data-ttu-id="162fe-181">Hora atual (em formato HHMMSS).</span><span class="sxs-lookup"><span data-stu-id="162fe-181">Current time (in HHMMSS format).</span></span>|  
|<span data-ttu-id="162fe-182">**(STRTTM)**</span><span class="sxs-lookup"><span data-stu-id="162fe-182">**(STRTTM)**</span></span>|<span data-ttu-id="162fe-183">A hora (em formato HHMMSS) em que o trabalho começou a ser executado.</span><span class="sxs-lookup"><span data-stu-id="162fe-183">The time (in HHMMSS format) that the job began executing.</span></span>|  
|<span data-ttu-id="162fe-184">**(STRTDT)**</span><span class="sxs-lookup"><span data-stu-id="162fe-184">**(STRTDT)**</span></span>|<span data-ttu-id="162fe-185">A data (em formato AAAAMMDD) em que o trabalho começou a ser executado.</span><span class="sxs-lookup"><span data-stu-id="162fe-185">The date (in YYYYMMDD format) that the job began executing.</span></span>|  
|<span data-ttu-id="162fe-186">**(WMI (** *propriedade* **))**</span><span class="sxs-lookup"><span data-stu-id="162fe-186">**(WMI(** *property* **))**</span></span>|<span data-ttu-id="162fe-187">Em trabalhos executados em resposta a alertas do WMI, o valor da propriedade especificado por *propriedade*.</span><span class="sxs-lookup"><span data-stu-id="162fe-187">For jobs that run in response to WMI alerts, the value of the property specified by *property*.</span></span> <span data-ttu-id="162fe-188">Por exemplo, `$(WMI(DatabaseName))` fornece o valor da propriedade **DatabaseName** do evento WMI que provocou a execução do alerta.</span><span class="sxs-lookup"><span data-stu-id="162fe-188">For example, `$(WMI(DatabaseName))` provides the value of the **DatabaseName** property for the WMI event that caused the alert to run.</span></span>|  
  
### <a name="sql-server-agent-escape-macros"></a><span data-ttu-id="162fe-189">Macros de fuga do SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="162fe-189">SQL Server Agent Escape Macros</span></span>  
  
|<span data-ttu-id="162fe-190">Macros de fuga</span><span class="sxs-lookup"><span data-stu-id="162fe-190">Escape Macros</span></span>|<span data-ttu-id="162fe-191">Descrição</span><span class="sxs-lookup"><span data-stu-id="162fe-191">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="162fe-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="162fe-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="162fe-193">Ignora aspas simples (') na cadeia de caracteres de substituição do token.</span><span class="sxs-lookup"><span data-stu-id="162fe-193">Escapes single quotation marks (') in the token replacement string.</span></span> <span data-ttu-id="162fe-194">Substitui um aspa simples por duas aspas simples.</span><span class="sxs-lookup"><span data-stu-id="162fe-194">Replaces one single quotation mark with two single quotation marks.</span></span>|  
|<span data-ttu-id="162fe-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="162fe-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="162fe-196">Ignora aspas duplas (") na cadeia de caracteres de substituição do token.</span><span class="sxs-lookup"><span data-stu-id="162fe-196">Escapes double quotation marks (") in the token replacement string.</span></span> <span data-ttu-id="162fe-197">Substitui um aspa dupla por duas aspas duplas.</span><span class="sxs-lookup"><span data-stu-id="162fe-197">Replaces one double quotation mark with two double quotation marks.</span></span>|  
|<span data-ttu-id="162fe-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="162fe-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span></span>|<span data-ttu-id="162fe-199">Ignora colchetes de fechamento (]) na cadeia de caracteres de substituição do token.</span><span class="sxs-lookup"><span data-stu-id="162fe-199">Escapes right brackets (]) in the token replacement string.</span></span> <span data-ttu-id="162fe-200">Substitui um colchete de fechamento por dois colchetes de fechamento.</span><span class="sxs-lookup"><span data-stu-id="162fe-200">Replaces one right bracket with two right brackets.</span></span>|  
|<span data-ttu-id="162fe-201">**$(ESCAPE_NONE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="162fe-201">**$(ESCAPE_NONE(** *token_name* **))**</span></span>|<span data-ttu-id="162fe-202">Substitui o token sem ignorar nenhum caractere da cadeia.</span><span class="sxs-lookup"><span data-stu-id="162fe-202">Replaces token without escaping any characters in the string.</span></span> <span data-ttu-id="162fe-203">Esta macro é fornecida para dar suporte a compatibilidade retroativa em ambientes nos quais cadeias de caracteres de substituição de tokens são esperadas apenas de usuários confiáveis.</span><span class="sxs-lookup"><span data-stu-id="162fe-203">This macro is provided to support backward compatibility in environments where token replacement strings are only expected from trusted users.</span></span> <span data-ttu-id="162fe-204">Para obter mais informações, consulte "Atualizando etapas de trabalho para usar macros", mais adiante, neste tópico.</span><span class="sxs-lookup"><span data-stu-id="162fe-204">For more information, see "Updating Job Steps to Use Macros," later in this topic.</span></span>|  
  
## <a name="updating-job-steps-to-use-macros"></a><span data-ttu-id="162fe-205">Atualizando etapas de trabalho para usar macros</span><span class="sxs-lookup"><span data-stu-id="162fe-205">Updating Job Steps to Use Macros</span></span>  
 <span data-ttu-id="162fe-206">A partir do [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, as etapas de trabalho que contêm tokens sem macros de fuga passaram a falhar e a retornar uma mensagem de erro indicando que a etapa contém um ou mais tokens que devem ser atualizados com uma macro para que o trabalho possa ser executado.</span><span class="sxs-lookup"><span data-stu-id="162fe-206">Beginning with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, job steps that contain tokens without escape macros will fail and return an error message indicating the job step contains one or more tokens that must be updated with a macro before the job can run.</span></span>  
  
 <span data-ttu-id="162fe-207">Um script é fornecido com o artigo 915845 da Base de Dados de Conhecimento da [!INCLUDE[msCoName](../../includes/msconame-md.md)] : [Etapas de trabalho do SQL Server Agent que usam tokens falham no SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845). Você pode usar esse script para atualizar todas as suas etapas de trabalho que usam tokens com a macro **ESCAPE_NONE** .</span><span class="sxs-lookup"><span data-stu-id="162fe-207">A script is provided with [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base article 915845: [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845).You can use this script to update all of your job steps that use tokens with the **ESCAPE_NONE** macro.</span></span> <span data-ttu-id="162fe-208">Após usar o script, recomendamos que você examine as etapas de trabalho que usam tokens o mais rápido possível e substitua a macro **ESCAPE_NONE** por uma macro de fuga apropriada ao contexto da etapa de trabalho.</span><span class="sxs-lookup"><span data-stu-id="162fe-208">After using this script, we recommend that you review your job steps that use tokens as soon as possible, and replace the **ESCAPE_NONE** macro with an escape macro that is appropriate for the job step context.</span></span>  
  
 <span data-ttu-id="162fe-209">A tabela a seguir descreve como a substituição de tokens é manipulada pelo [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="162fe-209">The following table describes how token replacement is handled by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="162fe-210">Para ativar ou desativar a substituição do token de alerta, clique com o botão direito do mouse em **SQL Server Agent** no Pesquisador de Objetos, selecione **Propriedades**e, na página **Sistema de Alerta** , marque ou desmarque a caixa de seleção **Substituir tokens de todas as respostas de trabalho aos alertas** .</span><span class="sxs-lookup"><span data-stu-id="162fe-210">To turn alert token replacement on or off, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select or clear the **Replace tokens for all job responses to alerts** check box.</span></span>  
  
|<span data-ttu-id="162fe-211">Sintaxe do token</span><span class="sxs-lookup"><span data-stu-id="162fe-211">Token syntax</span></span>|<span data-ttu-id="162fe-212">Substituição do token de alerta ativada</span><span class="sxs-lookup"><span data-stu-id="162fe-212">Alert token replacement on</span></span>|<span data-ttu-id="162fe-213">Substituição do token de alerta desativada</span><span class="sxs-lookup"><span data-stu-id="162fe-213">Alert token replacement off</span></span>|  
|------------------|--------------------------------|---------------------------------|  
|<span data-ttu-id="162fe-214">Macro ESCAPE usada</span><span class="sxs-lookup"><span data-stu-id="162fe-214">ESCAPE macro used</span></span>|<span data-ttu-id="162fe-215">Todos os tokens em trabalhos são substituídos com êxito.</span><span class="sxs-lookup"><span data-stu-id="162fe-215">All tokens in jobs are successfully replaced.</span></span>|<span data-ttu-id="162fe-216">Não são substituídos tokens ativados por alertas.</span><span class="sxs-lookup"><span data-stu-id="162fe-216">Tokens activated by alerts are not replaced.</span></span> <span data-ttu-id="162fe-217">Esses tokens **são a-DBN**, **a-SVR**, **a-Err**, **a-Sev**, **a-msg**e **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="162fe-217">These tokens are **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**, and **WMI(*`property`*)**.</span></span> <span data-ttu-id="162fe-218">Outros tokens estáticos são substituídos com êxito.</span><span class="sxs-lookup"><span data-stu-id="162fe-218">Other static tokens are replaced successfully.</span></span>|  
|<span data-ttu-id="162fe-219">Nenhuma macro ESCAPE usada</span><span class="sxs-lookup"><span data-stu-id="162fe-219">No ESCAPE macro used</span></span>|<span data-ttu-id="162fe-220">Todo trabalho contendo tokens falha.</span><span class="sxs-lookup"><span data-stu-id="162fe-220">Any jobs containing tokens fail.</span></span>|<span data-ttu-id="162fe-221">Todo trabalho contendo tokens falha.</span><span class="sxs-lookup"><span data-stu-id="162fe-221">Any jobs containing tokens fail.</span></span>|  
  
## <a name="token-syntax-update-examples"></a><span data-ttu-id="162fe-222">Exemplos de atualização de sintaxe de token</span><span class="sxs-lookup"><span data-stu-id="162fe-222">Token Syntax Update Examples</span></span>  
  
### <a name="a-using-tokens-in-non-nested-strings"></a><span data-ttu-id="162fe-223">a.</span><span class="sxs-lookup"><span data-stu-id="162fe-223">A.</span></span> <span data-ttu-id="162fe-224">Usando tokens em cadeias de caracteres não aninhadas</span><span class="sxs-lookup"><span data-stu-id="162fe-224">Using tokens in non-nested strings</span></span>  
 <span data-ttu-id="162fe-225">O exemplo a seguir mostra como atualizar um script não aninhado simples com a macro de fuga apropriada.</span><span class="sxs-lookup"><span data-stu-id="162fe-225">The following example shows how to update a simple non-nested script with the appropriate escape macro.</span></span> <span data-ttu-id="162fe-226">Antes de executar o script de atualização, o seguinte script de etapa de trabalho usa um token para imprimir o nome do banco de dados apropriado:</span><span class="sxs-lookup"><span data-stu-id="162fe-226">Before running the update script, the following job step script uses a job step token to print the appropriate database name:</span></span>  
  
 `PRINT N'Current database name is $(A-DBN)' ;`  
  
 <span data-ttu-id="162fe-227">Executado o script de atualização, uma macro `ESCAPE_NONE` é inserida antes do token `A-DBN` .</span><span class="sxs-lookup"><span data-stu-id="162fe-227">After running the update script, an `ESCAPE_NONE` macro is inserted before the `A-DBN` token.</span></span> <span data-ttu-id="162fe-228">Como são usadas aspas simples para delimitar a cadeia de caracteres de impressão, é necessário atualizar a etapa de trabalho, inserindo a macro `ESCAPE_SQUOTE` da seguinte maneira:</span><span class="sxs-lookup"><span data-stu-id="162fe-228">Because single quotation marks are used to delimit the print string, you must update the job step by inserting the `ESCAPE_SQUOTE` macro as follows:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
### <a name="b-using-tokens-in-nested-strings"></a><span data-ttu-id="162fe-229">B.</span><span class="sxs-lookup"><span data-stu-id="162fe-229">B.</span></span> <span data-ttu-id="162fe-230">Usando tokens em cadeias de caracteres aninhadas</span><span class="sxs-lookup"><span data-stu-id="162fe-230">Using tokens in nested strings</span></span>  
 <span data-ttu-id="162fe-231">Em scripts de etapa de trabalho em que são usados tokens em cadeias de caracteres ou instruções aninhadas, estas devem ser rescritas como várias instruções para que possam ser inseridas as macros de fuga apropriadas.</span><span class="sxs-lookup"><span data-stu-id="162fe-231">In job step scripts where tokens are used in nested strings or statements, the nested statements should be rewritten as multiple statements before inserting the appropriate escape macros.</span></span>  
  
 <span data-ttu-id="162fe-232">Por exemplo, considere a seguinte etapa de trabalho, que usa o token `A-MSG` e não foi atualizada com uma macro de fuga:</span><span class="sxs-lookup"><span data-stu-id="162fe-232">For example, consider the following job step, which uses the `A-MSG` token and has not been updated with an escape macro:</span></span>  
  
 `PRINT N'Print ''$(A-MSG)''' ;`  
  
 <span data-ttu-id="162fe-233">Executado o script de atualização, uma macro `ESCAPE_NONE` é inserida com o token.</span><span class="sxs-lookup"><span data-stu-id="162fe-233">After running the update script, an `ESCAPE_NONE` macro is inserted with the token.</span></span> <span data-ttu-id="162fe-234">Contudo, neste caso, você teria que rescrever o script sem usar aninhamento, como segue, e inserir a macro `ESCAPE_SQUOTE` para ignorar adequadamente delimitadores que pudessem ser transmitidos na cadeia de caracteres de substituição do token:</span><span class="sxs-lookup"><span data-stu-id="162fe-234">However, in this case, you would have to rewrite the script without using nesting as follows and insert the `ESCAPE_SQUOTE` macro to properly escape delimiters that may be passed in the token replacement string:</span></span>  
  
 `DECLARE @msgString nvarchar(max)`  
  
 `SET @msgString = '$(ESCAPE_SQUOTE(A-MSG))'`  
  
 `SET @msgString = QUOTENAME(@msgString,'''')`  
  
 `PRINT N'Print ' + @msgString ;`  
  
 <span data-ttu-id="162fe-235">Note ainda, neste exemplo, que a função QUOTENAME define o caractere aspas.</span><span class="sxs-lookup"><span data-stu-id="162fe-235">Note also in this example that the QUOTENAME function sets the quote character.</span></span>  
  
### <a name="c-using-tokens-with-the-escape_none-macro"></a><span data-ttu-id="162fe-236">C.</span><span class="sxs-lookup"><span data-stu-id="162fe-236">C.</span></span> <span data-ttu-id="162fe-237">Usando tokens com a macro ESCAPE_NONE</span><span class="sxs-lookup"><span data-stu-id="162fe-237">Using tokens with the ESCAPE_NONE macro</span></span>  
 <span data-ttu-id="162fe-238">O exemplo a seguir é parte de um script que recupera o `job_id` da tabela `sysjobs` e usa o token `JOBID` para popular a variável `@JobID` , declarada anteriormente no script como tipo de dados binário.</span><span class="sxs-lookup"><span data-stu-id="162fe-238">The following example is part of a script that retrieves the `job_id` from the `sysjobs` table and uses the `JOBID` token to populate the `@JobID` variable, which was declared earlier in the script as a binary data type.</span></span> <span data-ttu-id="162fe-239">Note que, como não são necessários delimitadores para tipos de dados binários, a macro `ESCAPE_NONE` é usada com o token `JOBID` .</span><span class="sxs-lookup"><span data-stu-id="162fe-239">Note that because no delimiters are required for binary data types, the `ESCAPE_NONE` macro is used with the `JOBID` token.</span></span> <span data-ttu-id="162fe-240">Você não precisaria atualizar esta etapa de trabalho após executar o script de atualização.</span><span class="sxs-lookup"><span data-stu-id="162fe-240">You would not need to update this job step after running the update script.</span></span>  
  
 `SELECT * FROM msdb.dbo.sysjobs`  
  
 `WHERE @JobID = CONVERT(uniqueidentifier, $(ESCAPE_NONE(JOBID))) ;`  
  
## <a name="see-also"></a><span data-ttu-id="162fe-241">Consulte Também</span><span class="sxs-lookup"><span data-stu-id="162fe-241">See Also</span></span>  
 <span data-ttu-id="162fe-242">[Implementar trabalhos](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="162fe-242">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="162fe-243">Gerenciar etapas de trabalho</span><span class="sxs-lookup"><span data-stu-id="162fe-243">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
